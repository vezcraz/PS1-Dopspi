function linkify(e,t,s,i,o,n){return e=e.replace(/((http|https|ftp)\:\/\/|\bw{3}\.)[a-z0-9\-\.]+\.[a-z]{2,3}(:[a-z0-9]*)?\/?([a-z\u00C0-\u017F0-9\-\._\?\,\'\/\\\+&amp;%\$#\=~])*/gi,function(e){var t;if(o)for(var i=0;i<o.length;i++)if(0<e.indexOf("."+o[i]))return e;if(0==e.toLowerCase().indexOf("www.")){if(!s)return e;t="http://"+e}else t=e;return n&&0!=t.toLowerCase().indexOf("http")?e:0<=t.toLowerCase().indexOf("localhost")?e:'<a href="'+(t="/go?to="+encodeURIComponent(t))+'" target="_blank">'+e+"</a>"}),t&&(e=e.replace(/\B#(\w+)/g,"<a href="+t("$1")+' target="'+i+'">#$1</a>')),e}function postForm(e,t,i,s){i=i||"post",s=s||"_self";var o=document.createElement("form");for(var n in o.setAttribute("method",i),o.setAttribute("action",e),o.setAttribute("target",s),t)if(t.hasOwnProperty(n)){var a=document.createElement("input");a.setAttribute("type","hidden"),a.setAttribute("name",n),a.setAttribute("value",t[n]),o.appendChild(a)}document.body.appendChild(o),o.submit()}C("hwh"),C.hwh.FBconnectView=C.View.extend({objName:"C.hwh.FBconnectView",tmpl:_.template('<div class="facebook-connect"></div>'),events:{"click .facebook-connect":"onClickFacebookConnect"},render:function(){return this.$el.html(this.tmpl()),this},destroy:function(){this.remove()},onClickFacebookConnect:function(){var e=0<this.$el.closest(".freemium").length?"freemium":"answerer";C.logger.doSessionLog({csclkfb:1}),C.facebook.queue($.proxy(function(){this.activateFacebookConnect(e)},this))},logAction:function(e){var t={action:e};C.logger.doSessionLog(t)},activateFacebookConnect:function(i){var e=this;$(".msg-error-sm",".obfuscated").remove(),FB.login(function(e){e.authResponse?(C.Events.trigger("C.hwh.fbConnect:login",!1),$.ajax({type:"POST",url:"/_ajax/fbconnect/",dataType:"JSON",data:{token:C.global.csrfToken,fbuid:e.authResponse.userID,initial:1,fbauth:e.authResponse.accessToken},success:function(e){var t=e&&e.errors?e.errors:"There was a problem with Facebook. Please try again.";e&&"success"==e.status?C.Events.trigger("C.hwh.fbConnect:success",{productName:i,userName:e.userName}):C.Events.trigger("C.hwh.fbConnect:error",t)},error:function(e){var t=e&&e.errors?e.errors:"There was a problem with Facebook. Please try again.";C.Events.trigger("C.hwh.fbConnect:error",t)}})):C.Events.trigger("C.hwh.fbConnect:login",!0)},{scope:"email"})}}),C("widget"),C.widget.schoolChanger=C.widget._base.extend({construct:function(e){this.opts=$.extend({callback:function(e){window.location.reload()}},e),this.opts.el=e.el.jQuery?e.el:$(e.el),this.doBind()},doBind:function(){this.opts.el.find(".school-detail").observe("click",this.editSchool,this),this.opts.el.find(".school-close").observe("click",this.closeSchool,this),this.addWidget(new C.widget.autoComplete({el:this.opts.el.find(".school-edit input"),type:"schools",schoolChangeCallback:$.proxy(this.chooseSchool,this)}))},editSchool:function(e){$(".school-detail").hide(),$(".school-edit").show(),e.stopPropagation()},closeSchool:function(e){$(".school-edit").hide(),$(".school-detail").show(),e.stopPropagation()},chooseSchool:function(e,t){var i=t.attr("data-schoolid");$.ajax({url:"/_ajax/user/profile/update",type:"post",data:{gid:i,token:C.global.csrfToken},context:this,complete:function(){this.opts.callback()}})},destruct:function(){}}),C("widget"),C.widget.termSelector=C.widget._base.extend({construct:function(e){this.opts=$.extend({callback:function(e,t){}},e),this.opts.el=e.el.jQuery?e.el:$(e.el),this.doBind()},doBind:function(){this.opts.el.chosen().observe("change",function(e){$(e.currentTarget).trigger("liszt:updated");var t=$(e.currentTarget).val().split("/"),i=t[0],s=t[1],o=C.utility.getCookie("gid");C.utility.setCookie(o+"_term",i),C.utility.setCookie(o+"_year",s),this.opts.callback(i,s)},this)},destruct:function(){}}),C("widget"),C.widget.freemiumUser=C.widget._base.extend({construct:function(e){this.opts=e||{},$(".msg-error-sm",".obfuscated").remove(),C.Events.on("C.hwh.fbConnect:success",function(e){e.productName&&"freemium"==e.productName&&(C.utility.showSpinner(),top.location.reload())},this),C.Events.on("C.hwh.fbConnect:error",function(e){$(".fbconnect-container").closest(".dialog").append('<div class="msg-error-sm"><div class="msg-icon"><div class="msg-text">'+e+"</div></div></div>")},this),this.schoolAutocomplete=new C.widget.autoComplete({el:$(".freemium-school"),type:"schools",refreshAfterSchoolChange:!1,schoolChangeCallback:$.proxy(this.submitSchool,this),schoolChangeSuccessCallback:$.proxy(this.schoolSuccess,this)}),this.$courseAutocomplete=new C.widget.hwhCourseAutoComplete({el:$(".freemium-course"),successCallback:$.proxy(this.courseSuccess,this)}),this.addWidget(this.$courseAutocomplete),$(".view-freemium-solution").observe("click",function(e){C.logger.doSessionLog({csviewclick:1})},this),$(".freemium-school").attr("disabled")?$(".freemium-course").focus():$(".freemium-school").focus(),$(".freemium-join-link").observe("click",function(e){C.logger.doSessionLog({csfbpaynow:1})},this),$(".freemium-signup-btn").observe("click",function(e){C.logger.doSessionLog({csclkfb:1})},this)},submitSchool:function(e,t){var i=t.attr("data-schoolid");this.schoolAutocomplete.submitUserSchool(i)},schoolSuccess:function(e){C.logger.doSessionLog({csscl:1}),$(".freemium-course").prop("disabled",!1),$(".freemium-course").focus()},courseSuccess:function(e){C.logger.doSessionLog({cssclcrs:1}),$(".view-freemium-solution").removeClass("disabled")},destruct:function(){}}),Eggshell.define("C.Eggshell.container",{inputs:["set headline","get headline area","set icon","set subheadline","get subheadline area","set content html","get content area","set container type","show","hide","show headline","hide headline","show icon","hide icon","show subheadline","hide subheadline","show content seperator","hide content seperator","show box border","hide box border","fill container"],outputs:["headline area","subheadline area","content area"]},C.View.extend({template:_.template('<div class="chg-component-container-inline small">\t<div class="chg-component-container-inline-headline">\t\t<span class="chg-component-container-inline-icon"></span>\t\t<h3 class="chg-component-container-inline-headline"></h3>\t</div>\t<p class="chg-component-container-inline-subheadline"></p>\t<div class="chg-component-container-inline-content"></div></div>'),initialize:function(){this.render(),this.registerListeners()},render:function(){this.$el.html(this.template()),this.$(".chg-component-container-inline-headline").hide(),this.$(".chg-component-container-inline-subheadline").hide(),this.$(".chg-component-container-inline-icon").hide()},registerListeners:function(){this.Eggshell.listen("set headline",function(e,t){if(!t&&"string"!=typeof t)throw"Invalid headline";this.$("h3.chg-component-container-inline-headline").html(t).attr("title",t),this.$(".chg-component-container-inline-headline").show()}),this.Eggshell.listen("get headline area",function(e,t){this.Eggshell.trigger("headline area",$.extend({},this.$("h3.chg-component-container-inline-headline")))}),this.Eggshell.listen("set icon",function(e,t){if(!t&&"string"!=typeof t)throw"Invalid icon";this.$(".chg-component-container-inline-icon").attr("class","icon").addClass(t).show()}),this.Eggshell.listen("set subheadline",function(e,t){if(!t&&"string"!=typeof t)throw"Invalid subheadline";this.$(".chg-component-container-inline-subheadline").html(t).attr("title",t).show()}),this.Eggshell.listen("get subheadline area",function(e,t){this.Eggshell.trigger("subheadline area",$.extend({},this.$(".chg-component-container-inline-subheadline")))}),this.Eggshell.listen("set content html",function(e,t){if(!t&&"string"!=typeof t)throw"Invalid html";this.$(".chg-component-container-inline-content").html(t)}),this.Eggshell.listen("get content area",function(e,t){this.Eggshell.trigger("content area",$.extend({},this.$(".chg-component-container-inline-content")))}),this.Eggshell.listen("set container type",function(e,t){if(!t||"string"!=typeof t||"inline small"!==t&&"inline large"!=t&&"rightrail"!=t)throw"Invalid container type";this.$(".chg-component-container-inline").removeClass("small").removeClass("large").removeClass("rightrail-inline"),"inline small"===t?this.$(".chg-component-container-inline").addClass("small"):"inline large"===t?this.$(".chg-component-container-inline").addClass("large"):"rightrail"===t&&this.$(".chg-component-container-inline").addClass("rightrail-inline")}),this.Eggshell.listen("show",function(){this.$el.show()}),this.Eggshell.listen("hide",function(){this.$el.hide()}),this.Eggshell.listen("show headline",function(){this.$(".chg-component-container-inline-headline").show()}),this.Eggshell.listen("hide headline",function(){this.$(".chg-component-container-inline-headline").hide()}),this.Eggshell.listen("show icon",function(){this.$(".chg-component-container-inline-icon").show()}),this.Eggshell.listen("hide icon",function(){this.$(".chg-component-container-inline-icon").hide()}),this.Eggshell.listen("show subheadline",function(){this.$(".chg-component-container-inline-subheadline").show()}),this.Eggshell.listen("hide subheadline",function(){this.$(".chg-component-container-inline-subheadline").hide()}),this.Eggshell.listen("show content seperator",function(){this.$(".chg-component-container-inline-content").addClass("seperator")}),this.Eggshell.listen("hide content seperator",function(){this.$(".chg-component-container-inline-content").removeClass("seperator")}),this.Eggshell.listen("show box border",function(){this.$(".chg-component-container-inline").addClass("border")}),this.Eggshell.listen("hide box border",function(){this.$(".chg-component-container-inline").removeClass("border")}),this.Eggshell.listen("fill container",function(){this.$(".chg-component-container-inline").addClass("filled")})}})),Eggshell.define("C.Eggshell.loading.inline",{inputs:["show","hide","fade in","fade out"],outputs:["faded in","faded out"]},Backbone.View.extend({initialize:function(){this.Eggshell.input("show",$.proxy(function(){this.$el.show()},this)),this.Eggshell.input("hide",$.proxy(function(){this.$el.hide()},this)),this.Eggshell.input("fade in",$.proxy(function(e,t){this.$el.fadeIn(300,$.proxy(function(){this.Eggshell.output("faded in",t)},this))},this)),this.Eggshell.input("fade out",$.proxy(function(e,t){this.$el.fadeOut(300,$.proxy(function(){this.Eggshell.output("faded out",t)},this))},this))},render:function(){return this.setupInputs(),$.el}})),C("widget.studysolution"),C.widget.studysolution.model=C.Model.extend({objName:"C.widget.studysolution.model",fetch:function(){$.ajax({url:"/_ajax/user/books",dataType:"json",type:"GET",timeout:15e3,data:{token:C.global.csrfToken},success:$.proxy(function(e){this.set(e,{silent:!0}),this.trigger("loaded")},this),error:$.proxy(function(){this.trigger("error")},this)})},parseSolutions:function(){var s=[],e=this.get("recentTbs"),o=this;return $.each(e,function(e,t){var i=this.item_type;i&&"recent_tbs_books"==i&&(solution={name:this.title,cover:this.details.imgSmall,solutionsUrl:this.solutionsUrl,author:this.details.authors[0],ean:this.details.ean,edition:this.details.editionNo,book_id:this.book_id},o.set("book_"+this.details.ean,solution),s.push(solution))}),s}}),function(e){var t;Eggshell.define("C.Eggshell.studysolution",e,(t=C.View.extend({objName:"C.widget.studysolution.view",events:{"click .view-all-result-wrapper":"viewAllQuestions","click .get-soln":"showTbsSearch","focus .chapter-dd":"onClickChapterDropdown","change .chapter-dd":"onChangeChapterDropdown","change .problem-dd":"onChangeProblemDropdown","click .icn-x":"onClickToClearInput","click .my-item-solution":"onClickOnBook"},initialize:function(e){var t=this;this.opts=$.extend({model:new C.widget.studysolution.model},e),this.solutionModel=this.opts.model,this.EggDialog=Eggshell.create("C.Eggshell.dialog",{el:this.$el}),this.EggDialog.trigger("show").trigger("set headline","Ask a study question").trigger("set icon","icn-type-speechbubble-sm").trigger("set icon size","small").trigger("hide control").trigger("set content html",this.getLayout()),this.EggDialogControl=Eggshell.create("C.Eggshell.dialog.control.standard",{el:this.$el.find(".control")}),this.EggDialogControl.trigger("hide primary button").trigger("set primary button","View").trigger("set secondary button","Back"),this.$primaryPage=this.$el.find(".primary-page"),this.$secondaryPage=this.$el.find(".secondary-page"),this.$input=this.$el.find(".studysolution-input-wrapper input"),this.$result=this.$el.find(".result-wrapper"),this.$askNew=this.$el.find(".ask-new-question-wrapper"),this.$viewAll=this.$el.find(".view-all-result-wrapper"),this.$bookList=this.$el.find(".book-list"),this.$tbs=this.$el.find(".studysolution-tbs-wrapper"),this.$tbsInput=this.$tbs.find("input"),this.$tbsBook=this.$el.find(".studysolution-tbs-book"),this.instantAnswers=new C.widget.autoComplete({el:this.$input,type:"instantanswers",topOffset:0,paramName:"question",dropdownOverride:".result-wrapper",overrideActiveClass:"hasContent",additionalGetParamsString:"instant_max=5",cssPositioning:"absolute"}),this.tbsAutoComplete=new C.widget.autoComplete({el:this.$tbsInput,type:"solutions",overrideSolutionsImage:!0,callback:$.proxy(this.onClickOnTbs,this)}),this.setBooks(),this.doBind()},doBind:function(){var i=this;this.$tbsInput.observe("keyup",function(e){this.solutionModel.set("tbsQuery",e.target.value)},this),this.$input.observe("keyup",function(e){this.solutionModel.set("query",e.target.value)},this),this.solutionModel.on("loaded",function(){i.setBooks(this.parseSolutions())}),this.solutionModel.on("change:tbsQuery",function(){i.$tbsInput.parent()[this.get("tbsQuery").length?"addClass":"removeClass"]("focused")}),this.solutionModel.on("change:query",function(){var e=this.get("query").length?"removeClass":"addClass",t=this.get("query").length?"addClass":"removeClass";i.$result[e]("hidden"),i.$askNew[e]("hidden").find(".new-question-query").text(this.get("query")).end().find("a").attr("href","/homework-help/ask?body="+encodeURIComponent(this.get("query"))),i.$viewAll[e]("hidden"),i.$bookList[t]("hidden"),i.$input.parent()[this.get("query").length?"addClass":"removeClass"]("focused")}),this.solutionModel.on("change:bookId",$.proxy(this.onSolutionClicked,this)),this.EggDialogControl.on("secondary button clicked",function(){i.$tbsInput.val(""),i.$input.val(""),i.$tbs.hasClass("hidden")?(i.$tbs.removeClass("hidden"),i.$tbsBook.addClass("hidden"),i.solutionModel.get("fromHome")&&(i.solutionModel.set("fromHome",!1),i.$primaryPage.removeClass("hidden"),i.$secondaryPage.addClass("hidden"),i.EggDialog.trigger("hide control"))):(i.$primaryPage.removeClass("hidden"),i.$secondaryPage.addClass("hidden"),i.EggDialog.trigger("hide control")),i.EggDialogControl.trigger("hide primary button")}),this.EggDialog.on("destroy",function(){i.instantAnswers.destroy(),i.tbsAutoComplete.destroy()}),this.EggDialogControl.on("primary button clicked",function(){C.utility.navigate(i.$tbsBookProblemDropdown.val())})},onClickOnBook:function(e){e.preventDefault(),e.stopPropagation();var t=$(e.currentTarget);this.solutionModel.set("edition",""),this.solutionModel.set("fromHome",!0),this.solutionModel.set("title",t.find(".title").text()),this.solutionModel.set("bookId",t.attr("data-book-id")),this.showTbsSearch(),this.onSolutionClicked(),this.EggDialogControl.trigger("hide primary button")},onClickToClearInput:function(){this.$input.val("").keyup(),this.$tbsInput.val("").keyup()},onSolutionClicked:function(){var e=_.template('<div class="clearfix"><div class="study-header"><div class="study-guidance">Chegg guided solutions for</div> <div class="study-title"><%-title%></div> <% if(edition){%> <div class="study-edition"><%-edition%></div><%}%></div><select class="select-sm chapter-dd"><option value="">Chapter</option></select><select class="select-sm problem-dd" disabled><option value="">Problem</option></select></div>');this.$tbs.addClass("hidden"),this.$tbsBook.html(e(this.solutionModel.toJSON())).removeClass("hidden")},onClickOnTbs:function(e){var t=$(e.target).closest("li"),i=t.find(".autocomplete-hdr").text(),s=t.find(".autocomplete-subtitle").text(),o=t.find("img").attr("src"),n=t.attr("data-book-id");this.solutionModel.set("title",i),this.solutionModel.set("edition",s),this.solutionModel.set("img",o),this.solutionModel.set("bookId",n)},onClickChapterDropdown:function(){var s=this;s.$tbsBookChapterDropdown=this.$el.find(".chapter-dd"),s.$tbsBookChapterDropdown.find("option").length<=1&&(s.$tbsBookChapterDropdown.html('<option value="">loading...</option>'),$.ajax({url:"/homework-help/ws/chapter/bookid/"+s.solutionModel.get("bookId"),dataType:"json",success:function(e){var t=0;if(0!=e.length){var i="";for(t=0;t<e.chapters.length;t++)t||(i+='<option value="">Chapter</option>'),i+='<option value="'+e.chapters[t].id+'">ch: '+e.chapters[t].name+"</option>";s.$tbsBookChapterDropdown.html(i)}}}))},onChangeChapterDropdown:function(){var s=this;this.EggDialogControl.trigger("hide primary button"),this.$tbsBookProblemDropdown=this.$el.find(".problem-dd"),this.$tbsBookProblemDropdown.attr("disabled","disabled"),s.$tbsBookChapterDropdown.val()&&(s.$tbsBookProblemDropdown.empty().html('<option value="">loading...</option>'),$.ajax({url:"/homework-help/ws/problem/chapter/"+s.$tbsBookChapterDropdown.val(),dataType:"json",success:function(e){var t="",i=0;if(e.problems||e.problems.length){for(i=0;i<e.problems.length;i++)i||(t+='<option value="">Problem</option>'),t+='<option value="'+e.problems[i].url+'">p: '+e.problems[i].name+"</option>";s.$tbsBookProblemDropdown.html(t),s.$tbsBookProblemDropdown.prop("disabled",!1)}}}))},onChangeProblemDropdown:function(){this.EggDialogControl.trigger("show primary button")},setBooks:function(){this.$bookList.prepend('<div class="book-list-label">Is your question from a textbook? <span class="get-soln f-color-12">Get step-by-step solutions.</span></div>')},getLayout:function(){return'<div class="primary-page"><div class="studysolution-input-wrapper"><div class="icn-x"></div><input data-prevent-autofocus="true" textvalue="Enter your question and get 24/7 study help from experts..." placeholder="Enter your question and get 24/7 study help from experts..." autocomplete="off" name="search" /></div><div class="result-wrapper hidden"></div><div class="ask-new-question-wrapper hidden"><a href=""><div class="ask-question-icn"></div><strong>Ask a new question:</strong> "<span class="new-question-query"></span>..."</a></div><div class="view-all-result-wrapper hidden">View all search results &raquo;</div><div class="book-list"></div></div><div class="secondary-page hidden"><div class="studysolution-tbs-wrapper"><div class="icn-x"></div><input data-prevent-autofocus="true" textvalue="Enter ISBN, title, or author of your book" placeholder="Enter ISBN, title, or author of your book" autocomplete="off" name="search_by" /></div><div class="studysolution-tbs-book hidden"></div></div>'},viewAllQuestions:function(){if(this.solutionModel.get("query")){var e=encodeURIComponent(this.solutionModel.get("query"));this.opts.glassSearchExp&&this.opts.glassSearchExp.search?C.utility.navigate("/search/"+e+"/questions-and-answers"):C.utility.navigate("/homework-help/search?filter=qa&search="+e)}},showTbsSearch:function(){Eggshell.create("C.common.tbspopup").trigger("show tbs popup in sidebar"),$("body").on("autocomplete:noResults",function(){$(".chg-util-autosuggest-form .chg-form-sm").trigger("focus")}),Eggshell.destroy(this)}}),C("widget.studysolution.view",t),t))}({inputs:[],outputs:[]}),Eggshell.define("C.Eggshell.studysolution.book",{inputs:["render"],outputs:["ready","enabled","error"]},function(){var e=C.Model.extend({url:"/_ajax/user/books",fetch:function(){$.cjax({url:this.url,dataType:"json",type:"GET",timeout:15e3,data:{token:C.global.csrfToken},success:$.proxy(function(e){null!=e?(this.set(e,{silent:!0}),this.trigger("loaded")):this.trigger("error")},this),error:$.proxy(function(){this.trigger("error")},this)})},parseSolutions:function(){var s=[],e=this.get("recentTbs"),t=this;return $.each(e,function(e,t){var i=this.item_type;i&&"recent_tbs_books"==i&&(solution={name:this.title,cover:this.details.imgSmall,solutionsUrl:this.solutionsUrl,author:this.details.authors[0],bookId:this.book_id},s.push(solution))}),s}}),t;return C.View.extend({model:new e,tmpl:_.template('<ul><% _.each(books, function(book, i) { %> <li><a data-book-id="<%= book.bookId %>" href="<%= book.solutionsUrl %>" class="my-item my-item-solution cover track-click-solutions"><% var letter = book.name; letter = letter.substring(0, 1); %><span class="solutionIcon"><%= letter %></span><span class="title"><%= book.name %></span><%= book.author %></a></li><% }) %></ul>'),initialize:function(e){this.model.bind("loaded",function(){this.render()},this),this.model.bind("error",function(){this.$el.hide(),this.Eggshell.trigger("error")},this),this.Eggshell.listen("render",function(e,t){try{this.model.fetch()}catch(e){this.Eggshell.trigger("error")}},this)},render:function(){this.$el.html(this.tmpl({books:this.model.parseSolutions()})).show(),this.Eggshell.trigger("ready")}})}()),C.resource.add("C.Eggshell.text.ellipses.more-link","Show more"),Eggshell.define("C.Eggshell.text.ellipsis",{inputs:["set text","set lines","get text","change more link copy","display more link","display more link with quotes","always display more link"],outputs:["original text","redrawn","read more clicked"]},C.View.extend({text:null,lines:1,textNodes:[],initialize:function(){this.moreText=C.resource.fetch("C.Eggshell.text.ellipses.more-link"),this.render(),this.registerListeners()},destroy:function(){if(this.textNodes)for(;this.textNodes.length;){var e=this.textNodes.pop();e.unwatch&&e.unwatch()}},render:function(e){if(this.text){var t=this.lines;this.$el.empty();var i=$("<div>").appendTo(this.$el);if(e){if(e&&"a.more-link"==e.after){var s="#";e.link&&(s=e.link);var o=this.text+' <a href="'+s+'" class="more-link">'+this.moreText+"</a>";i.html(o),t++}else if(e&&"span.last-element"==e.after){var s="#";e.link&&(s=e.link);var o='<span class="start-quote"></span> '+this.text+' <span class="last-element"><span class="end-quote"></span> <a href="'+s+'" class="more-link">'+this.moreText+"</a></span>";i.html(o),t++}}else i.html(this.text);var n=this.$el.css("line-height");n&&"0px"!=n||(n=this.$el.css("font-size"));var a=t*(n=parseInt(n)),r={height:1+a,watch:!0};e&&(r=$.extend(r,e));var l=r.callback;r.callback=$.proxy(function(){$.isFunction(l)&&l.apply(this,arguments),this.Eggshell.trigger("redrawn",arguments)},this),i.addClass("truncated-container"),i.dotdotdot(r),i.css({"line-height":n+"px","max-height":a+"px",overflow:"hidden"}),this.textNodes.push(i)}},registerListeners:function(){this.Eggshell.listen("set text",function(e,t){if(void 0!==t&&null!=t||(t=""),!t||"string"!=typeof t)throw"Invalid text";this.text=t,this.render()}),this.Eggshell.listen("set lines",function(e,t){if(!t||"number"!=typeof t)throw"Invalid lines";this.lines=t,this.render()}),this.Eggshell.listen("get text",function(e,t){this.Eggshell.trigger("original text",this.text)}),this.Eggshell.listen("display more link",function(e,t){this.opts={after:"a.more-link",callback:function(e,t){0==e&&this.$(".more-link").hide()}},this.options.alwaysDisplayMoreLink&&(this.opts.callback=function(){}),t&&"string"==typeof t&&(this.opts.link=t),this.render(this.opts)}),this.Eggshell.listen("display more link with quotes",function(e,t){this.opts={after:"span.last-element",callback:function(e,t){0==e&&this.$(".more-link").hide()}},this.options.alwaysDisplayMoreLink&&(this.opts.callback=function(){}),t&&"string"==typeof t&&(this.opts.link=t),this.render(this.opts)}),this.Eggshell.listen("change more link copy",function(e,t){if(!t||"string"!=typeof t)throw"Invald payload. needs to be string";this.moreText=t}),this.Eggshell.listen("always display more link",function(e,t){this.options.alwaysDisplayMoreLink=!0}),this.Eggshell.listen("destroy",this.destroy)},events:{"click .more-link":"triggerShowMore"},triggerShowMore:function(e){"#"==$(e.currentTarget).attr("href")&&(e.preventDefault(),e.stopPropagation(),this.$el.html(this.$("div").triggerHandler("originalContent")),this.$el.find(".more-link").hide()),this.Eggshell.trigger("read more clicked")}})),function(b,t){function d(e,t,i){var s=e.children(),o=!1;e.empty();for(var n=0,a=s.length;n<a;n++){var r=s.eq(n);if(e.append(r),i&&e.append(i),v(e,t)){r.remove(),o=!0;break}i&&i.detach()}return o}function g(e,t,i,s,o){var n=e.contents(),a=!1;e.empty();for(var r="table, thead, tbody, tfoot, tr, col, colgroup, object, embed, param, ol, ul, dl, blockquote, select, optgroup, option, textarea, script, style",l=0,c=n.length;l<c&&!a;l++){var d=n[l],h=b(d);void 0===d||3==d.nodeType&&0==b.trim(d.data).length||(e.append(h),o&&e[e.is(r)?"after":"append"](o),v(i,s)&&((a=3==d.nodeType?u(h,t,i,s,o):g(h,t,i,s,o))||(h.remove(),a=!0)),a||o&&o.detach())}return a}function u(e,t,i,s,o){var n=e[0];if(!n)return!1;for(var a=w(n),r=-1!==a.indexOf(" ")?" ":"　",l="letter"==s.wrap?"":r,c=a.split(l),d=-1,h=-1,g=0,u=c.length-1;g<=u&&(0!=g||0!=u);){var p=Math.floor((g+u)/2);if(p==h)break;h=p,y(n,c.slice(0,h+1).join(l)+s.ellipsis),v(i,s)?u=h:g=d=h,u==g&&0==u&&s.fallbackToLetter&&(l="",h=d=-1,u=(c=c[g=0].split(l)).length-1)}if(-1==d||1==c.length&&0==c[0].length){var m=e.parent();e.remove();var f=o&&o.closest(m).length?o.length:0;m.contents().length>f?n=k(m.contents().eq(-1-f),t):(n=k(m,t,!0),f||m.remove()),n&&(y(n,a=C(w(n),s)),f&&o&&b(n).parent().append(o))}else y(n,a=C(c.slice(0,d+1).join(l),s));return!0}function v(e,t){return e.innerHeight()>t.maxHeight}function C(e,t){for(;-1<b.inArray(e.slice(-1),t.lastCharacter.remove);)e=e.slice(0,-1);return b.inArray(e.slice(-1),t.lastCharacter.noEllipsis)<0&&(e+=t.ellipsis),e}function h(e){return{width:e.innerWidth(),height:e.innerHeight()}}function y(e,t){e.innerText?e.innerText=t:e.nodeValue?e.nodeValue=t:e.textContent&&(e.textContent=t)}function w(e){return e.innerText?e.innerText:e.nodeValue?e.nodeValue:e.textContent?e.textContent:""}function n(e){for(;(e=e.previousSibling)&&1!==e.nodeType&&3!==e.nodeType;);return e}function k(e,t,i){var s,o=e&&e[0];if(o){if(!i){if(3===o.nodeType)return o;if(b.trim(e.text()))return k(e.contents().last(),t)}for(s=n(o);!s;){if((e=e.parent()).is(t)||!e.length)return!1;s=n(e[0])}if(s)return k(b(s),t)}return!1}function i(e,t){return!!e&&("string"==typeof e?!!(e=b(e,t)).length&&e:!!e.jquery&&e)}function p(e){for(var t=e.innerHeight(),i=["paddingTop","paddingBottom"],s=0,o=i.length;s<o;s++){var n=parseInt(e.css(i[s]),10);isNaN(n)&&(n=0),t-=n}return t}function m(e,t){return e&&(t="string"==typeof t?"dotdotdot: "+t:["dotdotdot:",t],void 0!==window.console&&void 0!==window.console.log&&window.console.log(t)),!1}if(!b.fn.dotdotdot){b.fn.dotdotdot=function(e){if(0==this.length)return e&&!1===e.debug||m(!0,'No element found for "'+this.selector+'".'),this;if(1<this.length)return this.each(function(){b(this).dotdotdot(e)});var o=this;o.data("dotdotdot")&&o.trigger("destroy.dot"),o.data("dotdotdot-style",o.attr("style")),o.css("word-wrap","break-word"),"nowrap"===o.css("white-space")&&o.css("white-space","normal"),o.bind_events=function(){return o.on("update.dot",function(e,t){e.preventDefault(),e.stopPropagation(),a.maxHeight="number"==typeof a.height?a.height:p(o),a.maxHeight+=a.tolerance,void 0!==t&&(("string"==typeof t||t instanceof HTMLElement)&&(t=b("<div />").append(t).contents()),t instanceof b&&(n=t)),(c=o.wrapInner('<div class="dotdotdot" />').children()).empty().append(n.clone(!0)).find("br").replaceWith("  <br />  ").end().css({height:"auto",width:"auto",border:"none",padding:0,margin:0});var i=!1,s=!1;return r.afterElement&&(i=r.afterElement.clone(!0),r.afterElement.remove()),v(c,a)&&(s="children"==a.wrap?d(c,a,i):g(c,o,c,a,i)),c.replaceWith(c.contents()),c=null,b.isFunction(a.callback)&&a.callback.call(o[0],s,n),r.isTruncated=s}).on("isTruncated.dot",function(e,t){return e.preventDefault(),e.stopPropagation(),"function"==typeof t&&t.call(o[0],r.isTruncated),r.isTruncated}).on("originalContent.dot",function(e,t){return e.preventDefault(),e.stopPropagation(),"function"==typeof t&&t.call(o[0],n),n}).on("destroy.dot",function(e){e.preventDefault(),e.stopPropagation(),o.unwatch().unbind_events().empty().append(n).attr("style",o.data("dotdotdot-style")).data("dotdotdot",!1)}),o},o.unbind_events=function(){return o.off(".dot"),o},o.watch=function(){if(o.unwatch(),"window"==a.watch){var e=b(window),t=e.width(),i=e.height();e.on("resize.dot"+r.dotId,function(){t==e.width()&&i==e.height()&&a.windowResizeFix||(t=e.width(),i=e.height(),l&&clearInterval(l),l=setTimeout(function(){o.trigger("update.dot")},10))})}else s=h(o),l=setInterval(function(){var e=h(o);s.width==e.width&&s.height==e.height||(o.trigger("update.dot"),s=h(o))},100);return o},o.unwatch=function(){return b(window).off("resize.dot"+r.dotId),l&&clearInterval(l),o};var n=o.contents(),a=b.extend(!0,{},b.fn.dotdotdot.defaults,e),r={},s={},l=null,c=null;return a.lastCharacter.remove instanceof Array||(a.lastCharacter.remove=b.fn.dotdotdot.defaultArrays.lastCharacter.remove),a.lastCharacter.noEllipsis instanceof Array||(a.lastCharacter.noEllipsis=b.fn.dotdotdot.defaultArrays.lastCharacter.noEllipsis),r.afterElement=i(a.after,o),r.isTruncated=!1,r.dotId=f++,o.data("dotdotdot",!0).bind_events().trigger("update.dot"),a.watch&&o.watch(),o},b.fn.dotdotdot.defaults={ellipsis:"... ",wrap:"word",fallbackToLetter:!0,lastCharacter:{},tolerance:0,callback:null,after:null,height:null,watch:!1,windowResizeFix:!0,debug:!1},b.fn.dotdotdot.defaultArrays={lastCharacter:{remove:[" ","　",",",";",".","!","?"],noEllipsis:[]}};var f=1,s=b.fn.html;b.fn.html=function(e){return e!=t&&!b.isFunction(e)&&this.data("dotdotdot")?this.trigger("update",[e]):s.apply(this,arguments)};var o=b.fn.text;b.fn.text=function(e){return e!=t&&!b.isFunction(e)&&this.data("dotdotdot")?(e=b("<div />").text(e).html(),this.trigger("update",[e])):o.apply(this,arguments)}}}(jQuery),Eggshell.define("C.eggshell.message.error",{inputs:["set error message size","set header","set error text","show","hide"],outputs:[]},C.View.extend({model:new C.Model({size:"small",text:"",header:""}),initialize:function(){this.Eggshell.listen("set error message size",function(e,t){if(!t||"small"!=t&&"large"!=t)throw"Invalid message size";this.model.set("size",t),this.render()},this),this.Eggshell.listen("set header",function(e,t){if(!t||"string"!=typeof t)throw"Invalid header";this.model.set("header",t),this.render()},this),this.Eggshell.listen("set error text",function(e,t){if(!t||"string"!=typeof t)throw"Invalid text";this.model.set("text",t),this.render()},this),this.Eggshell.listen("show",function(e,t){this.$el.show()},this),this.Eggshell.listen("hide",function(e,t){this.$el.hide()},this),this.render()},largeErrorTemplate:_.template('<div class="msg-error-lg" role="alert">\t<div class="msg-icon">\t\t<div class="msg-header"><%= header %></div>\t\t<div class="msg-text"><%= text %></div>\t</div></div>'),smallErrorTemplate:_.template('<div class="msg-error-sm">\t<div class="msg-icon">\t\t<div class="msg-text"><%= text %></div>\t</div></div>'),render:function(){"large"===this.model.get("size")?this.$el.html(this.largeErrorTemplate(this.model.toJSON())):this.$el.html(this.smallErrorTemplate(this.model.toJSON()))}})),function(o){var d,e="1.7.2",h=Math.round,t,n={},s="en",a="undefined"!=typeof module&&module.exports,r="months|monthsShort|weekdays|weekdaysShort|weekdaysMin|longDateFormat|calendar|relativeTime|ordinal|meridiem".split("|"),l=/^\/?Date\((\-?\d+)/i,c=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|YYYY|YY|a|A|hh?|HH?|mm?|ss?|SS?S?|zz?|ZZ?|.)/g,g=/(\[[^\[]*\])|(\\)?(LT|LL?L?L?)/g,u=/([0-9a-zA-Z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+)/gi,i=/\d\d?/,p=/\d{1,3}/,m=/\d{3}/,f=/\d{1,4}/,b=/[0-9a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+/i,v=/Z|[\+\-]\d\d:?\d\d/i,C=/T/i,y=/^\s*\d{4}-\d\d-\d\d(T(\d\d(:\d\d(:\d\d(\.\d\d?\d?)?)?)?)?([\+\-]\d\d:?\d\d)?)?/,w="YYYY-MM-DDTHH:mm:ssZ",k=[["HH:mm:ss.S",/T\d\d:\d\d:\d\d\.\d{1,3}/],["HH:mm:ss",/T\d\d:\d\d:\d\d/],["HH:mm",/T\d\d:\d\d/],["HH",/T\d\d/]],$=/([\+\-]|\d\d)/gi,x="Month|Date|Hours|Minutes|Seconds|Milliseconds".split("|"),E={Milliseconds:1,Seconds:1e3,Minutes:6e4,Hours:36e5,Days:864e5,Months:2592e6,Years:31536e6},T={},_="DDD w M D d".split(" "),S="M D H h m s w".split(" "),I={M:function(){return this.month()+1},MMM:function(e){return D("monthsShort",this.month(),this,e)},MMMM:function(e){return D("months",this.month(),this,e)},D:function(){return this.date()},DDD:function(){var e,t;return~~((new Date(this.year(),this.month(),this.date())-new Date(this.year(),0,1))/864e5+1.5)},d:function(){return this.day()},dd:function(e){return D("weekdaysMin",this.day(),this,e)},ddd:function(e){return D("weekdaysShort",this.day(),this,e)},dddd:function(e){return D("weekdays",this.day(),this,e)},w:function(){var e=new Date(this.year(),this.month(),this.date()-this.day()+5),t=new Date(e.getFullYear(),0,4);return~~((e-t)/864e5/7+1.5)},YY:function(){return L(this.year()%100,2)},YYYY:function(){return L(this.year(),4)},a:function(){return this.lang().meridiem(this.hours(),this.minutes(),!0)},A:function(){return this.lang().meridiem(this.hours(),this.minutes(),!1)},H:function(){return this.hours()},h:function(){return this.hours()%12||12},m:function(){return this.minutes()},s:function(){return this.seconds()},S:function(){return~~(this.milliseconds()/100)},SS:function(){return L(~~(this.milliseconds()/10),2)},SSS:function(){return L(this.milliseconds(),3)},Z:function(){var e=-this.zone(),t="+";return e<0&&(e=-e,t="-"),t+L(~~(e/60),2)+":"+L(~~e%60,2)},ZZ:function(){var e=-this.zone(),t="+";return e<0&&(e=-e,t="-"),t+L(~~(10*e/6),4)}};function D(e,t,i,s){var o=i.lang();return o[e].call?o[e](i,s):o[e][t]}function P(t,i){return function(e){return L(t.call(this,e),i)}}function A(i){return function(e){var t=i.call(this,e);return t+this.lang().ordinal(t)}}for(;_.length;)t=_.pop(),I[t+"o"]=A(I[t]);for(;S.length;)t=S.pop(),I[t+t]=P(I[t],2);function N(e,t,i){this._d=e,this._isUTC=!!t,this._a=e._a||null,this._lang=i||!1}function M(e){var t=this._data={},i=e.years||e.y||0,s=e.months||e.M||0,o=e.weeks||e.w||0,n=e.days||e.d||0,a=e.hours||e.h||0,r=e.minutes||e.m||0,l=e.seconds||e.s||0,c=e.milliseconds||e.ms||0;this._milliseconds=c+1e3*l+6e4*r+36e5*a,this._days=n+7*o,this._months=s+12*i,t.milliseconds=c%1e3,l+=B(c/1e3),t.seconds=l%60,r+=B(l/60),t.minutes=r%60,a+=B(r/60),t.hours=a%24,n+=B(a/24),n+=7*o,t.days=n%30,s+=B(n/30),t.months=s%12,i+=B(s/12),t.years=i,this._lang=!1}function B(e){return e<0?Math.ceil(e):Math.floor(e)}function L(e,t){for(var i=e+"";i.length<t;)i="0"+i;return i}function O(e,t,i){var s=t._milliseconds,o=t._days,n=t._months,a;s&&e._d.setTime(+e+s*i),o&&e.date(e.date()+o*i),n&&(a=e.date(),e.date(1).month(e.month()+n*i).date(Math.min(a,e.daysInMonth())))}function q(e){return"[object Array]"===Object.prototype.toString.call(e)}function j(e,t){var i=Math.min(e.length,t.length),s=Math.abs(e.length-t.length),o=0,n;for(n=0;n<i;n++)~~e[n]!=~~t[n]&&o++;return o+s}function F(e,t,i,s){var o,n,a=[];for(o=0;o<7;o++)a[o]=e[o]=null==e[o]?2===o?1:0:e[o];return e[7]=a[7]=t,null!=e[8]&&(a[8]=e[8]),e[3]+=i||0,e[4]+=s||0,n=new Date(0),t?(n.setUTCFullYear(e[0],e[1],e[2]),n.setUTCHours(e[3],e[4],e[5],e[6])):(n.setFullYear(e[0],e[1],e[2]),n.setHours(e[3],e[4],e[5],e[6])),n._a=a,n}function R(e,t){var i,s,o=[];for(!t&&a&&(t=require("./lang/"+e)),i=0;i<r.length;i++)t[r[i]]=t[r[i]]||n.en[r[i]];for(i=0;i<12;i++)s=d([2e3,i]),o[i]=new RegExp("^"+(t.months[i]||t.months(s,""))+"|^"+(t.monthsShort[i]||t.monthsShort(s,"")).replace(".",""),"i");return t.monthsParse=t.monthsParse||o,n[e]=t}function U(e){var t="string"==typeof e&&e||e&&e._lang||null;return t?n[t]||R(t):d}function H(e){return e.match(/\[.*\]/)?e.replace(/^\[|\]$/g,""):e.replace(/\\/g,"")}function z(i){var s=i.match(c),o,n;for(o=0,n=s.length;o<n;o++)I[s[o]]?s[o]=I[s[o]]:s[o]=H(s[o]);return function(e){var t="";for(o=0;o<n;o++)t+="function"==typeof s[o].call?s[o].call(e,i):s[o];return t}}function Q(t,e){var i=5;function s(e){return t.lang().longDateFormat[e]||e}for(;i--&&g.test(e);)e=e.replace(g,s);return T[e]||(T[e]=z(e)),T[e](t)}function V(e){switch(e){case"DDDD":return m;case"YYYY":return f;case"S":case"SS":case"SSS":case"DDD":return p;case"MMM":case"MMMM":case"dd":case"ddd":case"dddd":case"a":case"A":return b;case"Z":case"ZZ":return v;case"T":return C;case"MM":case"DD":case"YY":case"HH":case"hh":case"mm":case"ss":case"M":case"D":case"d":case"H":case"h":case"m":case"s":return i;default:return new RegExp(e.replace("\\",""))}}function W(e,t,i,s){var o,n;switch(e){case"M":case"MM":i[1]=null==t?0:~~t-1;break;case"MMM":case"MMMM":for(o=0;o<12;o++)if(U().monthsParse[o].test(t)){i[1]=o,n=!0;break}n||(i[8]=!1);break;case"D":case"DD":case"DDD":case"DDDD":null!=t&&(i[2]=~~t);break;case"YY":i[0]=~~t+(70<~~t?1900:2e3);break;case"YYYY":i[0]=~~Math.abs(t);break;case"a":case"A":s.isPm="pm"===(t+"").toLowerCase();break;case"H":case"HH":case"h":case"hh":i[3]=~~t;break;case"m":case"mm":i[4]=~~t;break;case"s":case"ss":i[5]=~~t;break;case"S":case"SS":case"SSS":i[6]=~~(1e3*("0."+t));break;case"Z":case"ZZ":s.isUTC=!0,(o=(t+"").match($))&&o[1]&&(s.tzh=~~o[1]),o&&o[2]&&(s.tzm=~~o[2]),o&&"+"===o[0]&&(s.tzh=-s.tzh,s.tzm=-s.tzm)}null==t&&(i[8]=!1)}function Y(e,t){var i=[0,0,1,0,0,0,0],s={tzh:0,tzm:0},o=t.match(c),n,a;for(n=0;n<o.length;n++)(a=(V(o[n]).exec(e)||[])[0])&&(e=e.slice(e.indexOf(a)+a.length)),I[o[n]]&&W(o[n],a,i,s);return s.isPm&&i[3]<12&&(i[3]+=12),!1===s.isPm&&12===i[3]&&(i[3]=0),F(i,s.isUTC,s.tzh,s.tzm)}function J(e,t){var i,s=e.match(u)||[],o,n=99,a,r,l;for(a=0;a<t.length;a++)(l=j(s,o=Q(new N(r=Y(e,t[a])),t[a]).match(u)||[]))<n&&(n=l,i=r);return i}function G(e){var t="YYYY-MM-DDT",i;if(y.exec(e)){for(i=0;i<4;i++)if(k[i][1].exec(e)){t+=k[i][0];break}return v.exec(e)?Y(e,t+" Z"):Y(e,t)}return new Date(e)}function K(e,t,i,s,o){var n=o.relativeTime[e];return"function"==typeof n?n(t||1,!!i,e,s):n.replace(/%d/i,t||1)}function X(e,t,i){var s=h(Math.abs(e)/1e3),o=h(s/60),n=h(o/60),a=h(n/24),r=h(a/365),l=s<45&&["s",s]||1===o&&["m"]||o<45&&["mm",o]||1===n&&["h"]||n<22&&["hh",n]||1===a&&["d"]||a<=25&&["dd",a]||a<=45&&["M"]||a<345&&["MM",h(a/30)]||1===r&&["y"]||["yy",r];return l[2]=t,l[3]=0<e,l[4]=i,K.apply({},l)}function Z(e,i){d.fn[e]=function(e){var t=this._isUTC?"UTC":"";return null!=e?(this._d["set"+t+i](e),this):this._d["get"+t+i]()}}for(I.DDDD=P(I.DDD,3),(d=function(e,t){return null===e||""===e?null:d.isMoment(e)?new N(new Date(+e._d),e._isUTC,e._lang):new N(i=t?q(t)?J(e,t):Y(e,t):(s=l.exec(e),e===o?new Date:s?new Date(+s[1]):e instanceof Date?e:q(e)?F(e):"string"==typeof e?G(e):new Date(e)));var i,s}).utc=function(e,t){return q(e)?new N(F(e,!0),!0):("string"!=typeof e||v.exec(e)||(e+=" +0000",t&&(t+=" Z")),d(e,t).utc())},d.unix=function(e){return d(1e3*e)},d.duration=function(e,t){var i=d.isDuration(e),s="number"==typeof e,o=i?e._data:s?{}:e,n;return s&&(t?o[t]=e:o.milliseconds=e),n=new M(o),i&&(n._lang=e._lang),n},d.humanizeDuration=function(e,t,i){return d.duration(e,!0===t?null:t).humanize(!0===t||i)},d.version=e,d.defaultFormat=w,d.lang=function(e,t){var i;if(!e)return s;if(!t&&n[e]||R(e,t),n[e]){for(i=0;i<r.length;i++)d[r[i]]=n[e][r[i]];d.monthsParse=n[e].monthsParse,s=e}},d.langData=U,d.isMoment=function(e){return e instanceof N},d.isDuration=function(e){return e instanceof M},d.lang("en",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D YYYY",LLL:"MMMM D YYYY LT",LLLL:"dddd, MMMM D YYYY LT"},meridiem:function(e,t,i){return 11<e?i?"pm":"PM":i?"am":"AM"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},ordinal:function(e){var t=e%10;return 1==~~(e%100/10)?"th":1==t?"st":2==t?"nd":3==t?"rd":"th"}}),d.fn=N.prototype={clone:function(){return d(this)},valueOf:function(){return+this._d},unix:function(){return Math.floor(+this._d/1e3)},toString:function(){return this._d.toString()},toDate:function(){return this._d},toArray:function(){var e=this;return[e.year(),e.month(),e.date(),e.hours(),e.minutes(),e.seconds(),e.milliseconds(),!!this._isUTC]},isValid:function(){return this._a?null!=this._a[8]?!!this._a[8]:!j(this._a,(this._a[7]?d.utc(this._a):d(this._a)).toArray()):!isNaN(this._d.getTime())},utc:function(){return this._isUTC=!0,this},local:function(){return this._isUTC=!1,this},format:function(e){return Q(this,e||d.defaultFormat)},add:function(e,t){var i;return O(this,t?d.duration(+t,e):d.duration(e),1),this},subtract:function(e,t){var i;return O(this,t?d.duration(+t,e):d.duration(e),-1),this},diff:function(e,t,i){var s=this._isUTC?d(e).utc():d(e).local(),o=6e4*(this.zone()-s.zone()),n=this._d-s._d-o,a=this.year()-s.year(),r=this.month()-s.month(),l=this.date()-s.date(),c;return c="months"===t?12*a+r+l/30:"years"===t?a+(r+l/30)/12:"seconds"===t?n/1e3:"minutes"===t?n/6e4:"hours"===t?n/36e5:"days"===t?n/864e5:"weeks"===t?n/6048e5:n,i?c:h(c)},from:function(e,t){return d.duration(this.diff(e)).lang(this._lang).humanize(!t)},fromNow:function(e){return this.from(d(),e)},calendar:function(){var e=this.diff(d().sod(),"days",!0),t=this.lang().calendar,i=t.sameElse,s=e<-6?i:e<-1?t.lastWeek:e<0?t.lastDay:e<1?t.sameDay:e<2?t.nextDay:e<7?t.nextWeek:i;return this.format("function"==typeof s?s.apply(this):s)},isLeapYear:function(){var e=this.year();return e%4==0&&e%100!=0||e%400==0},isDST:function(){return this.zone()<d([this.year()]).zone()||this.zone()<d([this.year(),5]).zone()},day:function(e){var t=this._isUTC?this._d.getUTCDay():this._d.getDay();return null==e?t:this.add({d:e-t})},startOf:function(e){switch(e.replace(/s$/,"")){case"year":this.month(0);case"month":this.date(1);case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return this},endOf:function(e){return this.startOf(e).add(e.replace(/s?$/,"s"),1).subtract("ms",1)},sod:function(){return this.clone().startOf("day")},eod:function(){return this.clone().endOf("day")},zone:function(){return this._isUTC?0:this._d.getTimezoneOffset()},daysInMonth:function(){return d.utc([this.year(),this.month()+1,0]).date()},lang:function(e){return e===o?U(this):(this._lang=e,this)}},t=0;t<x.length;t++)Z(x[t].toLowerCase(),x[t]);function ee(e){d.duration.fn[e]=function(){return this._data[e]}}function te(e,t){d.duration.fn["as"+e]=function(){return+this/t}}for(t in Z("year","FullYear"),d.duration.fn=M.prototype={weeks:function(){return B(this.days()/7)},valueOf:function(){return this._milliseconds+864e5*this._days+2592e6*this._months},humanize:function(e){var t=+this,i=this.lang().relativeTime,s=X(t,!e,this.lang()),o=t<=0?i.past:i.future;return e&&(s="function"==typeof o?o(s):o.replace(/%s/i,s)),s},lang:d.fn.lang},E)E.hasOwnProperty(t)&&(te(t,E[t]),ee(t.toLowerCase()));te("Weeks",6048e5),a&&(module.exports=d),"undefined"==typeof ender&&(this.moment=d),"function"==typeof define&&define.amd&&define("moment",[],function(){return d})}.call(this),Eggshell.define("C.Eggshell.stream",{inputs:["render my stream","render course stream","render school stream","render study stream"],outputs:[]},C.View.extend({initialize:function(){Eggshell.find(this).on("render course stream",this.renderCourse).on("render my stream",this.renderMyStream).on("render school stream",this.renderSchoolStream).on("render study stream",this.renderStudyStream)},renderStudyStream:function(e,t){this.render(),this.feed.trigger("render",{ownerId:C.global.userUuid,postTypes:t.postTypes,limit:t.limit,name:"question-page"}),this.feed.on("ready",function(){this.Eggshell.trigger("study feed ready"),this.postbox.trigger("hide"),Eggshell.find("C.Eggshell.stream.like").destroy()},this)},renderSchoolStream:function(e,t){this.render(),this.postbox.trigger("set feed name and owner",{name:"school-page",owner:{org:"chegg",type:"school",schoolId:t.schoolId}}),this.feed.trigger("render",{schoolId:t.schoolId,name:"school-page"})},renderCourse:function(e,t){this.render(),this.postbox.trigger("set feed name and owner",{name:"course-page",owner:{org:"chegg",type:"course-instance",schoolId:t.schoolId,subjectCode:t.subject,catalogNumber:t.code,academicYear:t.academicYear,academicTerm:t.academicTerm}}),this.feed.trigger("render",{schoolId:t.schoolId,subjectCode:t.subject,catalogNumber:t.code,academicYear:t.academicYear,academicTerm:t.academicTerm,name:"course-page"})},renderMyStream:function(e,t){this.render(),this.feed.trigger("render",{ownerId:C.global.userUuid,name:"sihp"})},render:function(){void 0!==C.global.userUuid&&C.global.userUuid?(this.loadingIndicator=Eggshell.create("C.Eggshell.loading.inline",{el:this.$el}).trigger("show"),this.postbox=Eggshell.create("C.Eggshell.stream.postbox",{el:this.$el,feedName:"sihp"}).on("user has a school",function(e,t){}).on("height",function(e,t){this.postboxHeight=t},this).on("submitting post",function(e,t){Eggshell.trigger(this.postbox,"get height"),this.bottom=this.top=this.postboxHeight/2,Eggshell.trigger(this.postbox,"hide"),Eggshell.trigger(this.loadingIndicator,"fade in"),this.$el.find("#"+C.factory.createSafeCssName(this.loadingIndicator)).css({margin:this.top+"px auto "+this.bottom+"px"})},this).on("post submitted",function(e,t){Eggshell.trigger(this.loadingIndicator,"fade out"),Eggshell.trigger(this.postbox,"show"),this.feed&&t.length&&Eggshell.trigger(this.feed,"load and insert a post item",{position:0,id:t})},this).on("user has school and name",function(){this.readyToPost=!0,Eggshell.trigger("C.Eggshell.stream.commentList","show add comment box"),Eggshell.trigger("C.Eggshell.stream.like","show like button")},this).on("user needs a name",function(){this.readyToPost=!1,Eggshell.trigger("C.Eggshell.stream.commentList","hide add comment box"),Eggshell.trigger("C.Eggshell.stream.like","hide like button")},this).trigger("hide"),this.feed=Eggshell.create("C.Eggshell.stream.feed",{el:this.$el}).trigger("hide").on("ready",function(){this.loadingIndicator.trigger("hide"),this.postbox.trigger("show"),this.feed.trigger("show")},this).on("error",function(){this.loadingIndicator.trigger("hide")},this)):Eggshell.create("C.eggshell.message.error",{el:this.$el}).trigger("set header","Authentication error").trigger("set error text",'Please <a href="/login/">sign in</a>').trigger("set error message size","large")}})),C.resource.add("C.Eggshell.stream.feed.more","Load more"),C.resource.add("C.Eggshell.stream.feed.emptyFeed"," "),Eggshell.define("C.Eggshell.stream.feed",{inputs:["show","hide","insert an empty post item","load and insert a post item","render","hide all native posts"],outputs:["shown","hidden","ready","empty post item inserted","load more clicked"]},function(){var n=C.Model.extend({load:function(e){$.cjax({context:this,url:"/_ajax/odin",dataType:"json",type:"POST",data:{url:"/v1/stream-post/"+e+"/details",method:"POST",token:C.global.csrfToken,payload:JSON.stringify({maxComments:3,tracker:C.utility.dataLogger()})},success:function(e){200!=e.httpCode?this.trigger("error"):(this.set(e.result),this.trigger("loaded"))},error:function(e,t){this.trigger("error")}})}}),e=C.Collection.extend({model:n,lastPage:!0,initialize:function(){this.requestFields={owner:{org:"chegg",type:"user"},name:null,limit:20,offset:0,maxComments:2,maxLikes:4,marker:null,pageNumber:0,direction:"NEXT",tracker:null}},fetch:function(){this.reset(),this.fetchNext()},fetchNext:function(){var e=this.requestFields.pageNumber+1;this.requestFields.pageNumber=e,$.cjax({url:"/_ajax/odin",type:"post",data:{url:"/v1/stream-feed/_/details",method:"POST",payload:JSON.stringify(this.requestFields),token:C.global.csrfToken},context:this,dataType:"json",success:function(e){try{200!==e.httpCode&&this.trigger("error"),response=e.result,this.lastPage=response.lastPage;var t=response.posts;if(0<t.length){for(var i=0;i<t.length;i++){var s=t[i],o=new n;o.set(s),this.add(o,{silent:!0})}this.requestFields.marker=t[t.length-1].id}this.trigger("loaded")}catch(e){this.trigger("error")}},error:function(){this.trigger("error")}})}}),t;return C.View.extend({template:_.template('<div class="error"/><div class="posts"/><div class="more"><button class="btn-flat-sm" title="<%- more %>"><%- more %></button></div><div class="loading"/>'),emptyFeedTemplate:_.template('<div class="noPost"><%- emptyFeed %></div>'),errorTemplate:_.template('<div class="error">Something went wrong</div>'),initialize:function(){this.beaconApi=Eggshell.create("C.common.beacon"),this.collection=new e,this.$el.empty().html(this.template({more:C.resource.fetch("C.Eggshell.stream.feed.more")})),this.$(".more").hide(),this.loadingIndicator=Eggshell.create("C.Eggshell.loading.inline",{el:this.$(".loading")}).getNs(),this.errorNS=Eggshell.create("C.eggshell.message.error",{el:this.$(".error")}).getNs(),Eggshell.trigger(this.loadingIndicator,"show"),this.$(".error").hide(),this.collection.on("loaded",function(){try{this.render()}catch(e){this.Eggshell.trigger("error",e)}this.Eggshell.trigger("ready")},this),this.collection.on("error",function(){Eggshell.trigger(this.loadingIndicator,"hide"),Eggshell.trigger(this.errorNS,"set error text","Feed fails to load. Please refresh."),Eggshell.trigger(this.errorNS,"show"),this.$(".error").show(),this.Eggshell.trigger("error","show")},this),this.Eggshell.listen("show",function(){this.$el.show()}),this.Eggshell.listen("hide",function(){this.$el.hide()}),this.Eggshell.listen("insert an empty post item",this.insertEmpty),this.Eggshell.listen("load and insert a post item",this.loadAndInsert),this.Eggshell.listen("remove a post item",this.remove),this.Eggshell.listen("render",function(e,t){if(!t)throw"Empty payload";if(t.ownerId&&"string"==typeof t.ownerId)this.collection.requestFields.owner.userUuid=t.ownerId;else if(!t.ownerId&&t.schoolId&&t.subjectCode&&t.catalogNumber&&t.academicYear&&t.academicTerm)this.collection.requestFields.owner.type="course-instance",this.collection.requestFields.owner.schoolId=t.schoolId,this.collection.requestFields.owner.subjectCode=t.subjectCode,this.collection.requestFields.owner.catalogNumber=t.catalogNumber,this.collection.requestFields.owner.academicYear=t.academicYear,this.collection.requestFields.owner.academicTerm=t.academicTerm,delete this.collection.requestFields.owner.userUuid;else{if(t.ownerId||!t.schoolId)throw"Invalid entity id";this.collection.requestFields.owner.type="school",this.collection.requestFields.owner.schoolId=t.schoolId,delete this.collection.requestFields.owner.userUuid}if(!t.name||"string"!=typeof t.name)throw"Invalid name";this.collection.requestFields.name=t.name,t.postTypes&&(this.collection.requestFields.postTypes=t.postTypes),t.limit&&(this.collection.requestFields.limit=t.limit),null===this.collection.requestFields.tracker&&(this.collection.requestFields.tracker=C.utility.dataLogger()),this.collection.fetch()}),Eggshell.find(this).on("hide all native posts",function(){this.$el.addClass("hide-all-native-posts")},this),this.Eggshell.trigger("ready")},render:function(){if(this.$(".loading").hide(),this.$(".more").hide(),0===this.collection.length)this.$(".posts").html(this.emptyFeedTemplate({emptyFeed:C.resource.fetch("C.Eggshell.stream.feed.emptyFeed")}));else{for(var e=0;e<this.collection.length;e++){var t=this.collection.at(e),i=t.get("id");if(0===this.$("."+i).length){var s=$("<div/>").addClass(this.createSafeCssClassName(i)).addClass("post post-entity");s.appendTo(this.$(".posts"));var o,n=null;switch(t.attributes.format){case"joinOne":postNS=Eggshell.create("C.Eggshell.stream.post-join",{el:s}),Eggshell.trigger(postNS,"render",t.attributes);break;default:postNS=Eggshell.create("C.Eggshell.stream.post",{el:s}),Eggshell.trigger(postNS,"render",t.attributes)}postNS.on("impression fired",this.createImpressionTrackingCallback(t.toJSON())).trigger("track impression")}}this.collection.lastPage||this.$(".more").show()}},createImpressionTrackingCallback:function(e){return $.proxy(function(){Eggshell.create("C.common.beacon").trigger("send beacon request",{impressionId:this.tracker.impressionId,eventTargetId:this.id,eventType:"POST_IMPRESSION"})},e)},events:{"click .more button":"loadMore"},loadMore:function(){this.$(".loading").show(),this.$(".more").hide(),this.collection.fetchNext(),this.Eggshell.trigger("load more clicked")},createSafeCssClassName:function(e){return e.replace(/[!\"#$%&'\(\)\*\+,\.\/:;<=>\?\@\[\\\]\^`\{\|\}~]/g,"-")},insertEmpty:function(e,t){if(null===t||"number"!=typeof t)throw"Invalid position";var i=this.$(".posts .post"),s=null;s=t>=i.length?$('<div class="custom-post post-entity"></div>').appendTo(".posts"):$('<div class="custom-post post-entity"></div>').insertBefore(i[t]),this.Eggshell.trigger("empty post item inserted",$.extend({},s))},loadAndInsert:function(e,t){var i=t.id,s=new n;s.on("loaded",this.loadAndInsertCallback,{context:this,post:s,id:i}),s.load(i)},loadAndInsertCallback:function(){var e=this.context,t=e.$(".posts .post-entity"),i=$("<div/>").addClass(e.createSafeCssClassName(this.id)).addClass("post post-entity");0<t.length?i.insertBefore($(t.get(0))):i.appendTo(e.$(".posts"));var s=Eggshell.create("C.Eggshell.stream.post",{el:i});Eggshell.trigger(s,"render",this.post.attributes),this.post.off()},remove:function(e,t){}})}()),Eggshell.define("C.Eggshell.stream.post-container",{inputs:["get icon area","get content area","hide icon","set headline","set icon","show","hide","add class","remove class","get container height","highlight container"],outputs:["content area","icon area","container height"]},Backbone.View.extend({initialize:function(){this.render(),Eggshell.find(this).on("get content area",this.getContentArea).on("get icon area",this.getIconArea).on("hide icon",this.hideIcon).on("set headline",this.setHeadline).on("set icon",this.setIcon).on("get container height",this.getContainerHeight).on("add class",this.addClass).on("remove class",this.removeClass).on("highlight container",this.highlight)},render:function(){this.$el.html(this.template()),this.$(".headline").hide()},template:_.template('<div class="item-post item-post-container">   <div class="item-post-icon-container"></div>   <div class="item-post-content-container"></div></div>'),getContentArea:function(){this.Eggshell.trigger("content area",$.extend({},this.$(".item-post-content-container")))},getIconArea:function(){this.Eggshell.trigger("icon area",$.extend({},this.$(".item-post-icon-container")))},hideIcon:function(){this.$(".item-post-icon-container").hide(),this.$(".item-post-content-container").addClass("noIcon")},setHeadline:function(e,t){if("string"!=typeof t||!$.trim(t))throw"Invalid headline. Headline needs to a non-empty string.";this.$(".headline").show().html(t)},setIcon:function(e,t){if("string"!=typeof t||!$.trim(t))throw"Invalid icon class. Icon class needs to a non-empty string.";this.$(".item-post-icon-container").addClass(t)},getContainerHeight:function(){Eggshell.find(this).trigger("container height",this.$(".item-post-container").height())},addClass:function(e,t){this.$(".item-post-container").addClass(t.className)},removeClass:function(e,t){this.$(".item-post-container").removeClass(t.className)},highlight:function(){this.$el.addClass("highlighted")}})),C.resource.add("C.Eggshell.stream.post.delete.title","Delete this"),C.resource.add("C.Eggshell.stream.post.created.date","posted on"),C.resource.add("C.Eggshell.stream.post.question.text","A new question was asked in"),C.resource.add("C.Eggshell.stream.post.answer.text","A question was answered in"),C.resource.add("C.Eggshell.stream.post.review.text","A classmate reviewed"),C.resource.add("C.Eggshell.stream.post.delete.header","Delete Post"),C.resource.add("C.Eggshell.stream.post.delete.confirmation","Are you sure you want to delete this?"),C.resource.add("C.Eggshell.stream.post.button.delete","Delete"),C.resource.add("C.Eggshell.stream.post.button.cancel","Cancel"),C.resource.add("C.Eggshell.stream.post.join.one.text","joined "),C.resource.add("C.Eggshell.stream.post.join.many.text","{0} classmates joined"),C.resource.add("C.Eggshell.stream.post.concatenation.in"," in "),C.resource.add("C.Eggshell.stream.post.concatenation.and"," and "),C.resource.add("C.Eggshell.stream.post.profile.link","View Profile"),Eggshell.define("C.Eggshell.stream.post",{inputs:["render","get all comments"],outputs:["removed","ready","render","post is deleted"]},C.View.extend({template_post_userText:_.template('<% if(C.global.userUuid == data.authors[0].id || C.global.userUuid == data.authors[0].userUuid){ %><a href="#" title="Delete this" class="delete-post"></a><% } %><div class="item-post-header"><% if(data.authors[0]){ %><a href="<%- data.authors[0].url %>" class="post-author-name capitalized"><%- data.authors[0].name %></a><% }else{ %><% } %> posted on <%= this.buildTargetList(data.targets) %> &bull; <a href="/post/<%- data.id %>" class="post-timestamp"><%- this.formatTimeStamp(data.createdAt) %></a></div><div class="item-post-body"><%- data.body %></div><div class="item-post-likes"></div><div class="item-post-comments"></div>'),template_post_question:_.template('<div class="item-post-header">A new <a class="item-post-question-link" href="<%- data.actionUrl %>">question</a> was asked in <a href="<%- data.targets[0].url %>" class="post-context-link"><%- data.targets[0].name %></a> &bull; <a href="/post/<%- data.id %>" class="post-timestamp"><%- this.formatTimeStamp(data.createdAt) %></a></div><div class="item-post-body"><%- data.body %></div><div class="item-post-likes"></div><div class="item-post-comments"></div>'),template_post_answer:_.template('<div class="item-post-header">A <a class="item-post-question-link" href="<%- data.actionUrl %>">question</a> was answered in <a href="<%- data.targets[0].url %>" class="post-context-link"><%- data.targets[0].name %></a> &bull; <a href="/post/<%- data.id %>" class="post-timestamp"><%- this.formatTimeStamp(data.createdAt) %></a></div><div class="item-post-body"><%- data.body %></div><div class="item-post-likes"></div><div class="item-post-comments"></div>'),template_post_review:_.template('<div class="item-post-header">A classmate reviewed <a href="<%- data.targets[0].url %>" class="post-context-link"><%- data.targets[0].name %></a> &bull; <a href="/post/<%- data.id %>" class="post-timestamp"><%- this.formatTimeStamp(data.createdAt) %></a></div><div class="item-post-body"><%- data.body %></div><div class="item-post-likes"></div><div class="item-post-comments"></div>'),template_avatar:_.template('<a href="<%- data.authors[0].url %>" class="item-post-icon item-post-icon-avatar"><img src="<%- data.authors[0].icon %>"></a>'),template_icon:_.template('<span class="item-post-icon item-post-icon-<%- format %>"></span>'),template_icon_link:_.template('<a class="item-post-icon-link item-post-icon item-post-icon-<%- format %>"  href="<%- data.actionUrl %>"></a>'),initialize:function(){this.registerListeners()},render:function(){this.$el.empty();var e=C.global.userUuid,t=Eggshell.create("C.Eggshell.stream.post-container",{el:this.$el}),o=this.model.toJSON();Eggshell.listen(t,"content area",$.proxy(function(e,t){var i=t,s;switch(o.format){case"userText":i.html(this.template_post_userText({data:o})),this.$el.attr("data-type","user text");break;case"question":i.html(this.template_post_question({data:o})),this.$el.attr("data-type","question");break;case"answer":i.html(this.template_post_answer({data:o})),this.$el.attr("data-type","answer");break;case"review":i.html(this.template_post_review({data:o})),this.$el.attr("data-type","review");break;default:i.html(this.template_post_userText({data:o}))}},this)),Eggshell.listen(t,"icon area",$.proxy(function(e,t){var i=t,s=o.format;switch(s){case"userText":Eggshell.create("C.common.avatar",{el:i}).trigger("set avatar id",o.authors[0].userUuid).trigger("set size","medium").trigger("set shape","circle").trigger("set border",!0).trigger("set avatar link url",o.authors[0].url).trigger("update avatar image url",o.authors[0].icon);break;case"question":case"answer":i.html(this.template_icon_link({data:o,format:s}));break;case"review":i.html(this.template_icon({data:o,format:s}));break;default:i.html(this.template_avatar({data:o}))}},this)),Eggshell.trigger(t,"get content area"),Eggshell.trigger(t,"get icon area");var i=$(this.$el.find(".item-post-body")),s=$(i).html();if(s&&"string"==typeof s&&0<s.length){var n=Eggshell.create("C.eggshell.linkify").trigger("set plain text",s).on("linkified text",function(e,t){s=t},this).trigger("get linkified text");Eggshell.destroy(n)}else s="";$(i).empty("");var a=Eggshell.create("C.Eggshell.text.ellipsis",{el:i});if(Eggshell.trigger(a,"set text",s),Eggshell.trigger(a,"set lines",3),Eggshell.listen(a,"read more clicked",function(){this.Eggshell.trigger("read more clicked in "+this.$el.attr("data-type")+" post")},this),"question"==o.format?a.trigger("always display more link").trigger("change more link copy","View question").trigger("display more link with quotes",o.actionUrl):"answer"==o.format?a.trigger("always display more link").trigger("change more link copy","View answer").trigger("display more link with quotes",o.actionUrl):"userText"!=o.format?Eggshell.trigger(a,"display more link with quotes"):Eggshell.trigger(a,"display more link"),1==this.model.attributes.likable){var r=this.$el.find(".item-post-likes"),l=$.extend(this.model.toJSON(),{targetId:this.model.get("id"),el:r,type:"post"}),c=Eggshell.create("C.Eggshell.stream.like",l);Eggshell.on(c,"liked",function(){this.Eggshell.trigger("like clicked in "+this.$el.attr("data-type")+" post")},this)}if(1==this.model.attributes.commentable){var d=this.$el.find(".item-post-comments"),h=this.model.toJSON(),g={thisUserAvatar:C.global.userAvatar,thisUserUuid:C.global.userUuid},u;h=$.extend({},h,g),Eggshell.create("C.Eggshell.stream.commentList",{el:d,model:h}).on("comment added",function(){this.Eggshell.trigger("comment added in "+this.$el.attr("data-type")+" post")},this).on("comment avatar clicked",function(){this.Eggshell.trigger("comment avatar clicked in "+this.$el.attr("data-type")+" post")},this).on("comment author clicked",function(){this.Eggshell.trigger("comment author clicked in "+this.$el.attr("data-type")+" post")},this).on("comment liked",function(){this.Eggshell.trigger("comment liked in "+this.$el.attr("data-type")+" post")},this).on("more comments loaded",function(){this.Eggshell.trigger("more comments loaded in "+this.$el.attr("data-type")+" post")},this)}},registerListeners:function(){this.Eggshell.listen("render",function(e,t){this.model=new C.Model(t),this.render()})},formatTimeStamp:function(e){var e=moment.unix(e),t;return moment(e,"YYYYMMDD").fromNow()},buildTargetList:function(e){var o="",n=e.length;return $.each(e,function(e,t){1<n&&n==e+1&&(o+=C.resource.fetch("C.Eggshell.stream.post.concatenation.and"));var i="",s=C.utility.escapeHtml(t.name);"school"!=t.type&&t.url&&null!==t.url?(i=t.url,o+='<a href="'+i+'" class="post-context-link">'+s+"</a>"):o+="<span>"+s+"</span>",1<n&&e+1!=n&&e+2!=n&&(o+=", ")}),o},events:{"click a.item-post-icon-link":"postIconClicked","click a.item-post-question-link":"questionClicked","click a.delete-post":"deletePostChallenge","click .item-post-icon-avatar":"avatarClicked","click .post-author-name":"authorClicked","click .post-timestamp":"timestampClicked","click .more-link":"readMoreClicked","click .post-context-link":"tagClicked"},questionClicked:function(e){this.Eggshell.trigger("question clicked in "+this.$el.attr("data-type")+" post")},postIconClicked:function(e){this.Eggshell.trigger("post icon clicked in "+this.$el.attr("data-type")+" post")},avatarClicked:function(e){this.Eggshell.trigger("avatar clicked in "+this.$el.attr("data-type")+" post")},authorClicked:function(e){this.Eggshell.trigger("author name clicked in "+this.$el.attr("data-type")+" post")},timestampClicked:function(e){this.Eggshell.trigger("timestamp clicked in "+this.$el.attr("data-type")+" post")},tagClicked:function(e){this.Eggshell.trigger("tag clicked in "+this.$el.attr("data-type")+" post")},deletePostChallenge:function(e){this.dialogNS=Eggshell.create("C.Eggshell.dialog",{el:"body"}),Eggshell.trigger(this.dialogNS,"set headline",C.resource.fetch("C.Eggshell.stream.post.delete.header")),Eggshell.trigger(this.dialogNS,"set sub headline",C.resource.fetch("C.Eggshell.stream.post.delete.confirmation")),Eggshell.trigger(this.dialogNS,"hide icon"),Eggshell.trigger(this.dialogNS,"enable default control"),Eggshell.trigger(this.dialogNS,"set primary button",C.resource.fetch("C.Eggshell.stream.post.button.delete")),Eggshell.trigger(this.dialogNS,"set secondary button",C.resource.fetch("C.Eggshell.stream.post.button.cancel")),Eggshell.listen(this.dialogNS,"primary button clicked",$.proxy(function(){this.deletePost(),Eggshell.trigger(this.dialogNS,"hide"),Eggshell.destroy(this.dialogNS)},this)),Eggshell.listen(this.dialogNS,"secondary button clicked",$.proxy(function(){Eggshell.trigger(this.dialogNS,"hide")},this)),Eggshell.trigger(this.dialogNS,"show"),Eggshell.listen(this.dialogNS,"hidden",$.proxy(function(){Eggshell.destroy(this.dialogNS)},this)),e.preventDefault(),e.stopPropagation()},deletePost:function(){var e=this.model.get("id");$.ajax({context:this,url:"/_ajax/odin",dataType:"json",type:"POST",data:{url:"/v1/stream-post/"+e,method:"DELETE",token:C.global.csrfToken,payload:JSON.stringify({})},success:function(e){200==e.httpCode&&this.$el.animate({opacity:0,height:0},500,$.proxy(function(){this.$el.remove(),this.Eggshell.trigger("post is deleted")},this))},error:function(e,t){Eggshell.trigger(this.dialogNS,"hide")}})}})),Eggshell.define("C.Eggshell.stream.post-join",{inputs:["render"],outputs:["removed","ready","render"]},C.View.extend({template_post_joinOne:_.template('<div class="item-post-header"><% if(data.authors[0]){ %><a class="capitalized" href="<%- data.authors[0].url %>" class="post-author-name"><%- data.authors[0].name %></a> <% }else{ %><% } %><%= joined %><a href="<%- data.targets[0].url %>" class="post-context-link"><%- data.targets[0].name %></a> &bull; <span class="post-timestamp"><%- this.formatTimeStamp(data.createdAt) %></span></div><div class="item-post-body"><a href="<%- data.authors[0].url %>" class="profile-link"><%= view %></a></div>'),template_post_joinMany:_.template('<div class="item-post-header"><%= joined %><a href="<%= data.targets[0].url %>" class="post-context-link"><%= data.targets[0].name %></a></div><div class="item-post-body"><ul class="avatar-list-sml"><li><a href="#" class="item-post-icon-avatar-sml"><img src="http://media.cheggcdn.com/media_testing%2Ff77%2Ff7787e39-b2b7-4621-86c4-81bc9c00d705%2FHEAD%20EXPLODE.jpg"></a></li><li><a href="#" class="item-post-icon-avatar-sml"><img src="http://media.cheggcdn.com/media_testing%2Ff77%2Ff7787e39-b2b7-4621-86c4-81bc9c00d705%2FHEAD%20EXPLODE.jpg"></a></li> </ul></div>'),template_avatar:_.template('<a href="<%= data.authors[0].url %>" class="item-post-icon item-post-icon-avatar"><img src="<%= data.authors[0].icon %>"></a>'),template_icon:_.template('<span class="item-post-icon item-post-icon icn-course-lg-0"></span>'),initialize:function(){this.registerListeners()},render:function(){this.$el.html("");var e=Eggshell.create("C.Eggshell.stream.post-container",{el:this.$el});Eggshell.listen(e,"content area",$.proxy(function(e,t){var i=t,s,o=6;switch(this.model.attributes.type){case"joinMany":i.html(this.template_post_joinMany({data:this.model.toJSON(),joined:C.resource.fetch("C.Eggshell.stream.post.join.many.text",[6])}));break;case"joinOne":default:i.html(this.template_post_joinOne({data:this.model.toJSON(),joined:C.resource.fetch("C.Eggshell.stream.post.join.one.text"),view:C.resource.fetch("C.Eggshell.stream.post.profile.link")}))}},this)),Eggshell.listen(e,"icon area",$.proxy(function(e,t){var i=t,s;switch(this.model.attributes.type){case"joinMany":i.html(this.template_icon({data:this.model.toJSON()}));break;case"joinOne":default:i.html(this.template_avatar({data:this.model.toJSON()}))}},this)),Eggshell.trigger(e,"get content area"),Eggshell.trigger(e,"get icon area")},registerListeners:function(){this.Eggshell.listen("render",function(e,t){this.model=new C.Model(t),this.render()})},getAuthorLink:function(e){return"/u/ee97bdc6-0646-11e3-9a42-021505c79ee2/"},formatTimeStamp:function(e){var e=moment.unix(e),t;return moment(e,"YYYYMMDD").fromNow()},buildTargetList:function(e){var i="",s=e.length;return $.each(e,function(e,t){s==e+1&&(i+=C.resource.fetch("C.Eggshell.stream.post.concatenation.in")),i+='<a href="'+t.url+'" class="post-context-link">'+t.name+"</a>",1<s&&s!=e+1&&(i+=", ")}),i}})),C.resource.add("C.Eggshell.stream.like.main","Like"),C.resource.add("C.Eggshell.stream.like.liked","<strong>Liked</strong>"),C.resource.add("C.Eggshell.stream.like.liked.this","<strong>liked</strong> this"),C.resource.add("C.Eggshell.stream.like.you","You"),Eggshell.define("C.Eggshell.stream.like",{inputs:["render","hide like button","show like button"],outputs:["liked","unliked"]},function(e){var t=C.Model.extend({initialize:function(e){this.set({type:e.type?e.type:"post",likesTotal:e.likesTotal?e.likesTotal:0,likedByMe:!!e.likedByMe&&e.likedByMe,likes:e.likes?e.likes:[],targetId:e.id?e.id:"",authorId:{org:"chegg",type:"user",userUuid:C.global.userUuid},impressionId:e.tracker&&e.tracker.impressionId?e.tracker.impressionId:""}),this.get("likedByMe")&&this.setYouLiked()},updateLike:function(){var e=C.utility.dataLogger();e.impressionId=this.get("impressionId"),$.ajax({context:this,url:"/_ajax/odin",dataType:"json",type:"POST",data:{url:"/v1/stream-like",method:"POST",payload:JSON.stringify({author:this.get("authorId"),targetId:this.get("targetId"),tracker:e}),token:C.global.csrfToken},success:function(e){200==e.httpCode&&e.result&&(this.set({targetId:e.result.id}),this.onLikeUpdated())},error:function(e,t){403==e.status&&C.utility.showCsrfMessage()}})},setYouLiked:function(){this.get("likes").unshift({author:{name:C.resource.fetch("C.Eggshell.stream.like.you"),id:"",url:!1,icon:"",type:"user"},created:"now"})},onLikeUpdated:function(){"post"==this.get("type")&&(this.setYouLiked(),this.set({likesTotal:this.get("likesTotal")+1})),this.set({likedByMe:!this.get("likedByMe")})},destroy:function(){}}),i;return C.View.extend({tmplPost:_.template('<div class="like-container">\t<div class="button-alignment">\t\t<a data-type="button" class="btn-outline-mini like"><%- like %></a>\t</div>\t<span class="names"></span></div>'),tmplComment:_.template('<div class="like-container">\t<a class="like"><%- like %></a></div>'),initialize:function(){this.model=new t(this.options),this.model.on("change:likedByMe",this.likedByMe,this),Eggshell.listen("C.Eggshell.stream.like","hide like button",function(e,t){this.$("a.like").hide()},this),Eggshell.listen("C.Eggshell.stream.like","show like button",function(e,t){this.$("a.like").show()},this),this.render()},events:{"click .like":"onLike","click .unlike":"onUnlike"},render:function(){var e={like:C.resource.fetch("C.Eggshell.stream.like.main")};return"post"==this.model.get("type")?this.$el.html(this.tmplPost(e)):this.$el.html(this.tmplComment(e)),this.likedByMe(),this.Eggshell.trigger("ready"),this},likedByMe:function(){this.model.get("likedByMe")?"post"==this.model.get("type")?(this.$(".button-alignment").addClass("hidden"),this.displayNames()):this.$(".like-container").html(C.resource.fetch("C.Eggshell.stream.like.liked")):"post"==this.model.get("type")?(this.$(".button-alignment").hasClass("hidden")&&this.$(".button-alignment").removeClass("hidden"),this.displayNames()):this.$el.html(this.tmplComment({like:C.resource.fetch("C.Eggshell.stream.like.main")}))},displayNames:function(){var e="";0<this.model.get("likes").length&&(e=this.getNames()),this.$(".names").html(e)},getNames:function(){if(0==this.model.get("likes").length)return"";var s="",o=this.model.get("likes").slice(0,4),n=this.model.get("likesTotal")-o.length,a=C.resource.fetch("C.Eggshell.stream.like.you");return _.each(o,function(e,t){var i=e.author;i.url=i.url,o.length-1==t&&1<o.length?s+=0<n?"and "+(n+=1)+" others ":'and <a class="capitalized" href="'+i.url+'">'+_.escape(i.name)+"</a> ":o.length-2==t||1==o.length?"false"==i.url||0==i.url?s+=a+" ":s+='<a class="capitalized" href="'+i.url+'">'+_.escape(i.name)+"</a> ":"false"==i.url||0==i.url?s+=a+", ":s+='<a class="capitalized" href="'+i.url+'">'+_.escape(i.name)+"</a>, "},this),s+=C.resource.fetch("C.Eggshell.stream.like.liked.this")},onLike:function(e){e.preventDefault(),e.stopPropagation(),$(e.target).removeClass("like"),$(e.target).attr("disabled","disabled"),this.model.updateLike(),this.Eggshell.trigger("liked")},onUnlike:function(){this.Eggshell.trigger("unliked")}})}()),C.resource.add("C.Eggshell.stream.postbox.post.placeholder","Write a post... "),C.resource.add("C.Eggshell.stream.postbox.post.error.empty.text","Please add some text to your post."),C.resource.add("C.Eggshell.stream.postbox.post.error.empty.target","Please select a tag for your post."),C.resource.add("C.Eggshell.stream.postbox.post.error.generic","Sorry we could not complete your post at this time."),C.resource.add("C.Eggshell.stream.postbox.name.error.first","Enter your first name"),C.resource.add("C.Eggshell.stream.postbox.name.error.last","Enter your last name"),C.resource.add("C.Eggshell.stream.postbox.post.button","Post"),C.resource.add("C.Eggshell.stream.postbox.headline","Share with your classmates"),Eggshell.define("C.Eggshell.stream.postbox",{inputs:["get height","update targets","set feed name and owner"],outputs:["user has a school","user needs a school","user needs a name","user has school and name","submitting post","post submitted","height"],createSafeDomContainer:!1},function(e){var t=C.Model.extend({initialize:function(e){this.requestFields.name=e.feedName?e.feedName:"sihp","sihp"==this.requestFields.name&&(this.requestFields.owner={org:"chegg",type:"user",userUuid:C.global.userUuid}),this.set({lock:!1,postableTargets:[],defaultTargets:[],hasSchool:!1,hasName:!1})},requestFields:{owner:null,name:null,limit:20,offset:0,maxComments:2,maxLikes:4,marker:null,pageNumber:0,direction:"NEXT",tracker:null},updateRequestFields:function(e){if(!e.name||!e.owner)throw"Missing request fields";this.requestFields.name=e.name,this.requestFields.owner=e.owner,this.getPostableTargets()},getPostableTargets:function(){this.requestFields.tracker=C.utility.dataLogger();var e=this.requestFields.pageNumber+1;this.requestFields.pageNumber=e,$.cjax({url:"/_ajax/odin",type:"post",data:{url:"/v1/stream-feed/_/details",method:"POST",payload:JSON.stringify(this.requestFields),token:C.global.csrfToken},context:this,dataType:"json",success:function(e){if(200!==e.httpCode)this.trigger("targetError");else{var t=e.result.postableTargets,i=[],s=[];0<t.length?_.each(t,function(e,t){"sihp"==this.requestFields.name&&"school"==e.type?(i.unshift($.extend({displayName:e.name},e)),s.unshift(e.name)):"course-page"==this.requestFields.name&&"course-instance"==e.type?(i.unshift($.extend({displayName:e.name},e)),s.unshift(e.name)):i.push($.extend({displayName:e.name},e))},this):this.trigger("targetError"),this.set({postableTargets:i,defaultTargets:s})}},error:function(){this.trigger("targetError")}})},submitPost:function(e){$.ajax({url:"/_ajax/odin",type:"post",data:{url:"/v1/stream-post",method:"POST",payload:JSON.stringify(e),token:C.global.csrfToken,tracker:C.utility.dataLogger()},context:this,dataType:"json",success:function(e){200!==e.httpCode?this.trigger("postError"):(this.set({postId:e.result.id}),this.trigger("postSuccess"))},error:function(e,t){this.trigger("postError"),403==e.status&&C.utility.showCsrfMessage()}})},canPost:function(){$.cjax({url:"/_ajax/cartographer/get",type:"post",data:{version:2,token:C.global.csrfToken,components:{user:{profile:!0},school:"school"}},context:this,dataType:"json",success:function(e){e||this.trigger("error"),e.school&&null!=e.school.ipedId&&this.set({hasSchool:!0}),e.user&&e.user.firstName&&$.trim(e.user.firstName)&&e.user.lastName&&$.trim(e.user.lastName)&&this.set({hasName:!0}),this.set({firstName:"",lastName:""}),this.get("hasName")&&this.get("hasSchool")?this.trigger("readyToPost"):this.get("hasSchool")?(e.user&&this.set({firstName:e.user.firstName?e.user.firstName:"",lastName:e.user.lastName?e.user.lastName:""}),this.trigger("needsName")):(e.user&&this.set({firstName:e.user.firstName?e.user.firstName:"",lastName:e.user.lastName?e.user.lastName:""}),this.trigger("needsSchool"))},error:function(e,t){this.trigger("error")}})}}),i;return C.View.extend({tmpl:_.template('<div class="message-area"></div><div class="post-btn top"><button class="btn-flat-sm post"><%- postButtonText %></button></div><div class="postbox-action-area collapsed">\t<div class="flex-text-area"></div>\t<div class="post-options"></div></div><div class="post-btn bottom"><button class="btn-flat-sm post"><%- postButtonText %></button></div>'),tmpl_avatar:_.template('<span class="item-post-icon item-post-icon-avatar"><img src="<%- data %>"></span>'),initialize:function(){this.model=new t(this.options),this.model.canPost(),this.model.on("readyToPost",this.readyToPost,this),this.model.on("error",this.needsSchool,this),this.model.on("needsSchool",this.needsSchool,this),this.model.on("needsName",this.needsName,this),this.model.on("postSuccess",this.postSuccess,this),this.model.on("postError",this.postError,this),this.model.on("targetError",this.targetError,this),this.model.on("change:defaultTargets",this.updatePostTarget,this),this.model.on("change:postableTargets",this.updatePostTarget,this),this.render(),this.registerListeners()},events:{"click button.btn-flat-sm.post":"onClickSubmitPost","mouseover .postbox-action-area":function(){this.model.set("lock",!0)},"mouseout .postbox-action-area":function(){this.model.set("lock",!1)},"mouseout .C-Eggshell-stream-postbox":function(){this.model.set("lock",!1)}},render:function(){return this.$el.addClass("postbox-disabled"),this},registerListeners:function(){this.Eggshell.listen("get height",function(e,t){this.Eggshell.trigger("height",this.$el.height())}),this.Eggshell.listen("update targets",function(e,t){this.model.getPostableTargets()}),this.Eggshell.listen("set feed name and owner",function(e,t){this.model.updateRequestFields(t)})},hasSchool:function(){var e=Eggshell.create("C.eggshell.component.ajax.client").getNs();Eggshell.trigger(e,"flush all"),this.Eggshell.trigger("user has a school"),this.schoolNS&&Eggshell.destroy(this.schoolNS),this.model.get("hasName")?this.readyToPost():this.needsName()},updateTextArea:function(e,t){var i=this.$(".post-options").height(),t=t||0==t?t:i+36;this.$(".postbox-action-area").height()!=e+t&&this.$(".postbox-action-area").animate({height:e+t+"px"},100)},readyToPost:function(){this.Eggshell.trigger("user has school and name"),this.$el.removeClass("postbox-disabled"),this.nameNS&&Eggshell.destroy(this.nameNS),this.model.getPostableTargets();var e=Eggshell.create("C.Eggshell.stream.post-container",{el:this.$el});Eggshell.listen(e,"content area",$.proxy(function(e,t){var i=t;this.$el.find(".item-post-content-container").html(this.tmpl({postButtonText:C.resource.fetch("C.Eggshell.stream.postbox.post.button")})).addClass("collapsed"),this.$el.find(".item-post-content-container").prepend('<h3 class="postbox-headline">'+C.resource.fetch("C.Eggshell.stream.postbox.headline")+"</h3>"),this.flexNS=Eggshell.create("C.Eggshell.flexible.area",{el:this.$(".flex-text-area"),placeholder:C.resource.fetch("C.Eggshell.stream.postbox.post.placeholder"),maxlength:2e3}),Eggshell.listen(this.flexNS,"focus",function(e,t){this.expand()},this),Eggshell.listen(this.flexNS,"output text",function(e,t){this.model.set("postBody",t)},this),Eggshell.listen(this.flexNS,"updated height",function(e,t){this.updateTextArea(t)},this),this.postTargetNS=Eggshell.create("C.Eggshell.stream.post-target",{el:this.$(".post-options"),feedName:this.options.feedName,searchOptions:this.model.get("postableTargets"),selectedOptions:this.model.get("defaultTargets")}),Eggshell.listen(this.postTargetNS,"element height",$.proxy(function(e,t){if(1==this.model.get("lock")){var i=$("textarea.flexible-area")[0].offsetHeight,s=0==t?t:t+15;this.updateTextArea(i,s)}},this)),Eggshell.listen(this.postTargetNS,"all selected",function(e,t){this.model.set({selectedTargets:t}),Eggshell.trigger(this.postTargetNS,"get height")},this);var s=Eggshell.create("C.Eggshell.window.resize.tracker");Eggshell.listen(s,"resize",$.proxy(function(){Eggshell.trigger(this.postTargetNS,"get height")},this)),this.$el.observe("click",function(e){e.stopPropagation()},this),$("body").observe("click",this.closePostBox,this)},this)),Eggshell.listen(e,"icon area",$.proxy(function(e,t){var i=t,s=C.global.userAvatar;Eggshell.create("C.common.avatar",{el:this.$el.find(".item-post-icon-container")}).trigger("set avatar id",C.global.userUuid).trigger("set size","medium").trigger("set shape","circle").trigger("set border",!0).trigger("update avatar image url",s).trigger("set avatar link url","/my/profile")},this)),Eggshell.trigger(e,"get content area"),Eggshell.trigger(e,"get icon area")},updatePostTarget:function(){this.postTargetNS&&(Eggshell.trigger(this.postTargetNS,"show"),Eggshell.trigger(this.postTargetNS,"set defaults",this.model.get("defaultTargets")),Eggshell.trigger(this.postTargetNS,"set targets",this.model.get("postableTargets")))},collapse:function(){if(this.$(".post-btn.bottom").hide(),this.$(".post-btn.top").css("posiiton","relative"),this.$(".post-btn.top").fadeIn(300),this.$(".post-btn").hasClass("collapsed")||this.$(".post-btn").addClass("collapsed"),this.postTargetNS&&Eggshell.trigger(this.postTargetNS,"collapse dropdown"),this.$el.hasClass("expanded")&&(this.$el.removeClass("expanded"),this.$el.addClass("collapsed")),!this.$(".postbox-action-area").hasClass("collapsed")){var e=Eggshell.trigger(this.postTargetNS,"get height");this.$(".postbox-action-area").animate({height:"36px","margin-right":"110px"},200,"swing",$.proxy(function(){this.$(".postbox-action-area").addClass("collapsed"),this.model.set("lock",!1)},this))}},expand:function(){if(this.$(".post-btn.top").hide(),this.$(".post-btn.bottom").fadeIn(300),this.$(".post-btn").hasClass("collapsed")&&this.$(".post-btn").removeClass("collapsed"),this.$el.hasClass("collapsed")&&(this.$el.removeClass("collapsed"),this.$el.addClass("expanded")),this.$(".postbox-action-area").hasClass("collapsed")){var e=this.$(".post-options").height(),t=this.$("textarea.flexible-area")[0].offsetHeight;this.$(".postbox-action-area").removeClass("collapsed"),this.$(".postbox-action-area").animate({height:t+e,"margin-right":"0px"},200,"swing",$.proxy(function(){},this))}},closePostBox:function(e){Eggshell.trigger(this.flexNS,"get text"),this.model.set("lock",!0),this.model.get("postBody")&&""!=this.model.get("postBody")||this.collapse()},onClickSubmitPost:function(){Eggshell.trigger(this.flexNS,"get text"),Eggshell.trigger(this.postTargetNS,"get all selected"),this.expand();var i=[],e=jQuery.extend(!0,{},this.model.get("selectedTargets"));if(_.each(e,function(e,t){delete e.displayName,i.push(e)}),0<i.length)if($.trim(this.model.get("postBody"))){this.$(".btn-flat-sm.post").attr("disabled","disabled");var t={type:"cheggstream-textpost",format:"userText",authors:[{org:"chegg",type:"user",userUuid:C.global.userUuid}],targets:i,verb:"posted on",body:this.model.get("postBody"),commentable:!0,likable:!0,tracker:C.utility.dataLogger()};this.Eggshell.trigger("submitting post"),this.model.submitPost(t)}else this.postError(C.resource.fetch("C.Eggshell.stream.postbox.post.error.empty.text"));else this.postError(C.resource.fetch("C.Eggshell.stream.postbox.post.error.empty.target"))},postSuccess:function(){this.Eggshell.trigger("post submitted",this.model.get("postId")),this.$(".btn-flat-sm.post").prop("disabled",!1),this.postErrorNS&&Eggshell.trigger(this.postErrorNS,"hide"),this.$(".flexible-area").css("height","35px"),this.collapse(),this.flexNS&&Eggshell.trigger(this.flexNS,"set text",""),this.postTargetNS},postError:function(e){this.Eggshell.trigger("post submitted",""),this.$(".btn-flat-sm.post").prop("disabled",!1),this.postErrorNS||(this.postErrorNS=Eggshell.create("C.eggshell.message.error",{el:this.$(".message-area")})),this.expand(),this.postErrorNS&&Eggshell.trigger(this.postErrorNS,"show"),Eggshell.trigger(this.postErrorNS,"set error message size","small"),e&&e.length?Eggshell.trigger(this.postErrorNS,"set error text",e):Eggshell.trigger(this.postErrorNS,"set error text",C.resource.fetch("C.Eggshell.stream.postbox.post.error.generic"))},targetError:function(){this.$el.addClass("hidden"),Eggshell.trigger(this.postTargetNS,"hide")},needsSchool:function(){this.schoolNS=Eggshell.create("C.Eggshell.stream.school-collector",{el:this.$el}),Eggshell.trigger(this.schoolNS,"fade in"),this.Eggshell.trigger("user needs a school"),Eggshell.listen(this.schoolNS,"added",function(e,t){1<t.schoolId?(Eggshell.trigger(this.schoolNS,"fade out"),Eggshell.listen(this.schoolNS,"faded out",$.proxy(function(){this.hasSchool()},this))):Eggshell.trigger(this.schoolNS,"reset")},this)},needsName:function(){this.nameNS=Eggshell.create("C.Eggshell.stream.name-collector",{el:this.$el,options:{firstName:this.model.get("firstName"),lastName:this.model.get("lastName")}}),this.Eggshell.trigger("user needs a name"),Eggshell.listen(this.nameNS,"added",function(e,t){t.firstName&&t.lastName&&""!=t.firstName&&""!=t.lastName&&(Eggshell.listen(this.nameNS,"faded out",$.proxy(function(){this.readyToPost()},this)),Eggshell.trigger(this.nameNS,"fade out"))},this)}})}()),C.resource.add("C.Eggshell.stream.school.collector.header","What <strong>school</strong> are you attending?"),C.resource.add("C.Eggshell.stream.school.collector.description","See what other students at your school are talking about on Chegg"),C.resource.add("C.Eggshell.stream.school.collector.placeholder","Enter school"),Eggshell.define("C.Eggshell.stream.school-collector",{inputs:["fade in","fade out","reset"],outputs:["faded in","faded out"]},function(e){var t=C.Model.extend({initialize:function(e){},changeSchool:function(){$.ajax({url:"/_ajax/cartographer/set",type:"post",data:{version:2,token:C.global.csrfToken,data:{school:{id:this.get("schoolId")}}},context:this,dataType:"json",success:$.proxy(function(e){this.trigger("success")},this),error:function(){this.trigger("error")}})},destroy:function(){}}),i;return C.View.extend({tmpl:_.template('<div class="loading-indicator"></div><div class="sc"><div class="item-post-header school-collection">\t<h2><%= header %></h2></div><div class="item-post-body">\t<div class="school-add-benefit"><%= description %></div>\t<input type="text" placeholder="<%- placeholder %>" class="school-collector"/></div></div>'),tmplIcon:_.template('<span class="item-post-icon"></span>'),initialize:function(){this.model=new t(this.options),this.model.on("success",this.addedSchool,this),this.Eggshell.input("fade in",$.proxy(function(e,t){this.$el.fadeIn(300,$.proxy(function(){this.Eggshell.trigger("faded in",t)},this))},this)),this.Eggshell.input("fade out",$.proxy(function(e,t){this.$el.animate({opacity:"0",height:"56px"},300,$.proxy(function(){this.Eggshell.trigger("faded out",t)},this))},this)),this.Eggshell.input("reset",$.proxy(function(e,t){this.resetForm()},this)),this.render()},events:{},render:function(){var e=Eggshell.create("C.Eggshell.stream.post-container",{el:this.$el});return Eggshell.listen(e,"content area",$.proxy(function(e,t){var i;t.html(this.tmpl({header:C.resource.fetch("C.Eggshell.stream.school.collector.header"),description:C.resource.fetch("C.Eggshell.stream.school.collector.description"),placeholder:C.resource.fetch("C.Eggshell.stream.school.collector.placeholder")}));var s=new C.widget.autoComplete({el:".school-collector",type:"schools",callback:$.proxy(function(e,t,i){var s=$(t).attr("data-schoolid"),o=$(t).find(".autocomplete-hdr").html();o=o.replace(/(<([^>]+)>)/gi,""),$(i).attr("data-school-id",s),$(i).val(o),this.model.set("schoolName",o),this.model.set("schoolId",s),this.preChangeSchool()},this)});this.Eggshell.trigger("ready")},this)),Eggshell.listen(e,"icon area",$.proxy(function(e,t){var i;t.html(this.tmplIcon())},this)),Eggshell.trigger(e,"add class",{className:"item-collection-container background-notice-container"}),Eggshell.trigger(e,"get content area"),Eggshell.trigger(e,"get icon area"),this},addedSchool:function(){this.Eggshell.trigger("added",{schoolName:this.model.get("schoolName"),schoolId:this.model.get("schoolId")}),Eggshell.trigger(this.postingNS,"hide")},preChangeSchool:function(){this.postingNS=Eggshell.create("C.Eggshell.loading.inline",{el:$(".loading-indicator")}),Eggshell.trigger(this.postingNS,"show"),this.$(".sc").animate({opacity:.2},300,$.proxy(function(){},this)),this.model.changeSchool()},resetForm:function(){Eggshell.destroy(this.postingNS),this.$(".school-collector").attr("data-school-id",""),this.$(".school-collector").val(""),this.$(".sc").css({opacity:"1"})}})}()),C.resource.add("C.Eggshell.stream.name.collector.question","What's your <strong>name</strong>?"),C.resource.add("C.Eggshell.stream.name.collector.reason","Add your name and start sharing with classmates"),C.resource.add("C.Eggshell.stream.name.collector.button.save","Save Name"),C.resource.add("C.Eggshell.stream.name.collector.name.first","Enter your first name"),C.resource.add("C.Eggshell.stream.name.collector.name.placeholder.first","First Name"),C.resource.add("C.Eggshell.stream.name.collector.name.last","Enter your last name"),C.resource.add("C.Eggshell.stream.name.collector.name.placeholder.last","Last Name"),C.resource.add("C.Eggshell.stream.name.collector.name.error","Invalid Characters"),Eggshell.define("C.Eggshell.stream.name-collector",{inputs:["fade in","fade out"],outputs:["faded in","faded out"]},function(e){var i=C.Model.extend({initialize:function(){},changeName:function(){var t=Eggshell.create("C.Eggshell.loading.inline",{el:$(".loading-indicator")});$(".name-collector").animate({opacity:.2},400,function(){Eggshell.trigger(t,"show")}),$.ajax({url:"/_ajax/cartographer/set",type:"post",data:{version:2,token:C.global.csrfToken,data:{user:{firstName:this.get("firstName"),lastName:this.get("lastName")}}},context:this,dataType:"json",success:function(e){Eggshell.trigger(t,"fade out"),this.trigger("success")},error:function(){Eggshell.trigger(t,"fade out"),this.trigger("error")}})},destroy:function(){}}),t;return C.View.extend({tmpl:_.template('<div class="loading-indicator"></div><div class="name-collector"><div class="item-post-header">\t<h2><%= question %></h2></div><div class="item-post-body">\t<div class="name-add-benefit"><%= reason %></div>\t<a data-type="button" class="btn-secondary-sm save-name"><%= save %></a>\t<div class="input-container-container">\t\t<div class="input-container"><input type="text" placeholder="<%- placeholderFirst %>" class="name-collector-fname" value="<%- opts.firstName %>"/></div>\t\t<div class="input-container"><input type="text" placeholder="<%- placeholderLast %>" class="name-collector-lname" value="<%- opts.lastName %>"/></div>\t</div></div></div>'),tmplIcon:_.template('<span class="item-post-icon"></span>'),initialize:function(){this.model=new i(this.options),this.Eggshell.input("fade in",$.proxy(function(e,t){this.$el.animate({height:"136px",opacity:0},300,$.proxy(function(){this.Eggshell.trigger("faded in",t)},this))},this)),this.Eggshell.input("fade out",$.proxy(function(e,t){this.$el.animate({height:"85px",opacity:0},400,$.proxy(function(){this.Eggshell.trigger("faded out",t)},this))},this)),this.render()},events:{"click a.save-name":"evalName"},evalName:function(e){e.preventDefault(),e.stopPropagation(),this.model=new i,this.model.set("firstName",$("input.name-collector-fname").val()),this.model.set("lastName",$("input.name-collector-lname").val());var t=!0;$("input").removeClass("error-shadow"),$(".error-msg").remove(),this.model.get("firstName")&&$.trim(this.model.get("firstName"))||($(".name-collector-fname").addClass("error-shadow"),$('<span class="error-msg"></span>').text(C.resource.fetch("C.Eggshell.stream.name.collector.name.first")).insertAfter(".name-collector-fname"),t=!1),this.model.get("lastName")&&$.trim(this.model.get("lastName"))||($(".name-collector-lname").addClass("error-shadow"),$('<span class="error-msg"></span>').text(C.resource.fetch("C.Eggshell.stream.name.collector.name.last")).insertAfter(".name-collector-lname"),t=!1),0==this.validateInput(this.model.get("firstName"))&&($(".name-collector-fname").addClass("error-shadow"),$('<span class="error-msg"></span>').text(C.resource.fetch("C.Eggshell.stream.name.collector.name.error")).insertAfter(".name-collector-fname"),t=!1),0==this.validateInput(this.model.get("lastName"))&&($(".name-collector-lname").addClass("error-shadow"),$('<span class="error-msg"></span>').text(C.resource.fetch("C.Eggshell.stream.name.collector.name.error")).insertAfter(".name-collector-lname"),t=!1),t&&(this.model.changeName(this.model),this.model.on("success",this.addedName,this))},render:function(){var e=Eggshell.create("C.Eggshell.stream.post-container",{el:this.$el});return Eggshell.listen(e,"content area",$.proxy(function(e,t){var i;t.html(this.tmpl({opts:this.model.get("options"),question:C.resource.fetch("C.Eggshell.stream.name.collector.question"),reason:C.resource.fetch("C.Eggshell.stream.name.collector.reason"),save:C.resource.fetch("C.Eggshell.stream.name.collector.button.save"),placeholderFirst:C.resource.fetch("C.Eggshell.stream.name.collector.name.placeholder.first"),placeholderLast:C.resource.fetch("C.Eggshell.stream.name.collector.name.placeholder.last")})),this.Eggshell.trigger("ready")},this)),Eggshell.listen(e,"icon area",$.proxy(function(e,t){var i;t.html(this.tmplIcon())},this)),Eggshell.trigger(e,"add class",{className:"item-collection-container background-notice-container"}),Eggshell.trigger(e,"get content area"),Eggshell.trigger(e,"get icon area"),this},addedName:function(){this.Eggshell.trigger("added",{firstName:this.model.get("firstName"),lastName:this.model.get("lastName")})},validateInput:function(e){return!e.match(/<[^>]*>/)}})}()),C.resource.add("C.Eggshell.stream.post.target.default.selector","Select a tag"),Eggshell.define("C.Eggshell.stream.post-target",{inputs:["get all types","get all selected","set targets","set defaults","get height","collapse dropdown"],outputs:["all targets","all selected","element height"]},function(e){var t;return C.View.extend({initialize:function(){this.render(),this.registerListeners(),this.Eggshell.trigger("ready")},registerListeners:function(){this.Eggshell.listen("get all types",function(e,t){Eggshell.trigger(this.smartSelectNS,"get all options")}),Eggshell.listen(this.smartSelectNS,"all options",function(e,t){this.Eggshell.trigger("all targets",t)},this),this.Eggshell.listen("get all selected",function(e,t){Eggshell.trigger(this.smartSelectNS,"get all selected")}),Eggshell.listen(this.smartSelectNS,"all selected",function(e,t){this.Eggshell.trigger("all selected",t)},this),this.Eggshell.listen("set targets",function(e,t){Eggshell.trigger(this.smartSelectNS,"set targets",t)}),this.Eggshell.listen("set defaults",function(e,t){Eggshell.trigger(this.smartSelectNS,"set selected",t)}),this.Eggshell.listen("render",function(e,t){this.render()}),this.Eggshell.listen("collapse dropdown",function(e,t){Eggshell.trigger(this.smartSelectNS,"collapse dropdown",t)}),Eggshell.connect(this.Eggshell.getNamespace(),"get height",this.smartSelectNS,"get height"),Eggshell.connect(this.smartSelectNS,"element height",this.Eggshell.getNamespace(),"element height")},render:function(){return this.buildSmartSelect(),this},buildSmartSelect:function(){this.smartSelectNS||(this.smartSelectNS=Eggshell.create("C.Eggshell.smartselect",{el:this.$el,searchOptions:this.options.searchOptions,selectedOptions:this.options.selectedOptions,selectBoxName:"add-class",selectDefault:C.resource.fetch("C.Eggshell.stream.post.target.default.selector"),selectListType:"auto"}))}})}()),C.resource.add("C.Eggshell.smartselect.select.default","Select"),Eggshell.define("C.Eggshell.smartselect",{inputs:["get all options","get all selected","set targets","set selected","get height","collapse dropdown"],outputs:["all options","all selected","element height","display drop down","display drop down"]},function(e){var t=C.Model.extend({initialize:function(e){this.set({availableOptions:[],searchOptions:e.searchOptions?e.searchOptions:[],selectedOptions:e.selectedOptions?e.selectedOptions:[],selectBoxName:e.selectBoxName?e.selectBoxName:"smart-select-box",selectDefault:e.selectDefault?e.selectDefault:C.resource.fetch("C.Eggshell.smartselect.select.default"),selectListType:e.selectListType?e.selectListType:"select",sortFlag:!!e.sortFlag&&e.sortFlag}),this.setAvailableOptions()},setAvailableOptions:function(){var i={};_.each(this.get("searchOptions"),function(e,t){_.contains(this.get("selectedOptions"),e.displayName)||(i[t]=e.displayName)},this),this.set({availableOptions:i})},getAllSelected:function(){var i=[];return _.each(this.get("selectedOptions"),function(e){var t=_.where(this.get("searchOptions"),{displayName:e},this);i=i.concat(t)},this),i}}),i;return C.View.extend({tmpl:_.template('<div class="selected-options"></div>'),tmplSelect:_.template('<select class="select-mini multi">\t<option value="" selected ><%- defaultOption %></option></select>'),tmplAuto:_.template('<div class="smart-select multi hidden"></div>'),initialize:function(){this.model=new t(this.options),this.model.on("change:availableOptions",this.render,this),this.registerListeners(),this.render(),this.Eggshell.trigger("ready")},events:{"change select.multi":"removeAvailableSelect","click .dropdown-trigger":"displayDropdown","click .select-option":"removeAvailableAuto","click button.btn-flat-mini":"removeSelected"},registerListeners:function(){this.Eggshell.listen("get all options",function(e,t){this.Eggshell.trigger("all options",this.model.get("searchOptions"))}),this.Eggshell.listen("get all selected",function(e,t){this.Eggshell.trigger("all selected",this.model.getAllSelected())}),this.Eggshell.listen("set selected",function(e,t){this.model.set("selectedOptions",t),this.model.setAvailableOptions()}),this.Eggshell.listen("set targets",function(e,t){this.model.set("searchOptions",t),this.model.setAvailableOptions(),this.render()}),this.Eggshell.listen("render",function(e,t){this.render()}),this.Eggshell.listen("get height",function(e,t){var i=this.$el.find(".selected-options").height();this.Eggshell.trigger("element height",i)}),this.Eggshell.listen("collapse dropdown",function(e,t){0<this.$(".smart-select").length&&this.$(".smart-select").addClass("hidden")})},render:function(){return this.$el.empty(),this.$el.html(this.tmpl()),this.$el.append(this.buildSelectedTargets()),this.$el.append(this.buildList()),this},buildSelectedTargets:function(){var s=this.$el.find(".selected-options"),e=this.sort(this.model.get("selectedOptions"));return _.each(e,function(e,t){if(e){var i=$('<button class="btn-flat-mini"></button>').attr("data-label",this.getDisplayLabel(e)).attr("data-value",t).text(this.getDisplayLabel(e)).append('<span class="remove-selection"></span>');s.append(i)}},this),"auto"==this.model.get("selectListType")&&0<_.size(this.model.get("availableOptions"))&&s.append($('<span class="dropdown-trigger"></span>').text(this.model.get("selectDefault"))),this.Eggshell.trigger("all selected",this.model.getAllSelected()),s},getDisplayLabel:function(i){var e=this.model.get("selectedOptions"),t;return _.find(e,function(e,t){return t==i||e==i},this)},buildList:function(){var e=this.model.get("selectListType");return"select"==e?this.buildSelectList():"auto"==e?this.buildAutoList():void 0},buildSelectList:function(){var s=$(this.tmplSelect({defaultOption:this.model.get("selectDefault")})),e=this.sort(this.model.get("availableOptions"));return s.attr("name",this.model.get("selectBoxName")),$.each(e,function(e,t){var i=$("<option></option>").attr("value",e).text(t);s.append(i)}),s},buildAutoList:function(){var s=$('<div class="selections"></div>'),e=this.sort(this.model.get("availableOptions")),t;return s.attr("name",this.model.get("selectBoxName")),$.each(e,function(e,t){if(e&&t){var i=$('<div class="select-option"></div>').attr("data-value",e).attr("data-label",t).text(t);s.append(i)}}),$(this.tmplAuto()).append(s)},displayDropdown:function(){0<_.size(this.model.get("availableOptions"))&&(this.$(".smart-select").hasClass("hidden")?this.$(".smart-select").removeClass("hidden"):this.$(".smart-select").addClass("hidden")),this.Eggshell.trigger("display drop down")},sort:function(e){if(this.model.get("sortFlag"))return e;var t={},i,s=[];for(i in e)e.hasOwnProperty(i)&&s.push(i);for(s.sort(),i=0;i<s.length;i++)t[s[i]]=e[s[i]];return t},removeSelected:function(e){var t=$(e.currentTarget),i=t.attr("data-value"),s=t.attr("data-label"),o=this.model.get("selectedOptions"),n=this.model.get("availableOptions");e.preventDefault(),e.stopPropagation(),o=_.omit(o,i),n[i]=s,this.model.set("selectedOptions",o),this.model.set("availableOptions",n),this.Eggshell.trigger("ready"),this.render()},removeAvailableAuto:function(e){var t=$(e.currentTarget),i=t.attr("data-value"),s=t.attr("data-label");this.removeAvailable(s,i),this.$(".smart-select").addClass("hidden"),e.preventDefault(),e.stopPropagation()},removeAvailableSelect:function(e){var t=$(e.currentTarget),i=this.$(".select-mini option:selected").html(),s=t.val();this.removeAvailable(i,s),e.preventDefault(),e.stopPropagation()},removeAvailable:function(e,t){var i=this.model.get("selectedOptions"),s=this.model.get("availableOptions");s=_.omit(s,t),i[t]=e,this.model.set("selectedOptions",i),this.model.set("availableOptions",s)}})}()),Eggshell.define("C.Eggshell.stream.comment",{inputs:["render"],outputs:["ready","error","avatar clicked","author clicked","comment liked","comment is deleted"]},C.View.extend({templateCommentView:_.template('<div class="comment"><div class="comment-avatar-container"></div><div class="comment-body-container"><% if(C.global.userUuid == data.author.id || C.global.userUuid == data.author.userUuid){ %><a href="#" title="Delete this" class="delete-comment"></a><% } %><div class="comment-header"><% if(data.author){ %><a href="<%- data.author.url %>" class="comment-author-name capitalized"><%- data.author.name %></a> &bull; <% } %> <span class="post-timestamp"><%- this.formatTimeStamp(data.createdAt) %></span> &bull; <span class="comment-like-container"></span></div><div class="comment-body"><%- data.body %></div></div></div>'),initialize:function(){this.registerListeners();try{this.render()}catch(e){this.Eggshell.trigger("error")}},render:function(){this.$el.html(this.templateCommentView({data:this.model})),this.model.author&&Eggshell.create("C.common.avatar",{el:this.$(".comment-avatar-container")}).trigger("set avatar id",this.model.author.userUuid).trigger("set size","small").trigger("set border",!0).trigger("set avatar link url",this.model.author.url).trigger("update avatar image url",this.model.author.icon);var e=this.$el.find(".comment-like-container")[0],t=$.extend(this.model,{targetId:this.model.id,el:e,type:"comment"}),i=Eggshell.create("C.Eggshell.stream.like",t);i.on("liked",function(){this.Eggshell.trigger("comment liked")},this),Eggshell.trigger(i,"render"),this.Eggshell.trigger("ready")},registerListeners:function(){},formatTimeStamp:function(e){var e=moment.unix(e),t;return moment(e,"YYYYMMDD").fromNow()},events:{"click .comment-avatar":"avatarClicked","click .comment-author-name":"authorClicked","click a.delete-comment":"deletePostChallenge"},avatarClicked:function(){this.Eggshell.trigger("avatar clicked")},authorClicked:function(){this.Eggshell.trigger("author clicked")},deletePostChallenge:function(e){this.dialogCommentNS=Eggshell.create("C.Eggshell.dialog",{el:"body"}),Eggshell.trigger(this.dialogCommentNS,"set headline",C.resource.fetch("C.Eggshell.stream.comment.delete.header")),Eggshell.trigger(this.dialogCommentNS,"set sub headline",C.resource.fetch("C.Eggshell.stream.comment.delete.confirmation")),Eggshell.trigger(this.dialogCommentNS,"hide icon"),Eggshell.trigger(this.dialogCommentNS,"enable default control"),Eggshell.trigger(this.dialogCommentNS,"set primary button",C.resource.fetch("C.Eggshell.stream.comment.button.delete")),Eggshell.trigger(this.dialogCommentNS,"set secondary button",C.resource.fetch("C.Eggshell.stream.comment.button.cancel")),Eggshell.listen(this.dialogCommentNS,"primary button clicked",$.proxy(function(){this.deleteComment(),Eggshell.trigger(this.dialogCommentNS,"hide"),Eggshell.destroy(this.dialogCommentNS)},this)),Eggshell.listen(this.dialogCommentNS,"secondary button clicked",$.proxy(function(){Eggshell.trigger(this.dialogCommentNS,"hide")},this)),Eggshell.trigger(this.dialogCommentNS,"show"),Eggshell.listen(this.dialogCommentNS,"hidden",$.proxy(function(){Eggshell.destroy(this.dialogCommentNS)},this)),e.preventDefault(),e.stopPropagation()},deleteComment:function(){var e=this.model.id;$.ajax({context:this,url:"/_ajax/odin",dataType:"json",type:"POST",data:{url:"/v1/stream-comment/"+e,method:"DELETE",token:C.global.csrfToken,payload:JSON.stringify({})},success:function(e){200==e.httpCode&&this.$el.animate({opacity:0,height:0},500,$.proxy(function(){this.$el.remove(),this.Eggshell.trigger("comment is deleted")},this))},error:function(e,t){Eggshell.trigger(this.dialogNS,"hide")}})}})),C.resource.add("C.Eggshell.stream.comment.list.btn.txt","Comment"),C.resource.add("C.Eggshell.stream.comment.list.more.singular"," more comment"),C.resource.add("C.Eggshell.stream.comment.list.more.plural"," more comments"),C.resource.add("C.Eggshell.stream.comment.list.placeholder.add","Add comment"),C.resource.add("C.Eggshell.stream.comment.list.show","Show "),C.resource.add("C.Eggshell.stream.comment.delete.header","Delete Comment"),C.resource.add("C.Eggshell.stream.comment.delete.confirmation","Are you sure you want to delete this comment?"),C.resource.add("C.Eggshell.stream.comment.button.delete","Delete"),C.resource.add("C.Eggshell.stream.comment.button.cancel","Cancel"),Eggshell.define("C.Eggshell.stream.commentList",{inputs:["get content area","user needs a name","update"],outputs:["ready","get one comment","comment added","comment avatar clicked","comment liked","more comments loaded"]},C.View.extend({template:_.template('<div class="add-comment-container"><button class="btn-outline-sm add-comment-button">Comment</button><div class="comment-avatar"/><div class="add-comment-input-container"></div><div class="loading-indicator"></div></div>'),initialize:function(){this.registerListeners(),this.render()},render:function(){this.$el.empty();var e={thisUserAvatar:C.global.userAvatar,thisUserUuid:C.global.userUuid},t=$.extend({},this.model.comments);$.each(t,$.proxy(function(e,t){var i=Eggshell.create("C.Eggshell.stream.comment",{el:this.$el,model:t});this.registerCommentEvent(i,t)},this)),this.model.thisUserAvatar||(this.model.thisUserAvatar=e.thisUserAvatar),this.$el.append(this.template({data:this.model})),Eggshell.create("C.common.avatar",{el:this.$(".comment-avatar")}).trigger("set avatar id",C.global.userUuid).trigger("set size","small").trigger("set border",!0).trigger("update avatar image url",this.model.thisUserAvatar);var i=2,s=this.model.commentsTotal,o=1<s-2?" more comments":" more comment";2<s&&this.$el.prepend('<a href="#" class="load-more-comments">Show '+(s-2)+o+"</a>");var n=this.$el.find(".add-comment-input-container");this.createNewFlexheightBox(n)},registerListeners:function(){this.Eggshell.listen("get content area",function(e,t){this.Eggshell.trigger("content area",$.extend({},this.$(".item-post-comments")))}),this.Eggshell.listen("get one comment",function(e,t){this.getComment(t)}),Eggshell.listen("C.Eggshell.stream.postbox","user needs a name",function(e,t){}),Eggshell.listen("C.Eggshell.stream.commentList","hide add comment box",function(e,t){this.$(".add-comment-container").hide()},this),Eggshell.listen("C.Eggshell.stream.commentList","show add comment box",function(e,t){this.$(".add-comment-container").show()},this)},createNewFlexheightBox:function(e){this.flexHeight=Eggshell.create("C.Eggshell.flexible.area",{el:e,classes:["add-comment-input"],placeholder:"Add comment",maxlength:1e3}),Eggshell.listen(this.flexHeight,"focus",$.proxy(function(e,t){this.giveFocus()},this)),Eggshell.listen(this.flexHeight,"blur",$.proxy(function(e,t){this.looseFocus()},this)),Eggshell.listen(this.flexHeight,"output text",function(e,t){this.commentText=t},this)},events:{"click .add-comment-button":"addComment","click a.load-more-comments":"loadMoreComments"},addComment:function(){this.$el.find(".add-comment-container").removeClass("active"),this.$el.find(".add-comment-container").addClass("posting"),Eggshell.trigger(this.flexHeight,"get text");var e=C.utility.dataLogger();e.impressionId=this.model.tracker&&this.model.tracker.impressionId?this.model.tracker.impressionId:"",$.trim(this.commentText)?$.ajax({context:this,url:"/_ajax/odin",dataType:"json",type:"POST",data:{url:"/v1/stream-comment",method:"POST",payload:JSON.stringify({author:{org:"chegg",type:"user",userUuid:C.global.userUuid},targetId:this.model.id,body:this.commentText,tracker:e}),token:C.global.csrfToken},success:function(e){200==e.httpCode&&e.result&&(this.Eggshell.trigger("get one comment",{postId:this.model.id,commentId:e.result.id}),this.Eggshell.trigger("comment added"))},error:function(e,t){403==e.status&&C.utility.showCsrfMessage()}}):this.resetAddCommentBox()},getComment:function(e){var t=e.postId,i=e.commentId;$.ajax({context:this,url:"/_ajax/odin",dataType:"json",type:"POST",data:{url:"/v1/stream-post/"+t+"/details",method:"POST",token:C.global.csrfToken,payload:JSON.stringify({maxComments:1,commentMarker:i,tracker:C.utility.dataLogger()})},success:function(e){if(200==e.httpCode&&e.result){var t=$("<div>").insertBefore(this.$el.find(".add-comment-container")),i=Eggshell.create("C.Eggshell.stream.comment",{el:t,model:e.result.comments[0]});this.registerCommentEvent(i,e.result.comments[0]),this.resetAddCommentBox()}},error:function(e,t){this.resetAddCommentBox();var i=$("<div>").insertBefore(this.$el.find(".add-comment-container"));Eggshell.create("C.eggshell.message.error",{el:i}).trigger("set error message size","small").trigger("set error text","Failed to add a comment. Please refresh your page and try again."),this.$el.find(".add-comment-container").hide()}})},loadMoreComments:function(e){e.preventDefault(),e.stopPropagation();var t=this.model.id;$.ajax({context:this,url:"/_ajax/odin",dataType:"json",type:"POST",data:{url:"/v1/stream-post/"+t+"/details",method:"POST",token:C.global.csrfToken,payload:JSON.stringify({maxComments:1e5,tracker:C.utility.dataLogger()})},success:function(e){200==e.httpCode&&e.result&&(this.model=$.extend({},e.result),this.render(),this.$el.find(".load-more-comments").remove(),this.Eggshell.trigger("more comments loaded"))},error:function(e,t){}})},giveFocus:function(){this.$el.find(".add-comment-container").addClass("active")},looseFocus:function(){""!==this.$el.find(".add-comment-input").val()&&null!==this.$el.find(".add-comment-input").val()||this.$el.find(".add-comment-container").removeClass("active")},resetAddCommentBox:function(){this.$el.find(".add-comment-container").removeClass("posting"),Eggshell.destroy(this.flexHeight);var e=this.$el.find(".add-comment-input-container");this.createNewFlexheightBox(e)},registerCommentEvent:function(e,t){e.on("avatar clicked",function(){this.Eggshell.trigger("comment avatar clicked")},this).on("author clicked",function(){this.Eggshell.trigger("comment author clicked")},this).on("comment liked",function(){this.Eggshell.trigger("comment liked")},this).on("impression fired",$.proxy(function(){Eggshell.create("C.common.beacon").trigger("send beacon request",{impressionId:this.tracker.impressionId,eventTargetId:this.id,eventType:"COMMENT_IMPRESSION"})},t)).trigger("track impression")}})),Eggshell.define("C.eggshell.linkify",{inputs:["set plain text","get linkified text"],outputs:["linkified text"]},function(e){this.$el=e.el,Eggshell.shell(this).on("set plain text",function(e,t){if(!t||"string"!=typeof t)throw"Invalid text";this.$el.html(t),this.$el.linkify({httpOnly:!0,excludedExtensions:["torrent","exe","dmg"],target:"_blank"})}).on("get linkified text",function(e,t){Eggshell.shell(this).trigger("linkified text",this.$el.html())})}),function(a){a.fn.linkify=function(n){return this.each(function(){var e=a(this),t,i=!0,s="_self",o=null;n&&("function"==typeof n?t=n:("function"==typeof n.hashtagUrlBuilder&&(t=n.hashtagUrlBuilder),"boolean"==typeof n.includeW3&&(i=n.includeW3),"boolean"==typeof n.httpOnly&&(httpOnly=n.httpOnly),"string"==typeof n.target&&(s=n.target),n.excludedExtensions&&"number"==typeof n.excludedExtensions.length&&(o=n.excludedExtensions))),e.html(linkify(e.html(),t,i,s,o,httpOnly))})}}(jQuery),C.resource.add("C.common.getapp.success.message","Check your phone to download the Chegg app."),C.resource.add("C.common.getapp.error.fail.message","We failed to deliver the text message. Please try again."),C.resource.add("C.common.getapp.error.invalid.number","Invalid phone number."),C.resource.add("C.common.getapp.dialog.headline","Download the Chegg App"),C.resource.add("C.common.getapp.dialog.subheader","Get the Chegg app texted to you. Don't worry we won't keep or share your digits."),C.resource.add("C.common.getapp.dialog.disclaimer",'Standard messaging rates apply. An automated-telephone-dialer robot, Robby, will be texting you. No chit-chat please he\'ll get distracted. Robby says consent is not required to purchase goods or services. Read his masterwork, \'The Chegg Guidelines of <a class="disclosures" href="/mobiledisclosures">Mobile Disclosures</a>\' if you want to impress him.'),C.resource.add("C.common.getapp.dialog.button","Get the app"),Eggshell.define("C.common.getapp",{inputs:["render","show"],outputs:[]},Backbone.View.extend({initialize:function(){this.render(),Eggshell.find(this).on("show",this.show).on("render",this.render)},render:function(){this.dialog=Eggshell.create("C.Eggshell.dialog",{el:this.$el}).trigger("set headline",C.resource.fetch("C.common.getapp.dialog.headline")).trigger("hide control").trigger("hide sub headline").trigger("hide icon").on("content area",function(e,t){t.empty().html(this.template({subheader:C.resource.fetch("C.common.getapp.dialog.subheader"),disclaimer:C.resource.fetch("C.common.getapp.dialog.disclaimer"),button:C.resource.fetch("C.common.getapp.dialog.button")})),this.$message=this.$el.find(".message"),this.$inputWrapper=this.$el.find(".getapp-input-wrapper"),this.$phoneNumber=this.$el.find("#phone-number")},this).trigger("get content area")},template:_.template('<div class="primary-page"> <h4><%- subheader %></h4> <div id="disclaimer"><%= disclaimer %></div> <div class="getapp-content">     <div class="message"></div>     <div class="getapp-input-wrapper">         <input id="phone-number" textvalue="888-888-8888" placeholder="888-888-8888" autocomplete="off" name="search" />         <input type="submit" id="get-app-btn" class="btn-primary-lg" value="<%- button %>" />     </div> </div> <div id="app-store-wrapper">     <a href="https://itunes.apple.com/us/app/chegg-textbooks-etextbooks/id385758163?mt=8" class="chegg-event" event-name="logout_ios_download_click" target="_blank">         <img src="/s/_common/getapp/images/appstore-logo.png"/>     </a>&nbsp;&nbsp;     <a href="https://play.google.com/store/apps/details?id=com.chegg&hl=en" class="chegg-event" event-name="logout_android_download_click" target="_blank">         <img src="/s/_common/getapp/images/googleplay-logo.png"/>     </a> </div></div>'),events:{"click #get-app-btn":"getTheApp","click .chegg-event":"logEvent","click a.disclosures":"hide"},show:function(e){this.$message.html(""),this.$phoneNumber.val(""),this.hideMsg(),this.$inputWrapper.removeClass("hidden"),this.dialog.trigger("show")},hide:function(e){this.dialog.trigger("hide")},getTheApp:function(e){var t=this,i=this.$phoneNumber.val();e.preventDefault(),e.stopPropagation(),this.hideMsg(),this.validatePhoneNumber(i)?(this.createSpinner(),$.ajax({type:"POST",url:"/_ajax/gettheapp",data:"pn="+encodeURIComponent(i)}).done(function(e){t.$inputWrapper.addClass("hidden"),t.displayMsg(C.resource.fetch("C.common.getapp.success.message"),"msg-success")}).fail(function(e){t.displayMsg(C.resource.fetch("C.common.getapp.error.fail.message"),"msg-error")}).always(function(e){t.removeSpinner()}),C.logger.doEventLog({event_name:"logout_download_app"})):this.displayMsg(C.resource.fetch("C.common.getapp.error.invalid.number"),"msg-error")},validatePhoneNumber:function(e){var t=/^\d{10}$/,i;return!!$.trim(e.replace(/-/g,"")).match(t)},hideMsg:function(e,t){this.$message.html(""),this.$message.addClass("hidden")},displayMsg:function(e,t){this.$message.attr("class","message "+t),this.$message.html(e),this.$message.removeClass("hidden")},createSpinner:function(){var e='<div class="cvload"></div>',t='<canvas class="loading" width="70" height="70"><img src="'+this.ajaxLoaderImg+'"></canvas>',i=$(e).html(t);this.$message.addClass("hidden"),this.$inputWrapper.addClass("hidden"),this.$message.before(i),this.spinner=new C.widget.spinner({canvas:i.find("canvas")})},removeSpinner:function(){var e;this.$el.find(".cvload").remove(),this.spinner&&this.spinner.destroy()},logEvent:function(e){e.preventDefault(),e.stopPropagation();var t=$(e.target).parent(".chegg-event"),i=t.attr("href"),s=t.attr("event-name");C.logger.doEventLog({event_name:s},function(){window.location=i})}})),Eggshell.define("C.common.page.l",{inputs:["get main content area"],outputs:["return main content"]},function(e){"use strict";this.$el=e.el,this.render=function(){this.$el.empty(),this.$el.html('<div class="c-page l"><div class="c-page-mainCol"><div class="c-page-mainCol-content"></div></div></div>')},this.getMainContent=function(){var e=$.extend({},$(".c-page-mainCol-content",this.$el));this.Eggshell.trigger("return main content",e)},Eggshell.find(this).listen("get main content area",this.getMainContent),!1!==e.newNode&&this.render()}),Eggshell.define("C.common.page.l-s",{inputs:["get main content area","get right col content","get ad content"],outputs:["return main content","return right col content","return ad content"]},function(e){"use strict";this.$el=e.el,this.render=function(){this.$el.empty(),this.$el.html('<div class="c-page l-s"><div class="c-page-rightCol"><div class="c-page-rightCol-container"><div class="c-page-rightCol-content"></div></div><div class="c-page-rightCol-adWrapper hidden"><div class="c-page-rightCol-adlabel">Advertisement</div><div class="c-page-rightCol-adContent"></div></div></div><div class="c-page-mainCol"><div class="c-page-mainCol-content"></div></div></div>')},this.getMainContent=function(){var e=$.extend({},$(".c-page-mainCol-content",this.$el));this.Eggshell.trigger("return main content",e)},this.getRightColContent=function(){var e=$.extend({},$(".c-page-rightCol-content",this.$el));this.Eggshell.trigger("return right col content",e)},this.getAdArea=function(){this.Eggshell.trigger("ad area",$.extend({},$(".c-page-rightCol-adContent",this.$el))),$(".c-page-rightCol-adWrapper",this.$el).removeClass("hidden"),this.Eggshell.trigger("return ad content")},Eggshell.find(this).listen("get main content area",this.getMainContent).listen("get right col content",this.getRightColContent).listen("get ad content",this.getAdArea),!1!==e.newNode&&this.render()}),Eggshell.define("C.common.page.f-l-s",{inputs:["get top content area","get main content area","get right col content","get ad content"],outputs:["return top content","return main content","return right col content","return ad content"]},function(e){"use strict";this.$el=e.el,this.render=function(){this.$el.empty(),this.$el.html('<div class="c-page f-l-s"><div class="c-page-topRow"><div class="c-page-topRow-content"></div></div><div class="c-page-rightCol"><div class="c-page-rightCol-container"><div class="c-page-rightCol-content"></div></div><div class="c-page-rightCol-adWrapper hidden"><div class="c-page-rightCol-adlabel">Advertisement</div><div class="c-page-rightCol-adContent"></div></div></div><div class="c-page-mainCol"><div class="c-page-mainCol-content"></div></div></div>')},this.getTopContent=function(){var e=$.extend({},$(".c-page-topRow-content",this.$el));this.Eggshell.trigger("return top content",e)},this.getMainContent=function(){var e=$.extend({},$(".c-page-mainCol-content",this.$el));this.Eggshell.trigger("return main content",e)},this.getRightColContent=function(){var e=$.extend({},$(".c-page-rightCol-content",this.$el));this.Eggshell.trigger("return right col content",e)},this.getAdArea=function(){this.Eggshell.trigger("return ad content",$.extend({},$(".c-page-rightCol-adContent",this.$el))),$(".c-page-rightCol-adWrapper",this.$el).removeClass("hidden")},Eggshell.find(this).on("get top content area",this.getTopContent).on("get main content area",this.getMainContent).on("get right col content",this.getRightColContent).on("get ad content",this.getAdArea),!1!==e.newNode&&this.render()}),function(M){"use strict";var y={};function i(e){var t=e.data;e.isDefaultPrevented()||(e.preventDefault(),M(this).ajaxSubmit(t))}function s(e){var t=e.target,i=M(t);if(!i.is("[type=submit],[type=image]")){var s=i.closest("[type=submit]");if(0===s.length)return;t=s[0]}var o=this;if("image"==(o.clk=t).type)if(void 0!==e.offsetX)o.clk_x=e.offsetX,o.clk_y=e.offsetY;else if("function"==typeof M.fn.offset){var n=i.offset();o.clk_x=e.pageX-n.left,o.clk_y=e.pageY-n.top}else o.clk_x=e.pageX-t.offsetLeft,o.clk_y=e.pageY-t.offsetTop;setTimeout(function(){o.clk=o.clk_x=o.clk_y=null},100)}function B(){if(M.fn.ajaxSubmit.debug){var e="[jquery.form] "+Array.prototype.join.call(arguments,"");window.console&&window.console.log?window.console.log(e):window.opera&&window.opera.postError&&window.opera.postError(e)}}y.fileapi=void 0!==M("<input type='file'/>").get(0).files,y.formdata=void 0!==window.FormData,M.fn.ajaxSubmit=function(D){if(!this.length)return B("ajaxSubmit: skipping submit process - no element selected"),this;var P,e,t,A=this;"function"==typeof D&&(D={success:D}),P=this.attr("method"),t=(t=(t="string"==typeof(e=this.attr("action"))?M.trim(e):"")||window.location.href||"")&&(t.match(/^([^#]+)/)||[])[1],D=M.extend(!0,{url:t,success:M.ajaxSettings.success,type:P||"GET",iframeSrc:/^https/i.test(window.location.href||"")?"javascript:false":"about:blank"},D);var i={};if(this.trigger("form-pre-serialize",[this,D,i]),i.veto)return B("ajaxSubmit: submit vetoed via form-pre-serialize trigger"),this;if(D.beforeSerialize&&!1===D.beforeSerialize(this,D))return B("ajaxSubmit: submit aborted via beforeSerialize callback"),this;var s=D.traditional;void 0===s&&(s=M.ajaxSettings.traditional);var N=[],o,n=this.formToArray(D.semantic,N);if(D.data&&(D.extraData=D.data,o=M.param(D.data,s)),D.beforeSubmit&&!1===D.beforeSubmit(n,this,D))return B("ajaxSubmit: submit aborted via beforeSubmit callback"),this;if(this.trigger("form-submit-validate",[n,this,D,i]),i.veto)return B("ajaxSubmit: submit vetoed via form-submit-validate trigger"),this;var a=M.param(n,s);o&&(a=a?a+"&"+o:o),"GET"==D.type.toUpperCase()?(D.url+=(0<=D.url.indexOf("?")?"&":"?")+a,D.data=null):D.data=a;var r=[];if(D.resetForm&&r.push(function(){A.resetForm()}),D.clearForm&&r.push(function(){A.clearForm(D.includeHidden)}),!D.dataType&&D.target){var l=D.success||function(){};r.push(function(e){var t=D.replaceTarget?"replaceWith":"html";M(D.target)[t](e).each(l,arguments)})}else D.success&&r.push(D.success);D.success=function(e,t,i){for(var s=D.context||this,o=0,n=r.length;o<n;o++)r[o].apply(s,[e,t,i||A,A])};var c,d=0<M('input[type=file]:enabled[value!=""]',this).length,h="multipart/form-data",g=A.attr("enctype")==h||A.attr("encoding")==h,u=y.fileapi&&y.formdata;B("fileAPI :"+u);var p=(d||g)&&!u,m;!1!==D.iframe&&(D.iframe||p)?D.closeKeepAlive?M.get(D.closeKeepAlive,function(){m=C(n)}):m=C(n):m=(d||g)&&u?v(n):M.ajax(D),A.removeData("jqxhr").data("jqxhr",m);for(var f=0;f<N.length;f++)N[f]=null;return this.trigger("form-submit-notify",[this,D]),this;function b(e){var t=M.param(e).split("&"),i=t.length,s=[],o,n;for(o=0;o<i;o++)t[o]=t[o].replace(/\+/g," "),n=t[o].split("="),s.push([decodeURIComponent(n[0]),decodeURIComponent(n[1])]);return s}function v(e){for(var i=new FormData,t=0;t<e.length;t++)i.append(e[t].name,e[t].value);if(D.extraData){var s=b(D.extraData);for(t=0;t<s.length;t++)s[t]&&i.append(s[t][0],s[t][1])}D.data=null;var o=M.extend(!0,{},M.ajaxSettings,D,{contentType:!1,processData:!1,cache:!1,type:P||"POST"});D.uploadProgress&&(o.xhr=function(){var e=jQuery.ajaxSettings.xhr();return e.upload&&e.upload.addEventListener("progress",function(e){var t=0,i=e.loaded||e.position,s=e.total;e.lengthComputable&&(t=Math.ceil(i/s*100)),D.uploadProgress(e,i,s,t)},!1),e}),o.data=null;var n=o.beforeSend;return o.beforeSend=function(e,t){t.data=i,n&&n.call(this,e,t)},M.ajax(o)}function C(e){var a=A[0],t,i,d,h,r,g,u,p,s,o,m,f,n=!!M.fn.prop,b=M.Deferred();if(e)for(i=0;i<N.length;i++)t=M(N[i]),n?t.prop("disabled",!1):t.removeAttr("disabled");if((d=M.extend(!0,{},M.ajaxSettings,D)).context=d.context||d,r="jqFormIO"+(new Date).getTime(),d.iframeTarget?(o=(g=M(d.iframeTarget)).attr("name"))?r=o:g.attr("name",r):(g=M('<iframe name="'+r+'" src="'+d.iframeSrc+'" />')).css({position:"absolute",top:"-1000px",left:"-1000px"}),u=g[0],p={aborted:0,responseText:null,responseXML:null,status:0,statusText:"n/a",getAllResponseHeaders:function(){},getResponseHeader:function(){},setRequestHeader:function(){},abort:function(e){var t="timeout"===e?"timeout":"aborted";B("aborting upload... "+t),this.aborted=1;try{u.contentWindow.document.execCommand&&u.contentWindow.document.execCommand("Stop")}catch(e){}g.attr("src",d.iframeSrc),p.error=t,d.error&&d.error.call(d.context,p,t,e),h&&M.event.trigger("ajaxError",[p,d,t]),d.complete&&d.complete.call(d.context,p,t)}},(h=d.global)&&0==M.active++&&M.event.trigger("ajaxStart"),h&&M.event.trigger("ajaxSend",[p,d]),d.beforeSend&&!1===d.beforeSend.call(d.context,p,d))return d.global&&M.active--,b.reject(),b;if(p.aborted)return b.reject(),b;(s=a.clk)&&(o=s.name)&&!s.disabled&&(d.extraData=d.extraData||{},d.extraData[o]=s.value,"image"==s.type&&(d.extraData[o+".x"]=a.clk_x,d.extraData[o+".y"]=a.clk_y));var v=1,C=2;function y(e){var t;return e.contentWindow?e.contentWindow.document:e.contentDocument?e.contentDocument:e.document}var l=M("meta[name=csrf-token]").attr("content"),c=M("meta[name=csrf-param]").attr("content");function w(){var e=A.attr("target"),t=A.attr("action");function i(){try{var e=y(u).readyState;B("state = "+e),e&&"uninitialized"==e.toLowerCase()&&setTimeout(i,50)}catch(e){B("Server abort: ",e," (",e.name,")"),T(C),f&&clearTimeout(f),f=void 0}}a.setAttribute("target",r),P||a.setAttribute("method","POST"),t!=d.url&&a.setAttribute("action",d.url),d.skipEncodingOverride||P&&!/post/i.test(P)||A.attr({encoding:"multipart/form-data",enctype:"multipart/form-data"}),d.timeout&&(f=setTimeout(function(){m=!0,T(v)},d.timeout));var s=[];try{if(d.extraData)for(var o in d.extraData)d.extraData.hasOwnProperty(o)&&(M.isPlainObject(d.extraData[o])&&d.extraData[o].hasOwnProperty("name")&&d.extraData[o].hasOwnProperty("value")?s.push(M('<input type="hidden" name="'+d.extraData[o].name+'">').val(d.extraData[o].value).appendTo(a)[0]):s.push(M('<input type="hidden" name="'+o+'">').val(d.extraData[o]).appendTo(a)[0]));d.iframeTarget||(g.appendTo("body"),u.attachEvent?u.attachEvent("onload",T):u.addEventListener("load",T,!1)),setTimeout(i,15);try{a.submit()}catch(e){var n;document.createElement("form").submit.apply(a)}}finally{a.setAttribute("action",t),e?a.setAttribute("target",e):A.removeAttr("target"),M(s).remove()}}c&&l&&(d.extraData=d.extraData||{},d.extraData[c]=l),d.forceSync?w():setTimeout(w,10);var k,$,x=50,E;function T(t){if(!p.aborted&&!E){try{$=y(u)}catch(e){B("cannot access response document: ",e),t=C}if(t===v&&p)return p.abort("timeout"),void b.reject(p,"timeout");if(t==C&&p)return p.abort("server abort"),void b.reject(p,"error","server abort");if($&&$.location.href!=d.iframeSrc||m){u.detachEvent?u.detachEvent("onload",T):u.removeEventListener("load",T,!1);var i="success",s;try{if(m)throw"timeout";var e="xml"==d.dataType||$.XMLDocument||M.isXMLDoc($);if(B("isXml="+e),!e&&window.opera&&(null===$.body||!$.body.innerHTML)&&--x)return B("requeing onLoad callback, DOM not available"),void setTimeout(T,250);var o=$.body?$.body:$.documentElement;p.responseText=o?o.innerHTML:null,p.responseXML=$.XMLDocument?$.XMLDocument:$,e&&(d.dataType="xml"),p.getResponseHeader=function(e){var t;return{"content-type":d.dataType}[e]},o&&(p.status=Number(o.getAttribute("status"))||p.status,p.statusText=o.getAttribute("statusText")||p.statusText);var n=(d.dataType||"").toLowerCase(),a=/(json|script|text)/.test(n);if(a||d.textarea){var r=$.getElementsByTagName("textarea")[0];if(r)p.responseText=r.value,p.status=Number(r.getAttribute("status"))||p.status,p.statusText=r.getAttribute("statusText")||p.statusText;else if(a){var l=$.getElementsByTagName("pre")[0],c=$.getElementsByTagName("body")[0];l?p.responseText=l.textContent?l.textContent:l.innerText:c&&(p.responseText=c.textContent?c.textContent:c.innerText)}}else"xml"==n&&!p.responseXML&&p.responseText&&(p.responseXML=_(p.responseText));try{k=I(p,n,d)}catch(e){i="parsererror",p.error=s=e||i}}catch(e){B("error caught: ",e),i="error",p.error=s=e||i}p.aborted&&(B("upload aborted"),i=null),p.status&&(i=200<=p.status&&p.status<300||304===p.status?"success":"error"),"success"===i?(d.success&&d.success.call(d.context,k,"success",p),b.resolve(p.responseText,"success",p),h&&M.event.trigger("ajaxSuccess",[p,d])):i&&(void 0===s&&(s=p.statusText),d.error&&d.error.call(d.context,p,i,s),b.reject(p,"error",s),h&&M.event.trigger("ajaxError",[p,d,s])),h&&M.event.trigger("ajaxComplete",[p,d]),h&&!--M.active&&M.event.trigger("ajaxStop"),d.complete&&d.complete.call(d.context,p,i),E=!0,d.timeout&&clearTimeout(f),setTimeout(function(){d.iframeTarget||g.remove(),p.responseXML=null},100)}}}var _=M.parseXML||function(e,t){return window.ActiveXObject?((t=new ActiveXObject("Microsoft.XMLDOM")).async="false",t.loadXML(e)):t=(new DOMParser).parseFromString(e,"text/xml"),t&&t.documentElement&&"parsererror"!=t.documentElement.nodeName?t:null},S=M.parseJSON||function(e){return window.eval("("+e+")")},I=function(e,t,i){var s=e.getResponseHeader("content-type")||"",o="xml"===t||!t&&0<=s.indexOf("xml"),n=o?e.responseXML:e.responseText;return o&&"parsererror"===n.documentElement.nodeName&&M.error&&M.error("parsererror"),i&&i.dataFilter&&(n=i.dataFilter(n,t)),"string"==typeof n&&("json"===t||!t&&0<=s.indexOf("json")?n=S(n):("script"===t||!t&&0<=s.indexOf("javascript"))&&M.globalEval(n)),n};return b}},M.fn.ajaxForm=function(e){if((e=e||{}).delegation=e.delegation&&M.isFunction(M.fn.on),e.delegation||0!==this.length)return e.delegation?(M(document).off("submit.form-plugin",this.selector,i).off("click.form-plugin",this.selector,s).on("submit.form-plugin",this.selector,e,i).on("click.form-plugin",this.selector,e,s),this):this.ajaxFormUnbind().bind("submit.form-plugin",e,i).bind("click.form-plugin",e,s);var t={s:this.selector,c:this.context};return!M.isReady&&t.s?(B("DOM not ready, queuing ajaxForm"),M(function(){M(t.s,t.c).ajaxForm(e)})):B("terminating; zero elements found by selector"+(M.isReady?"":" (DOM not ready)")),this},M.fn.ajaxFormUnbind=function(){return this.off("submit.form-plugin click.form-plugin")},M.fn.formToArray=function(e,t){var i=[];if(0===this.length)return i;var s=this[0],o=e?s.getElementsByTagName("*"):s.elements,n,a,r,l,c,d,h;if(!o)return i;for(n=0,d=o.length;n<d;n++)if(r=(c=o[n]).name)if(e&&s.clk&&"image"==c.type)c.disabled||s.clk!=c||(i.push({name:r,value:M(c).val(),type:c.type}),i.push({name:r+".x",value:s.clk_x},{name:r+".y",value:s.clk_y}));else if((l=M.fieldValue(c,!0))&&l.constructor==Array)for(t&&t.push(c),a=0,h=l.length;a<h;a++)i.push({name:r,value:l[a]});else if(y.fileapi&&"file"==c.type&&!c.disabled){t&&t.push(c);var g=c.files;if(g.length)for(a=0;a<g.length;a++)i.push({name:r,value:g[a],type:c.type});else i.push({name:r,value:"",type:c.type})}else null!=l&&(t&&t.push(c),i.push({name:r,value:l,type:c.type,required:c.required}));if(!e&&s.clk){var u=M(s.clk),p=u[0];(r=p.name)&&!p.disabled&&"image"==p.type&&(i.push({name:r,value:u.val()}),i.push({name:r+".x",value:s.clk_x},{name:r+".y",value:s.clk_y}))}return i},M.fn.formSerialize=function(e){return M.param(this.formToArray(e))},M.fn.fieldSerialize=function(o){var n=[];return this.each(function(){var e=this.name;if(e){var t=M.fieldValue(this,o);if(t&&t.constructor==Array)for(var i=0,s=t.length;i<s;i++)n.push({name:e,value:t[i]});else null!=t&&n.push({name:this.name,value:t})}}),M.param(n)},M.fn.fieldValue=function(e){for(var t=[],i=0,s=this.length;i<s;i++){var o=this[i],n=M.fieldValue(o,e);null==n||n.constructor==Array&&!n.length||(n.constructor==Array?M.merge(t,n):t.push(n))}return t},M.fieldValue=function(e,t){var i=e.name,s=e.type,o=e.tagName.toLowerCase();if(void 0===t&&(t=!0),t&&(!i||e.disabled||"reset"==s||"button"==s||("checkbox"==s||"radio"==s)&&!e.checked||("submit"==s||"image"==s)&&e.form&&e.form.clk!=e||"select"==o&&-1==e.selectedIndex))return null;if("select"!=o)return M(e).val();var n=e.selectedIndex;if(n<0)return null;for(var a=[],r=e.options,l="select-one"==s,c=l?n+1:r.length,d=l?n:0;d<c;d++){var h=r[d];if(h.selected){var g=h.value;if(g=g||(h.attributes&&h.attributes.value&&!h.attributes.value.specified?h.text:h.value),l)return g;a.push(g)}}return a},M.fn.clearForm=function(e){return this.each(function(){M("input,select,textarea",this).clearFields(e)})},M.fn.clearFields=M.fn.clearInputs=function(i){var s=/^(?:color|date|datetime|email|month|number|password|range|search|tel|text|time|url|week)$/i;return this.each(function(){var e=this.type,t=this.tagName.toLowerCase();s.test(e)||"textarea"==t?this.value="":"checkbox"==e||"radio"==e?this.checked=!1:"select"==t?this.selectedIndex=-1:"file"==e?/MSIE/.test(navigator.userAgent)?M(this).replaceWith(M(this).clone()):M(this).val(""):i&&(!0===i&&/hidden/.test(e)||"string"==typeof i&&M(this).is(i))&&(this.value="")})},M.fn.resetForm=function(){return this.each(function(){"function"!=typeof this.reset&&("object"!=typeof this.reset||this.reset.nodeType)||this.reset()})},M.fn.enable=function(e){return void 0===e&&(e=!0),this.each(function(){this.disabled=!e})},M.fn.selected=function(i){return void 0===i&&(i=!0),this.each(function(){var e=this.type;if("checkbox"==e||"radio"==e)this.checked=i;else if("option"==this.tagName.toLowerCase()){var t=M(this).parent("select");i&&t[0]&&"select-one"==t[0].type&&t.find("option").selected(!1),this.selected=i}})},M.fn.ajaxSubmit.debug=!1}(jQuery),function(ut){ut.Jcrop=function(e,t){var _=ut.extend({},ut.Jcrop.defaults),n,i,s=!1;function S(e){return e+"px"}function I(e){return _.baseClass+"-"+e}function o(){return ut.fx.step.hasOwnProperty("backgroundColor")}function a(e){var t=ut(e).offset();return[t.left,t.top]}function r(e){return[e.pageX-n[0],e.pageY-n[1]]}function l(e){"object"!=typeof e&&(e={}),_=ut.extend(_,e),ut.each(["onChange","onSelect","onRelease","onDblClick"],function(e,t){"function"!=typeof _[t]&&(_[t]=function(){})})}function c(e,t){if(n=a(N),Ne.setCursor("move"===e?e:e+"-resize"),"move"===e)return Ne.activateHandlers(h(t),p);var i=te.getFixed(),s=g(e),o=te.getCorner(g(s));te.setPressed(te.getCorner(s)),te.setCurrent(o),Ne.activateHandlers(d(e,i),p)}function d(t,i){return function(e){if(_.aspectRatio)switch(t){case"e":case"w":e[1]=i.y+1;break;case"n":case"s":e[0]=i.x+1}else switch(t){case"e":case"w":e[1]=i.y2;break;case"n":case"s":e[0]=i.x2}te.setCurrent(e),Ae.update()}}function h(e){var t=e;return Qe.watchKeys(),function(e){te.moveOffset([e[0]-t[0],e[1]-t[1]]),t=e,Ae.update()}}function g(e){switch(e){case"n":return"sw";case"s":case"e":return"nw";case"w":return"ne";case"ne":return"sw";case"nw":return"se";case"se":return"nw";case"sw":return"ne"}}function D(t){return function(e){return _.disabled||"move"===t&&!_.allowMove||(n=a(N),J=!0,c(t,r(e)),e.stopPropagation(),e.preventDefault()),!1}}function u(e,t,i){var s=e.width(),o=e.height();t<s&&0<t&&(o=(s=t)/e.width()*e.height()),i<o&&0<i&&(s=(o=i)/e.height()*e.width()),V=e.width()/s,W=e.height()/o,e.width(s).height(o)}function P(e){return{x:e.x*V,y:e.y*W,x2:e.x2*V,y2:e.y2*W,w:e.w*V,h:e.h*W}}function p(e){var t=te.getFixed();t.w>_.minSelect[0]&&t.h>_.minSelect[1]?(Ae.enableHandles(),Ae.done()):Ae.release(),Ne.setCursor(_.allowSelect?"crosshair":"default")}function m(e){if(_.disabled)return!1;if(!_.allowSelect)return!1;J=!0,n=a(N),Ae.disableHandles(),Ne.setCursor("crosshair");var t=r(e);return te.setPressed(t),Ae.update(),Ne.activateHandlers(f,p),Qe.watchKeys(),e.stopPropagation(),e.preventDefault(),!1}function f(e){te.setCurrent(e),Ae.update()}function A(){var e=ut("<div></div>").addClass(I("tracker"));return C.utility.browser.msie&&e.css({opacity:0,backgroundColor:"white"}),e}C.utility.browser.msie&&"6"===C.utility.browser.version.split(".")[0]&&(s=!0),"object"!=typeof e&&(e=ut(e)[0]),"object"!=typeof t&&(t={}),l(t);var b={border:"none",visibility:"visible",margin:0,padding:0,position:"absolute",top:0,left:0},v=ut(e),w=!0;if("IMG"==e.tagName){if(0!=v[0].width&&0!=v[0].height)v.width(v[0].width),v.height(v[0].height);else{var k=new Image;k.src=v[0].src,v.width(k.width),v.height(k.height)}var N=v.clone().removeAttr("id").css(b).show();N.width(v.width()),N.height(v.height()),v.after(N).hide()}else N=v.css(b).show(),w=!1,null===_.shade&&(_.shade=!0);u(N,_.boxWidth,_.boxHeight);var $=N.width(),E=N.height(),T=ut("<div />").width($).height(E).addClass(I("holder")).css({position:"relative",backgroundColor:_.bgColor}).insertAfter(v).append(N);_.addClass&&T.addClass(_.addClass);var M=ut("<div />"),B=ut("<div />").width("100%").height("100%").css({zIndex:310,position:"absolute",overflow:"hidden"}),L=ut("<div />").width("100%").height("100%").css("zIndex",320),O=ut("<div />").css({position:"absolute",zIndex:600}).dblclick(function(){var e=te.getFixed();_.onDblClick.call(gt,e)}).insertBefore(N).append(B,L);w&&(M=ut("<img />").attr("src",N.attr("src")).css(b).width($).height(E),B.append(M)),s&&O.css({overflowY:"hidden"});var q=_.boundary,j=A().width($+2*q).height(E+2*q).css({position:"absolute",top:S(-q),left:S(-q),zIndex:290}).mousedown(m),F=_.bgColor,R=_.bgOpacity,U,H,z,Q,V,W,Y=!0,J,G,K;n=a(N);var X={createDragger:function(t){return function(e){return e.pageX=e.originalEvent.changedTouches[0].pageX,e.pageY=e.originalEvent.changedTouches[0].pageY,_.disabled||"move"===t&&!_.allowMove||(J=!0,c(t,r(e)),e.stopPropagation(),e.preventDefault()),!1}},newSelection:function(e){return e.pageX=e.originalEvent.changedTouches[0].pageX,e.pageY=e.originalEvent.changedTouches[0].pageY,m(e)},isSupported:Z,support:ee()};function Z(){var e={},t=["touchstart","touchmove","touchend"],i=document.createElement("div"),s;try{for(s=0;s<t.length;s++){var o=t[s],n=(o="on"+o)in i;n||(i.setAttribute(o,"return;"),n="function"==typeof i[o]),e[t[s]]=n}return e.touchstart&&e.touchend&&e.touchmove}catch(e){return!1}}function ee(){return!0===_.touchSupport||!1===_.touchSupport?_.touchSupport:Z()}var te=(ne=oe=se=ie=0,{flipCoords:me,setPressed:le,setCurrent:ce,getOffset:de,moveOffset:he,getCorner:ge,getFixed:ue}),ie,se,oe,ne,ae,re;function le(e){e=pe(e),oe=ie=e[0],ne=se=e[1]}function ce(e){e=pe(e),ae=e[0]-oe,re=e[1]-ne,oe=e[0],ne=e[1]}function de(){return[ae,re]}function he(e){var t=e[0],i=e[1];ie+t<0&&(t-=t+ie),se+i<0&&(i-=i+se),E<ne+i&&(i+=E-(ne+i)),$<oe+t&&(t+=$-(oe+t)),ie+=t,oe+=t,se+=i,ne+=i}function ge(e){var t=ue();switch(e){case"ne":return[t.x2,t.y];case"nw":return[t.x,t.y];case"se":return[t.x2,t.y2];case"sw":return[t.x,t.y2]}}function ue(){if(!_.aspectRatio)return fe();var e=_.aspectRatio,t=_.minSize[0]/V,i=_.maxSize[0]/V,s=_.maxSize[1]/W,o=oe-ie,n=ne-se,a=Math.abs(o),r=Math.abs(n),l,c,d,h,g;return 0===i&&(i=10*$),0===s&&(s=10*E),a/r<e?(d=ne,h=r*e,(c=o<0?ie-h:h+ie)<0?(c=0,g=Math.abs((c-ie)/e),d=n<0?se-g:g+se):$<c&&(c=$,g=Math.abs((c-ie)/e),d=n<0?se-g:g+se)):(c=oe,g=a/e,(d=n<0?se-g:se+g)<0?(d=0,h=Math.abs((d-se)*e),c=o<0?ie-h:h+ie):E<d&&(d=E,h=Math.abs(d-se)*e,c=o<0?ie-h:h+ie)),ie<c?(c-ie<t?c=ie+t:i<c-ie&&(c=ie+i),d=se<d?se+(c-ie)/e:se-(c-ie)/e):c<ie&&(ie-c<t?c=ie-t:i<ie-c&&(c=ie-i),d=se<d?se+(ie-c)/e:se-(ie-c)/e),c<0?(ie-=c,c=0):$<c&&(ie-=c-$,c=$),d<0?(se-=d,d=0):E<d&&(se-=d-E,d=E),be(me(ie,se,c,d))}function pe(e){return e[0]<0&&(e[0]=0),e[1]<0&&(e[1]=0),e[0]>$&&(e[0]=$),e[1]>E&&(e[1]=E),[e[0],e[1]]}function me(e,t,i,s){var o=e,n=i,a=t,r=s;return i<e&&(o=i,n=e),s<t&&(a=s,r=t),[o,a,n,r]}function fe(){var e=oe-ie,t=ne-se,i;return U&&Math.abs(e)>U&&(oe=0<e?ie+U:ie-U),H&&Math.abs(t)>H&&(ne=0<t?se+H:se-H),Q/W&&Math.abs(t)<Q/W&&(ne=0<t?se+Q/W:se-Q/W),z/V&&Math.abs(e)<z/V&&(oe=0<e?ie+z/V:ie-z/V),ie<0&&(oe-=ie,ie-=ie),se<0&&(ne-=se,se-=se),oe<0&&(ie-=oe,oe-=oe),ne<0&&(se-=ne,ne-=ne),$<oe&&(ie-=i=oe-$,oe-=i),E<ne&&(se-=i=ne-E,ne-=i),$<ie&&(ne-=i=ie-E,se-=i),E<se&&(ne-=i=se-E,se-=i),be(me(ie,se,oe,ne))}function be(e){return{x:e[0],y:e[1],x2:e[2],y2:e[3],w:e[2]-e[0],h:e[3]-e[1]}}var ve=(Ce=!1,ye=ut("<div />").css({position:"absolute",zIndex:240,opacity:0}),we={top:Ee(),left:Ee().height(E),right:Ee().height(E),bottom:Ee()},{update:$e,updateRaw:xe,getShades:Pe,setBgColor:_e,enable:Te,disable:Se,resize:ke,refresh:De,opacity:Ie}),Ce,ye,we;function ke(e,t){we.left.css({height:S(t)}),we.right.css({height:S(t)})}function $e(){return xe(te.getFixed())}function xe(e){we.top.css({left:S(e.x),width:S(e.w),height:S(e.y)}),we.bottom.css({top:S(e.y2),left:S(e.x),width:S(e.w),height:S(E-e.y2)}),we.right.css({left:S(e.x2),width:S($-e.x2)}),we.left.css({width:S(e.x)})}function Ee(){return ut("<div />").css({position:"absolute",backgroundColor:_.shadeColor||_.bgColor}).appendTo(ye)}function Te(){Ce||(Ce=!0,ye.insertBefore(N),$e(),Ae.setBgOpacity(1,0,1),M.hide(),_e(_.shadeColor||_.bgColor,1),Ae.isAwake()?Ie(_.bgOpacity,1):Ie(1,1))}function _e(e,t){dt(Pe(),e,t)}function Se(){Ce&&(ye.remove(),M.show(),Ce=!1,Ae.isAwake()?Ae.setBgOpacity(_.bgOpacity,1,1):(Ae.setBgOpacity(1,1,1),Ae.disableHandles()),dt(T,0,1))}function Ie(e,t){Ce&&(_.bgFade&&!t?ye.animate({opacity:1-e},{queue:!1,duration:_.fadeTime}):ye.css({opacity:1-e}))}function De(){_.shade?Te():Se(),Ae.isAwake()&&Ie(_.bgOpacity)}function Pe(){return ye.children()}var Ae=function(){var s,i=370,o={},n={},a={},e=!1;function r(e){var t=ut("<div />").css({position:"absolute",opacity:_.borderOpacity}).addClass(I(e));return B.append(t),t}function l(e,t){var i=ut("<div />").mousedown(D(e)).css({cursor:e+"-resize",position:"absolute",zIndex:t}).addClass("ord-"+e);return X.support&&i.bind("touchstart.jcrop",X.createDragger(e)),L.append(i),i}function c(e){var t=_.handleSize;return l(e,i++).css({opacity:_.handleOpacity}).width(t).height(t).addClass(I("handle"))}function d(e){return l(e,i++).addClass("jcrop-dragbar")}function t(e){var t;for(t=0;t<e.length;t++)a[e[t]]=d(e[t])}function h(e){var t,i;for(i=0;i<e.length;i++){switch(e[i]){case"n":t="hline";break;case"s":t="hline bottom";break;case"e":t="vline right";break;case"w":t="vline"}o[e[i]]=r(t)}}function g(e){var t;for(t=0;t<e.length;t++)n[e[t]]=c(e[t])}function u(e,t){_.shade||M.css({top:S(-t),left:S(-e)}),O.css({top:S(t),left:S(e)})}function p(e,t){O.width(e).height(t)}function m(){var e=te.getFixed();te.setPressed([e.x,e.y]),te.setCurrent([e.x2,e.y2]),f()}function f(e){if(s)return b(e)}function b(e){var t=te.getFixed();p(t.w,t.h),u(t.x,t.y),_.shade&&ve.updateRaw(t),s||C(),e?_.onSelect.call(gt,P(t)):_.onChange.call(gt,P(t))}function v(e,t,i){(s||t)&&(_.bgFade&&!i?N.animate({opacity:e},{queue:!1,duration:_.fadeTime}):N.css("opacity",e))}function C(){O.show(),_.shade?ve.opacity(R):v(R,!0),s=!0}function y(){$(),O.hide(),_.shade?ve.opacity(1):v(1),s=!1,_.onRelease.call(gt)}function w(){e&&L.show()}function k(){if(e=!0,_.allowResize)return L.show(),!0}function $(){e=!1,L.hide()}function x(e){G===e?$():k()}function E(){x(!1),m()}_.dragEdges&&ut.isArray(_.createDragbars)&&t(_.createDragbars),ut.isArray(_.createHandles)&&g(_.createHandles),_.drawBorders&&ut.isArray(_.createBorders)&&h(_.createBorders),ut(document).bind("touchstart.jcrop-ios",function(e){ut(e.currentTarget).hasClass("jcrop-tracker")&&e.stopPropagation()});var T=A().mousedown(D("move")).css({cursor:"move",position:"absolute",zIndex:360});return X.support&&T.bind("touchstart.jcrop",X.createDragger("move")),B.append(T),$(),{updateVisible:f,update:b,release:y,refresh:m,isAwake:function(){return s},setCursor:function(e){T.css("cursor",e)},enableHandles:k,enableOnly:function(){e=!0},showHandles:w,disableHandles:$,animMode:x,setBgOpacity:v,done:E}}(),Ne=(Me=function(){},Be=function(){},(Le=_.trackDocument)||j.mousemove(je).mouseup(Fe).mouseout(Fe),N.before(j),{activateHandlers:Re,setCursor:ze}),Me,Be,Le;function Oe(){j.css({zIndex:450}),X.support&&ut(document).bind("touchmove.jcrop",Ue).bind("touchend.jcrop",He),Le&&ut(document).bind("mousemove.jcrop",je).bind("mouseup.jcrop",Fe)}function qe(){j.css({zIndex:290}),ut(document).off(".jcrop")}function je(e){return Me(r(e)),!1}function Fe(e){return e.preventDefault(),e.stopPropagation(),J&&(J=!1,Be(r(e)),Ae.isAwake()&&_.onSelect.call(gt,P(te.getFixed())),qe(),Me=function(){},Be=function(){}),!1}function Re(e,t){return J=!0,Me=e,Be=t,Oe(),!1}function Ue(e){return e.pageX=e.originalEvent.changedTouches[0].pageX,e.pageY=e.originalEvent.changedTouches[0].pageY,je(e)}function He(e){return e.pageX=e.originalEvent.changedTouches[0].pageX,e.pageY=e.originalEvent.changedTouches[0].pageY,Fe(e)}function ze(e){j.css("cursor",e)}var Qe=(Ve=ut('<input type="radio" />').css({position:"fixed",left:"-120px",width:"12px"}),We=ut("<div />").css({position:"absolute",overflow:"hidden"}).append(Ve),_.keySupport&&(Ve.keydown(Ke).blur(Je),s||!_.fixedSupport?(Ve.css({position:"absolute",left:"-20px"}),We.append(Ve).insertBefore(N)):Ve.insertBefore(N)),{watchKeys:Ye}),Ve,We;function Ye(){_.keySupport&&(Ve.show(),Ve.focus())}function Je(e){Ve.hide()}function Ge(e,t,i){_.allowMove&&(te.moveOffset([t,i]),Ae.updateVisible(!0)),e.preventDefault(),e.stopPropagation()}function Ke(e){if(e.ctrlKey||e.metaKey)return!0;var t=(K=!!e.shiftKey)?10:1;switch(e.keyCode){case 37:Ge(e,-t,0);break;case 39:Ge(e,t,0);break;case 38:Ge(e,0,-t);break;case 40:Ge(e,0,t);break;case 27:_.allowSelect&&Ae.release();break;case 9:return!0}return!1}function Xe(e){T.removeClass().addClass(I("holder")).addClass(e)}function Ze(e,t){var i=e[0]/V,s=e[1]/W,o=e[2]/V,n=e[3]/W;var a=te.flipCoords(i,s,o,n),r=te.getFixed(),l=[r.x,r.y,r.x2,r.y2],c=l,d=_.animationDelay,h=a[0]-l[0],g=a[1]-l[1],u=a[2]-l[2],p=a[3]-l[3],m=0,f=_.swingSpeed,b;function v(){window.setTimeout(C,d)}x=c[0],y=c[1],o=c[2],n=c[3],Ae.animMode(!0);var C=function(){m+=(100-m)/f,c[0]=x+m/100*h,c[1]=y+m/100*g,c[2]=o+m/100*u,c[3]=n+m/100*p,99.8<=m&&(m=100),m<100?(tt(c),v()):(Ae.done(),"function"==typeof t&&t.call(gt))};v()}function et(e){tt([e[0]/V,e[1]/W,e[2]/V,e[3]/W]),_.onSelect.call(gt,P(te.getFixed())),Ae.enableHandles()}function tt(e){te.setPressed([e[0],e[1]]),te.setCurrent([e[2],e[3]]),Ae.update()}function it(){return P(te.getFixed())}function st(){return te.getFixed()}function ot(e){l(e),ht()}function nt(){_.disabled=!0,Ae.disableHandles(),Ae.setCursor("default"),Ne.setCursor("default")}function at(){_.disabled=!1,ht()}function rt(){Ae.done(),Ne.activateHandlers(null,null)}function lt(){T.remove(),v.show(),ut(e).removeData("Jcrop")}function ct(o,n){Ae.release(),nt();var a=new Image;a.onload=function(){var e=a.width,t=a.height,i=_.boxWidth,s=_.boxHeight;N.width(e).height(t),N.attr("src",o),M.attr("src",o),u(N,i,s),$=N.width(),E=N.height(),M.width($).height(E),j.width($+2*q).height(E+2*q),T.width($).height(E),ve.resize($,E),at(),"function"==typeof n&&n.call(gt)},a.src=o}function dt(e,t,i){var s=t||_.bgColor;_.bgFade&&o()&&_.fadeTime&&!i?e.animate({backgroundColor:s},{queue:!1,duration:_.fadeTime}):e.css("backgroundColor",s)}function ht(e){_.allowResize?e?Ae.enableOnly():Ae.enableHandles():Ae.disableHandles(),Ne.setCursor(_.allowSelect?"crosshair":"default"),Ae.setCursor(_.allowMove?"move":"default"),_.hasOwnProperty("trueSize")&&(V=_.trueSize[0]/$,W=_.trueSize[1]/E),_.hasOwnProperty("setSelect")&&(et(_.setSelect),Ae.done(),delete _.setSelect),ve.refresh(),_.bgColor!=F&&(dt(_.shade?ve.getShades():T,_.shade&&_.shadeColor||_.bgColor),F=_.bgColor),R!=_.bgOpacity&&(R=_.bgOpacity,_.shade?ve.refresh():Ae.setBgOpacity(R)),U=_.maxSize[0]||0,H=_.maxSize[1]||0,z=_.minSize[0]||0,Q=_.minSize[1]||0,_.hasOwnProperty("outerImage")&&(N.attr("src",_.outerImage),delete _.outerImage),Ae.refresh()}X.support&&j.on("touchstart.jcrop",X.newSelection),L.hide(),ht(!0);var gt={setImage:ct,animateTo:Ze,setSelect:et,setOptions:ot,tellSelect:it,tellScaled:st,setClass:Xe,disable:nt,enable:at,cancel:rt,release:Ae.release,destroy:lt,focus:Qe.watchKeys,getBounds:function(){return[$*V,E*W]},getWidgetSize:function(){return[$,E]},getScaleFactor:function(){return[V,W]},getOptions:function(){return _},ui:{holder:T,selection:O}};return C.utility.browser.msie&&T.bind("selectstart",function(){return!1}),v.data("Jcrop",gt),gt},ut.fn.Jcrop=function(e,t){var i;return this.each(function(){if(ut(this).data("Jcrop")){if("api"===e)return ut(this).data("Jcrop");ut(this).data("Jcrop").setOptions(e)}else"IMG"==this.tagName?ut.Jcrop.Loader(this,function(){ut(this).css({display:"block",visibility:"hidden"}),i=ut.Jcrop(this,e),ut.isFunction(t)&&t.call(i)}):(ut(this).css({display:"block",visibility:"hidden"}),i=ut.Jcrop(this,e),ut.isFunction(t)&&t.call(i))}),this},ut.Jcrop.Loader=function(e,t,i){var s=ut(e),o=s[0];function n(){o.complete?(s.off(".jcloader"),ut.isFunction(t)&&t.call(o)):window.setTimeout(n,50)}s.bind("load.jcloader",n).bind("error.jcloader",function(e){s.off(".jcloader"),ut.isFunction(i)&&i.call(o)}),o.complete&&ut.isFunction(t)&&(s.off(".jcloader"),t.call(o))},ut.Jcrop.defaults={allowSelect:!0,allowMove:!0,allowResize:!0,trackDocument:!0,baseClass:"jcrop",addClass:null,bgColor:"black",bgOpacity:.6,bgFade:!1,borderOpacity:.4,handleOpacity:.5,handleSize:7,aspectRatio:0,keySupport:!0,createHandles:["n","s","e","w","nw","ne","se","sw"],createDragbars:["n","s","e","w"],createBorders:["n","s","e","w"],drawBorders:!0,dragEdges:!0,fixedSupport:!0,touchSupport:null,shade:null,boxWidth:0,boxHeight:0,boundary:2,fadeTime:400,animationDelay:20,swingSpeed:3,minSelect:[0,0],maxSize:[0,0],minSize:[0,0],onChange:function(){},onSelect:function(){},onDblClick:function(){},onRelease:function(){}}}(jQuery),C.resource.add("C.Eggshell.profile.updateImage.dialogHeadline","Update your profile photo <span>(selfies accepted)</span>"),C.resource.add("C.Eggshell.profile.updateImage.savePhoto","Save photo"),C.resource.add("C.Eggshell.profile.updateImage.uploadPhoto","Upload photo"),C.resource.add("C.Eggshell.profile.updateImage.changePhoto","Change photo"),C.resource.add("C.Eggshell.profile.updateImage.editPhoto","Edit Photo"),C.resource.add("C.Eggshell.profile.updateImage.previewPhoto","Preview photo"),C.resource.add("C.Eggshell.profile.updateImage.editDesc","You can upload a JPEG, GIF, or PNG file smaller than 2MB."),C.resource.add("C.Eggshell.profile.updateImage.previewDesc","How you appear across Chegg"),C.resource.add("C.Eggshell.profile.updateImage.right","Right"),C.resource.add("C.Eggshell.profile.updateImage.left","Left"),C.resource.add("C.Eggshell.profile.updateImage.crop","Crop"),C.resource.add("C.Eggshell.profile.updateImage.delete","Delete"),C.resource.add("C.Eggshell.profile.updateImage.bullet1","Your photo must be a picture of yourself"),C.resource.add("C.Eggshell.profile.updateImage.bullet2","Keep it classy! This is how you'll be seen by classmates and Chegg members"),C.resource.add("C.Eggshell.profile.updateImage.bullet3","Photos must be either JPEG or PNG format"),C.resource.add("C.Eggshell.profile.updateImage.error.general","An error has orccurred during upload.  Please try again."),Eggshell.define("C.profile.updateImage",{inputs:["render","browse for files"],outputs:["rendered","content area","image loaded","profile updated","newProfileImage","deleted image","hide control buttons"]},function(){var e=C.Model.extend({initialize:function(){this.set({fakePath:null,canCrop:!1,activeCrop:!1,rotateMode:!1,resetPreview:!1,originalWidth:0,originalHeight:0,rotatedWidth:0,rotatedHeight:0,currentImageId:null,currentImageURL:null,deleteImage:!1,defaultImage:null,x:0,y:0,w:220,h:220,rotation:0}),this.defaultImages=["/s/profile/images/avatar_male.png","/s/profile/images/avatar_female.png","/s/profile/images/avatar_unisex.png"],this.errorMessages=[]},evalExistingImage:function(){return this.set("currentImageId",this.profilePictureId),this.set("currentImageURL",this.profilePictureUrl),0<=$.inArray(this.profilePictureUrl,this.defaultImages)&&(this.setDefaultImage(),!0)},setDefaultImage:function(){var e;switch(this.gender){case"male":this.set("defaultImage","/s/profile/images/avatar_male.png");break;case"female":this.set("defaultImage","/s/profile/images/avatar_female.png");break;default:this.set("defaultImage","/s/profile/images/avatar_unisex.png")}},uploadNewImage:function(){$("#theform").ajaxSubmit({data:{token:C.global.csrfToken},success:$.proxy(function(e){this.set("currentImageId",e.uuid),this.set("currentImageURL",e.location),this.set("originalWidth",e.width),this.set("originalHeight",e.height),this.set("rotatedWidth",0),this.set("rotatedHeight",0),this.set("deleteImage",!1),this.set("defaultImage",!1),this.set("rotateMode",!1),this.set("canCrop",!0),this.trigger("clearErrors"),this.trigger("refreshImageSource")},this),timeout:3e4,error:$.proxy(function(){this.trigger("clearErrors"),this.errorMessages.push(C.resource.fetch("C.Eggshell.profile.updateImage.error.general")),this.trigger("showErrorBox"),this.trigger("hideAJAXLoader")},this),dataType:"json",context:self})},closeParentModal:function(){Eggshell.trigger("C.profile.updateImage","profile updated")},transformProfileImage:function(){$.ajax({type:"POST",dataType:"json",url:"/_ajax/profile/picture",data:{transformedFileId:this.get("currentImageId"),token:C.global.csrfToken,x:this.get("x"),y:this.get("y"),w:this.get("w"),h:this.get("h")},timeout:3e4,error:$.proxy(function(){this.trigger("clearErrors"),this.errorMessages.push(C.resource.fetch("C.Eggshell.profile.updateImage.error.general")),this.trigger("showErrorBox"),this.trigger("hideAJAXLoader")},this),success:$.proxy(function(e){this.set("currentImageId",e.uuid),this.set("currentImageURL",e.location),this.saveImageToProfile(e.uuid)},this)})},rotateProfileImage:function(){$.ajax({type:"POST",dataType:"json",url:"/_ajax/profile/picture",data:{transformedFileId:this.get("currentImageId"),token:C.global.csrfToken,rotate:this.get("rotation")},timeout:3e4,error:$.proxy(function(){this.trigger("clearErrors"),this.errorMessages.push(C.resource.fetch("C.Eggshell.profile.updateImage.error.general")),this.trigger("showErrorBox"),this.trigger("hideAJAXLoader")},this),success:$.proxy(function(e){this.set("currentImageId",e.uuid),this.set("currentImageURL",e.location),this.set("rotatedWidth",e.width),this.set("rotatedHeight",e.height),this.set("deleteImage",!1),this.set("defaultImage",!1),this.set("rotation",0),this.trigger("clearErrors"),this.trigger("refreshImageSource")},this)})},saveImageToProfile:function(e){$.ajax({type:"POST",dataType:"json",url:"/_ajax/profile/update",data:{updateimage:e,token:C.global.csrfToken},timeout:3e4,error:$.proxy(function(){this.trigger("clearErrors"),this.errorMessages.push(C.resource.fetch("C.Eggshell.profile.updateImage.error.general")),this.trigger("showErrorBox"),this.trigger("hideAJAXLoader")},this),success:$.proxy(function(e){this.set("canCrop",!1),this.trigger("updateParentComponenet"),this.trigger("hideAJAXLoader"),this.closeParentModal()},this)})},saveDeletedImage:function(){$.ajax({type:"POST",url:"/_ajax/profile/update",data:{updateimage:"delete",token:C.global.csrfToken},timeout:3e4,error:$.proxy(function(){this.trigger("clearErrors"),this.errorMessages.push(C.resource.fetch("C.Eggshell.profile.updateImage.error.general")),this.trigger("showErrorBox"),this.trigger("hideAJAXLoader")},this),success:$.proxy(function(e){this.trigger("updateParentComponenet"),this.closeParentModal()},this),dataType:"json"})}}),t;return C.View.extend({model:new e,tmpl:_.template('<form action="/_ajax/profile/picture/" method="POST" enctype="multipart/form-data" id="theform"><input type="file" name="myfile" id="uploadFile" data-action="uploadfile" style="position: absolute;left: -9999px;"><input type="hidden" id="deleteImage" name="deleteImage" value="false"><div class="update-image-container clearfix"><div class="msg-error-sm hidden"><div class="msg-icon"><div class="msg-text"></div></div></div><div class="update-image l-col"><div class="col-header"><h4><%- text.editPhoto %></h4><p><%- text.editDesc %></p></div><div class="loadingIndicator"></div><div class="pl-upload-inner pl-image-div" data-id="pop-picture"><img src="<%- data.profilePictureUrl %>" class="croppableImg" id="theImage" /></div><div class="image-update-tools"><ul><li><a href="#" class="tool-rotate-r"><%- text.rightLabel %></a></li><li><a href="#" class="tool-rotate-l"><%- text.leftLabel %></a></li><li><a href="#" class="tool-crop"><%- text.cropLabel %></a></li><li class="last-item"><a href="#" class="tool-delete"><%- text.deleteLabel %></a></li></ul></div></div><div class="update-image r-col"><div class="col-header"><h4><%- text.previewPhoto %></h4><p><%- text.previewDesc %></p></div><div id="preview-container" data-id="preview-container" class="scaleImage"><img src="<%- data.profilePictureUrl %>" data-id="preview" class="preview-image" /></div><div class="update-image-controls"><label for="uploadFile" data-type="button" class="browse-images secondary btn-secondary-sm btn-secondary-dk-sm" data-action="upload">Change photo</label><button class="primary btn-primary-sm saveImage" title="Save photo">Save photo</button></div></div><div class="new-image hidden"><label for="uploadFile" data-type="button" class="btn-primary-lg uploadPhotoButton"><%- text.uploadPhoto %></label><ul class="chg-list"><li><span><%- text.bullet1 %></span></li><li><span><%- text.bullet2 %></span></li><li><span><%- text.bullet3 %></span></li></ul></div></div></form>'),initialize:function(){this.model=$.extend(this.model,this.options.data),this.model.on("uploadNewImage",this.showLoadingIndicator,this),this.model.on("refreshImageSource",this.refreshImageSource,this),this.model.set("currentImageId",this.model.profilePictureId),this.model.set("currentImageURL",this.model.profilePictureUrl),this.model.on("updateParentComponenet",this.updateParentComponenet,this),this.model.on("hideAJAXLoader",this.hideLoadingIndicator,this),this.model.on("refreshContent",this.render,this),this.model.on("showErrorBox",this.showErrors,this),this.model.on("clearErrors",this.clearErrors,this),this.registerListeners(),this.render()},events:{"click a.tool-crop":"clickCrop","click a.tool-delete":"deleteImage","click button.saveImage":"saveImage","click a.tool-rotate-r":"rotateR","click a.tool-rotate-l":"rotateL"},render:function(){var e;this.model.set("originalWidth",0),this.model.set("originalHeight",0),this.$el.html(this.tmpl({data:this.model,text:{editPhoto:C.resource.fetch("C.Eggshell.profile.updateImage.editPhoto"),previewPhoto:C.resource.fetch("C.Eggshell.profile.updateImage.previewPhoto"),editDesc:C.resource.fetch("C.Eggshell.profile.updateImage.editDesc"),previewDesc:C.resource.fetch("C.Eggshell.profile.updateImage.previewDesc"),rightLabel:C.resource.fetch("C.Eggshell.profile.updateImage.right"),leftLabel:C.resource.fetch("C.Eggshell.profile.updateImage.left"),cropLabel:C.resource.fetch("C.Eggshell.profile.updateImage.crop"),deleteLabel:C.resource.fetch("C.Eggshell.profile.updateImage.delete"),uploadPhoto:C.resource.fetch("C.Eggshell.profile.updateImage.uploadPhoto"),bullet1:C.resource.fetch("C.Eggshell.profile.updateImage.bullet1"),bullet2:C.resource.fetch("C.Eggshell.profile.updateImage.bullet2"),bullet3:C.resource.fetch("C.Eggshell.profile.updateImage.bullet3")}})),this.model.setDefaultImage(),this.model.evalExistingImage()&&(this.$(".update-image-controls").hide(),this.$(".update-image").addClass("hidden"),this.$(".new-image").removeClass("hidden")),this.imgContainer=this.$(".pl-upload-inner"),this.croppableImage=this.$(".pl-upload-inner img"),this.previewImage=this.$("img.preview-image"),this.previewImageContainer=this.$("#preview-container"),this.refreshControls(!0,!1,!0),this.$("#uploadFile").change($.proxy(function(e){var t=$("#uploadFile").val(),i;""!==t&&(this.validateImageType()?(this.clearErrors(),this.$(".update-image").removeClass("hidden"),this.$(".new-image").addClass("hidden"),this.showLoadingIndicator(),this.cancelCrop(),this.model.set("fakePath",t),this.model.uploadNewImage(),this.refreshControls(!0,!0,!0)):this.showErrors())},this))},saveImage:function(e){e.preventDefault(),e.stopPropagation(),this.cancelCrop(),this.showLoadingIndicator(),1==this.model.get("deleteImage")?this.model.saveDeletedImage():this.model.transformProfileImage()},registerListeners:function(){this.Eggshell.listen("render",function(e,t){this.render()})},clickCrop:function(e){e&&(e.preventDefault(),e.stopPropagation()),1==this.model.get("canCrop")&&0==this.model.get("activeCrop")&&(this.model.set("rotateMode",!1),this.transformImage(),this.refreshControls(!0,!1,!0))},transformImage:function(e){1==this.model.get("canCrop")&&0==this.model.get("deleteImage")&&0==this.model.get("defaultImage")&&0==this.model.get("rotateMode")?(this.initCrop(),this.refreshControls(!0,!1,!0)):1==this.model.get("rotateMode")&&null!=this.model.get("fakePath")?(this.initCrop(),this.cancelCrop(),this.refreshControls(!0,!0,!0)):(this.initCrop(),this.cancelCrop())},initCrop:function(){this.previewImageContainer.removeClass("scaleImage"),this.$(".jcrop-holder").remove(),this.jcrop_api=$.Jcrop(".croppableImg",{aspectRatio:1,onChange:$.proxy(this.updatePreview,this),onSelect:$.proxy(this.updatePreview,this),minSize:[110,110],bgColor:"#fff",bgOpacity:.2,createHandles:["nw","ne","se","sw"],handleSize:15,handleOpacity:1,borderOpacity:1});var e=this.calculateDefaultCrop(this.model.get("originalWidth"),this.model.get("originalHeight"));this.jcrop_api.setSelect([e.width,e.height,e.x,e.y]),this.model.set("canCrop",!1),this.model.set("activeCrop",!0)},cancelCrop:function(){this.model.set("canCrop",!0),this.model.set("activeCrop",!1),this.jcrop_api&&this.jcrop_api.destroy()},updatePreview:function(e){var t=200/e.w,i=200/e.h,s=this.model.get("rotateMode"),o=this.model.get("originalWidth"),n=this.model.get("originalHeight"),a=this.model.get("rotatedWidth"),r=this.model.get("rotatedHeight"),l=this.model.get("originalWidth"),c=this.model.get("originalHeight");0!=a&&a!=o&&0!=r&&r!=n&&(l=this.model.get("rotatedWidth"),c=this.model.get("rotatedHeight")),this.model.set("x",e.x),this.model.set("y",e.y),this.model.set("w",e.w),this.model.set("h",e.h),this.$(".preview-image").css({width:Math.round(t*l)+"px",height:Math.round(i*c)+"px",marginLeft:"-"+Math.round(t*e.x)+"px",marginTop:"-"+Math.round(i*e.y)+"px"}),this.model.get("resetPreview")&&(this.$(".preview-image").css({marginLeft:0,marginTop:0}),this.model.set("resetPreview",!1))},rotateR:function(e){this.rotateImage("r"),e.preventDefault(),e.stopPropagation()},rotateL:function(e){this.rotateImage("l"),e.preventDefault(),e.stopPropagation()},rotateImage:function(e){0==this.model.get("deleteImage")&&0==this.model.get("rotateMode")&&(this.jcrop_api&&this.cancelCrop(),this.model.set("x",0),this.model.set("y",0),this.model.set("w",0),this.model.set("h",0),this.model.set("resetPreview",!0),this.model.set("rotateMode",!0),"r"===e?(this.model.set("rotation",90),this.imgContainer.addClass("rotate-ninety")):(this.model.set("rotation",270),this.imgContainer.addClass("rotate-two-seventy")),this.showLoadingIndicator(),this.model.rotateProfileImage())},resetRotation:function(){null==this.model.get("fakePath")?this.model.set("canCrop",!1):this.model.set("canCrop",!0),this.model.set("rotateMode",!1),this.imgContainer.removeClass("rotate-ninety").removeClass("rotate-two-seventy")},calculateDefaultCrop:function(e,t){var i=220;return e==t?e=t=i:i<e&&i<t&&(t*=i/e,e=i),e<i?(height1=i/e*t,height1<i&&(height1=(i=i/t*e)/e*t),t=height1,e=i):t<i&&(e*=i/t,t=i),x=e/2-i/2,y=t/2-i/2,{width:e,height:t,x:x,y:y}},refreshImageSource:function(e){var e=this.model.get("currentImageURL"),t;this.croppableImage.attr("src",""),this.croppableImage.attr("src",e),this.croppableImage.show(),this.previewImage.attr("src",""),0==this.model.get("rotateMode")?(this.croppableImage.css("width",0<this.model.get("originalWidth")?this.model.get("originalWidth"):this.model.get("rotatedWidth")),this.croppableImage.css("height",0<this.model.get("originalHeight")?this.model.get("originalHeight"):this.model.get("rotatedHeight")),this.previewImage.css("width",this.model.get("originalWidth")),this.previewImage.css("height",this.model.get("originalHeight")),this.$("#preview-container").removeClass("scaleImage")):(this.croppableImage.css("width",this.model.get("rotatedWidth")),this.croppableImage.css("height",this.model.get("rotatedHeight")),this.previewImage.css("width",""),this.previewImage.css("height","")),this.croppableImage.css("display","block"),this.croppableImage.css("margin","0 auto"),this.previewImage.css("margin",0),this.previewImage.attr("src",e),this.$(".update-image-controls").show(),690<$(window).height()&&this.$el.parent("div").css("overflow-y","hidden"),this.hideLoadingIndicator(),0==this.model.get("deleteImage")&&(this.jcrop_api&&this.cancelCrop(),this.transformImage()),this.resetRotation()},showLoadingIndicator:function(){this.$(".croppableImg").css("opacity",0),this.previewImageContainer.css("opacity",.1),this.loadingIndicator=Eggshell.create("C.widget.loading.indicator",{el:this.$(".loadingIndicator")}),Eggshell.trigger(this.loadingIndicator,"show")},hideLoadingIndicator:function(){this.loadingIndicator&&Eggshell.destroy(this.loadingIndicator),this.$(".croppableImg").css("opacity",1),this.previewImageContainer.css("opacity",1)},deleteImage:function(e){e&&(e.preventDefault(),e.stopPropagation()),this.model.setDefaultImage(),this.model.set("deleteImage",!0),this.model.set("canCrop",!1),this.model.set("fakePath",null),this.model.set("currentImageId",null),this.model.set("currentImageURL",this.model.get("defaultImage")),this.model.set("originalWidth",220),this.model.set("originalHeight",220),this.cancelCrop(),this.refreshImageSource(this.model.get("currentImageURL")),this.previewImageContainer.hasClass("scaleImage")||this.previewImageContainer.addClass("scaleImage"),this.refreshControls(!1,!1,!1)},updateParentComponenet:function(){var e=this.model.get("currentImageId"),t=this.model.get("currentImageURL");C&&C.global&&(C.global.userAvatar=t),Eggshell.find("C.common.avatar").trigger("update avatar image url with matching id",{image:t,id:C.global.userUuid}),this.Eggshell.trigger("newProfileImage",{uuid:e,url:t})},validateImageType:function(){var e=this.$("#uploadFile").val(),t,i=e.substring(e.lastIndexOf(".")+1).toLowerCase();return"gif"==i||"png"==i||"jpg"==i||"jpeg"==i||(this.model.errorMessages.push("Please upload a JPG, PNG or GIF image "),!1)},showErrors:function(){var e=this.$(".msg-error-sm"),t=this.$(".msg-text"),i=this.model.errorMessages,s=$('<ul class="chg-list"></ul>');$.each(i,function(e,t){s.append("<li>"+t+"</li>")}),t.html(s),e.removeClass("hidden")},clearErrors:function(){var e;this.$(".msg-error-sm").addClass("hidden"),this.model.errorMessages=[]},refreshControls:function(e,t,i){this.$(".image-update-tools li a").removeClass("disabled"),e||(this.$("a.tool-rotate-r").addClass("disabled"),this.$("a.tool-rotate-l").addClass("disabled")),t||this.$("a.tool-crop").addClass("disabled"),i||this.$("a.tool-delete").addClass("disabled")}})}()),Eggshell.define("C.widget.loading.indicator",C.View.extend({initialize:function(){this.render()},render:function(){return this.setupInputs(),$.el},setupInputs:function(){this.Eggshell.input("show",$.proxy(function(){this.$el.show()},this)),this.Eggshell.input("hide",$.proxy(function(){this.$el.hide()},this)),this.Eggshell.input("fade in",$.proxy(function(e,t){this.$el.fadeIn(300,$.proxy(function(){this.Eggshell.output("faded in",t)},this))},this)),this.Eggshell.input("fade out",$.proxy(function(e,t){this.$el.fadeOut(300,$.proxy(function(){this.Eggshell.output("faded out",t)},this))},this))}})),Eggshell.define("C.common.form",{inputs:["build form","show error","hide error"],outputs:[],newNode:!1},Backbone.View.extend({counter:0,initialize:function(){Eggshell.find(this).on("build form",this.build).on("show error",this.showError).on("hide error",this.hideError)},build:function(){var i=this,e=this.$("input:not([type=button]):not([type=submit]), select, textarea"),s="ontouchstart"in document.documentElement;e.each(function(e,t){$(t).attr("id")||i.setInputId($(t)),$(t).data("group-type")&&i.buildFormGroup($(t)),$(t).attr("data-label")&&i.buildLabel($(t)),$(t).is("select")&&$(t).data("group-select")&&!s&&i.buildSelectElement(t)})},setInputId:function(e){var t=e.attr("data-id")||this.generateUniqueId();e.attr("id",t)},buildFormGroup:function(e){var t="form-group "+e.data("group-type");this.wrapElement(e,{class:t})},wrapElement:function(e,t){e.wrap($("<div>",t))},buildLabel:function(e){var t=e.attr("id"),i=e.attr("type"),s=e.data("group-type"),o=$("<label>",{for:t,html:e.attr("data-label")});"radio"!==i&&"checkbox"!==i?o.addClass("form-input").insertBefore(e):(o.insertAfter(e),$("<label>",{html:"&nbsp;",for:t,class:"form-"+i,tabindex:0}).insertBefore(o)),s&&this.wrapElement(e,{class:"input-column"}),"group-icon"===s&&o.insertAfter(e).addClass(e.data("label")),this.addLabelClass(e,o)},addLabelClass:function(e,t){var i=["lg","sm","mini"],s,o;for(s=0;o=i[s];s++)if(e.is('[class$="-'+o+'"], [class*="-'+o+' "]'))return void t.addClass("form-label-"+o)},buildSelectElement:function(i){var s=new Backbone.Model({el:i,wrapperClass:$(i).data("group-select"),id:$(i).attr("id"),length:i.length,optionLabel:i[i.selectedIndex].label,value:i.value||""}),o=$(this._selectTpl(s.toJSON()));o.insertAfter($(i)).prepend($(i)),$(".drop-down-list",o).empty().append(this._dropDownTpl(s.toJSON())),s.on("change:value",function(e,t){$(".drop-down-value",o).text(i[i.selectedIndex].label),$(".drop-down-list",o).empty().append(this._dropDownTpl(s.toJSON()))},this),$(".drop-down-value",o).focus(function(e){$(this).addClass("ui-focus")}).blur(function(e){setTimeout(function(){$(e.target).removeClass("ui-focus")},300)}),$(".drop-down-list",o).on("mousedown","li",i,this.setSelectedValue),$(i).on("change",function(e){s.set("value",e.target.value)})},setSelectedValue:function(e){for(var t=$(e.target),i=e.data,s=i.length-1;0<=s;s--)i[s].value!=t.data("value")||i[s].disabled||$(i).val(t.data("value")).trigger("change")},setSelectModel:function(e,t){$(".drop-down-value",$selectTpl).text(select[select.selectedIndex].label),$(".drop-down-list",$selectTpl).empty().append(this._dropDownTpl(e.toJSON()))},_selectTpl:_.template('<div class="<%- wrapperClass %>"><div class="drop-down-value" tabindex="1"><%- optionLabel %></div><ul class="drop-down-list"></ul><div class="select-error-container"></div></div>'),_dropDownTpl:_.template('<% for (var index = 0; index < el.length; index++){ %><li data-value="<%- el[index].value %>" <% if (el.selectedIndex == index) { %>class="active"<% }  %> ><%- el[index].label %></li><% } %>'),generateUniqueId:function(){return this.$el.attr("id")+"-"+this.counter++},getInputByName:function(e){return this.$('[name="'+e+'"]').first()},getInputType:function(e){return e.is("textarea")?"textarea":e.is("select")?e.is(".chzn-drop, .chzn, .chzn-done, .choosen, .chosen")?"select-chosen":"select":e.attr("type")},getErrorClassName:function(e){return void 0===e&&(e="input"),"text"==e||"password"==e||"number"==e||"email"==e||"tel"==e?"form-input-error":"form-"+e+"-error"},getErrorContainer:function(e,t){var i,s,i;if((i=e.closest(".form-error-container",this.$el)).length)return i;if(e.is("select")&&e.data("group-select")&&(i=e.closest("."+e.data("group-select")).find(".select-error-container")))return i;return"select-chosen"===t||"checkbox"===t||"radio"===t?e.parent():e},showError:function(e,t){var i=t.name,s=this.getInputByName(i),o=this.getInputType(s),n=t.message,a=s.attr("id")+"-error",r;if(0!==s.length){if(s.attr("data-errorId",a),n)if(0<this.$("#"+a).length)$("#"+a).html(n);else{r=$("<div/>").html(n).attr("id",a);var l=this.getErrorContainer(s,o);l===s||0==l.length?r.insertAfter(s):l.append(r.css("clear","both"))}this.addErrorClasses(s,r)}},addErrorClasses:function(e,t){var i=this.getInputType(e),s=this.getErrorClassName(i),o=this.getErrorContainer(e,i);"select"===i&&e.data("group-select")?e.addClass(s):o.addClass(s),t&&(e.is('[class$="-lg"], [class*="-lg "]')?t.addClass("error-msg-lg"):e.is('[class$="-sm"], [class*="-sm "]')?t.addClass("error-msg-sm"):e.is('[class$="-mini"], [class*="-mini "]')&&t.addClass("error-msg-mini"),t.attr("role","alert"))},hideError:function(e,t){var i=this.getInputByName(t);if(0!==i.length){var s=this.getInputType(i),o=this.getErrorClassName(s),n;if(this.getErrorContainer(i,s).removeClass(o),i.removeClass(o),i.attr("data-errorId")){var a=i.attr("data-errorId");$("#"+a).remove()}}}})),C("widget"),C.widget.hwhCourseAutoComplete=C.widget._base.extend({construct:function(e){this.addCourseBtn=e.addCourseBtn,this.opts=$.extend({el:".addCourseInput",addCourseBtn:null,successCallback:null,errorCallback:null},e),this.data={},this.opts.el&&(this.opts.el.attr||(this.opts.el=$(this.opts.el)),this.opts.el.attr("placeholder","Enter course name"),this.attachAutoComplete()),this.opts.addCourseBtn&&(this.opts.addCourseBtn.observe("click",this.saveCourse,this),this.opts.addCourseBtn.attr("disabled","disabled"))},attachAutoComplete:function(){this.$courseAutocomplete=new C.widget.autoComplete({el:this.opts.el,type:"courses",lastItem:'<li class="no-course"><span class="icn-no-course" /> Can\'t find your course?</li>',lastItemCallback:$.proxy(this.clickLastItem,this),callback:$.proxy(this.getCourseInfoFromAutoComplete,this)}),this.addWidget(this.$courseAutocomplete)},clickLastItem:function(){C.Events.trigger("C.hwh.addCourse.customChosen"),this.opts.el.after('<input type="text" placeholder="Department code (e.g. CHEM)" name="department" class="course-dept" maxlength="20"><input type="text" name="dept-number" class="dept-number" placeholder="Number" maxlength="10">'),this.opts.el.hide(),$(".course-dept").observe("blur",function(e){this.data["courses[0][subject]"]=$(e.target).val()},this),$(".dept-number").observe("blur",function(e){this.data["courses[0][code]"]=$(e.target).val(),this.opts.addCourseBtn?this.opts.addCourseBtn.prop("disabled",!1):this.saveCourse()},this)},getCourseInfoFromAutoComplete:function(e,t){var i=t.attr("data-catalognumber"),s=t.attr("data-subjectcode"),o=s+" "+i;e.preventDefault(),e.stopPropagation(),this.opts.el.val(o),this.data["courses[0][subject]"]=i,this.data["courses[0][code]"]=s,this.opts.addCourseBtn?this.opts.addCourseBtn.prop("disabled",!1):this.saveCourse()},saveCourse:function(){this.data.token=C.global.csrfToken,$.cjax({context:this,url:"/_ajax/course/batch/add",dataType:"json",type:"POST",data:this.data,success:$.proxy(function(e){this.opts.successCallback?this.opts.successCallback(e):this.opts.el.after('<div class="msg-success-sm"><div class="msg-icon"><div class="msg-text">Course successfully added!<span class="msg-close"></span></div></div></div>')},this),error:$.proxy(function(e){this.opts.errorCallback?this.opts.errorCallback(e):this.opts.el.after('<div class="msg-error-sm"><div class="msg-icon"><div class="msg-text">An error occurred while adding this course.<span class="msg-close"></span></div></div></div>')},this)})},destruct:function(){}}),Eggshell.define("C.common.editor",{inputs:["set container","set editor html","set config","set toolbar","set height","set resize tooltip flag","show resize tooltip","set type","render editor","make url field read only","update container","set editor instance"],outputs:["editor focused","editor rendered"]},function(e){var s=null,o,a,r,l=!1;this.opts=e,this.Eggshell.on("set container",function(e,t){o=t}).on("set config",function(e,t){a=t}).on("set toolbar",function(e,t){this.toolbar=t}).on("set height",function(e,t){this.height=t}).on("set type",function(e,t){"ask"!=t&&"answer"!=t&&"sme"!=t||(a={toolbar:[{name:"row1",items:void 0!==this.toolbar?this.toolbar:["Image","EqnEditor","-","Bold","Italic","Underline","Subscript","Superscript","-","JustifyLeft","JustifyCenter","JustifyRight","JustifyBlock","-","NumberedList","BulletedList","Indent","Outdent","-","Table","-","PasteText","PasteFromWord","Undo","Redo","-","Scayt"]}],extraAllowedContent:"pre",removeButtons:"",image_previewText:" ",height:void 0!==this.height?this.height:"140px",removePlugins:this.opts.enableCKEditorNewVersion?"answer"==t?"elementspath, scayt":"elementspath, scayt, uploadimage":"elementspath, scayt",resize_enabled:!0,filebrowserUploadUrl:"/study/_ajax/questions/ckimageupload/?token="+C.global.csrfToken+"&autoOrientChk=true",extraPlugins:"indentblock,justify",disableNativeSpellChecker:!1})}).on("set editor html",function(e,t){r&&r.setData(t)}).on("update container",function(e,t){r&&r.updateElement()}).on("set resize tooltip flag",function(e,t){l=t}).on("show resize tooltip",function(e,t){var i,s;0<$("#cke_1_resizer").length&&("1"==C.utility.getLocal("editorResizeTooltipShown")&&1!=t||($container=$("#cke_1_resizer"),Eggshell.create("C.common.overlay.tooltip").on("after hide",function(){C.utility.setLocal("editorResizeTooltipShown","1")}).trigger("set target",$("#cke_1_resizer")).trigger("set text","<p class='resize-tooltip-heading'><strong>New!</strong><p>Drag the corner to increase window size</p>").trigger("set tooltip above target").trigger("get tooltip content node").trigger("hide tooltip when user click anywhere else").trigger("set tooltip size","large").trigger("set tooltip the width",220).trigger("add custom css class",{cssSelector:".tooltip",cssClass:"editorResizeTooltip"}).trigger("disable tooltip on hover").trigger("show")))}).on("render editor",function(e,t){var i=this.opts.enableCKEditorNewVersion?"ckeditor":"ckeditor_old",n=this;null===s&&o&&(o.length||o.nodeName)&&(s=!0,C.utility.loadScript(C.global.staticBaseUrl+"s/_widget/"+i+"/ckeditor.js",function(){(r=a?CKEDITOR.replace(o,a):CKEDITOR.replace(o)).on("focus",function(){n.Eggshell.trigger("editor focused")}),n.Eggshell.trigger("editor rendered"),r.on("instanceReady",function(){CKEDITOR.lang.en.image.urlMissing="Oops! You haven't uploaded the image yet.",CKEDITOR.lang.en.common.ok="Done",1==l&&n.Eggshell.trigger("show resize tooltip")});var t=0,i=null,s=[];r.on("fileUploadRequest",function(e){void 0!==e.data.fileLoader.fileName&&""!==e.data.fileLoader.fileName&&t++,10<t?(alert("Drag and Drop 10 images at once."),t=0,clearTimeout(i),$(".cke_wysiwyg_frame").contents().find(".cke_upload_uploading").remove(),$(".cke_wysiwyg_frame").contents().find(".cke_upload_loading").remove()):(s.push(e.data.fileLoader),i&&clearTimeout(i),i=setTimeout(function(e){s.map(function(e){var t=new FormData,i;e.xhr.open("PUT",e.uploadUrl,!0),t.append("upload",e.file,e.fileName),e.xhr.send(t)}),t=0,s=[]},1e3)),e.stop()}),CKEDITOR.on("dialogDefinition",function(e){var t=e.data.name,i=e.data.definition,s=e.data.definition.dialog,o;"image"==t&&((o=i.getContents("info")).remove("txtHSpace"),o.remove("txtVSpace"),o.remove("cmbAlign"),o.remove("txtAlt"),s.on("show",function(){n.Eggshell.trigger("make url field read only"),this.selectPage("Upload"),$(".cke_dialog_ui_fileButton").focus()}),imageUploadTab=i.getContents("Upload"),imageUploadTab.elements[0].label="Upload an image",imageUploadTab.elements[1].label="Upload",imageUploadTab.add({type:"checkbox",id:"autoOrientChk",label:"Auto-rotate image",title:"Adjusts an image orientation correctly for better readability",default:"checked",onClick:function(){var e=$("#"+this.domId).closest("tbody").find(".cke_dialog_ui_input_file iframe").contents().find("form"),t=e.attr("action"),i;void 0!==t.match(/autoOrientChk=([^&]*)/)[1]&&(url=t.replace(/autoOrientChk=([^&]*)/g,"autoOrientChk="+$("#"+this.domId+" input").is(":checked")),e.attr("action",url))}}))})}))}).on("destroy",function(){var e;if(window.CKEDITOR&&window.CKEDITOR.instances)for(e in window.CKEDITOR.instances)window.CKEDITOR.instances[e].destroy()}).on("make url field read only",function(){$("[name='info'].cke_dialog_page_contents").find(".cke_dialog_ui_hbox_first input").first().prop("readonly",!0).css({color:"#ccc","background-color":"#eee"})})}),Eggshell.define("C.Eggshell.homeworkhelp.contentfeedback",{inputs:{render:{}},outputs:{"closed feedback form":{}}},function(){var t=Backbone.Model.extend({initialize:function(e){this.opts=$.extend(e,{}),this.setAbuseOptions(),this.setFormData()},setAbuseOptions:function(){this.set("abuseOptions",{0:{id:1,name:"Adult_Or_Inappropriate",reason:"Inappropriate"},1:{id:2,name:"Spam",reason:"Spam"},2:{id:3,name:"Other",reason:"Other"}})},setFormData:function(){this.set("aid",this.opts.container.attr("data-answerid")||this.opts.entityId||""),this.set("qid",this.opts.container.attr("data-questionid")||""),this.set("cid",this.opts.container.attr("data-commentid")||""),this.set("rid",this.opts.container.attr("data-ratingid")||""),this.set("arid",this.opts.container.attr("data-appratingid")||"")},deletePost:function(e){$.ajax({type:"post",dataType:"json",url:"/_ajax/hwh/delete",data:e,context:this})},saveReview:function(t){$.ajax({type:"post",dataType:"json",url:"/_ajax/contentfeedback/savereview",data:t,context:this,success:function(e){e.result&&(e.result.reviewValue=t.reviewValue,this.trigger("review_posted",e.result))},error:function(){C.log("error posting rating value.")}})},getFeedbackReasons:function(e){$.ajax({type:"get",dataType:"json",url:"/_ajax/contentfeedback/getreasons?entityType="+e,context:this,success:function(e){e.result&&(this.set("feedbackOptions",e.result),this.trigger("render_reasons"))},error:function(){C.log("error fetching reasons.")}})}}),e;return Backbone.View.extend({initialize:function(e){this.initParams(e),this.setClickEventType(),this.setUpListeners()},initParams:function(e){this.opts=$.extend({maxDescLength:300},e),this.model=new t(this.opts),this.isMod=$(".content-moderation-view").length,this.review=0,this.tooltipShown=0},setUpListeners:function(){this.Eggshell.on("show feedback options",this.setFeedbackOptions,this).on("show abuse options",this.setAbuseOptions,this).on("thumbs up clicked",this.changeReviewValue,this).on("thumbs down clicked",this.renderReasons,this).on("set review id",this.setReviewId,this).on("render",this.render,this),this.model.on("render_reasons",this.render,this).on("review_posted",this.setReviewPosted,this)},autoFocusOnNegativeToolTip:function(){var e=this.$feedback;0<e.length&&setTimeout(function(){e.find("a:first").focus()},200)},autoFocusOnNextPageOfTooltip:function(){var e=this.$fa;0<e.length&&setTimeout(function(){e.find("a:first").focus(),e.find("textarea").attr("disabled",!0),e.find(".moderator-button button").attr("disabled",!0)},200)},setReviewId:function(e,t){this.reviewId=t},setReviewPosted:function(e){var t="",i=this.reviewId?"review updated":"review posted";this.Eggshell.trigger(i,e),$(".show-unrated-message").fadeOut(1e3),$(".positive-rating").prop("disabled",!1),this.opts.doTutorAttach&&this.hideTooltip(),this.review?this.displayFastTrackMessages(void 0!==e.fastTrackAnswerExpVal&&e.fastTrackAnswerExpVal):(this.renderMessageTooltip(),t="Many thanks for the thumbs up!",this.displayThanksMessage(this.$messageContent,t))},displayFastTrackMessages:function(a){if(!this.opts.isMobile){$(".tooltip").hide();var e=function(){return"<div class='ft-header'>Sorry, this answer was not helpful!</div><div class='ft-body'><ul><li>We've <b>credited</b> this question back to your account</li><li>We'll <b>email</b> you when we have a new answer</li></ul></div><div class='btn-cls'><button class='btn-primary btn-mini'>OK, GOT IT</button></div>"},t=function(){return"<div class='ft-content'>Sorry, that's frustrating! We care deeply about answer quality, so we'll review this and make updates based on your feedback.</div><div class='btn-cls'><button class='btn-secondary-outline btn-mini'>GOT IT</button></div>"},i=Eggshell.create("C.common.overlay.tooltip").on("return tooltip content node",function(e,t){var i=t;if(a){var s=$(".post-question-form-wrapper").find(".label"),o=s.text().match(/\d+/);if(o){var n=parseInt(o)+1;s.text(n+" questions remaining")}i.html("<div class='ft-header'>Sorry, this answer was not helpful!</div><div class='ft-body'><ul><li>We've <b>credited</b> this question back to your account</li><li>We'll <b>email</b> you when we have a new answer</li></ul></div><div class='btn-cls'><button class='btn-primary btn-mini'>OK, GOT IT</button></div>"),C.logger.doSessionLog({fast_track_message:1})}else i.html("<div class='ft-content'>Sorry, that's frustrating! We care deeply about answer quality, so we'll review this and make updates based on your feedback.</div><div class='btn-cls'><button class='btn-secondary-outline btn-mini'>GOT IT</button></div>");$(".btn-cls").on("click",$.proxy(function(){$(".tooltip").hide()},this))}).trigger("add custom css class",{cssClass:"ft-tooltip-top-green-border",cssSelector:".tooltip"}).trigger("set target",this.opts.tooltipTarget.find(".thumbs-down")).trigger("set tooltip the width",a?420:300).trigger("get tooltip content node").trigger("set tooltip below target").trigger("disable tooltip on hover");return a?i.trigger("position caret on top right",{caretMarginLeft:"393px",caretRightMinusLeft:176}).trigger("show"):i.trigger("show")}this.hideMobileAbuseMarkup()},displayThanksMessage:function(e,t){var i='<div class="msg-text">'+t+"</div>";e.html(i).addClass("thanks-message"),$(".thanks-message").css({width:"200px"}),this.opts.isMobile?setTimeout($.proxy(function(){e.fadeOut(500,$.proxy(function(){this.hideTooltip()},this))},this),3e3):$(".thanks-message").parent(".tooltip").delay(3e3).fadeOut(500)},setFeedbackOptions:function(e,t){this.feedback=1,this.opts.reviewType?this.renderReasons("feedbackOptions"):(this.review=0,$(".positive-rating").prop("disabled",!0),this.submitFeedback(null,t))},renderReasons:function(e){$(".show-unrated-message").fadeOut(1e3),this.model.get(e)?this.render():this.getReasons()},getReasons:function(){this.feedback?this.model.getFeedbackReasons(this.opts.entityType):this.model.setAbuseOptions()},setAbuseOptions:function(){this.feedback=0,this.renderReasons("abuseOptions")},render:function(){this.opts.isMobile?this.renderDialog():this.renderReasonsTooltip(),this.tooltipShown=1,this.styleContent(),this.feedback&&this.slideTooltip()},styleContent:function(){-1!==navigator.appVersion.indexOf("Win")&&$(".report-header").css("font-size","13px")},renderMessageTooltip:function(){var e="";this.opts.isMobile?(e=$('<div class="tooltip thanks-tooltip"></div>').appendTo(this.opts.tooltipTarget.parent()),this.$messageContent=$(".tooltip"),$(this.opts.tooltipTarget).on("click",function(){e.fadeIn(),setTimeout($.proxy(function(){e.fadeOut(500)},this),3e3)})):(e=Eggshell.create("C.common.overlay.tooltip").on("return tooltip content node",$.proxy(function(e,t){this.$messageContent=t,this.$messageContent.html(this.commonTemplate({tooltip:""}))},this)),this.triggerTooltipEvents(e,this.opts.tooltipTarget.find(".thumbs-up")))},renderReasonsTooltip:function(){var e=this.feedback?this.opts.tooltipTarget.find(".thumbs-down"):this.opts.tooltipTarget;this.reasonsTooltip=Eggshell.create("C.common.overlay.tooltip").on("return tooltip content node",$.proxy(function(e,t){this.$content=t,this.$content.html(this.getContent()),this.bindContent()},this)),this.triggerTooltipEvents(this.reasonsTooltip,e);var t="#"+this.reasonsTooltip.getId().replace(/[\.]+/g,"-")+" a:first";setTimeout(function(){$(t).focus()},100)},triggerTooltipEvents:function(e,t){e.trigger("set target",t).trigger("get tooltip content node").trigger("set tooltip below target").trigger("disable tooltip on hover").trigger("show")},renderDialog:function(){var e=this.getContent(),t=$("<div class='Dialog mobile-feedback-dialog'><div class='content'>"+e+"</div></div>");this.dialog=Eggshell.create("Mobile.Dialog",{element:t}),Eggshell.find(this.dialog).on("shown",$.proxy(function(){this.$content=$(".mobile-feedback-dialog").find(".content"),this.bindContent()},this)),this.dialog.trigger("show"),this.styleDialogForMobile()},bindContent:function(){this.$textarea=this.$content.find("textarea"),this.$feedbackButton=this.$content.find("form .feedback-button button"),this.$abuseButton=this.$content.find("form .abuse-button button"),this.cancelLink=this.$content.find("form .cancel-feedback"),this.$formArea=this.$content.find("form ul li"),this.$reportForm=this.$content.find(".report-form"),this.$reportNotice=this.$content.find(".report-notice"),this.$formArea.on(this.clickEventType,$.proxy(this.onClickForm,this)),this.$feedbackButton.on(this.clickEventType,$.proxy(this.submitNegativeFeedback,this)),this.$abuseButton.on(this.clickEventType,$.proxy(this.reportAbuse,this)),this.cancelLink.on(this.clickEventType,$.proxy(this.cancelAction,this)),this.$formArea.on("keydown",function(e){13===e.which&&$(e.currentTarget).click()});var t=this.opts.tooltipTarget;this.cancelLink.on("keydown",function(e){if(e.shiftKey&&9===e.keyCode)return!0;9!==e.which&&13!==e.which||($(e.currentTarget).click(),setTimeout(function(){void 0===t.attr("id")?t.focus():$("#"+t.attr("id")+" .negative-rating").focus()},100))})},submitNegativeFeedback:function(e){this.review=1,this.submitFeedback(e)},cancelAction:function(e){e.preventDefault(),e.stopPropagation(),this.opts.isMobile&&this.hideMobileTooltip(),$(e.currentTarget).hasClass("fa-cancel")?(this.$fa.animate({left:"150%"}),this.$feedback.animate({left:"0px"}),this.$feedback.find(".icon-chegg-Check").remove(),this.$textarea.attr("disabled",!0),this.autoFocusOnNegativeToolTip()):this.hideTooltip(),this.Eggshell.trigger("closed feedback form")},hideMobileAbuseMarkup:function(){this.hideMobileTooltip();var e="";e=$('<div class="tooltip abuse-tooltip"></div>').appendTo(".thumbs-down"),this.$messageCont=$(".tooltip");var t="Sorry, that's frustrating! We care <br />deeply about answer quality, so <br />we'll review this and make <br />updates based on your feedback.";this.displayThanksMessage(this.$messageCont,t)},hideMobileTooltip:function(){$(".content").hide(),Eggshell.find("Mobile.Dialog").trigger("hide")},hideTooltip:function(){this.opts.isMobile&&this.dialog?this.dialog.trigger("hide"):this.reasonsTooltip.trigger("hide"),this.tooltipShown=0},onClickForm:function(e){e.preventDefault(),this.$selectedReason=$(e.currentTarget),$(".icon-chegg-Check").remove(),this.$selectedReason.find("span").addClass("selected").prepend('<span class="icon-chegg-Check"></span>'),this.formatTextarea()},getContent:function(){var e="",t="",i=this.contentTemplate({tooltipClass:"abuse-tooltip",headerType:"second-page",header:"Report abuse",reasons:this.displayReasons("abuse"),maxlength:this.opts.maxDescLength,btnClass:"abuse-button",btnText:"Report abuse"}),s;if(this.feedback){var o="Help us fix this. What's the issue?";e=(t=this.contentTemplate({tooltipClass:"feedback-tooltip",headerType:"first-page",header:o,reasons:this.displayReasons("feedback"),maxlength:this.opts.maxDescLength,btnClass:"feedback-button",btnText:"Submit"}))+i}else e=i;return this.commonTemplate({tooltip:e})},commonTemplate:_.template('<form onsubmit="return false"><div class="report-reason"><div class="report-form"><%= tooltip %></div><div class="report-notice"></div></div></form>'),contentTemplate:_.template('<div class="<%=tooltipClass%>"><div class="report-header <%=headerType%>"><%= header %></div><%= reasons %><textarea name="description" placeholder="Additional details (optional)" maxlength="<%=maxlength%>" disabled="disabled" tabindex="0"></textarea><div class="moderator-button <%=btnClass%>"><button class="btn-secondary btn-mini ignore btn-submit" disabled="disabled" tabindex="0"><%= btnText %></button><span class="cancel-feedback"><a data-noajax="1" class="cancel-button link-button" tabindex="0">Cancel</a></span></div></div>'),slideTooltip:function(){this.$feedback=$(".feedback-tooltip"),this.$feedback.siblings().addClass("fa-tooltip"),this.$fa=$(".fa-tooltip"),this.$fa.find(".cancel-feedback").addClass("fa-cancel"),this.$spamReason=$(".feedback-tooltip a:contains('spam')"),this.$spamReason.on(this.clickEventType,$.proxy(function(){this.$feedback.animate({left:"-155%"}),this.$fa.animate({left:"0px"}),this.autoFocusOnNextPageOfTooltip()},this))},displayReasons:function(o){var e,t;return function(e){var t="",i="";for(var s in e)i='<li id="reason-'+e[s].id,"abuse"===o&&(i+='" name="'+e[s].name),t+=i+='"><a href="#" ><span class="reason">'+e[s].reason+"</span></a></li>";return"<ul>"+t+"</ul>"}("feedback"===o?this.model.get("feedbackOptions"):this.model.get("abuseOptions"))},reportAbuse:function(){var e=this,t=this.model.get("aid"),i=this.model.get("cid"),s=this.model.get("rid"),o=this.$content.find(".abuse-tooltip").find("textarea").val();this.$abuseButton.attr("disabled","disabled"),!t||i||s||this.submitNegativeFeedback("abuse"),$.ajax({url:"/_ajax/hwh/moderate/?token="+C.global.csrfToken+"&aid="+this.model.get("aid")+"&qid="+this.model.get("qid")+"&cid="+this.model.get("cid")+"&rid="+this.model.get("rid")+"&arid="+this.model.get("arid")+"&reason="+this.$selectedReason.attr("name")+"&comment="+encodeURIComponent($.trim(o)),success:function(){t&&!i&&!s||e.opts.tooltipTarget.css({"pointer-events":"none","background-position":"-12px 0"}),e.isMod&&e.moderateContent(),e.hideTooltip()},error:this.submitError.bind(this)})},formatTextarea:function(){var e=this.$selectedReason.find(".reason").html(),t=this.$textarea.val();this.$textarea.prop("disabled",!1),"Other"!==e||t?(this.$textarea.prop("required",!1),this.$textarea.attr("placeholder","Additional details (optional)"),$(".moderator-button button").prop("disabled",!1)):(this.$textarea.attr("required",!0),this.$textarea.attr("placeholder","Additional details (required)"),$(".moderator-button button").attr("disabled",!0),this.$textarea.on("input",function(){$(".moderator-button button").prop("disabled",!1)}))},changeReviewValue:function(){this.review=0,$(".show-unrated-message").fadeOut(1e3),$(".positive-rating").prop("disabled",!0),this.submitFeedback()},submitFeedback:function(e,t){var i=$(".dialog-question").attr("data-qid");i=void 0!==i?i:0;var s={askerId:this.opts.askerId,entityType:this.opts.entityType,entityId:this.opts.entityId,reviewType:"LIKE_DISLIKE",reviewValue:this.review,answerCreatedDate:this.opts.answerCreatedDate,token:C.global.csrfToken,questionId:i,options:this.opts.reviewOptions};if(this.review){if("abuse"===e)var o=this.$content.find(".abuse-tooltip").find("textarea");else var o=this.$textarea;var n=this.$selectedReason.find(".reason").html(),a=o.val(),r=a||n,l=this.$selectedReason.attr("id").replace("reason-",""),c={reviewReason:{reviewReasonId:l,reviewComment:r}};$.extend(s,c),this.$feedbackButton.attr("disabled","disabled"),this.Eggshell.trigger("feedback submitted",{reviewId:l})}var d=void 0!==this.reviewId?this.reviewId:t;d&&$.extend(s,{reviewId:d}),void 0!==l&&"9"===l.valueOf()&&$.extend(s,{isECAnswer:$(this.opts.tooltipTarget).parent().hasClass("enhanced-content-rating")}),this.model.saveReview(s)},submitSuccess:function(){var e="Success";this.displayThanksMessage(this.$content,e)},submitError:function(){var e="We encountered an error. Please try again.";this.displayThanksMessage(this.$content,e)},moderateContent:function(){var e=$(this.opts.container).closest(".mod-parent-container").find(".content-moderation").first(),t=e.attr("data-type"),i=e.attr("data-id"),s=e.attr("data-extra-id"),o={id:i,type:t,token:C.global.csrfToken};s&&(o.id_extra=s),this.model.deletePost(o)},styleDialogForMobile:function(){$(".moderator-button button").removeClass("btn-primary-mini").addClass("small")},setClickEventType:function(){this.clickEventType=this.opts.isMobile?mChegg.CLICK:"click"}})}()),Eggshell.define("C.Eggshell.homeworkhelp.thumbrating",{inputs:["render"],outputs:[]},function(){var t=Backbone.Model.extend({initialize:function(e){this.opts=$.extend(e,{})},getReviews:function(e,t){$.ajax({type:"get",dataType:"json",url:"/_ajax/contentfeedback/getreview?entityType="+e+"&entityId="+t,context:this,success:function(e){var t=e.user_review.result,i=e.review_count.result;this.trigger("display_review_counts",i),void 0===t||$.isEmptyObject(t)?this.trigger("answer_not_rated"):this.trigger("answer_rated",t[0])},error:function(){C.log("error posting rating value.")}})}}),e;return Backbone.View.extend({thumb_template:_.template('<div class="thumb-rating"><button class="positive-rating rating-block" aria-label=""><div class="thumb-button thumbs-up"><div class="thumbs-up-active hidden"/><div class="thumbs-up-inactive"/></div><div class="review-count up-count"/></button><button class="negative-rating rating-block" aria-label=""><div class="thumb-button thumbs-down"><div class="thumbs-down-active hidden"/><div class="thumbs-down-inactive"/></div><div class="review-count down-count"/></button></div>'),initialize:function(e){this.opts=e,this.model=new t(this.opts),this.reviewId=0,this.reviewType=0,this.setClickEventType(),this.setUpListeners(),this.positiveMsg="Sweet! Glad to be of help!",this.negativeMsg="Sorry! Sometimes we make mistakes. Let us know so we can fix it."},setUpListeners:function(){this.Eggshell.on("render",this.render,this),this.model.on("display_review_counts",$.proxy(this.displayReviewCounts,this)).on("answer_rated",$.proxy(this.displayPostedRating,this)).on("answer_not_rated",$.proxy(this.performUnratedActions,this))},performUnratedActions:function(){"E"===this.opts.qnaThumbsRatingExpBucket&&0===this.opts.userReviewCount&&($(".answers-h2").prepend('<div class="show-unrated-message"></div>').fadeIn(1e3),$(".question").css("margin-bottom","75px"),this.opts.isEnhancedContent?$(".show-unrated-message").addClass("ec-answer"):$(".show-unrated-message").addClass("non-ec-answer")),this.invokeRating(),this.Eggshell.trigger("display unrated message",this)},render:function(){this.$el.append(this.thumb_template({})),this.triggerHoverEvents(),this.$el.find(".positive-rating").attr("aria-label",this.positiveMsg),this.$el.find(".negative-rating").attr("aria-label",this.negativeMsg),this.model.getReviews(this.opts.entityType,this.opts.entityId)},invokeRating:function(){this.$el.on(this.clickEventType,$.proxy(function(e){this.noPositiveCountUpdate=0,(this.noNegativeCountUpdate=0)==this.$el.find(".thumbs-up-active.hidden").length?this.noPositiveCountUpdate=1:0==this.$el.find(".thumbs-down-active.hidden").length&&(this.noNegativeCountUpdate=1);var t=$(e.target).hasClass("negative-rating")||$(e.target).parents().hasClass("negative-rating"),i=$(e.target).hasClass("positive-rating")||$(e.target).parents().hasClass("positive-rating");void 0===this.feedback&&(t?(C.logger.doSessionLog({feedback_click:"thumbs_down"}),this.reviewType=1):i&&C.logger.doSessionLog({feedback_click:"thumbs_up"}),this.feedback=Eggshell.create("C.Eggshell.homeworkhelp.contentfeedback",{container:this.opts.el,tooltipTarget:$(e.currentTarget),entityType:this.opts.entityType,entityId:this.opts.entityId,isMobile:!!this.opts.isMobile&&this.opts.isMobile,reviewType:this.reviewType,askerId:this.opts.askerId,loggedInId:this.opts.loggedInId,answerCreatedDate:this.opts.answerCreatedDate,doTutorAttach:this.opts.doTutorAttach,reviewOptions:this.opts.reviewOptions}).on("review posted",this.displayCurrentRating,this).on("review updated",this.updateDisplay,this).on("closed feedback form",this.enableHoverTooltips,this).trigger("show feedback options",this.reviewId),this.opts.doTutorAttach&&!this.opts.isMobile&&this.feedback.on("feedback submitted",$.proxy(function(e,t){var i=t.reviewId;if(9==i||11==i){var s=9==i?"incorrect":"incomplete";C.logger.doSessionLog({feedback_tutor_shown:s}),Eggshell.create("C.Eggshell.homeworkhelp.tutorattach",{tooltipTarget:this.opts.el,reason:s}).trigger("render")}},this)),this.triggerRatingEvents()),t?(this.hoverTooltipNeg.trigger("hide").trigger("disable tooltip on hover"),this.hoverTooltipPos.trigger("disable tooltip on hover")):this.hoverTooltipPos.trigger("hide"),this.feedback.trigger("set review id",this.reviewId)},this))},triggerRatingEvents:function(){this.$el.find(".positive-rating").on(this.clickEventType,$.proxy(function(){C.logger.doSessionLog({feedback_click:"thumbs_up"}),this.feedback.trigger("thumbs up clicked")},this)),this.$el.find(".negative-rating").on(this.clickEventType,$.proxy(function(){C.logger.doSessionLog({feedback_click:"thumbs_down"}),this.feedback.trigger("thumbs down clicked")},this))},triggerHoverEvents:function(){this.hoverTooltipPos=this.createHoverTooltip(this.$el.find(".positive-rating"),this.positiveMsg),this.hoverTooltipNeg=this.createHoverTooltip(this.$el.find(".negative-rating"),this.negativeMsg)},createHoverTooltip:function(e,s){var t=Eggshell.create("C.common.overlay.tooltip").trigger("set target",e).on("return tooltip content node",$.proxy(function(e,t){var i;t.html('<div class="hover-message">'+s+"</div>")},this)).trigger("set tooltip below target").trigger("get tooltip content node").trigger("disable_max_z_index").trigger("enable tooltip on hover").trigger("open on tab");return $(".hover-message").parent(".tooltip-content").css({width:"200px"}),t},enableHoverTooltips:function(){this.hoverTooltipPos.trigger("enable tooltip on hover"),this.hoverTooltipNeg.trigger("enable tooltip on hover")},displayReviewCounts:function(e){var t;for(t in this.upCount=0,this.downCount=0,e)0==e[t].reviewValue?this.upCount=e[t].count:this.downCount=e[t].count;this.displayUpCount(this.upCount),this.displayDownCount(this.downCount)},displayUpCount:function(e){var t=this.roundCountValue(e);this.$el.find(".up-count").html(t)},displayDownCount:function(e){var t=this.roundCountValue(e);this.$el.find(".down-count").html(t)},roundCountValue:function(e){var t,i;1e3<=e?t=Math.round(e/100)/10+"K":t=parseInt(e);return t},displayPostedRating:function(e){this.toggleIcons(e)},displayCurrentRating:function(e,t){this.toggleIcons(t),1==t.reviewValue?this.displayDownCount(++this.downCount):this.displayUpCount(++this.upCount)},toggleIcons:function(e){1==e.reviewValue?this.toggleThumbsDown():this.toggleThumbsUp(),this.reviewId=e.id,this.invokeRating(),this.feedback&&this.feedback.trigger("set review id",this.reviewId)},updateDisplay:function(e,t){0==this.noNegativeCountUpdate&&1==t.reviewValue?(this.toggleThumbsDown(),this.toggleThumbsUp(),this.displayUpCount(--this.upCount),this.displayDownCount(++this.downCount)):0==this.noPositiveCountUpdate&&0==t.reviewValue&&(this.toggleThumbsDown(),this.toggleThumbsUp(),this.displayUpCount(++this.upCount),this.displayDownCount(--this.downCount))},toggleThumbsUp:function(){this.$el.find(".thumbs-up-active").toggleClass("hidden"),this.$el.find(".thumbs-up-inactive").toggleClass("hidden")},toggleThumbsDown:function(){this.$el.find(".thumbs-down-active").toggleClass("hidden"),this.$el.find(".thumbs-down-inactive").toggleClass("hidden")},setClickEventType:function(){this.clickEventType=this.opts.isMobile?mChegg.CLICK:"click"}})}()),Eggshell.define("C.Eggshell.homeworkhelp.tutorattach",{inputs:{render:{}},outputs:{}},function(){var t=Backbone.Model.extend({initialize:function(e){this.opts=$.extend(e,C.global.pageObject.opts),this.getTutors()},getTutors:function(){var e=this.opts.question;$.ajax({context:this,type:"GET",dataType:"JSON",url:"/_ajax/tutors",data:{token:C.global.csrfToken,subjectId:e.subSubjectId,subjectName:e.subSubjectName,campaign:"Chegg_Study-QA",limit:3,noSubjectCheck:0},success:function(e){$.isEmptyObject(e)||(this.set("tutors",e.tutors),this.set("tutorsUrl",e.url),this.trigger("loaded"))},error:function(e){C.log("Something went wrong with fetching tutors! "+JSON.stringify(e))}})}}),e;return Backbone.View.extend({initialize:function(e){this.initParams(e),this.setUpListeners()},initParams:function(e){this.opts=$.extend({},e),this.model=new t(this.opts)},setUpListeners:function(){this.Eggshell.on("render",this.render,this),this.model.on("loaded",this.renderTutorAvatars,this)},render:function(){this.renderTutorsTooltip()},renderTutorAvatars:function(){var e;this.model.get("tutors").forEach(function(e){this.$tutorsAvailable.append('<img src="'+e.image_thumb_small+'"><span class="available-icn"></span>')},this)},renderTutorsTooltip:function(){var e=this.feedback?this.opts.tooltipTarget.find(".thumbs-down"):this.opts.tooltipTarget;this.tooltip=Eggshell.create("C.common.overlay.tooltip").on("return tooltip content node",$.proxy(function(e,t){this.$content=t,this.$content.html(this.getContent()),this.bindContent()},this)),this.triggerTooltipEvents(this.tooltip,e)},triggerTooltipEvents:function(e,t){e.trigger("set target",t).trigger("set tooltip the width",320).trigger("get tooltip content node").trigger("set tooltip below target").trigger("disable tooltip on hover").trigger("show")},bindContent:function(){this.$tutorsAvailable=this.$content.find(".tutors-available"),this.$tutorsCta=this.$content.find(".tutor-cta"),this.$exit=this.$content.find(".x-icn"),this.$tutorsCta.on("click",$.proxy(this.ctaClick,this)),this.$exit.on("click",$.proxy(this.exitClick,this)),this.$content.css({width:"320px",padding:0})},ctaClick:function(){C.logger.doSessionLog({feedback_tutor_clicked:this.opts.reason},$.proxy(function(){var e=this.model.get("tutorsUrl");C.utility.navigate(e)},this))},exitClick:function(){this.hideTooltip()},hideTooltip:function(){this.tooltip.trigger("hide")},getContent:function(){return this.contentTemplate({subjectName:this.opts.subSubject})},contentTemplate:_.template('<div class="tutors-tooltip"><div class="tutor-header">It\'s very important to us to provide you with a complete answer. Can an online tutor help?<span class="x-icn"></span></div><div class="tutor-footer"><div class="tutor-desc">Get unstuck with <span class="highlight-txt">30 free minutes</span> of tutoring (included with your subscription):</div><span class="tutors-available"></span><span class="tutors-avail-blurb"><%= subjectName %> tutors online right now</span><button class="btn-primary btn-sm tutor-cta">Talk to a Chegg tutor</button></div></div>')})}()),Eggshell.define("C.Eggshell.overlay.menu",{inputs:["set target","set header html","set background color","set text color","get header area","add menu item","add menu item as a new component","get menu item area","clear menu items","stop item default click event","show","hide","sticky menu","enable header","enable click","add css class","destroy when hidden"],outputs:["header area","menu item area","menu item added as a new component","item clicked","shown","hidden"]},C.View.extend({target:null,visible:!1,stopDefaultClick:!1,itemComponents:[],template:_.template('<div class="arrow"><div class="outer"></div><div class="inner"></div></div><div class="menu"><div class="header"></div><div class="items"></div></div>'),initialize:function(){this.render(),this.registerListeners(),this.HideProxy=$.proxy(this.hide,this),$(window).on("click",this.HideProxy),$(window).on("resize",this.HideProxy),this.Eggshell.listen("destroy",this.destroy)},destroy:function(){$(window).off("click",this.HideProxy),$(window).off("resize",this.HideProxy)},render:function(){this.$el.html(this.template()),this.$el.hide(),this.$(".header").hide(),this.$el.on("mouseover",$.proxy(this.stopWait,this)),this.$el.on("mouseleave",$.proxy(this.waitAndHide,this))},events:{"mouseover .item":"itemOnMouseOver","mouseout .item":"itemOnMouseOut","click .menu":"stopEvent"},registerListeners:function(){this.Eggshell.listen("set target",function(e,t){if(t&&t.jquery)this.$target=t;else{if(!t||"string"==typeof t)throw"Invalid target node";this.$target=$(t)}this.$target=$.extend({},this.$target),this.enableHover()}),this.Eggshell.listen("add css class",function(e,t){t&&"string"==typeof t&&this.$el.addClass(t)}),this.Eggshell.listen("set header html",function(e,t){if(!t||"string"!=typeof t)throw"Invalid header html";this.$(".header").html(t),this.$(".arrow .inner").addClass("hoverEnabled"),this.$(".header").show()}),this.Eggshell.listen("set background color",function(e,t){if(!t||"string"!=typeof t)throw"Invalid color code";this.$(".arrow .inner").css("borderBottomColor",t),this.$(".menu").css("background-color",t)}),this.Eggshell.listen("set text color",function(e,t){if(!t||"string"!=typeof t)throw"Invalid color code";this.$(".menu .items .item").css("color",t)}),this.Eggshell.listen("enable click",function(){this.enableClick()}),this.Eggshell.listen("get header area",function(){this.Eggshell.trigger("header area",$.extend({},this.$(".header")))}),this.Eggshell.listen("add menu item",function(e,t){if(!t||!t.text||"string"!=typeof t.text)throw"Invalid item name";var i=$('<a class="item"></a>').appendTo(this.$(".items")),s;i.html(t.text).attr("title",t.text),t.link&&"string"==typeof t.link&&i.attr("href",t.link),i.click($.proxy((s=t,function(e){this.stopDefaultClick&&e.preventDefault(),this.Eggshell.trigger("item clicked",s),this.hide()}),this))}),this.Eggshell.listen("add menu item as a new component",function(e,t){if(!t||"string"!=typeof t)throw"Invalid component";var i=$('<div class="item"></div>').appendTo(this.$(".items")),s=Eggshell.create(t,{el:$.extend({},i)}).getNs(),o;this.itemComponents.push(s),this.Egghshell.trigger("menu item added as a new component",s),i.click($.proxy((o=t,function(e){this.stopDefaultClick&&e.preventDefault(),this.Eggshell.trigger("item clicked",o),this.hide()}),this))}),this.Eggshell.listen("get menu item area",function(){this.Eggshell.trigger("menu item area",$.extend({},this.$(".items")))}),this.Eggshell.listen("clear menu items",function(){if(this.itemComponents&&0<this.itemComponents.length)for(var e=0;e<this.itemComponents.length;e++)Eggshell.destroy(this.itemComponents[e]);this.itemComponents=[],this.$(".items").empty()}),this.Eggshell.listen("stop item default click event",function(){this.stopDefaultClick=!0}),this.Eggshell.listen("show",function(){if(!this.$target)throw"Target is not set";this.resetArrow(),this.positionMenu(),this.show()}),this.Eggshell.listen("hide",function(){this.hide()}),this.Eggshell.listen("sticky menu",function(){$(window).scroll($.proxy(function(){this.positionMenu()},this))}),this.Eggshell.listen("enable header",function(){this.$(".arrow .inner").addClass("hoverEnabled"),this.$(".header").show()})},positionMenu:function(){var e=$(window).width(),t=$(window).height(),i=this.$target.width(),s=this.$target.height(),o=this.$target.offset(),n=o.top,a=o.left,r;this.$(".arrow").removeClass("left").removeClass("right"),(n+=s)<0&&(n=0),(a=a+Math.floor(i/2)-Math.floor(this.$(".arrow").width()/2)-Math.floor(this.$el.width()/2))+this.$el.width()>e&&(this.$(".arrow").addClass("right"),a=o.left+Math.floor(i)-Math.floor(this.$el.width())),a<0&&(a=0),this.$el.css({top:n+"px",left:a+"px"})},show:function(){this.$el.hide(),this.positionMenu(),this.$el.fadeIn(100,$.proxy(function(){this.Eggshell.trigger("shown"),this.visible=!0},this))},hide:function(){this.visible&&this.$el.fadeOut(100,$.proxy(function(){this.Eggshell.trigger("hidden"),this.resetArrow(),this.visible=!1},this))},itemOnMouseOver:function(e){$(e.target).prev().addClass("noBorder")},itemOnMouseOut:function(e){this.$(".item").removeClass("noBorder"),this.Eggshell.trigger("mouseout")},stopEvent:function(e){e.stopPropagation()},resetArrow:function(){this.$(".arrow").removeClass("left").removeClass("right")},enableHover:function(){if(!this.$target)throw"Please set the target element first";this.disableHover(),this.$target.on("mouseover",$.proxy(this.handleTargetMouseOverEvent,this)),this.$target.on("mouseleave",$.proxy(this.waitAndHide,this)),this.$el.on("mouseover",$.proxy(this.stopWait,this)),this.$el.on("mouseleave",$.proxy(this.waitAndHide,this))},disableHover:function(){if(!this.$target)throw"Please set the target element first";this.$target.off("mouseover"),this.$target.off("mouseleave"),this.$el.off("mouseover"),this.$el.off("mouseleave")},enableClick:function(){this.disableHover(),this.$target.on("click",$.proxy(function(){this.visible?this.hide():this.handleTargetMouseOverEvent()},this))},waitAndHide:function(){this.timer=setTimeout($.proxy(function(){this.hide()},this),100)},stopWait:function(){clearTimeout(this.timer)},handleTargetMouseOverEvent:function(){this.show(),this.stopWait()}})),Eggshell.define("C.Eggshell.overlay.header.book",{Inputs:["set book title","set ordered date"],Outputs:["book title clicked","ordered date clicked"]},C.View.extend({template:_.template('<div class="title"></div><div class="date"></div>'),initialize:function(){this.render(),this.registerListeners()},render:function(){this.$el.empty(),this.$el.html(this.template())},events:{"click .title":"click","click .date":"click"},registerListeners:function(){this.Eggshell.listen("set book title",function(e,t){if(!t||"string"!=typeof t)throw"Invalid book title";this.titleNS&&(Eggshell.destroy(this.titleNS),delete this.titleNS),this.titleNS=Eggshell.create("C.Eggshell.text.ellipsis",{el:this.$(".title")}).getNs(),Eggshell.trigger(this.titleNS,"set text",t),Eggshell.trigger(this.titleNS,"set lines",2)}),this.Eggshell.listen("set ordered date",function(e,t){if(!(t&&t instanceof Date))throw"Invalid ordered date";this.$(".date").html("Ordered: "+(t.getMonth()+1)+"/"+t.getDate()+"/"+t.getFullYear()).attr("title",t)})},click:function(e){var t=$(e.target);t.hasClass("title")?this.Eggshell.trigger("book title clicked"):t.hasClass("date")&&this.Eggshell.trigger("ordered date clicked")}})),Eggshell.define("C.common.cspricemodal",{inputs:["show cs price modal","set type","update price","set headline","set list content","destroy on close","redirect to checkout page"],outputs:[]},C.View.extend({initialize:function(e){this.data=$.extend({type:"",alcItemId:""},e),this.model=new C.cspricemodal.model(this.data),this.model.on("subsDataCaptured",this.createComponent,this),this.fireAdobePaywallEvent()},fireAdobePaywallEvent:function(){C.adobeAnalytics.setData("page",{pageInfo:{pageType:"promotion",pageName:"CS Paywall"},category:{primaryCategory:"Chegg",subCategory1:"Web",subCategory2:"cs"}}),C.adobeAnalytics.track("pageView")},createComponent:function(){this.setUpListeners(),this.Eggshell.trigger("loaded")},priceTemplate:_.template('<div class="radio-input"><input type="radio" name="cs-radio" <%= checked %> id="<%= option %>" data-priceid="<%= priceId %>" data-catalogid="<%= catalogId %>" data-catalogsource="<%= catalogItemSource %>"/><label class="form-radio <%= hide %>" for="<%= option %>">&nbsp;</label><label for="<%= option %>"><span class="radio-label">$<%= label %></span> <div class="radio-term"><%= term %></div></label></div>'),createPopup:function(){if(void 0===this.popup){this.popup=Eggshell.create("C.Eggshell.dialog");var e="chkout"===this.data.page?"Update":"Continue";this.popup.trigger("hide sub headline").trigger("hide icon").trigger("enable default control").trigger("set primary button",e).trigger("set id","cspricemodal"),this.displayPopupContent()}var t;this.popup.trigger("show"),"chkout"!==this.data.page&&this.setInitialState(),C.global.userUuid||this.data.userSignedIn||this.popup.trigger("set secondary button","Sign In"),this.setDialogListeners()},displayPopupContent:function(){var e={el:"#"+this.popup.getId(),priceTemplate:this.priceTemplate,trialPeriod:this.model.getTrialPeriod(),page:this.data.page,type:this.data.type};this.model.get("alcOptionExists")&&Eggshell.create("C.common.cspricemodal.alacarte",{subsPriceData:this.model.get("subsPriceData")}).trigger("render",e),Eggshell.create("C.common.cspricemodal.subscription",{subsPriceData:this.model.get("subsPriceData"),alcOptionExists:this.model.get("alcOptionExists")}).trigger("render",e)},setDialogListeners:function(){this.listenToPrimaryBtnClick(),this.listenToSecondaryBtnClick(),this.listenToRadioBtnChange(),this.destroyOnClose&&this.listenToCloseBtnClick()},listenToCloseBtnClick:function(){this.popup.listen("hidden",$.proxy(function(e){Eggshell.find(this.popup).trigger("destroy")},this))},listenToPrimaryBtnClick:function(){this.popup.listen("primary button clicked",$.proxy(function(){"chkout"!==this.data.page?window.location.href=this.model.getAddToCartUrl(this.catalogId,this.priceId,this.catalogItemSource):(this.popup.trigger("hide"),this.Eggshell.trigger("update price"))},this)),C.adobeAnalytics.track("cs_paywall")},redirectToCheckoutPage:function(){var e=this.model.get("subsPriceData"),t=this.model.get("alcOptionExists");this.updateSelection(this,{priceId:e.monthly.priceId,catalogId:e.monthly.catalogId,catalogItemSource:e.monthly.catalogItemSource}),t||C.utility.setCookie("alcItemId",null,0),C.utility.setCookie("csPriceModalType",this.data.type),"chkout"!==this.data.page?window.location.href=this.model.getAddToCartUrl(this.catalogId,this.priceId,this.catalogItemSource):this.Eggshell.trigger("update price"),C.adobeAnalytics.track("cs_paywall")},listenToSecondaryBtnClick:function(){var e=this;this.popup.listen("secondary button clicked",function(){C.logger.doSessionLog({signup_flow:"hwhv1"},function(){C.utility.navigate("/auth?redirect="+window.location.pathname)})})},listenToRadioBtnChange:function(){$("input[type=radio]").on("change",$.proxy(function(e){this.Eggshell.trigger("option selected",{priceId:$(e.target).data("priceid"),catalogId:$(e.target).data("catalogid"),catalogItemSource:$(e.target).data("catalogsource")})},this))},setUpListeners:function(){this.Eggshell.on("show cs price modal",this.createPopup).on("set type",this.setType).on("option selected",this.updateSelection).on("set headline",this.setHeadline).on("set list content",this.setListContent).on("destroy on close",this.setDestroyOnClose).on("redirect to checkout page",this.redirectToCheckoutPage)},setDestroyOnClose:function(e,t){this.destroyOnClose=!0},setHeadline:function(e,t){this.headline=t},setListContent:function(e,t){this.listContent=t},setInitialState:function(){var e=$(".cs-wrapper").find("input[name=cs-radio]").data("priceid"),t=$(".cs-wrapper").find("input[name=cs-radio]").data("catalogid"),i=$(".cs-wrapper").find("input[name=cs-radio]").data("catalogsource");this.updateSelection(this,{priceId:e,catalogId:t,catalogItemSource:i}),this.model.get("alcOptionExists")||C.utility.setCookie("alcItemId",null,0),C.utility.setCookie("csPriceModalType",this.data.type)},updateSelection:function(e,t){this.catalogId=t.catalogId,this.priceId=t.priceId,this.catalogItemSource=t.catalogItemSource;var i={priceId:t.priceId,catalogId:t.catalogId,catalogItemSource:t.catalogItemSource,price:this.model.getPriceGivenPriceId(t.priceId),desc:this.model.getDesc(t.priceId,t.catalogId),term:this.model.getTermGivenPriceId(t.priceId),trialPeriod:this.model.getTrialPeriod()};C.utility.setLocal("priceSelectedData",i)},setType:function(e,t){this.data.type=t}})),C("cspricemodal"),C.cspricemodal.model=C.Model.extend({objName:"C.cspricemodal.model",initialize:function(e){this.data=e,this.getSubsData()},getSubsData:function(){$.ajax({url:"/study/_ajax/hwh/subscription/",type:"GET",data:{token:C.global.csrfToken,alcItemId:this.data.alcItemId,page:this.data.page,csPriceModal:!0},context:this,success:function(e){this.set("subsPriceData",e.subsPriceData)},error:function(){C.utility.refresh()}}).done(function(e){this.set("annualOptionExists",this.annualOptionExists()),this.set("alcOptionExists",this.alcItemExists()),this.set("offerType",this.getOfferType()),this.trigger("subsDataCaptured")})},annualOptionExists:function(){return void 0!==this.get("subsPriceData").yearly},alcItemExists:function(){return void 0!==this.get("subsPriceData").alacarte&&void 0!==this.get("subsPriceData").alacarte.prices&&void 0!==this.get("subsPriceData").alacarte.prices.price},getOfferType:function(){return this.hasFreeTrial()?"free-trial":this.get("annualOptionExists")?this.get("annualOptionExists")&&!this.get("alcOptionExists")?"monthly-and-annual":this.get("alcOptionExists")?"alacarte":"monthly-only":"monthly-only"},getAddToCartUrl:function(e,t,i){return"/checkoutinterstitial/hwh/?redirect=hwh&command="+e+","+t+",1,"+i},getPriceGivenPriceId:function(e){return this.get("subsPriceData").monthly.priceId===e?this.get("subsPriceData").monthly.price:this.get("annualOptionExists")&&this.get("subsPriceData").yearly.priceId===e?this.get("subsPriceData").yearly.price:this.get("subsPriceData").alacarte.prices.price},getDesc:function(e,t){return this.get("subsPriceData").monthly.priceId===e?this.get("subsPriceData").monthly.desc:this.get("annualOptionExists")&&this.get("subsPriceData").yearly.priceId===e?this.get("subsPriceData").yearly.desc:this.get("alcOptionExists")&&this.get("subsPriceData").alacarte.catalogItemId==t?this.get("subsPriceData").alacarte.desc:""},getTermGivenPriceId:function(e){return this.get("subsPriceData").monthly.priceId===e?"month":this.get("annualOptionExists")&&this.get("subsPriceData").yearly.priceId===e?"year":""},hasFreeTrial:function(){var e=parseInt(this.get("subsPriceData").monthly.trialPeriod),t;return 0<e&&e<parseInt(this.get("subsPriceData").monthly.renewalPeriod)},getTrialPeriod:function(){return this.hasFreeTrial()?this.get("subsPriceData").monthly.trialPeriod:""}}),Eggshell.define("C.common.cspricemodal.subscription",{inputs:["render"],outputs:[]},C.View.extend({initialize:function(e){this.data=$.extend({type:""},e),this.model=new C.cspricemodal.subscription.model({subsPriceData:this.data.subsPriceData}),this.setUpListeners()},subsContent:{tbsLi:"<li>Step-by-step Textbook Solutions for over 34,000 ISBNs</li>",answerLi:"<li>Get this answer and millions more</li>",qnaLi:"<li>Ask questions of experts and enthusiasts 24/7</li>",hwhLi:"<li>Search millions of homework answers</li>",headlineAlc:"Select option",headlineNoTrial:"Choose monthly or annual",headlineNoAnnual:"Ace your course",csSubheader:"Chegg Study",tbsSubheader:"All Textbook Solutions and more",qnaSubheader:"All answers, Textbook Solutions and more"},setUpListeners:function(){this.Eggshell.on("render",this.render)},render:function(e,t){this.el=t.el.split(".").join("-"),$(this.el).find(".content").append(this.getCSMarkup(t)),$(this.el).find(".headline").append(this.getHeadline(t))},getHeadline:function(e){return this.data.alcOptionExists?this.subsContent.headlineAlc:this.model.hasFreeTrial()?"Start "+e.trialPeriod+"-day free trial":this.model.get("annualOptionExists")?this.subsContent.headlineNoTrial:this.subsContent.headlineNoAnnual},getCSMarkup:function(e){var t=this.model.get("annualOptionExists")||this.data.alcOptionExists?"":"hide";this.checkMonthly=this.data.alcOptionExists?"":"checked",this.checkYearly="","chkout"===e.page&&this.getCSDefaultRadio();var i='<div class="cs-radio">'+e.priceTemplate({checked:this.checkMonthly,option:"monthly",label:this.model.getMonthlyPrice(),term:this.model.getBillingText("monthly"),priceId:this.model.getMonthlyPriceId(),catalogId:this.model.getMonthlyCatalogId(),catalogItemSource:this.model.getCatalogItemSource(),hide:t});this.model.get("annualOptionExists")&&(i+=e.priceTemplate({checked:this.checkYearly,option:"yearly",label:this.model.getAnnualPrice(),term:this.model.getBillingText("annually"),priceId:this.model.getAnnualPriceId(),catalogId:this.model.getAnnualCatalogId(),catalogItemSource:this.model.getCatalogItemSource(),hide:t})),i+="</div>";var s=this.subsContent.csSubheader;return this.data.alcOptionExists&&(s=this.model.isTBSAlcItem()?this.subsContent.tbsSubheader:this.subsContent.qnaSubheader),'<div class="cs-wrapper"><div class="cs-subheadline">'+s+"</div>"+this.getCSListContent()+i+"</div>"},getCSDefaultRadio:function(){if(C.utility.getLocal("priceSelectedData")){var e=C.utility.getLocal("priceSelectedData").desc;this.checkMonthly="",this.checkYearly="",-1!==e.indexOf("annual")?this.checkYearly="checked":-1!==e.indexOf("monthly")&&(this.checkMonthly="checked")}},getCSListContent:function(){var e="";return"qna"===this.data.type?e+=this.subsContent.answerLi+this.subsContent.tbsLi+this.subsContent.qnaLi:e+=this.subsContent.tbsLi+this.subsContent.qnaLi+this.subsContent.hwhLi,'<ul class="cs-list">'+e+"</ul>"}})),C("cspricemodal.subscription"),C.cspricemodal.subscription.model=C.Model.extend({objName:"C.cspricemodal.subscription.model",initialize:function(e){this.data=e,this.subsPriceData=e.subsPriceData,this.set("annualOptionExists",this.annualOptionExists())},annualOptionExists:function(){return void 0!==this.subsPriceData.yearly},isTBSAlcItem:function(){return!!this.data.alcOptionExists&&-1!==this.subsPriceData.alacarte.type.indexOf("TBS")},getMonthlyPrice:function(){return this.subsPriceData.monthly.price},getAnnualPrice:function(){return this.get("annualOptionExists")?this.subsPriceData.yearly.price:""},getMonthlyPriceId:function(){return this.subsPriceData.monthly.priceId},getAnnualPriceId:function(){return this.get("annualOptionExists")?this.subsPriceData.yearly.priceId:""},getMonthlyCatalogId:function(){return this.subsPriceData.monthly.catalogId},getAnnualCatalogId:function(){return this.get("annualOptionExists")?this.subsPriceData.yearly.catalogId:""},hasFreeTrial:function(){var e=parseInt(this.subsPriceData.monthly.trialPeriod),t;return 0<e&&e<parseInt(this.subsPriceData.monthly.renewalPeriod)},getBillingText:function(e){return this.hasFreeTrial()?e+" after trial":e},getCatalogItemSource:function(){return this.subsPriceData.monthly.catalogItemSource}}),Eggshell.define("C.common.cspricemodal.alacarte",{inputs:["render"],outputs:[]},C.View.extend({initialize:function(e){this.data=$.extend({type:"",alcItemId:""},e),this.model=new C.cspricemodal.alacarte.model({subsPriceData:this.data.subsPriceData}),this.setUpListeners()},alcContent:{alcFineprint:"Access limited to the chegg.com website. Excludes mobile app access.",alcSubheaderTBS:"This Textbook Solution",alcSubheaderQNA:"This answer"},setUpListeners:function(){this.Eggshell.on("render",this.render)},render:function(e,t){this.el=t.el.split(".").join("-");var i=this.getALaCarteMarkup(t);$(this.el).find(".content").append(i)},getALaCarteMarkup:function(e){var t="tbs"===e.type?this.alcContent.alcSubheaderTBS:this.alcContent.alcSubheaderQNA,i=this.model.getAlcContent(),s="tbs"===e.type?'<div class="tbs-chapter">Chapter '+i.chapter+", Problem "+i.problem+'</div><div class="tbs-title">'+i.bookTitle+"</div>":'<div class="qna-body">'+i.qnaBody+"</div>",o='<div class="alc-radio">'+e.priceTemplate({checked:"checked",option:"alcarte",label:this.model.getALaCartePrice(),term:this.model.getAlcBillingText(),priceId:this.model.getAlcPriceId(),catalogId:this.model.getAlcCatalogId(),hide:""})+"</div>";return'<div class="cs-wrapper"><div class="cs-subheadline">'+t+'</div><div class="alc-content">'+s+'</div><div class="cs-fineprint">'+this.alcContent.alcFineprint+"</div>"+o+"</div>"}})),C("cspricemodal.alacarte"),C.cspricemodal.alacarte.model=C.Model.extend({objName:"C.cspricemodal.alacarte.model ",initialize:function(e){this.subsPriceData=e.subsPriceData},getALaCartePrice:function(){return this.subsPriceData.alacarte.prices.price},isTBSAlcItem:function(){return-1!==this.subsPriceData.alacarte.type.indexOf("TBS")},getAlcContent:function(){var e={};return this.isTBSAlcItem()?(e.bookTitle=this.subsPriceData.alacarte.bookTitle,e.chapter=this.subsPriceData.alacarte.chapterName,e.problem=this.subsPriceData.alacarte.problemName):(e.qnaBody=this.subsPriceData.alacarte.body,this.subsPriceData.alacarte.transcribedData&&(e.qnaBody=JSON.parse(this.subsPriceData.alacarte.transcribedData).text)),e},getAlcPriceId:function(){return this.subsPriceData.alacarte.prices.logId},getAlcCatalogId:function(){return this.subsPriceData.alacarte.catalogItemId},getAlcBillingText:function(){return this.isTBSAlcItem()?"1 solution":"1 answer"}}),Eggshell.define("C.common.cspricemodal.responsive",{inputs:["set type","set mobile","option selected","show cs price modal"],outputs:[],strict:!1},function(){var e;return Backbone.View.extend({initialize:function(e){this.data=$.extend({type:""},e),this.model=new C.cspricemodal.model(this.data),this.model.on("subsDataCaptured",this.triggerLoaded,this),this.isMobile=!1,Eggshell.find(this).on("set type",this.setType).on("set mobile",this.setMobile).on("option selected",this.updateSelection).on("show cs price modal",this.createModal)},triggerLoaded:function(){Eggshell.find(this).trigger("loaded")},createModal:function(){if(this.isMobile&&0!=this.isMobile){var e={secondaryText:"Cancel"};this.popup=Eggshell.create("C.mobile.dialog").trigger("hide headline").trigger("hide sub headline").trigger("hide icon").trigger("hide control").trigger("configure controls",e).trigger("show"),this.popupElement=".native-dialog"}else this.popup=Eggshell.create("C.Eggshell.dialog").trigger("hide headline").trigger("hide sub headline").trigger("hide icon").trigger("hide control"),$("#"+this.popup.getId().replace(".","-")).addClass("cspricemodal"),this.popupElement="#"+this.popup.getId().replace(".","-");this.renderModalContent()},renderModalContent:function(){Eggshell.create("C.common.cspricemodal.responsive.general",{elem:this.popupElement,page:this.data.page,subsPriceData:this.model.get("subsPriceData"),type:this.data.type,offerType:this.model.get("offerType"),isMobile:this.isMobile}).on("ready",this.showDialog,this).trigger("render")},showDialog:function(){this.setInitialState(),this.setDialogListeners(),this.isMobile?$(this.popupElement).find(".content > .wrapper").remove():this.popup.trigger("show")},setType:function(e,t){if(!t||"string"!=typeof t)throw"Invalid type. Type must be of type string";this.data.type=t},setMobile:function(e,t){this.isMobile=t},setInitialState:function(){var e=$(".cspricemodal-wrapper"),t=e.find("input[name=cs-radio]").data("priceid"),i=e.find("input[name=cs-radio]").data("catalogid"),s=e.find("input[name=cs-radio]").data("catalogsource");this.updateSelection(this,{priceId:t,catalogId:i,catalogItemSource:s}),C.utility.setCookie("csPriceModalType",this.data.type)},updateSelection:function(e,t){this.catalogId=t.catalogId?t.catalogId:t.catalogItemId?t.catalogItemId:"",this.priceId=t.priceId,this.catalogItemSource=t.catalogItemSource;var i={priceId:this.priceId,catalogId:this.catalogId,catalogItemSource:this.catalogItemSource,price:this.model.getPriceGivenPriceId(this.priceId),desc:this.model.getDesc(this.priceId,this.catalogId),trialPeriod:this.model.getTrialPeriod()};C.utility.setLocal("priceSelectedData",i)},setDialogListeners:function(){this.listenToPrimaryBtnClick(),this.listenToSecondaryBtnClick(),this.listenToHide(),this.listenToRadioBtnChange()},listenToPrimaryBtnClick:function(){$(".cspricemodal-cta").on("click",$.proxy(function(){window.location.href=this.model.getAddToCartUrl(this.catalogId,this.priceId,this.catalogItemSource)},this))},listenToSecondaryBtnClick:function(){$(".cspricemodal-signin-link").on("click",$.proxy(function(){C.logger.doSessionLog({signup_flow:"hwhv1"},function(){C.utility.navigate("/auth?redirect="+window.location.pathname)})},this))},listenToHide:function(){this.popup.on("hidden",$.proxy(function(){this.popup.trigger("destroy content")},this))},listenToRadioBtnChange:function(){$("input[type=radio]").on("change",$.proxy(function(e){this.Eggshell.trigger("option selected",{priceId:$(e.target).data("priceid"),catalogId:$(e.target).data("catalogid"),catalogItemSource:$(e.target).data("catalogsource")})},this))}})}()),Eggshell.define("C.common.cspricemodal.responsive.general",{inputs:["render"],outputs:["ready"],strict:!1},function(){var e;return Backbone.View.extend({initialize:function(e){this.data=$.extend({type:""},e),this.model=new C.cspricemodal.subscription.model({subsPriceData:this.data.subsPriceData}),this.Eggshell.on("render",this.render)},render:function(){$(this.data.elem).find(".content").append(this.getModalMarkup()),this.showAlacarteOffer(),Eggshell.find(this).trigger("ready")},getModalMarkup:function(){return this.modalData={},this.setPromotionalTextSectionData(),this.setPriceSectionData(),this.setCTATextData(),this.modalTemplate({modal:this.modalData})},setPromotionalTextSectionData:function(){this.modalData.type=this.data.type?this.data.type:"general";var e="cspricemodal.responsive."+this.modalData.type+".headline",t="cspricemodal.responsive."+this.modalData.type+".proofpoint1",i="cspricemodal.responsive."+this.modalData.type+".proofpoint2";this.modalData.subHeader=C.resource.fetch(e),this.modalData.proofPoint1=C.resource.fetch(t),this.modalData.proofPoint2=C.resource.fetch(i)},setPriceSectionData:function(){this.setDefaultRadioSelection();var e="free-trial"==this.data.offerType?"after":"",t=this.data.isMobile?C.resource.fetch("cspricemodal.responsive.general.mobile.pricedisclaimer"):"",i=this.radioInputTemplate({checked:this.checkMonthly,option:"monthly",label:this.model.getMonthlyPrice(),term:"month",priceId:this.model.getMonthlyPriceId(),catalogId:this.model.getMonthlyCatalogId(),catalogItemSource:this.model.getCatalogItemSource(),additionalText:e,additionalRadioLabel:t});"monthly-and-annual"!=this.data.offerType&&"alacarte"!=this.data.offerType&&"free-trial"!=this.data.offerType||(i+=this.radioInputTemplate({checked:this.checkYearly,option:"yearly",label:this.model.getAnnualPrice(),term:"year",priceId:this.model.getAnnualPriceId(),catalogId:this.model.getAnnualCatalogId(),additionalText:e,additionalRadioLabel:t,catalogItemSource:this.model.getCatalogItemSource()}));var s="free-trial"==this.data.offerType?"":C.resource.fetch("cspricemodal.responsive.general.pricedisclaimer");this.modalData.priceOffers=this.priceOfferTemplate({radioOptions:i,subText:s,className:""})},showAlacarteOffer:function(){"alacarte"==this.data.offerType?Eggshell.create("C.common.cspricemodal.responsive.alacarte",{elem:$(this.data.elem).find(".cspricemodal-price-section"),page:this.data.page,subsPriceData:this.model.get("subsPriceData"),type:this.data.type,radioInputTemplate:this.radioInputTemplate,priceOfferTemplate:this.priceOfferTemplate,checked:this.checkAlacarte}).trigger("render"):C.utility.setCookie("alcItemId",null,0)},setDefaultRadioSelection:function(){this.checkYearly="",this.checkAlacarte="",this.checkMonthly="checked"},setCTATextData:function(){var e="";e="free-trial"==this.data.offerType?C.resource.fetch("cspricemodal.responsive.general.freetrial.ctatext"):C.resource.fetch("cspricemodal.responsive.general.ctatext"),this.modalData.ctaText=e,this.modalData.signInText=C.global.userId?"":C.resource.fetch("cspricemodal.responsive.general.signintext")},radioInputTemplate:_.template('<div class="radio-input"><input type="radio" name="cs-radio" <%= checked %> id="<%= option %>" data-priceid="<%= priceId %>" data-catalogid="<%= catalogId %>" data-catalogsource="<%= catalogItemSource %>"/><label class="form-radio" for="<%= option %>">&nbsp;</label><label for="<%= option %>"><span class="radio-label">$<%= label %></span><span class="radio-term">/<%= term %> <%= additionalText %></span></label><div class="additional-radio-label"> <%= additionalRadioLabel %></div></div>'),priceOfferTemplate:_.template('<div class="cs-radio <%= className %>"><div class="radio-options"><%= radioOptions %></div><div class="cspricemodal-offer-subtext"><%= subText %></div></div>'),modalTemplate:_.template('<div class="cspricemodal-wrapper <%= modal.type %>"><div class="cspricemodal-top-section"><div class="cspricemodal-header"><span class="cspricemodal-header-logo"></div><div class="cspricemodal-subheader"><%= modal.subHeader %></div><div class="cspricemodal-proofpoints"><ul class="cspricemodal-proofpoint-list"><li class="cspricemodal-proofpoint-li"><%= modal.proofPoint1 %></li><li class="cspricemodal-proofpoint-li"><%= modal.proofPoint2 %></li></ul></div></div><div class="cspricemodal-bottom-section"><div class="cspricemodal-price-section"><%= modal.priceOffers %></div><div class="cspricemodal-cta-section"><button class="cspricemodal-cta btn-primary-sm"><%= modal.ctaText %></button><a href="#" class="cspricemodal-signin-link"><%= modal.signInText %></a></div></div></div>')})}()),Eggshell.define("C.common.cspricemodal.responsive.alacarte",{inputs:["render"],outputs:[],strict:!1},function(){var e;return Backbone.View.extend({initialize:function(e){this.data=$.extend({type:"",alcItemId:""},e),this.model=new C.cspricemodal.alacarte.model({subsPriceData:this.data.subsPriceData}),this.Eggshell.on("render",this.render)},render:function(){$(this.data.elem).append(this.getAlacarteModalMarkup())},getAlacarteModalMarkup:function(){var e=this.model.getAlcContent(),t=this.getModalData(e),i=this.data.radioInputTemplate({checked:this.data.checked,option:"alacarte",label:this.model.getALaCartePrice(),term:t.term,priceId:this.model.getAlcPriceId(),catalogId:this.model.getAlcCatalogId(),additionalText:"",additionalRadioLabel:""}),s;return this.dividerTemplate({})+this.data.priceOfferTemplate({radioOptions:i,subText:t.subText,className:"alacarte"})},getModalData:function(e){var t={};return t.subText=C.resource.fetch("cspricemodal.responsive.alacarte.tbs.subtext",[e.chapter,e.problem]),t.term=C.resource.fetch("cspricemodal.responsive.alacarte.tbs.pricelabel"),t},dividerTemplate:_.template('<div class="divider"><div class="divider-top"></div><div class="divider-middle">or</div><div class="divider-bottom"></div></div>')})}()),C.resource.add("cspricemodal.responsive.general.headline","Access Textbook Solutions and Expert Q&A"),C.resource.add("cspricemodal.responsive.general.proofpoint1","Get step-by-step solutions to problems in your textbooks"),C.resource.add("cspricemodal.responsive.general.proofpoint2","Post your study questions to our Chegg experts"),C.resource.add("cspricemodal.responsive.general.pricedisclaimer","(No worries. Cancel online at anytime.)"),C.resource.add("cspricemodal.responsive.general.signintext","Already a member? Sign in"),C.resource.add("cspricemodal.responsive.general.ctatext","Continue"),C.resource.add("cspricemodal.responsive.general.freetrial.ctatext","Start free trial"),C.resource.add("cspricemodal.responsive.tbs.headline","View solutions for this book & thousands of others!"),C.resource.add("cspricemodal.responsive.tbs.proofpoint1",'<span class="highlight">Plus</span> browse millions of homework answers'),C.resource.add("cspricemodal.responsive.tbs.proofpoint2",'<span class="highlight">Plus</span> post your study questions to Chegg experts'),C.resource.add("cspricemodal.responsive.qna.headline","View this answer & millions of others"),C.resource.add("cspricemodal.responsive.qna.proofpoint1",'<span class="highlight">Plus</span> post your study questions to Chegg experts'),C.resource.add("cspricemodal.responsive.qna.proofpoint2",'<span class="highlight">Plus</span> get step-by-step solutions to problems in your textbooks'),C.resource.add("cspricemodal.responsive.alacarte.tbs.subtext","Chapter {0}, Problem {1}"),C.resource.add("cspricemodal.responsive.alacarte.tbs.pricelabel","this solution only"),C.resource.add("cspricemodal.responsive.general.mobile.pricedisclaimer","(cancel anytime)"),Eggshell.define("C.common.tutors",{inputs:["set opportunity modal data","show tutors","set_quick_chat_data","set entity id"],outputs:["error","ready"],singleton:!0},function(){var e=Backbone.Model.extend({getTutors:function(e){var t=void 0!==e.count?e.count:3,i=void 0!==e.noSubjectCheck?e.noSubjectCheck:0;void 0!==C.global.csrfToken&&null!==C.global.csrfToken?$.ajax({context:this,type:"GET",dataType:"JSON",url:"/_ajax/tutors",data:{token:C.global.csrfToken,subjectId:e.subjectId,subjectName:e.subjectName,campaign:e.campaign,limit:t,noSubjectCheck:i},success:function(e){$.isEmptyObject(e)?this.trigger("errored"):(this.set("response",e),this.trigger("loaded"))},error:function(){this.trigger("errored")}}):C.logger.doSessionLog({"ERR-TUT-WGT":"CSRF Token not set"})},getAccessCode:function(e,i){$.ajax({url:"/_ajax/hwh/grantaccess",type:"get",dataType:"json",data:{assetId:e.assetId,assetType:e.assetType,offer:e.offer,userAgent:e.userAgent,token:C.global.csrfToken},context:this,complete:function(e){var t=JSON.parse(e.responseText);t&&t.accessCode&&"string"==typeof t.accessCode?this.set("accessCode",t.accessCode):this.set("accessCode",null),this.trigger(i)}})}}),t;return Backbone.View.extend({tutorTemplate:_.template('<div class="tutor-container <%= variant %> clearfix"><div class="tutor-headline"></div><div class="tutor-content"></div><div class="tutors-footer"></div></div>'),initialize:function(){this.model=new e,this.setUpListeners()},setUpListeners:function(){this.model.on("loaded",this.render,this),this.model.on("errored",this.renderError,this),this.model.on("do_tbs_opportunity_flow",this.doTbsOpportunityFlow,this),Eggshell.find(this).on("set opportunity modal data",this.setOpportunityModalData).on("show tutors",this.showTutors).on("set entity id",this.setEntityId).on("set_quick_chat_data",this.setupQuickChat)},setEntityId:function(e,t){this.entityId=t},setupQuickChat:function(e,t){this.$quickChatContainerElem=t.elem,this.quickChatExperience=t.experience,this.quickChatOcUrl=t.quickChatOcPath,this.doQuickChat="quickchat"==t.experience,this.doQuickChat&&this.insertQuickChatComponent()},setOpportunityModalData:function(e,t){this.modalContext=t.modalContext,this.modalBody=t.modalBody},showTutors:function(e,t){this.model.getTutors(t),this.source=t.type,this.product=t.product,this.variant=t.variant?t.variant:"",this.subject=t.subjectName,this.subjectId=t.subjectId,this.userHasCsSubscription=t.userHasCsSubscription,this.entityId=t.entityId},render:function(){var e=this.model.get("response"),t=this.tutorTemplate;this.$el.empty(),this.$el.html(t({variant:this.variant})),this.renderTutors(e)},renderTutors:function(e){var t=e.tutors,i=e.url,s,o='<span class="subject">'+(e.exception||null===this.model.get("subjectId")?"Top":this.subject)+"</span> Chegg tutors who can help right now",n='<a href="'+i+'" data-noajax><button class="tutors-cta btn-flat-sm">Find me a tutor</button></a>',a=0,r=$(".tutor-content");switch(this.source){case"rightrail":for(this.$(".tutor-headline").html(o),this.$(".tutors-footer").html(n),this.$(".tutors-cta").addClass("rightrail-cta"),a=0;a<t.length;a++)this.displayQnaTutors(t[a],r,"qna");e.exception&&$(".online-indicator ").addClass("hidden"),this.modalContext?($(".tutors-cta").text("Find me a tutor"),this.listenToOpportunityClick()):this.setupDefaultListeners();break;case"tbs":for(this.$(".tutor-headline").html(o),this.$(".tutors-footer").html(n),this.$(".tutors-footer").addClass("tbs-footer"),$(".tutor-container").css({padding:"20px"}),t.length%2==0&&t.splice(t.length-1,1),a=0;a<t.length-1;a+=2)this.displayleftTutor(t[a],r),this.displayRightTutor(t[a+1],r);t.length%2!=0&&this.displayleftTutor(t[a],r),this.modalContext?($(".tutors-cta").text("Find me a tutor"),this.listenToOpportunityClick()):this.setupDefaultListeners();break;case"cshp":for(o="Find an online tutor who can help with your toughest classes. Connect instantly or schedule a convenient time to meet.",a=0;a<t.length-1;a+=2)this.displayleftTutor(t[a],r),this.displayRightTutor(t[a+1],r);$(".tutor-container").addClass("cshp-container"),$(".tutor-card").addClass("cshp-card"),$(".tutor-headline").html(o),$(".tutors-footer").html(n),$(".tutors-cta").html("Find a tutor"),this.setupDefaultListeners()}Eggshell.find(this).trigger("ready")},listenToOpportunityClick:function(){$(".tutor-row, .tutors-cta").on("click",$.proxy(function(e){if(e.preventDefault(),e.stopPropagation(),$(e.currentTarget).hasClass("tutor-row")){var t={tutor_clicked:1};this.tutorsRedirectUrl=$(e.currentTarget).find("a").attr("href")}else{var t={tutors_button_clicked:1};this.tutorsRedirectUrl=$(e.currentTarget).parent().attr("href")}var i="TBS"==this.product?this.doTbsOpportunityClickBehavior(e):this.doGenericOpportunityFlow(e);C.logger.doSessionLog(t,i,{logSubscription:1})},this))},doTbsOpportunityClickBehavior:function(e){if(e.preventDefault(),e.stopPropagation(),this.userHasCsSubscription){var t=this.getGrantAccessData();this.model.getAccessCode(t,"do_tbs_opportunity_flow")}else this.doTbsOpportunityFlow()},doTbsOpportunityFlow:function(){var e=this.model.get("accessCode");void 0!==e&&(this.modalBody+="?access_code="+e),this.setOpportunityModalCookie(),C.utility.navigate(this.tutorsRedirectUrl)},doGenericOpportunityFlow:function(e){if(this.doQuickChat){var t=$(e.currentTarget).find("a").data("id");this.openQuickChat(t)}else this.setOpportunityModalCookie(),C.utility.navigate(this.tutorsRedirectUrl)},setOpportunityModalCookie:function(){var e=this.model.get("response"),t=e&&e.instaEduSubjectId?e.instaEduSubjectId:this.subjectId,i=10/60/24,s=".chegg",o,n=s+window.location.host.split(s)[1],a="control"==this.quickChatExperience?this.modalContext+"_CONTROL":this.modalContext,r='{"formData":{"body":"'+this.modalBody+'","modalContext":"'+a+'","subject":"'+this.subject+'","subjectID":"'+t+'","priority":1,"isBlast":true,"timestamp": '+currentTime+"}}";C.utility.setCookie("messageData",r,i)},setupDefaultListeners:function(){$tutor=$(".tutor-content .C-common-tutors-tutor"),$tutorsCta=$(".tutors-cta"),$tutor.on("click",$.proxy(function(e){var t=$(e.currentTarget);e.preventDefault(),C.logger.doSessionLog({tutor_clicked:1},function(){location.href=t.find("a").attr("href")},{logSubscription:1})},this)),$tutorsCta.on("click",$.proxy(function(e){e.preventDefault(),C.logger.doSessionLog({tutors_button_clicked:1},function(){location.href=$tutorsCta.parent().attr("href")},{logSubscription:1})},this))},getGrantAccessData:function(){return{assetId:this.entityId,assetType:"TBS",offer:"TBS_SOLUTION_2H_ACCESS",userAgent:"WEB"}},insertQuickChatComponent:function(){this.$quickChatContainerElem.append('<oc-component href="'+this.quickChatOcUrl+'"></oc-component>'),oc.renderUnloadedComponents()},openQuickChat:function(e){var t=this.model.get("response"),i,s,o={subjectId:t&&t.instaEduSubjectId?t.instaEduSubjectId:this.subjectId,tutorId:e||null,asset:{type:"QNA"==this.product?"QnA":this.product,id:this.entityId}};window.startQuickChat(o)},displayQnaTutors:function(e,t,i){var s=$('<div class="tutor-row"></div>');Eggshell.create("C.common.tutors.tutor",{el:s}).trigger("get "+i+" tutor",e),t.append(s)},displayleftTutor:function(e,t){var i=$('<div class="tutor-card left-card tutor-row"></div>');Eggshell.create("C.common.tutors.tutor",{el:i}).trigger("get tbs tutor",e),t.append(i)},displayRightTutor:function(e,t){var i=$('<div class="tutor-card right-card tutor-row"></div>');Eggshell.create("C.common.tutors.tutor",{el:i}).trigger("get tbs tutor",e),t.append(i)},renderError:function(){Eggshell.find(this).trigger("error")}})}()),Eggshell.define("C.common.tutors.tutor",{inputs:["get qna tutor","get tbs tutor","get mystuff tutor"],outputs:[]},Backbone.View.extend({tutorTemplate:_.template('<a href="<%= uri %>" data-noajax data-id=<%= id %>><div class="online-indicator <%= hidden %>"><div class="circle-icn"></div><div class="check-icn"></div></div><img class="tutor-img" src="<%= picture %>" onError="this.onerror=null;this.src=\'<%= default_picture %>\'"><div class="tutor-info"><div class="name"><%= name %></div><div class="school"><%= school %></div></div><div class="tutor-likes"><div class="thumbs-icn"><div class="reviews"><%= reviews %></div></div></div></a>'),initialize:function(){this.setUpListeners()},setUpListeners:function(){Eggshell.find(this).on("get qna tutor",this.renderQnaTutor,this).on("get tbs tutor",this.renderTbsTutor,this).on("get mystuff tutor",this.renderMyStuffTutor,this)},renderQnaTutor:function(e,t){var i=t.last_name.charAt(0)+".",s=t.first_name+" "+i;this.$el.html(this.tutorTemplate({uri:t.uri,hidden:"",picture:t.image_thumb_small,default_picture:t.default_images.image_thumb_small,name:s,school:t.school,reviews:t.positive_reviews,id:t.id})),t.available_now?this.$(".circle-icn").hide():this.$(".check-icn").hide()},renderTbsTutor:function(e,t){var i=t.last_name.charAt(0)+".",s=t.first_name+" "+i;this.$el.html(this.tutorTemplate({uri:t.uri,hidden:"hidden",picture:t.image_thumb_medium,default_picture:t.default_images.image_thumb_medium,name:s,school:t.school,reviews:t.positive_reviews,id:t.id}))},renderMyStuffTutor:function(e,t){var i=t.last_name.charAt(0)+".",s=t.first_name+" "+i;this.$el.html(this.tutorTemplate({uri:t.uri,hidden:"",picture:t.image_thumb_small,default_picture:t.default_images.image_thumb_small,name:s,school:t.school,reviews:t.positive_reviews,id:t.id})),this.$(".tutor-info").append(this.$(".tutor-likes")),this.$(".check-icn").hide(),t.available_now||3===t.chat_availability||this.$(".circle-icn").hide()}})),Eggshell.define("C.common.adslist.join",{inputs:["set list","set data","render","displayed content"],outputs:["set ads container","set title","set items","render","run company","displayed"]},Backbone.View.extend({order:[],data:{},initialize:function(){this.wEl=Eggshell.create("C.common.adslist",{el:this.$el}),Eggshell.shell(this).on("render",this.render).on("set list",this.setOrder).on("set data",this.setData).on("destroy",this.destroy)},setOrder:function(e,t){if("object"!=typeof(t=t||{}))throw"Invalid order.";this.order=t},setData:function(e,t){if("object"!=typeof(t=t||{}))throw"Invalid order.";this.data=t},template:_.template('<div class="chg-display <%= className %>" data-unit="<%= dataUnit %>" data-size="<%= dataSize %>"<%= fullWidth %> <%= onLoad %> data-title="<%= dataTitle %>"></div>'),render:function(){_.each(this.order,function(e,t){this.loadDFPAds(this.data[e],e)},this),this.launchAdvertisement()},loadDFPAds:function(e,t){Eggshell.find(this.wEl).trigger("set ads container",t).trigger("set title",e.title).trigger("set items",this.getItems(e.items,e.title?1:0)).trigger("render").on("displayed content",this.displayedContent)},displayedContent:function(){Eggshell.find(this).trigger("displayed")},launchAdvertisement:function(){Eggshell.find(this.wEl).trigger("run company")},getItems:function(e,t){var i=this;return e.map(function(e){return i.template({dataUnit:e.dataUnit,dataSize:e.dataSize,dataTitle:t,className:null==e.className?"":e.className,fullWidth:void 0!==e.dataFullwidth?' data-fullwidth="'+e.dataFullwidth+'"':"",onLoad:void 0!==e.dataOnLoad?' data-onload="'+e.dataOnLoad+'"':""})}).join("")},destroy:function(){this.remove()}})),Eggshell.define("C.common.adslist",{inputs:["set ads container","set title","set items","render","run company"],outputs:["displayed content"]},Backbone.View.extend({initialize:function(e){var t=Backbone.Model.extend({});this.model=new t({title:"",items:"",container:""}),this.countBlock={start:0,finish:0},this.fullArray={},this.adsIds={},this.setTitleShowed(!1),this.setDisplayed(!1),this.Ads=Eggshell.create("C.common.advertisements").on("slot rendered",this.slotRendered,this),Eggshell.find(this).on("set ads container",this.setAdsContainer).on("set title",this.setTitle).on("set items",this.setItems).on("render",this.render).on("run company",this.launchAdvertisement).on("destroy",this.destroy),e.title&&Eggshell.find(this).trigger("set title",e.title),e.items&&Eggshell.find(this).trigger("set items",e.items),e.container&&Eggshell.find(this).trigger("set ads container",e.container)},setAdsContainer:function(e,t){if("string"!=typeof(t=t||""))throw"Invalid name container.";var i=$('<div class="'+t+' container-ads" />');this.$el.append(i),this.model.set("container",i)},setTitle:function(e,t){if("string"!=typeof(t=t||""))throw"Invalid title.";this.model.set("title",t)},setItems:function(e,t){if("string"!=typeof(t=t||""))throw"Invalid items content.";this.model.set("items",t)},launchAdvertisement:function(){Eggshell.find(this.Ads).trigger("render"),this.statAds()},template:_.template('<% if (title) { %><div class="adslist-title"><%- title %></div><% } %><div class="adslist-items"><%= items %></div>'),render:function(){this.model.get("container").html(this.template({title:this.model.get("title"),items:this.model.get("items")})).hide()},statAds:function(){var e={},t=this;this.$(".chg-display").each(function(){e[this.id]=!0,void 0!==t.fullArray[this.id]&&t.fullArray[this.id].element.is(t.model.get("container"))||(t.countBlock.start++,t.fullArray[this.id]={titleBlock:1==$(this).data("title"),displayed:!1,element:$(this).parents(".container-ads",this.$el)})}),this.adsIds=e},slotRendered:function(e,t){!0===this.adsIds[t.id]&&this.countBlock.finish++,t.nonempty&&this.adsIds[t.id]&&(!0===this.adsIds[t.id]&&(this.fullArray[t.id].displayed=!0,this.fullArray[t.id].element.show()),this.getDisplayed()||(this.setDisplayed(!0),Eggshell.find(this).trigger("displayed content"))),this.countBlock.finish==this.countBlock.start&&this.configTitle()},destroy:function(){Eggshell.find(this.Ads).off("slot rendered",this.slotRendered,this),this.remove()},configTitle:function(){for(element in this.fullArray)this.fullArray[element].titleBlock&&this.fullArray[element].displayed&&!this.getTitleShowed()&&(this.setTitleShowed(!0),this.fullArray[element].element.find(".adslist-title").show())},setTitleShowed:function(e){this.titleShowed=e},getTitleShowed:function(){return this.titleShowed},setDisplayed:function(e){this.displayed=e},getDisplayed:function(){return this.displayed}})),Eggshell.define("C.common.message",{inputs:["set type","set size","set header","set body","set call to action link","enable close button","scrollOnShow"],outputs:["call to action link clicked","close button clicked"]},C.View.extend({initialize:function(){this.model=new C.Model({type:"information",size:"lg",header:"",body:"",linkText:"",linkUrl:"",closeButton:!1,scrollOnShow:!1,dismissAnimation:"slideUp"}),this.model.on("change",this.render,this),Eggshell.find(this).on("set type",this.setType).on("set size",this.setSize).on("set header",this.setHeader).on("set body",this.setBody).on("set call to action link",this.setLink).on("enable close button",this.enableCloseButton).on("scrollOnShow",this.setScrollOnShow).on("set dismiss animation",this.setDismissAnimation).on("destroy dom on dismiss",this.destroyDomOnDismiss).on("auto dismiss duration",this.enableAutoDismiss).on("add css classes",this.addCssClasses)},setType:function(e,t){if("information"!=t&&"error"!=t&&"success"!=t&&"important"!=t&&"custom"!=t)throw"Invalid message type.";t="information"==t?"info":t,this.model.set("type",t)},setSize:function(e,t){if("large"!=t&&"small"!=t)throw"Invalid message size.";this.model.set("size","large"==t?"lg":"sm")},setHeader:function(e,t){if(!t||"string"!=typeof t)throw"Invalid message header.";this.model.set("header",t)},setBody:function(e,t){if(!t||"string"!=typeof t)throw"Invalid message body.";this.model.set("body",t)},setLink:function(e,t){if(!t||!t.text||"string"!=typeof t.text)throw"Invalid link text.";if(!t||!t.url||"string"!=typeof t.url)throw"Invalid link URL.";this.model.set("linkText",t.text),this.model.set("linkUrl",t.url)},enableCloseButton:function(e,t){if("boolean"!=typeof t)throw"Invalid close button flag.";this.model.set("closeButton",t)},setScrollOnShow:function(e,t){if("boolean"!=typeof t)throw"Invalid close button flag.";this.model.set("scrollOnShow",t),this.model.get("scrollOnShow")?Eggshell.find(this).on("show",function(){this.$el.show(),C.utility.isIE()?window.scroll(0,0):$("body").animate({scrollTop:"0px"},300)}):Eggshell.find(this).on("show",function(){this.$el.show()})},setDismissAnimation:function(e,t){if("string"!=typeof t)throw"payload is not string.";this.model.set("dismissAnimation",t)},destroyDomOnDismiss:function(){Eggshell.find(this).on("element disappeared",function(){this.$el.remove()}.bind(this))},enableAutoDismiss:function(e,t){var i=this;if("number"!=typeof t)throw"payload is not a number";void 0===t&&(t=5e3),window.setTimeout(function(){i.setUpAnimationOnDismiss()},t)},addCssClasses:function(e,t){if("string"!=typeof t)throw"Payload needs to be string";this.$el.addClass(t)},render:function(){var e=this.model.get("body")||this.model.get("linkUrl")?"":"msg-header-only";return this.$el.empty().html(this.template($.extend(this.model.toJSON(),{headerClass:e}))),this.model.get("linkUrl")||this.$("a.message-call-to-action").remove(),this.model.get("header")&&"sm"!=this.model.get("size")||this.$(".msg-header").remove(),this.model.get("closeButton")||this.$(".msg-close").remove(),this},template:_.template('<div class="msg-<%- type %>-<%- size %>">\t<div class="msg-icon">\t\t<div class="msg-header <%- headerClass %>"><%= header %></div>\t\t<div class="msg-text"><%= body %>\t\t\t<a class="message-call-to-action" href="<%- linkUrl %>"><%= linkText %></a> \t\t\t<span class="msg-close"></span>\t\t</div>\t</div></div>'),events:{"click a.message-call-to-action":"handleLinkOnClicked","click .msg-close":"closeMessage"},handleLinkOnClicked:function(e){Eggshell.find(this).trigger("call to action link clicked")},closeMessage:function(e){this.setUpAnimationOnDismiss(),Eggshell.find(this).trigger("close button clicked")},setUpAnimationOnDismiss:function(){var e=this,t;switch(this.model.get("dismissAnimation")){case"slideUp":this.$el.slideUp("fast",function(){Eggshell.find(e).trigger("element disappeared")});break;case"fadeOut":e.$el.addClass("msg-fade-out").on("transitionend",function(){Eggshell.find(e).trigger("element disappeared")})}}})),C.resource.add("C.common.question.form.title","Post new question"),C.resource.add("C.common.question.form.subtitle","Expert answers in as little as 30 minutes"),C.resource.add("C.common.question.form.label","Continue to edit and attach image(s)."),C.resource.add("C.common.question.form.label.questioncount","{0} questions remaining"),C.resource.add("C.common.question.form.button","Continue to post"),Eggshell.define("C.common.question.form",{inputs:["render","set question body","set placeholder text","set form title","set form subtitle","set form button","set source","show remaining questions"],outputs:{rendered:{payload:null}}},function(){var t=C.Model.extend({getRemainingQuestions:function(t){$.ajax({url:"/_ajax/cs/usage",type:"get",dataType:"json",data:{token:C.global.csrfToken,whitelist:{remainingQuestions:{options:null}}},context:this,success:function(e){this.set("userData",e),void 0!==t&&this.trigger(t)},error:function(e){console.log("Error retrieving post question form data")}})}}),e;return C.View.extend({tmpl:_.template('<div class="post-question-form-wrapper"><div class="title" id="question-title-label"><%- label.title %></div><div class="subtitle"><%- label.subtitle %></div><form action="<%- url %>study/qa/post" method="post" name="questionform"><textarea placeholder="<%- placeholderText %>" name="questionBody" aria-labelledby="question-title-label"><%- questionBody %></textarea><button class="btn btn-flat-sm"><%- label.button %></button><div class="label"><%- label.label %></div></form></div>'),events:{"click button":"formSubmit"},initialize:function(e){this.model=new t,this.model.on("render_module",this.render,this),this.opts=e,this.questionBody="",this.formTitle=C.resource.fetch("C.common.question.form.title"),this.formSubtitle=C.resource.fetch("C.common.question.form.subtitle"),this.formLabel=C.resource.fetch("C.common.question.form.label"),this.buttonText=C.resource.fetch("C.common.question.form.button"),this.placeholderText="",this.showRemainingQuestions=!1,this.source="questionform",Eggshell.find(this).on("set source",this.setSource,this).on("set question body",this.setQuestionBody,this).on("set form title",this.setFormTitle,this).on("set form subtitle",this.setFormSubtitle,this).on("set form label",this.setFormLabel,this).on("set button text",this.setButtonText,this).on("set placeholder text",this.setPlaceholderText,this).on("show remaining questions",this.setShowRemainingQuestions,this).on("render",this.load,this)},load:function(){this.showRemainingQuestions?this.model.getRemainingQuestions("render_module"):this.render()},render:function(){var e=this.model.get("userData"),t=e&&e.remainingQuestions&&null!=e.remainingQuestions?C.resource.fetch("C.common.question.form.label.questioncount",[e.remainingQuestions]):this.formLabel;this.$el.html(this.tmpl({url:C.global.cheggSiteSecureUrl,questionBody:this.questionBody,placeholderText:this.placeholderText,label:{title:this.formTitle,subtitle:this.formSubtitle,label:t,button:this.buttonText}})),Eggshell.find(this).trigger("rendered")},setSource:function(e,t){this.source=t},setQuestionBody:function(e,t){if(!t||"string"!=typeof t)throw"Invalid question body. Type needs to be a string value.";this.questionBody=t},setFormTitle:function(e,t){if(!t||"string"!=typeof t)throw"Invalid form title. Type needs to be a string value.";this.formTitle=t},setFormSubtitle:function(e,t){if(!t||"string"!=typeof t)throw"Invalid form subtitle. Type needs to be a string value.";this.formSubtitle=t},setFormLabel:function(e,t){if(!t||"string"!=typeof t)throw"Invalid form label. Type needs to be a string value.";this.formLabel=t},setButtonText:function(e,t){if(!t||"string"!=typeof t)throw"Invalid button text. Type needs to be a string value.";this.buttonText=t},setPlaceholderText:function(e,t){if(!t||"string"!=typeof t)throw"Invalid placeholder text. Type needs to be a string value.";this.placeholderText=t},setShowRemainingQuestions:function(e,t){this.showRemainingQuestions=t},formSubmit:function(e){e.preventDefault(),C.logger.doSessionLog({post_button_click:this.source},$.proxy(function(){this.$el.find('form[name="questionform"]').submit()},this),{logSubscription:1})}})}()),Eggshell.define("C.common.tbspopup",{inputs:["show tbs popup","show tbs popup in sidebar","go to solution"],outputs:[],singleton:!0},C.View.extend({initialize:function(e){this.data=$.extend({},e),this.setTBSContent(),this.setUpListeners()},setTBSContent:function(){this.tbsDialog=Eggshell.create("C.Eggshell.dialog");var e='<fieldset class="chg-util-autosuggest-form"><input type="text" class="chg-form-sm has-default" placeholder="Enter ISBN, Title or Author\'s Name" name="search_by" autocomplete="off" autofocus></fieldset>';this.tbsDialog.trigger("hide sub headline").trigger("hide icon").trigger("set content html",e)},setUpListeners:function(){this.Eggshell.on("show tbs popup",this.showTBSPopup),this.Eggshell.on("show tbs popup in sidebar",this.showSidebarTbs)},showTBSPopup:function(e,t){this.doAutoComplete(),this.tbsDialog.trigger("set headline","Find your textbook to view solutions").trigger("show"),$(".C-common-tbspopup").next().find(".dialog").css({overflow:"visible"})},showSidebarTbs:function(e,t){this.doAutoComplete(),this.tbsDialog.trigger("set headline","View textbook solutions").trigger("show"),this.displayBookList(),this.tbsDialog.on("hidden",this.emptyBookList)},displayBookList:function(){$(".chg-util-autosuggest-form").append('<div class="book-list-container"><div class="book-list"></div></div>'),this.EggLoading=Eggshell.create("C.Eggshell.loading.inline",{el:$(".book-list")});var e=this,t=Eggshell.create("C.Eggshell.studysolution.book",{el:$(".book-list")}).listen("ready",function(){e.EggLoading.trigger("hide"),$(".book-list li").length&&$(".book-list-container").prepend('<div class="book-list-header">RECENTLY VIEWED</div>')}).trigger("render");this.hideBookList()},hideBookList:function(){$(".chg-form-sm").on("keypress",function(){var e=$(".book-list-container");e.hasClass("hidden")||e.hide()})},emptyBookList:function(){$(".book-list-header").remove(),$(".book-list-container").remove()},doAutoComplete:function(){var e=window.cev||new Events;window.cev=window.cev||e,window.cev.addEvent("searchLoad:once",$.proxy(function(e){void 0===this.autoCompleteWidget&&(this.autoCompleteWidget=Eggshell.create("C.common.search",{el:$(".chg-util-autosuggest-form")}));var t=".chg-util-autosuggest-form input";this.autoCompleteWidget.trigger("render",{ajaxEndpoint:"/_ajax/search/tbsserp",target:$(t),filters:{type:"group",count:4,destination:"tbs"}}).trigger("show a single segway","single-tbs").trigger("show no categories").trigger("show no bottom content").trigger("set width to size of input field"),$(t).attr("placeholder","Enter book title or ISBN to view step-by-step solutions for your book..")},this))}})),C.resource.add("mytbs.title","My Textbook Solutions"),C.resource.add("mytbs.subtitle","Instant access to step-by-step solutions for your textbooks"),Eggshell.define("C.common.mytbs",{inputs:["render","set_source"],outputs:["mytbs_ready"]},function(){var e=Backbone.Model.extend({getTbsUsage:function(t){$.ajax({url:"/_ajax/cs/usage",type:"get",dataType:"json",data:{token:C.global.csrfToken,whitelist:{combinedTbs:{options:{count:3,includeBookmarkCount:!0}}}},context:this,success:function(e){this.set("usageData",e),void 0!==t&&this.trigger(t)},error:function(e){console.log("Error retrieving tbs usage data")}})}}),t;return Backbone.View.extend({initialize:function(){this.model=new e,this.model.on("tbs_usage_data_set",this.processUsageData,this),this.source="mytbs",Eggshell.find(this).on("set_source",this.setSource,this).on("render",this.load,this).on("usage_data_ready",this.render,this)},setSource:function(e,t){this.source=t},load:function(){this.model.getTbsUsage("tbs_usage_data_set")},processUsageData:function(){var e=this.model.get("usageData"),t=e&&e.combinedTbs?e.combinedTbs:null;this.userTbs=t,this.userHasViewedTbs=null!=t&&0<t.length,Eggshell.find(this).trigger("usage_data_ready")},render:function(){this.$el.html(this.myTbsTemplate({header:C.resource.fetch("mytbs.title"),subheader:this.userHasViewedTbs?" ":C.resource.fetch("mytbs.subtitle")})),this.renderTbsSection(),this.setupActionListeners(),Eggshell.find(this).trigger("mytbs_ready")},renderTbsSection:function(){var e=3,t=0,i=$(".mytbs");if(this.userHasViewedTbs&&this.userTbs&&this.userTbs.length){for(;t<this.userTbs.length&&t<3;t++){var s=this.userTbs[t];i.find(".mytbs-content").append(this.myTbsBook({tbs:{url:s.url,edition:"book_tbs"===s.type?C.utility.ordinal(parseInt(s.editionNo)):s.editionNo,title:s.shortTitle?s.shortTitle:s.title,bookmarkCount:s.bookmarkCount?s.bookmarkCount:""}}));var o=Eggshell.create("C.cs.tbscover",{el:i.find(".book-cover").last()});s.coverImage?o.trigger("set book image",s.coverImage):o.trigger("set book title",s.shortTitle?s.shortTitle:s.title),o.trigger("set cover size","small").trigger("render")}for(var n=i.find(".mytbs-book .short-title"),a=0;a<n.length;a++){var r=$(n[a]);1<r.text().split(" ").length?r.dotdotdot():r.addClass("truncated")}this.userTbs.length&&i.append('<a href="/study/tbs" class="mytbs-viewall">View all solutions</a>')}for(C.logger.doSessionLog({onboarding_user_tbs_shown:t});t<3;t++)i.find(".mytbs-content").append(this.myTbsPlaceholderBook({}))},setupActionListeners:function(){this.$el.find(".mytbs-book").on("click",$.proxy(function(e){e.preventDefault(),e.stopPropagation();var t=$(e.currentTarget),i={onboarding_user_tbs_clicked:1};"tbs_page"===this.source&&(i={tbs_rr_click:"tbs"}),C.logger.doSessionLog(i,function(){C.utility.navigate(t.attr("href"))},{logSubscription:1})},this)),this.$el.find(".mytbs-placeholderbook").on("click",$.proxy(function(e){var t={onboarding_placeholder_tbs_clicked:1};"tbs_page"===this.source&&(t={tbs_rr_click:"placeholder"}),C.logger.doSessionLog(t,null,{logSubscription:1}),void 0===this.findTbsPopup&&(this.findTbsPopup=Eggshell.create("C.common.tbspopup")),this.findTbsPopup.trigger("show tbs popup")},this)),this.$el.find(".mytbs-viewall").on("click",function(e){e.preventDefault(),C.logger.doSessionLog({onboarding_view_all_tbs:1},function(){C.utility.navigate("/study/tbs")})})},myTbsTemplate:_.template('<div class="mytbs"><div class="mytbs-header"><%- header %></div><div class="mytbs-subheader"><%- subheader %></div><div class="mytbs-content"></div></div>'),myTbsBook:_.template('<a href="<%= tbs.url %>" class="mytbs-book"><div class="book-cover"></div><div class="result-header short-title"><%= tbs.title %></div><div class="result-detail result-edition"><%= tbs.edition %> Edition</div><% if (tbs.bookmarkCount) { %><div class="bookmark-details"><span class="bookmark-icn"></span> <span class="count">(<%= tbs.bookmarkCount %>)</span></div><% } %></a>'),myTbsPlaceholderBook:_.template('<div class="mytbs-placeholderbook"><div class="placeholderbook-content"><div class="plus-icon"></div>Add a textbook</div></div>')})}()),Eggshell.define("C.common.onboardingoverlay",{inputs:{render:{payload:null},set_instruction_points:{payload:"object"},render_header_overlay:{payload:null},show_close_control:{payload:null},dismiss_on_click:{payload:null},set_on_click_callback:{payload:null},hide_overlay:{payload:null}},outputs:[]},function(){var e;return Backbone.View.extend({initialize:function(){this.instructionPoints=[],this.showCloseControl=!1,this.dismissOnClick=!1,this.onClickCallback=null,this.$headerHandle=C.dom&&C.dom.$header?$(C.dom.$header):$(".chgg-hdr"),this.origHeaderBorder=this.$headerHandle?this.$headerHandle.css("border-bottom"):"",Eggshell.find(this).on("render",this.render,this).on("show_overlay_close",this.setShowCloseControl,this).on("hide_overlay",this.hideOverlay,this).on("dismiss_on_click",this.setDismissOnClick,this).on("set_on_click_callback",this.setOnClickCallback,this).on("render_header_overlay",this.setRenderHeaderOverlay,this).on("set_instruction_points",this.setInstructionPoints,this)},render:function(){this.$el.prepend(this.overlayTemplate({showCloseControl:this.showCloseControl})),this.renderHeaderOverlay&&(this.$headerHandle.prepend(this.headerOverlayTemplate({})),this.$headerHandle.css({"border-bottom":"none"})),this.showCloseControl&&this.$el.find(".onboardingoverlay-close").css({top:this.$el.parent().position().top+50});for(var e=0;e<this.instructionPoints.length;e++){this.instructionPoints[e].id=e;var t=this.instructionPoints[e],i=t.content?t.content:this.imageTemplate({img:t.img});$(t.handle).append(this.instructionPointTemplate({id:t.id,top:t.top_padding,left:t.left_padding,content:i}))}C.logger.doSessionLog({onboarding_overlay_opened:1}),this.setActionListeners()},setInstructionPoints:function(e,t){if(!t||"object"!=typeof t)throw"Invalid instruction point. Type needs to be an object value.";$.extend(this.instructionPoints,t)},setShowCloseControl:function(e,t){this.showCloseControl=!0},setDismissOnClick:function(e,t){this.dismissOnClick=!0},setRenderHeaderOverlay:function(e,t){this.renderHeaderOverlay=!0},setOnClickCallback:function(e,t){this.onClickCallback=t},setActionListeners:function(){this.showCloseControl&&$(".onboardingoverlay-close").on("click",$.proxy(function(e){Eggshell.find(this).trigger("hide_overlay")},this)),this.dismissOnClick&&$(".onboardingoverlay-screenblocker, .onboardingoverlay-header-screenblocker").on("click",$.proxy(function(e){Eggshell.find(this).trigger("hide_overlay"),this.onClickCallback&&this.onClickCallback()},this))},hideOverlay:function(){C.logger.doSessionLog({onboarding_overlay_closed:1}),$(".onboardingoverlay-header-screenblocker, .onboardingoverlay-screenblocker").remove(),$(".onboardingoverlay-instruction-point").remove(),this.$headerHandle.css({"border-bottom":this.origHeaderBorder}),Eggshell.find(this).trigger("destroy")},headerOverlayTemplate:_.template('<div class="onboardingoverlay-header-screenblocker"></div>'),overlayTemplate:_.template('<% if(showCloseControl){ %><div class="onboardingoverlay-close"></div><% } %><div class="onboardingoverlay-screenblocker"></div>'),instructionPointTemplate:_.template('<div class="onboardingoverlay-instruction-point point-<%- id %>" style="top:<%- top %>px; left:<%- left %>px;"><%= content %></div>'),imageTemplate:_.template('<img src="http://c.cheggcdn.com/_public-assets/<%- img %>"/>')})}()),Eggshell.define("C.cs.tbscover",{inputs:["render","set book title","set book image","set cover size"],outputs:[],strict:!1},function(){var e;return Backbone.View.extend({initialize:function(e){this.opts=$.extend(e,{}),this.Eggshell.on("render",this.render,this).on("set book title",this.setBookTitle,this).on("set book image",this.setBookImage,this).on("set cover size",this.setCoverSize,this)},render:function(){this.$el.append(this.bookCoverTemplate({size:this.coverSize,bookCoverImg:this.bookCoverImg,bookCoverTxt:this.bookCoverTxt})),this.$el.find(".tbs-book-cover-title").dotdotdot().addClass("padding")},setBookTitle:function(e,t){this.bookCoverTxt=t},setCoverSize:function(e,t){this.coverSize=t},setBookImage:function(e,t){this.bookCoverImg=t},bookCoverTemplate:_.template('<div class="tbs-book-cover-wrapper"><div class="tbs-book-cover-bg <%= size ? size : "small" %>"><% if (bookCoverImg) { %><img class="tbs-book-cover-img" src="<%= bookCoverImg %>" onerror="this.src=\'//cs.cheggcdn.com/covers2/imagenalarge.gif\'"><% } else { %><div class="tbs-book-cover-text-wrapper"><% if (size === "large" || size === "medium") {%><div class="soln-title">Solutions</div><div class="split"></div><% } %><div class="tbs-book-cover-title"><%= bookCoverTxt %></div></div><% } %></div></div>')})}()),C.resource.add("csresubscribemodal.billingdetails",'Your ${0} (+ tax if applicable) Chegg Study subscription begins today, renews {1} and includes: 1) access to up to five textbook solution titles per month 2) the ability to post twenty questions per month and 3) unlimited viewing of the q&a archive. Cancel your subscription at any time by visiting <a href="https://www.chegg.com/my/account">My Account</a>. Chegg will deduct any available scholarship balance before charging your payment method on file.'),C.resource.add("csresubscribemodal.headline.generic","Welcome back{0}. We've missed you!"),C.resource.add("csresubscribemodal.headline.qna","Welcome back{0}. We've missed you!"),C.resource.add("csresubscribemodal.headline.tbs","Welcome back{0}. We've missed you!"),C.resource.add("csresubscribemodal.headline.tb_attach","Welcome back to Chegg"),C.resource.add("csresubscribemodal.subheadline.generic","Unlock solutions and post questions by resubscribing to Chegg Study."),C.resource.add("csresubscribemodal.subheadline.qna","Unlock this answer by resubscribing to Chegg Study."),C.resource.add("csresubscribemodal.subheadline.tbs","Unlock solutions by resubscribing to Chegg Study."),C.resource.add("csresubscribemodal.subheadline.tb_attach","Unlock this answer by subscribing to Chegg Study"),C.resource.add("csresubscribemodal.headline.mobile.qna","Welcome back! Resubscribe<br/>to unlock this answer"),C.resource.add("csresubscribemodal.headline.mobile.generic","Welcome back! Resubscribe<br/>to access Chegg Study"),C.resource.add("csresubscribemodal.headline.mobile.tbs","Welcome back! Resubscribe<br/>to unlock this solution"),Eggshell.define("C.common.csresubscribemodal",{inputs:["set_theme","update_text_on_cta_click","disable_loading_icon","set_payment_data","render_as_dialog","show_dialog","hide_dialog","set_is_mobile","prevent_close"],outputs:["rendered","order_processing","order_success","error_placing_order","error_with_payment_method"]},function(){var e=Backbone.Model.extend({initialize:function(e){this.data=e,this.orderAttempted=!1,this.getPriceCellData()},checkForHardLogin:function(t){$.ajax({context:this,url:"/my/_ajax/my/accountv2/checklogin",dataType:"json",type:"get",data:{token:C.global.csrfToken},success:function(e){this.set("hardLoggedIn",!e.refresh),this.trigger(t)},error:function(e){this.triggerGenericError()}})},getPriceCellData:function(){$.ajax({url:"/study/_ajax/hwh/subscription/",type:"get",data:{token:C.global.csrfToken},context:this,success:function(e){this.set("priceOptions",e.subsPriceData)},error:function(e){this.triggerGenericError()}}).done(function(e){this.trigger("priceOptionsCaptured")})},getSubscriptionPriceData:function(){var e=this.get("priceOptions");"undefined"!==e.monthly?this.set("subscriptionPriceData",$.extend(e.monthly,{termString:"monthly"})):"undefined"!==e.yearly&&this.set("subscriptionPriceData",$.extend(e.yearly,{termString:"annually"})),this.trigger("subPriceDataCaptured")},createOrder:function(e,t){$.ajax({url:"/checkout/_ajax/cart/add/",type:"get",data:e,dataType:"json",context:this,success:function(e){this.trigger(t)},error:function(e){this.triggerGenericError()}})},placeOrder:function(e){this.orderAttempted||(this.orderAttempted=!0,$.ajax({url:"/checkout/_ajax/chkout/hwhcheckout/?checkoutFlowType=SINGLE_ITEM_PURCHASE",type:"post",data:e,dataType:"json",context:this,error:function(e){this.triggerGenericError()}}).done($.proxy(function(e){this.handleOrderResponse(e)},this)))},handleOrderResponse:function(e){e&&e.result?(this.set("successData",e),this.trigger("orderSuccess")):e.errors&&""!=e.errors&&e.errorType&&"transaction_error"==e.errorType?this.trigger("errorWithPaymentMethod"):this.triggerGenericError()},triggerGenericError:function(){this.trigger("errorPlacingOrder")}}),t;return Backbone.View.extend({initialize:function(){this.model=new e,this.model.on("priceOptionsCaptured",this.getSubscriptionPriceData,this),this.model.on("subPriceDataCaptured",this.render,this),this.model.on("createOrder",this.createOrder,this),this.model.on("placeOrder",this.placeOrder,this),this.model.on("orderSuccess",this.triggerOrderSuccess,this),this.model.on("errorPlacingOrder",this.triggerOrderError,this),this.model.on("errorWithPaymentMethod",this.triggerPaymentError,this),this.theme="generic",this.tbAttach=!1,this.isMobile=!1,this.renderAsDialog=!1,this.updateDisabledCtaText=!1,this.disableLoadingIcon=!1,this.billingDetails="",this.preventClose=!1,Eggshell.find(this).on("set_theme",this.setTheme,this).on("set_payment_data",this.setPaymentData,this).on("update_text_on_cta_click",this.setUpdateDisabledCtaText,this).on("disable_loading_icon",this.setDisableLoadingIcon,this).on("render_as_dialog",this.setRenderAsDialog,this).on("show_dialog",this.showDialog,this).on("hide_dialog",this.hideDialog,this).on("set_is_mobile",this.setIsMobile,this).on("prevent_close",this.setPreventClose,this)},setTheme:function(e,t){this.theme=t,this.tbAttach="tb_attach"===this.theme},setIsMobile:function(e,t){this.isMobile=t},setRenderAsDialog:function(e,t){this.renderAsDialog=t},setDisableLoadingIcon:function(e,t){this.disableLoadingIcon=t},setUpdateDisabledCtaText:function(e,t){this.updateDisabledCtaText=t},showDialog:function(){this.tbAttach?C.logger.doSessionLog({tbcsattach_1click_shown:1}):C.logger.doSessionLog({resubscribe_modal_shown:1}),this.dialog?this.dialog.trigger("show"):this.render()},hideDialog:function(){this.enableCta(),this.dialog.trigger("hide")},setPreventClose:function(){this.preventClose=!0},onSecurityCodeKeyup:function(e){if(9==e.which)return!0;var t=this.cleanFieldNonNumerics(e);if(this.model.get("doExperimentA806"))return this.validateExpireFields(),t;var i=this.renderAsDialog?this.$controlElem.find(".resubscribe-cta"):$(".resubscribe-cta");return 3<=t.length?i.attr("disabled",!1):i.attr("disabled",!0),t},cleanFieldNonNumerics:function(e){var t=$(e.currentTarget),i=t.val(),s=i.replace(/[^\d]+/g,"");return s!=i&&t.val(s),s},render:function(){var e=C.global.study1ClickCvvExp;this.model.set("doExperimentA806",e),C.logger.doSessionLog({csresubscribe_render:Eggshell.find(this).getId()});var t=this.model.get("latestPaymentData"),i=t&&t.last_4?"•••• "+t.last_4:"",s=t&&t.cc_type?t.cc_type.toUpperCase():"",o=t&&t.cc_type?"payment-card":t&&t.paypal?"payment-paypal":"",n=t&&t.paypalEmail?t.paypalEmail:"",a="payment-card"==o?s+" "+i:n,r=0;e&&t&&t.cc_type&&(r="AMEX"===t.cc_type?4:3);var l=new Date,c=l.getFullYear(),d=l.getMonth()+1,h=t.ccExpYear<c||t.ccExpYear===c&&t.ccExpMonth<d;this.model.set("isCardExpired",h),"payment-card"==o&&h&&(a+=" exp. "+t.ccExpMonth+"/"+t.ccExpYear);var g,u,p={};p["cs1click_"+(e?h?"expiredccrequest":"validcc":"control")+"_shown"]=1,C.logger.doSessionLog(p),C.logger.doSessionLog({resubscribe_modal:1});var m=this.model.get("subscriptionPriceData"),f=m&&m.price?m.price:"",b=m&&m.termString?m.termString:"",v=m&&m.catalogId?m.catalogId:null,y=m&&m.priceId?m.priceId:null,w=m&&m.catalogItemSource?m.catalogItemSource:"COPS",k,x="/checkoutinterstitial/hwh/?cs_ft="+(this.tbAttach?1:0)+"&redirect=hwh&command="+v+","+y+",1,"+w;this.model.set("cartUrl",x);var E=C.global.userFirstName?", "+C.global.userFirstName:"",T=e&&h?"Update Payment Info":this.tbAttach?"Subscribe":"Resubscribe",_=this.isMobile?this.mobileControlTemplate:this.controlTemplate,S=this.isMobile?this.mobileContentTemplate:this.contentTemplate,I=_({price:f,ctaText:T,billingDetails:C.resource.fetch("csresubscribemodal.billingdetails",[f,b])});this.billingDetails=C.resource.fetch("csresubscribemodal.billingdetails",[f,b]);var D=this.tbAttach?this.valuePropsTemplate({contentClass:this.theme}):"",P=S({contentClass:this.theme,paymentDescription:a,paymentClass:o,cvvMaxLength:r,cartUrl:x,valuePropsHtml:D,isCardExpired:h,doExperimentA806:e});if(this.renderAsDialog)this.dialog&&void 0!==this.dialog||(this.dialog=Eggshell.create("C.common.dialog"),this.dialog.trigger("set headline",C.resource.fetch("csresubscribemodal.headline."+this.theme,[E])).trigger("set sub headline",C.resource.fetch("csresubscribemodal.subheadline."+this.theme)).trigger("hide icon").trigger("hide secondary button").trigger("hide primary button").trigger("set id","csresubscribemodal").trigger("add class",this.theme).trigger("set content html",P).on("control area",$.proxy(function(e,t){t.html(I),this.$controlElem=t},this)).on("rendered",$.proxy(function(e){this.triggerRendered()},this)).trigger("get control area"),this.preventClose&&this.dialog.trigger("hide close button").trigger("disable screen blocker click")),this.showDialog(),e?(this.model.get("isCardExpired")&&($("#cardExpiredHint").removeClass("hidden"),$("#oopsMsgBanner").removeClass("hidden"),$(".resubscribe-cta").attr("disabled",!1)),this.cardExpForm=Eggshell.create("C.common.form",{el:$(".payment-section")}),this.cardExpForm.trigger("build form")):$(".resubscribe-cta").attr("disabled",!1);else{var A=this.isMobile?C.resource.fetch("csresubscribemodal.headline.mobile."+this.theme):C.resource.fetch("csresubscribemodal.headline."+this.theme,[E]),N=this.isMobile?"":C.resource.fetch("csresubscribemodal.subheadline."+this.theme);this.$el.append(this.modalTemplate({modalClass:this.isMobile?"mobile-resubscribe":"",dialogClass:this.isMobile?"":"dialog",headline:A,subheadline:N,content:P,control:I})),this.triggerRendered(),this.enableCta()}this.setupListeners()},triggerRendered:function(){Eggshell.find(this).trigger("rendered")},setPaymentData:function(e,t){this.model.set("latestPaymentData",t)},getSubscriptionPriceData:function(){this.model.getSubscriptionPriceData()},setupListeners:function(){C.logger.doSessionLog({csresubscribe_setuplisteners:Eggshell.find(this).getId()}),$(document).on("keyup",".card-code-input",$.proxy(this.onSecurityCodeKeyup,this)),$(document).on("click",".resubscribe-cta, .resubscribe-billing-dialog .btn-primary-lg",$.proxy(function(e){e.preventDefault(),e.stopPropagation();var t=this.model.get("doExperimentA806"),i=this.model.get("isCardExpired"),s,o,n={};if(n["cs1click_"+(t?i?"expiredccrequest":"validcc":"control")+"_subscribe_clicked"]=1,C.logger.doSessionLog(n),t&&i)this.getUpdatedCardInfo();else{if(this.disableCta(),this.tbAttach)C.logger.doSessionLog({tbcsattach_1click_click:1});else{var a=this.isMobile?"mobile_resubscribe_modal_click":"resubscribe_modal_click",r=JSON.parse('{ "'+a+'":1 }');C.logger.doSessionLog(r)}C.utility.getLocal("resubscribe_order_started")||(C.utility.setLocal("resubscribe_order_started",!0),this.model.checkForHardLogin("createOrder"))}},this)),$(".billing-details-link").on("click",$.proxy(function(){var e=$(this.mobileBillingDetails({billingDetails:this.billingDetails}));Eggshell.create("Mobile.Dialog",{element:e}).trigger("show")},this)),$(document).on("click",".resubscribe-billing-dialog .close-button",function(){$(".resubscribe-billing-dialog").remove()}),$(document).on("click",".payment-method-edit-link a",$.proxy(function(){var e=this.model.get("doExperimentA806"),t=this.model.get("isCardExpired"),i,s,o={};o["cs1click_"+(e?t?"expiredccrequest":"validcc":"control")+"_changepayment_clicked"]=1,C.logger.doSessionLog(o)},this))},getUpdatedCardInfo:function(){C.logger.doSessionLog({cs1click_expiredccrequest_paymentupdate_clicked:1});var e=this.model.get("cartUrl");C.utility.navigate(e)},validateExpireFields:function(){var e,t,i=$("#checkout-modal-security-code").first().val().length==$("#checkout-modal-security-code").first().attr("maxlength");i?this.cardExpForm.trigger("hide error","cardCode"):this.cardExpForm.trigger("show error",{name:"cardCode"}),$(".resubscribe-cta").attr("disabled",!i)},createOrder:function(){var e=this.model.get("subscriptionPriceData"),t=this.model.get("hardLoggedIn"),i={command:e.catalogId+","+e.priceId+",1,"+e.catalogItemSource||"COPS",redirect:"hwh",token:C.global.csrfToken};if(t)Eggshell.find(this).trigger("order_processing"),this.model.createOrder(i,"placeOrder");else{var e,s,o,n="/auth?type=simplifiedstudy&action=signin&data="+((e=this.model.get("subscriptionPriceData"))&&e.initialPrice?e.initialPrice:"")+"&redirect="+escape(this.model.get("cartUrl"));C.utility.navigate(n)}},disableCta:function(){var e=this.renderAsDialog?this.$controlElem.find(".resubscribe-cta"):$(".resubscribe-cta");if(e.attr("disabled",!0),e.text("Subscribe"),this.updateDisabledCtaText){var t=this.tbAttach?"Subscribing...":"Resubscribing...";e.text(t),this.isMobile&&e.val(t),this.disableLoadingIcon||(this.loadingIcon=Eggshell.create("C.Eggshell.loading.inline",{el:e}).trigger("render").trigger("show"))}},enableCta:function(){if(this.renderAsDialog){var e=this.$controlElem.find(".resubscribe-cta");e.attr("disabled",!1),e.text("Resubscribe")}else this.$el.find(".resubscribe-cta").attr("disabled",!1);this.loadingIcon&&Eggshell.find(this.loadingIcon).trigger("destroy")},placeOrder:function(){var e=this.model.get("latestPaymentData"),t=e&&e.paymentAccount?e.paymentAccount:[],i=$("#checkout-modal-security-code").val(),s={updateCart:1,itemsBought:"subscription",card_id:t&&e.id?e.id:null,cardType:t&&t.cc_type?t.cc_type:null,cardCode:i,tbAttach:this.tbAttach?1:0,token:C.global.csrfToken};this.model.placeOrder(s)},triggerOrderSuccess:function(){var e,t,i,s={};s["cs1click_"+(this.model.get("doExperimentA806")?"validcc":"control")+"_order_success"]=1,C.logger.doSessionLog(s);var o=this.model.get("successData");this.tbAttach?C.logger.doSessionLog({tbcsattach_1click_ordersucess:1},$.proxy(function(){Eggshell.find(this).trigger("order_success",o)},this)):Eggshell.find(this).trigger("order_success",o)},triggerOrderError:function(){var e,t,i,s={};s["cs1click_"+(this.model.get("doExperimentA806")?"validcc":"control")+"_order_error"]=1,C.logger.doSessionLog(s),this.tbAttach?C.logger.doSessionLog({tbcsattach_1click_ordererror:1},$.proxy(function(){Eggshell.find(this).trigger("error_placing_order")},this)):Eggshell.find(this).trigger("error_placing_order")},triggerPaymentError:function(){var e,t,i,s={};s["cs1click_"+(this.model.get("doExperimentA806")?"validcc":"control")+"_payment_error"]=1,C.logger.doSessionLog(s);var o=this.model.get("cartUrl");this.tbAttach?C.logger.doSessionLog({tbcsattach_1click_paymenterror:1},$.proxy(function(){Eggshell.find(this).trigger("error_with_payment_method",o)})):Eggshell.find(this).trigger("error_with_payment_method",o)},valuePropsTemplate:_.template('<div class="value-props-section <%- contentClass %>"><span class="value-props-header">Subscription includes:</span><div class="value-props-content"><div class="value-prop-text"><span class="value-prop-check"></span>Step-by-step Textbook Solutions for thousands of books</div><div class="value-prop-text"><span class="value-prop-check"></span>Ask questions of experts and enthusiasts 24/7</div><div class="value-prop-text"><span class="value-prop-check"></span>Search millions of homework answers</div></div></div>'),contentTemplate:_.template('<div id="oopsMsgBanner" class="msg-error-sm hidden"><div class="msg-icon"><div class="msg-text">Ooops! The credit card you have on file is expired.</div></div></div><div class="payment-section <%- contentClass %>"><span class="payment-header">Current payment method</span><span class="payment-method <%= paymentClass %>"><% if (true) { %><span class="payment-left-info"><span class="payment-method-icon"></span></span><span class="payment-right-info"><span class="payment-method-caption"><%= paymentDescription %></span><div id="cardExpiredHint" class="color-error font hidden">Card Expired. <span id="cardExpiredSubHint" class="hidden">Update info.</span></div></span><% if (doExperimentA806 && !isCardExpired) { %><div id="card-update-form"><div class="payment-cvv-existing one-card"><div class="C-checkout-payment-cvv C-common-form cvv-block"><div class="cvv-container"><label for="checkout-modal-security-code" class="form-input form-label-sm"><span class="security-legend">CVV </span>code</label><input id="checkout-modal-security-code" type="text" value="" name="cardCode" autocomplete="off" class="card-code-input test-card-code form-input-sm card-secure-img" maxlength="<%= cvvMaxLength %>"><div class="icon-cvv-checkout"></div></div></div></div></div><% } %></span><% } else { %><span class="payment-left-info"><span class="payment-method-icon"></span></span><span class="payment-right-info"><span class="payment-method-caption"><%= paymentDescription %></span><div id="cardExpiredHint" class="color-error font hidden">Card Expired. <span id="cardExpiredSubHint" class="hidden">Update info.</span></div></span><div id="card-update-form" class="hidden"><div class="payment-cvv-existing one-card"><div class="expired-info-block"><label for="card-exp-month" class="form-input form-label-sm">Expiration Date</label><select id="card-exp-month" name="cardExpMo" class="inline-select"><option>MM</option><option>01</option><option>02</option><option>03</option><option>04</option><option>05</option><option>06</option><option>07</option><option>08</option><option>09</option><option>10</option><option>11</option><option>12</option></select><select id="card-exp-year"  name="cardExpYr" class="inline-select"><option>YYYY</option><option>2018</option><option>2019</option><option>2020</option><option>2021</option><option>2022</option><option>2023</option><option>2024</option><option>2025</option><option>2026</option><option>2027</option><option>2028</option><option>2029</option></select></div><div class="C-checkout-payment-cvv C-common-form cvv-block"><div class="cvv-container"><label for="checkout-modal-security-code" class="form-input form-label-sm"><span class="security-legend">CVV </span>code</label><input id="checkout-modal-security-code" name="cardCode" type="text" value="" autocomplete="off" class="card-code-input test-card-code form-input-sm card-secure-img" maxlength="<%= cvvMaxLength %>"><div class="icon-cvv-checkout"></div></div></div></div></div><% } %></span><span class="payment-method-edit-link"><a href="<%= cartUrl %>">Change Payment Method</a></span></div><%= valuePropsHtml %>'),mobileContentTemplate:_.template('<div class="payment-section <%- contentClass %>"><span class="payment-method <%= paymentClass %>"><span class="payment-method-icon"></span><span class="payment-method-caption"><%= paymentDescription %></span><span class="payment-method-edit-link"><a href="<%= cartUrl %>">update</a></span></span></div>'),controlTemplate:_.template('<div class="price-summary">You will be charged <span class="price-highlight">$<%= price %></span> (+ tax if applicable)</div><button class="btn-primary btn-sm resubscribe-cta" disabled="disabled"><%= ctaText %></button><div class="billing-details"><strong>Billing details:</strong> <%= billingDetails %></div>'),mobileControlTemplate:_.template('<button class="btn-primary btn-lg resubscribe-cta"  disabled="disabled"><%= ctaText %></button><div class="price-summary">You will be charged <span class="price-highlight">$<%= price %></span> (+ tax if applicable)</div><div class="billing-details"><a href="#" class="billing-details-link">See details</a></div>'),modalTemplate:_.template('<div id="csresubscribemodal" class="C-Eggshell-dialog C-Eggshell-inline-dialog <%= modalClass %>"><div class="<%= dialogClass %> inline-obfus"><h3 class="headline"><%= headline %></h3><br><p class="subHeadline"><%= subheadline %></p><div class="content"><%= content %></div><div class="control"><%= control %></div></div></div>'),mobileBillingDetails:_.template('<div class="Dialog resubscribe-billing-dialog"><div class="content"><button type="button" aria-label="close" class="close-button"></button><span class="billing-header">Billing Details</span><%= billingDetails %><input type="submit" class="resubscribe-cta outline" value="Resubscribe Now" /></div></div>')})}()),Eggshell.define("C.Eggshell.common.sticker",{inputs:["initTopPosition","resize","scrolling","horisontal scroll","fixed","unfixed","bottom","unbottom"],newNode:!1},C.View.extend({headerBlock:null,pageContentBlock:null,topPosition:0,scrollTop:-1,scrollLeft:0,getElementSelector:function(e){if(e&&e.selector)return e.selector;var t=e&&e[0]&&e[0].classList||[];return t&&t[0]?"."+t[0]:e},initialize:function(e){this.opts=_.extend({pageHeaderBlock:null,pageContentBlock:null,spyOnUpperBlock:null,useScrollTopChecker:!1,scrollTopCheckerClassName:"sticker-component-scroll-top-checker",marginTop:30,marginBottom:0,horisontalScroll:!1,checkWindowSize:!1},e||{});var t=this.getElementSelector(C.dom.$header);this.initHeaderBlock(t),this.initHeaderBlock(".chg-header"),this.initHeaderBlock(".chgg-hdr");var i=this.getElementSelector(C.dom.$content);return this.pageContentBlock=i,e.pageContentBlock&&$(e.pageContentBlock).length&&$(this.opts.pageContentBlock).addClass("sticker-page-content-block"),this.$el.addClass("sticker-component"),this.setPageContentBlock(this.opts.pageContentBlock),this.setHeaderBlock(this.opts.pageHeaderBlock),this.initEvents(),this.Eggshell.trigger("initTopPosition"),this.initStickerScrollTopCheckerBlock(),this.render()},initHeaderBlock:function(e){!this.headerBlock&&$(e).length&&(this.headerBlock=e)},initStickerScrollTopCheckerBlock:function(){if(this.stickerScrollTopChecker=null,this.opts.useScrollTopChecker){var e=this.getStickerScrollTopCheckerBlock();e&&e.length||this.$el.before('<div class="'+this.opts.scrollTopCheckerClassName+'"></div>')}return this.stickerScrollTopChecker},stickerScrollTopChecker:null,getStickerScrollTopCheckerBlock:function(){if(this.opts.useScrollTopChecker){if(!this.stickerScrollTopChecker&&this.opts.scrollTopCheckerClassName){var e=$("."+this.opts.scrollTopCheckerClassName);this.stickerScrollTopChecker=e.length?e:null}}else this.stickerScrollTopChecker=null;return this.stickerScrollTopChecker},render:function(){return this.Eggshell.trigger("scrolling"),this},initEvents:function(){this.Eggshell.on("initTopPosition",this.initTopPosition),this.Eggshell.on("resize",this.resize),this.Eggshell.on("scrolling",this.scrolling),this.Eggshell.on("horisontal scroll",this.horisontal),this.Eggshell.on("fixed",this.fixed),this.Eggshell.on("unfixed",this.unfixed),this.Eggshell.on("bottom",this.bottom),this.Eggshell.on("unbottom",this.unbottom);var e=$(window),t=this;return C.support.touch?e.on("touchmove",function(e){1<e.originalEvent.touches.length&&t.Eggshell.trigger("scrolling")}):e.resize(function(){t.Eggshell.trigger("resize")}),e.scroll(function(){t.scrollTop!=e.scrollTop()&&t.Eggshell.trigger("scrolling"),t.opts.horisontalScroll&&t.scrollLeft!=e.scrollLeft()&&t.Eggshell.trigger("horisontal scroll")}),this},setHeaderBlock:function(e){this.headerBlock=e&&$(e).length?$(e):$(this.headerBlock)||null},setPageContentBlock:function(e){this.pageContentBlock=e&&$(e).length?$(e):$(this.pageContentBlock)||null},getBottomPosition:function(e){var t=e?$(e):this.pageContentBlock,i,s,o,n;return 0+(t.offset().top||0)+this.getObjectHeight(t)-this.opts.marginBottom},initTopPosition:function(){return this.topPosition=this.$el.offset().top||0,this.topPosition},getObjectHeight:function(e){var t=e&&e.length&&e.outerHeight()||0,i=e&&e.length&&e.outerHeight(!0)||0;return i<t?t:i},getMinTopPosition:function(e){var t=e?$(e):this.headerBlock,i,s,o;return((t&&t.length&&t[0]||{}).offsetTop||0)+this.getObjectHeight(t)},getTopPosition:function(){return void 0!==this.topPosition&&null!==this.topPosition||this.Eggshell.trigger("initTopPosition"),this.topPosition},getSpyingBlockPosition:function(){var e=this.opts.spyOnUpperBlock?$(this.opts.spyOnUpperBlock):null,t=e&&e.length?e:this.getStickerScrollTopCheckerBlock();return t&&t.length?t.offset().top+this.getObjectHeight(t):0},checkBottom:function(){var e=this.$el.offset().top+this.getObjectHeight(this.$el),t;this.getBottomPosition()<e?this.Eggshell.trigger("bottom"):this.Eggshell.trigger("unbottom")},resize:function(){if(!this.opts.checkWindowSize)return!0;this.Eggshell.trigger("scrolling")},fixed:function(){this.Eggshell.trigger("unbottom");var e,t,i=this.getMinTopPosition()+(this.opts.marginTop||0),s=this.getObjectHeight(this.$el)+i,o=this.opts.checkWindowSize;!o||o&&window.innerHeight>s?this.$el.addClass("afixed").css("top",i+"px").css("bottom","auto"):this.Eggshell.trigger("unfixed"),this.checkBottom()},unfixed:function(){this.$el.removeClass("afixed").css("top","auto").css("bottom","auto")},bottom:function(){this.$el.hasClass("afixed")&&this.Eggshell.trigger("unfixed");var e=this.opts.marginBottom||0;this.$el.addClass("abottom").css("bottom",e+"px")},lockHorisontal:function(e){this.$el.css("margin-left",-e+"px")},unbottom:function(){this.$el.removeClass("abottom").css("bottom","auto")},horisontal:function(){this.opts.horisontalScroll&&(this.scrollLeft=$(window).scrollLeft(),this.lockHorisontal(this.scrollLeft))},scrolling:function(){var e=$(window).scrollTop(),t=this.getMinTopPosition(),i=this.getSpyingBlockPosition(),s=this.opts.marginTop||0,o=C.support.touch?document.documentElement.clientWidth/window.innerWidth:1,n=(this.scrollTop=e)+t+s,a,r="unfixed";this.getTopPosition()<n&&o<=1&&(0<i&&n<=i||(r="fixed")),this.Eggshell.trigger(r)}})),Eggshell.define("C.common.onboardingsequence",{inputs:{render:{payload:null},set_banner_text:{payload:"string"},set_banner_button_text:{payload:"string"},set_banner_handle:{payload:"selector"},set_obfuscation_handle:{payload:"selector"},set_instruction_points:{payload:"object"},begin_sequence:{payload:null},disable_header_obfuscation:{payload:null},disable_step_counter:{payload:null},apply_custom_css_prefix:{payload:"string"},disable_body_click_listener:{payload:null},set_tooltip_border_color:{payload:"string"},customize_close_btn_class:{payload:"string"}},outputs:["sequence_started","step_viewed","sequence_completed","close_button_clicked"]},function(){var e;return Backbone.View.extend({initialize:function(e){this.$obfuscationHandle=null,this.$bannerHandle=null,this.$headerHandle=C.dom&&C.dom.$header?$(C.dom.$header):$(".chgg-hdr"),this.origHeaderBorder=this.$headerHandle?this.$headerHandle.css("border-bottom"):"",this.bannerText="Welcome to Chegg Study, your start to better grades",this.bannerButtonText="Show me around",this.cssPrefix="onboardingsequence",this.$systemMessageEnabled=e.systemMessageEnabled,this.instructionPoints=[],this.tooltipSequence=[],this.currentTooltipIndex=null,this.sequenceStarted=!1,this.headerObfuscationEnabled=!0,this.disableStepCounter=!1,this.getCheggSearchAutosuggest=$(".chg-header-autosuggest")[0],this.tooltipCloseBtnClass="btn-primary-outline btn-sm",Eggshell.find(this).on("render",this.render,this).on("set_instruction_points",this.setInstructionPoints,this).on("set_banner_text",this.setBannerText,this).on("set_banner_button_text",this.setBannerButtonText,this).on("set_banner_handle",this.setBannerHandle,this).on("set_obfuscation_handle",this.setObfuscationHandle,this).on("disable_header_obfuscation",this.disableHeaderObfuscation,this).on("disable_step_counter",this.setDisableStepCounter,this).on("apply_custom_css_prefix",this.setCustomCssPrefix,this).on("begin_sequence",this.beginSequence,this).on("set_tooltip_border_color",this.setTooltipBorderColor,this).on("disable_body_click_listener",this.removeBodyClickListener,this).on("customize_close_btn_class",this.customizeCloseBtnClass,this)},render:function(){this.getCleanTooltips(),this.renderObfuscation(),this.renderTooltips(),this.renderBanner()},renderObfuscation:function(){this.$obfuscationHandle&&(this.$obfuscationHandle.prepend(this.obfuscationTemplate({})),this.headerObfuscationEnabled&&(this.$headerHandle.append(this.headerObfuscation({})),this.$headerHandle.css({"border-bottom":"none"}),void 0!==this.$systemMessageEnabled&&this.$systemMessageEnabled&&$(".onboarding-sequence-header-obfus").css({top:"32px"})))},renderBanner:function(){this.$bannerHandle&&($(this.bannerTemplate({text:this.bannerText,buttonText:this.bannerButtonText})).insertAfter(this.$bannerHandle),this.attachBannerButtonListener(),this.autoFocusBannerButton())},renderTooltips:function(){for(var e=0;e<this.instructionPoints.length;e++){var s=this.instructionPoints[e],o=Eggshell.create("C.common.overlay.tooltip"),n=e+1;switch(o.on("return tooltip content node",$.proxy(function(e,t){var i;t.html(this.instructionPointContentTemplate({stepNumber:n,content:s.content,buttonText:n==this.instructionPoints.length?"Got it":"Next",total:this.instructionPoints.length,cssPrefix:this.cssPrefix,disableStepCounter:this.disableStepCounter,tooltipCloseBtnClass:this.tooltipCloseBtnClass})),this.attachButtonListener(o)},this)).trigger("set target",s.handle).trigger("disable tooltip on hover").trigger("disable_max_z_index").trigger("enable close button").trigger("get tooltip content node"),s.position){case"left":o.trigger("set tooltip on the left of target");break;case"right":o.trigger("set tooltip on the right of target");break;case"top":o.trigger("set tooltip above target"),o.trigger("position caret center");break;case"bottom":o.trigger("set tooltip below target"),"top-right"===s.caretPosition?o.trigger("position caret on top right"):o.trigger("position caret center")}void 0!==this.tooltipBorderColor&&o.trigger("set tooltip border color",this.tooltipBorderColor),s.tooltipWidth&&o.trigger("set tooltip the width",s.tooltipWidth);var t=o.getId().replace(".","-");$("#"+t).addClass(this.cssPrefix+"-tooltip");var i=s.highlightHandle?s.highlightHandle:"";this.tooltipSequence.push({tooltip:o,highlight:i})}},getCleanTooltips:function(){for(var e=0;e<this.instructionPoints.length;e++){var t;this.instructionPoints[e].handle.length||this.instructionPoints.splice(e,1)}},beginSequence:function(){this.sequenceStarted=!0,Eggshell.find(this).trigger("sequence_started"),$.each(this.tooltipSequence,function(e,t){t.tooltip.trigger("hide")}),this.tooltipSequence&&this.tooltipSequence[0]&&(this.currentTooltipIndex=0,this.showTooltip(this.tooltipSequence[0].tooltip,this.tooltipSequence[0].highlight,this.currentTooltipIndex+1))},showNextTooltip:function(e){this.tooltipSequence[this.currentTooltipIndex].tooltip.trigger("hide");var t=this.currentTooltipIndex+1,i=this.tooltipSequence[this.currentTooltipIndex].highlight;if(t<this.tooltipSequence.length){var s=this.tooltipSequence[t].tooltip,o=this.tooltipSequence[t].highlight;this.currentTooltipIndex=t,this.removeHighlight(i),e&&Eggshell.find(this).trigger("step_viewed",{stepNumber:this.currentTooltipIndex}),this.showTooltip(s,o,this.currentTooltipIndex+1)}else this.removeObfuscation(),this.removeHighlight(i),this.scrollTo(0),this.removeBodyClickListener(),e&&Eggshell.find(this).trigger("step_viewed",{stepNumber:this.currentTooltipIndex+1}),Eggshell.find(this).trigger("sequence_completed")},attachButtonListener:function(s){var e,o="#"+s.getId().replace(".","-");$(o+" .onboarding-tooltip-btn").on("click",$.proxy(function(e){e.stopPropagation(),this.showNextTooltip(!0)},this)),$(o+" .close-btn").on("click",$.proxy(function(e){e.preventDefault(),e.stopPropagation();var t=$(o).find("."+this.cssPrefix+"-instruction-point").data("step"),i=this.tooltipSequence[t-1].highlight;Eggshell.find(this).trigger("close_button_clicked",{stepNumber:t}),this.removeObfuscation(),this.removeHighlight(i),s.trigger("hide"),this.removeBodyClickListener(),Eggshell.find(this).trigger("sequence_completed")},this))},autoFocusBannerButton:function(){var e=$(".onboarding-banner-btn:visible");0<e.length&&e[0].focus()},attachBannerButtonListener:function(){$(".onboarding-banner-btn").on("click",$.proxy(function(e){e.stopPropagation(),$(".onboarding-banner").animate({height:0,opacity:0},400,$.proxy(function(){$(".onboarding-banner").remove(),this.beginSequence()},this))},this))},showTooltip:function(e,t,i){var s=e.getId().replace(".","-"),o=$("#"+s),n=$("#"+s+" .onboarding-tooltip-btn");t[0]===this.getCheggSearchAutosuggest&&($(".onboarding-sequence-header-obfus").css({"z-index":"200"}),$(".chgg-hdr-content").css({"z-index":"unset"})),e.trigger("show"),this.addHighlight(t),this.scrollTo(o.position().top-200),setTimeout(function(){0<n.length&&n[0].focus()},200)},addHighlight:function(e){""!==e&&(e[0].style.pointerEvents="none",$(e).addClass("onboarding-sequence-highlight"))},removeHighlight:function(e){""!==e&&(e[0].style.pointerEvents="auto",$(e).removeClass("onboarding-sequence-highlight"))},removeBodyClickListener:function(){$("body").off("click",$.proxy(this.onBodyClick,this))},onBodyClick:function(){this.sequenceStarted?this.showNextTooltip():$(".onboarding-banner").animate({height:0,opacity:0},400,$.proxy(function(){$(".onboarding-banner").remove(),this.beginSequence()},this))},setInstructionPoints:function(e,t){if(!t||"object"!=typeof t)throw"Invalid instruction point. Type needs to be an object value.";$.extend(this.instructionPoints,t)},setBannerText:function(e,t){this.bannerText=t},setBannerButtonText:function(e,t){this.bannerButtonText=t},setBannerHandle:function(e,t){this.$bannerHandle=t},setObfuscationHandle:function(e,t){this.$obfuscationHandle=t},removeObfuscation:function(){$(".onboarding-sequence-obfuscation").remove(),$(".onboarding-sequence-header-obfus").remove(),this.$headerHandle.css({"border-bottom":this.origHeaderBorder})},disableHeaderObfuscation:function(){this.headerObfuscationEnabled=!1},setDisableStepCounter:function(){this.disableStepCounter=!0},setCustomCssPrefix:function(e,t){this.cssPrefix=t},setTooltipBorderColor:function(e,t){this.tooltipBorderColor=t},customizeCloseBtnClass:function(e,t){this.tooltipCloseBtnClass=t},instructionPointContentTemplate:_.template('<div class="<%=cssPrefix%>-instruction-point" data-step="<%= stepNumber %>"><% if(!disableStepCounter){ %><span class="instruction-point-counter"><%= stepNumber %> of <%= total %></span><% } %> <span class="instruction-point-content"><%= content %></span><button class="onboarding-tooltip-btn <%=tooltipCloseBtnClass%>" tabindex="0"><%= buttonText %></button></div>'),bannerTemplate:_.template('<div class="onboarding-banner"><span class="message-text"><%= text %> <button class="onboarding-banner-btn btn-primary-outline btn-sm" tabindex="0"><%= buttonText %></button></span></div>'),obfuscationTemplate:_.template('<div class="onboarding-sequence-obfuscation"></div>'),headerObfuscation:_.template('<div class="onboarding-sequence-header-obfus"></div>'),scrollTo:function(e){$("body, html").animate({scrollTop:e})}})}()),Eggshell.define("C.common.csrestartmodal",{inputs:["render","show","set_back_action","prevent_close","resume_subscription","render_resume_modal"],outputs:["primary_cta_clicked","restart_success"]},function(){var t=Backbone.Model.extend({resumeSubscription:function(e){$.ajax({type:"post",dataType:"json",url:"/my/_ajax/my/order/resume",data:{token:C.global.csrfToken,orderLineId:e},context:this,success:function(e){this.triggerSuccess()},error:function(e){C.log("Error in resuming subscription: "+JSON.stringify(e))}})},restartSubscription:function(e){$.ajax({type:"post",dataType:"json",url:"/my/_ajax/my/order/undocancel",data:{token:C.global.csrfToken,orderLineId:e},context:this,success:function(){this.triggerSuccess()},error:function(e){C.log("Error in restarting subscription: "+JSON.stringify(e))}})},triggerSuccess:function(){this.trigger("restart_success")}}),e;return Backbone.View.extend({initialize:function(e){this.data=$.extend({},e),this.timeout=5e3,this.model=new t,this.model.on("restart_success",this.triggerRestartSuccess,this),Eggshell.find(this).on("render",this.render,this).on("show",this.show,this).on("set_secondary_button_action",this.setSecondaryButtonAction,this).on("prevent_close",this.setPreventClose,this).on("resume_subscription",this.setResumeFlag,this).on("render_resume_modal",this.renderResumeModal,this)},render:function(){this.popupRestart?this.popupRestart.trigger("show"):(this.popupRestart=Eggshell.create("C.common.dialog").trigger("set headline","Welcome back").trigger("set content html",this.restartModalTemplate(this.data.subscription)).trigger("set id","uncancel-modal").trigger("enable default control").trigger("set primary button",this.resumeSubscription?"Resume Subscription":"Restart Subscription").trigger("set secondary button","Go back").on("primary button clicked",this.onCtaClick,this).on("secondary button clicked",this.onSecondaryButtonClick,this),this.preventClose&&this.popupRestart.trigger("hide close button").trigger("disable screen blocker click"))},show:function(){this.popupRestart&&this.popupRestart.trigger("show")},hide:function(){this.popupRestart&&this.popupRestart.trigger("hide")},onSecondaryButtonClick:function(){this.secondaryButtonAction?this.secondaryButtonAction():this.hide()},setSecondaryButtonAction:function(e,t){this.secondaryButtonAction=t},setPreventClose:function(){this.preventClose=!0},setResumeFlag:function(){this.resumeSubscription=!0},onCtaClick:function(){this.triggerCtaClick();var e=this.data.subscription.subscription.id;this.resumeSubscription?this.model.resumeSubscription(e):this.model.restartSubscription(e)},triggerCtaClick:function(){Eggshell.find(this).trigger("primary_cta_clicked")},triggerRestartSuccess:function(){Eggshell.find(this).trigger("restart_success")},renderResumeModal:function(){"tbs"===this.data.pageSource&&(this.timeout=8e3),Eggshell.find(this).on("primary_cta_clicked",function(){C.logger.doSessionLog({cs_resume_modal_click:1}),$("#uncancel-modal button").prop("disabled","disabled"),$("#uncancel-modal .primary").append('<div class="chg-load"></div>')}).on("restart_success",function(){setTimeout(function(){C.utility.navigate(window.location.href+"?cs_resume=1")},this.timeout),C.logger.doSessionLog({cs_resume_modal_success:1})}).trigger("set_secondary_button_action",function(){var e=document.referrer;-1!==e.indexOf(C.global.cheggBaseUrl)?C.utility.navigate(e):C.utility.navigate("/study")}).trigger("resume_subscription").trigger("render"),C.logger.doSessionLog({cs_resume_modal_shown:1})},restartModalTemplate:_.template('<div class="resume-dialog"><% if(subscription.suspended) {%>Welcome back. It\'s only $<%- subscription.price %> per <%- (subscription.renewalPeriod === "yr") ? "year" : "month" %> to resume your Chegg Study subscription. <% if (billing.paypal) { %><strong><%- billing.paypal %></strong><% } else { %>Your <%- billing.type %> ending in <strong><%- billing.last4 %></strong><% } %> will be charged today.<% } else { %><% if (subscription.subscriptionState.isCancelPending) { %>Your subscription will no longer be cancelled on <%- subscription.renewalDate %>. It will auto-renew and <% } else { %>Your subscription will no longer be paused on <%- subscription.suspendDate %>. It will auto-renew and <% } %><% if (billing.paypal) { %><strong><%- billing.paypal %></strong><% } else { %>your <%- billing.type %> ending in <strong><%- billing.last4 %></strong><% } %> will be charged $<%- subscription.price %> at that time.<% } %> </div> ')})}()),Eggshell.define("C.common.promotion.chromeextension",{inputs:["render"],outputs:["ready","error"]},function(){var e=C.Model.extend({defaults:{url:"https://chrome.google.com/webstore/detail/ppjpbfndmahggjdgblhidgamlepoegif",rel:"chrome-webstore-item"}}),t;return C.View.extend({initialize:function(){this.model=new e,this.model.on("ready",this.render,this),this.model.on("error",this.error,this),this.model.on("not supported",function(){Eggshell.find(this).trigger("ready").trigger("not available").trigger("hide")},this),Eggshell.find(this).on("render",this.render)},error:function(){Eggshell.find(this).trigger("error")},render:function(){try{var e=localStorage.getItem("isChromePromoDisabled");null!==e&&"true"===e||(this.$el.html(this.template({})),Eggshell.find(this).trigger("ready"),C.logger.doSessionLog({chrome_search_banner_shown:1}))}catch(e){Eggshell.find(this).trigger("error")}},events:{"click button.btn":"clickOnAddToChrome","click div.close-promo":"clickOnClosePromo"},clickOnAddToChrome:function(e){e.preventDefault(),e.stopPropagation();var t=window.open("","_blank");C.logger.doSessionLog({chrome_search_banner_click:1},$.proxy(function(){t.location.href=this.model.get("url")},this))},clickOnClosePromo:function(e){C.logger.doSessionLog({chrome_search_banner_close:1}),localStorage.setItem("isChromePromoDisabled",!0),this.$el.slideUp("medium")},template:_.template('<div class="chrome-ex-promo-wrapper"><div class="icon-chegg-cancel close-promo" title="Dismiss" aria-label="Close" role="button" tabindex="0"></div>    <div class="outer">        <div class="inner-left"></div>        <div class="inner-right"><div class="new-label"></div><span class="text-hdr-3">Chegg Study Extension</span><div class="subtitle">Find solutions from anywhere!</div></div>    </div>    <button class="btn cta-btn btn-flat-sm">Add to Chrome</button></div>')})}()),Eggshell.define("C.Eggshell.bundlebanner",{inputs:[],outputs:[]},C.View.extend({element:null,initialize:function(e){this.element=e.element,this.systemMessageEnabled=e.systemMessageEnabled,this.bundlePromoText=e.bannerText,this.bundlepagetype=e.pageType,this.initialpadding="",this.ctaBundleUrlOption=e.bundleCtaUrl,this.render(),this.setUpListeners()},render:function(){switch(C.logger.doSessionLog({bundle_upgrade_banner_shown:1}),this.bundlepagetype){case"homepage":$(this.template({})).insertBefore(this.element),$(".bundlebanner-button-text").attr("am-link-id","CSHP_get_bundle_offer");break;case"tbs":this.setCommonCssQaTbs(),$(".bundlebanner-button-text").attr("am-link-id","TBS_get_bundle_offer");break;default:this.setCommonCssQaTbs(),$(".bundlebanner-button-text").attr("am-link-id","QNA_get_bundle_offer")}this.bundlePromoText&&$(".bundlebanner-text").html(this.bundlePromoText),$(".bundlebanner-container").fadeIn()},setUpListeners:function(){$(".bundlebanner-btn-close").on("click",function(e){C.logger.doSessionLog({bundle_upgrade_banner_close:1}),$(".bundlebanner-container").fadeOut(),"qa"!=this.bundlepagetype&&"tbs"!=this.bundlepagetype||$(".chg-content").css("padding-top",this.initialpadding),C.utility.setUserKvp("bundle_banner_disabled",1)}.bind(this)),$(".bundlebanner-button-text").on("click",function(e){C.logger.doSessionLog({bundle_upgrade_banner_click:1}),"TO_SIBC"==this.ctaBundleUrlOption?$.ajax({url:"/_ajax/sibcurlbuilder",type:"POST",data:{item:{externalId:"CHGStudyPcknoFT"},successUrl:"/?smartMove=1",errorUrl:"/study",view:"leftBubbleView",token:C.global.csrfToken,swapAnnotationsNeeded:1},context:this,success:function(e){window.location.href=e.url},error:function(e){console.log("error",e)}}):window.location.href="/study-pack"}.bind(this))},setCommonCssQaTbs:function(){$(this.template({})).prependTo(this.element);var e=this.systemMessageEnabled?parseInt($(".uma").height())+parseInt($(".chgg-hdr").height()):$(".chgg-hdr").height();$(".bundlebanner-container").css("top",e),this.initialpadding=$(".chg-content").css("padding-top"),$(".chg-content").css("padding-top","17px")},template:_.template('<div class="bundlebanner-container"><div class="bundlebanner-cnt"><div class="bundlebanner-inner"><div class="icon-chegg-study-pack bundlebanner-icon">&nbsp;</div><div class="bundlebanner-text">Everything you need to succeed with 2 new study tools from Chegg! </div><div class="bundlebanner-cta"><button class="btn-white btn-sm bundlebanner-button-text">See offer</button></div></div><div class="bundlebanner-btn-close"> </div></div></div>')})),Eggshell.define("C.common.accountsharing.block",{singleton:!0},function(){var t="cs-as-block-email-sent",i=864e5,s="chgcsastoken",a="shown",r="cta_button",l="resend_link",c="reset_pw_link",d=-1===location.hostname.indexOf("chegg.com")?"cheggnet":"chegg",h="2.0.0",o=Backbone.Model.extend({initialize:function(){var e=this.readEmailSentData();this.set({emailSent:e})},instantiateLogging:function(){var i=C.utility.getCookie(s);$.ajax({url:"/_ajax/sharing",type:"get",dataType:"json",data:{sharing_id:i,token:C.global.csrfToken},context:this,success:function(e){var t=e.sharingID;t&&t!==i&&(C.utility.setCookie(s,t,180),i=t)},complete:function(){this.set("token",i),this.log(a)}.bind(this)})},kickToSubscribe:function(t){var i,s,o,n,a,r;C.utility.getSubsPriceData(function(e){i=e.subsPriceData?e.subsPriceData.monthly:{},s=i.catalogId,o=i.priceId,n=i.catalogItemSource,a=escape("/checkoutinterstitial/hwh/?redirect=hwh&command="+s+","+o+",1,"+n),r="/auth?type=simplifiedstudy&action=signup&redirect="+a,$.ajax({url:"/_ajax/logout",type:"get",dataType:"json",data:{token:C.global.csrfToken},context:this,success:function(e){e.logout?(C.utility.setCookie("as_ref",location.href),C.utility.navigate(r)):this.trigger("actionFailure")},error:function(){this.trigger("actionFailure")},complete:function(){"function"==typeof t&&t()}})}.bind(this))},log:function(e){var t=this.get("source"),i=this.get("token")||"unknown",s=window.digitalData&&window.digitalData.pageInfo&&window.digitalData.pageInfo.pageName||null,o="com."+d+".",n={account_sharing_id:i,account_sharing_user_state:"blocked",page_url:location.href};switch(e){case a:o+="account_sharing_shown";break;case r:case l:case c:o+="account_sharing_click",n.account_sharing_component=e}null!=C.utility.getCookie("logging")&&console.table({user_state:n.account_sharing_user_state,event:o,click_component:n.account_sharing_component||"n/a",source:t,id:n.account_sharing_id}),window.rio&&window.rio.logEvent&&window.rio.logEvent(t,o,h,n,s,function(){C.log("account_sharing_event",e,"logged")})},sendEmail:function(e){$.ajax({url:"/_ajax/sendemail/reset",type:"get",dataType:"json",data:{token:C.global.csrfToken,page:location.href},context:this,success:function(e){e.emailSent?(this.trigger("emailSent"),window.setTimeout(function(){C.utility.navigate("/study")},42e4)):this.trigger("actionFailure")},error:function(){this.trigger("actionFailure")},complete:function(){"function"==typeof e&&e()}})},readEmailSentData:function(){var i=!1;return $.ajax({url:"/_ajax/sharing/actions",type:"get",dataType:"json",data:{key:t,mode:"get",token:C.globalcsrfToken},context:this,success:function(e){var t=e.data;t&&t.length&&2===t.length&&(i=parseInt(t[1],10)>Date.now()),C.log("account_sharing_action_get_response",t)}}),i},updateEmailSentData:function(e){$.ajax({url:"/_ajax/sharing/actions",type:"get",dataType:"json",data:{key:t,mode:"set",token:C.globalcsrfToken,value:e?Date.now()+i:null},context:this,success:function(e){C.log("account_sharing_action_set_response",e.data)}})}}),e;return Backbone.View.extend({initialize:function(e){this.model=new o({source:e.source}),this.model.on("actionFailure",this.updateStatusActionFailure,this),this.model.on("emailSent",this.updateStatusEmailSent,this),this.model.on("change",function(){this.model.hasChanged("emailSent")&&(this.model.updateEmailSentData(this.model.get("emailSent")),this.render())},this),this.contentID="cs-as-block",this.errorClassName="as-dialog-error",this.errorSelector="."+this.errorClassName,this.isMobile=C.utility.isMobile(),this.root=null,this.model.instantiateLogging(),this.render()},events:{"click .as-dialog-send-email":"sendEmail","click .as-dialog-subscribe":"subscribe"},template:_.template('<div id="cs-as-block" aria-live="polite" role="status" tabindex="-1"><div id="cs-as-dialog"><div id="as-dialog-sent-notification" class="visually-hidden"></div><div id="as-dialog-content"><%= content %><div class="chg-load" aria-hidden="true"></div></div></div></div>'),render:function(){var e,t=this.model.get("emailSent")?this.getEmailSentTemplate({icon:this.getEmailSentIcon()}):this.getBlockingTemplate();document.documentElement.classList.add("cs-as-blocked"),document.body.classList.add("cs-as-blocked"),this.isMobile&&this.el.classList.add("as-mobile"),this.el.innerHTML=this.template({content:t}),this.root=document.getElementById(this.contentID),this.root.focus()},getBlockingTemplate:_.template('<div class="as-icon"><div class="icon-chegg-Lock"></div></div><p class="msg-header">Uh oh, this account has been restricted because of an unusual amount of activity.</p><p class="msg-text"><button type="button" class="as-dialog-send-email">Get a reset password link</button> to regain access.</p><p class="msg-text">Need your own subscription?</p><p class="as-dialog-cta"><a data-type="button" class="btn-special btn-lg as-dialog-subscribe" href="#">Subscribe now</a></p><p class="as-dialog-disclaimer">Cancel anytime</p>'),getActionFailureTemplate:_.template('<div class="icn-messaging-error-sm"></div> Sorry, something went wrong. Try again.'),getEmailSentIcon:_.template('<svg viewBox="0 0 100 56" version="1.1" xmlns="http://www.w3.org/2000/svg"><title>Email Sent</title><g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g transform="translate(-51.000000, -49.000000)"><g transform="translate(51.000000, 49.000000)"><polygon fill="#71CFC9" points="0 21.9260773 4.7373849 26.6630939 54.8600368 26.6630939 54.8600368 21.9260773"></polygon><polygon fill="#71CFC9" points="54.8598527 44.0724862 54.8598527 39.3354696 17.4093923 39.3354696 22.1464088 44.0724862"></polygon><polygon fill="#71CFC9" points="54.8598527 35.3677716 54.8598527 30.6307551 8.70441989 30.6307551 13.4418048 35.3677716"></polygon><g transform="translate(27.992634, 0.000000)"><path d="M48.4314549,6.13134438 C46.3835727,4.60353591 44.8159853,2.47093923 43.9839411,0.000220994475 C43.1518969,2.47093923 41.5839411,4.60353591 39.5364273,6.13134438 C41.5839411,7.65915285 43.1518969,9.79174954 43.9839411,12.2628361 C44.8159853,9.79174954 46.3835727,7.65915285 48.4314549,6.13134438" fill="#FFB70D"></path><g transform="translate(65.193370, 22.467772)"><mask id="magic-email-sent-mask" fill="white"><polygon points="6.44235727 0.257495396 6.44235727 8.9506814 0.136058932 8.9506814 0.136058932 0.257495396 6.44235727 0.257495396"></polygon></mask><path d="M6.4425046,4.6040884 C4.99093923,3.52084715 3.87896869,2.00924494 3.28891344,0.257495396 C2.69959484,2.00924494 1.58762431,3.52084715 0.136058932,4.6040884 C1.58762431,5.68732965 2.69959484,7.19893186 3.28891344,8.9506814 C3.87896869,7.19893186 4.99093923,5.68732965 6.4425046,4.6040884" fill="#FFB70D" mask="url(#magic-email-sent-mask)"></path></g><path d="M6.58946593,50.9019521 C5.13790055,49.8187109 4.02629834,48.3071087 3.43624309,46.5553591 C2.84655617,48.3071087 1.73495396,49.8187109 0.283020258,50.9019521 C1.73495396,51.9851934 2.84655617,53.4967956 3.43624309,55.2485451 C4.02629834,53.4967956 5.13790055,51.9851934 6.58946593,50.9019521" fill="#FFB70D"></path><path d="M60.6293186,46.6694659 C60.6293186,47.2775691 60.1317127,47.7748066 59.5239779,47.7748066 L13.4035359,47.7748066 C12.7954328,47.7748066 12.2981952,47.2775691 12.2981952,46.6694659 L12.2981952,19.3291344 C12.2981952,18.7210313 12.7954328,18.2237937 13.4035359,18.2237937 L59.5239779,18.2237937 C60.1317127,18.2237937 60.6293186,18.7210313 60.6293186,19.3291344 L60.6293186,46.6694659 Z" fill="#FFFFFF"></path><path d="M13.6798527,46.3930387 L13.6798527,20.8994843 L36.4632781,37.6339227 L59.2478085,20.899116 L59.2478085,46.3930387 L13.6798527,46.3930387 Z M56.3420994,19.6051934 L36.4632781,34.20593 L16.5851934,19.6051934 L56.3420994,19.6051934 Z M13.4036096,16.8423941 C12.0323389,16.8423941 10.9166851,17.9576796 10.9166851,19.3289503 L10.9166851,46.6692818 C10.9166851,48.0405525 12.0323389,49.1558379 13.4036096,49.1558379 L59.5244199,49.1558379 C60.8953223,49.1558379 62.0109761,48.0405525 62.0109761,46.6692818 L62.0109761,19.3289503 C62.0109761,17.9576796 60.8953223,16.8423941 59.5244199,16.8423941 L13.4036096,16.8423941 Z" fill="#F07D00"></path></g></g></g></g></svg>'),getEmailSentTemplate:_.template('<div class="as-icon"><%= icon %></div><p class="msg-header">Check your email</p><p class="msg-text">We sent you an email to reset your password. <span class="msg-reminder-text">Didn&rsquo;t get it? Wait another minute or <button type="button" class="as-dialog-send-email">get a new reset email</button>.</span></p>'),removeActionFailureMessage:function(){var e=this.root.querySelector(this.errorSelector);null!==e&&e.parentNode.removeChild(e)},sendEmail:function(e){e.preventDefault(),this.model.get("emailSent")?($("#cs-as-block .msg-reminder-text").fadeOut("slow"),this.model.log(l)):this.model.log(c),this.root.setAttribute("aria-busy","true"),this.removeActionFailureMessage(),this.model.sendEmail(function(){this.root.setAttribute("aria-busy","false")}.bind(this))},subscribe:function(e){e.preventDefault(),this.model.log(r),this.root.setAttribute("aria-busy","true"),this.removeActionFailureMessage(),this.model.kickToSubscribe(function(){this.root.setAttribute("aria-busy","false")}.bind(this))},updateStatusActionFailure:function(){var e=document.createElement("div");e.classList.add(this.errorClassName),e.innerHTML=this.getActionFailureTemplate(),document.getElementById("as-dialog-content").insertBefore(e,null)},updateStatusEmailSent:function(){var e;this.model.get("emailSent")?(document.getElementById("as-dialog-sent-notification").innerText+="Email sent. ",this.model.updateEmailSentData(!0)):this.model.set("emailSent",!0)}})}()),Eggshell.define("C.common.csaccountsharing.warn",{singleton:!0},function(){var t="cs-as-warn-closed",i=18e5,s="chgcsastoken",o="cs-as-warn-email-sent",n=864e5,a="shown",r="cta_button",l="resend_link",c="reset_pw_link",d=-1===location.hostname.indexOf("chegg.com")?"cheggnet":"chegg",h="2.0.0",g=Backbone.Model.extend({initialize:function(){var e=this.readBannerClosedData(),t=this.readEmailSentData();this.set({bannerClosed:e,emailSent:t})},instantiateLogging:function(){var i=C.utility.getCookie(s);$.ajax({url:"/_ajax/sharing",type:"get",dataType:"json",data:{sharing_id:i,token:C.global.csrfToken},context:this,success:function(e){var t=e.sharingID;t&&t!==i&&(C.utility.setCookie(s,t,180),i=t)},complete:function(){this.set("token",i),this.log(a)}.bind(this)})},kickToSubscribe:function(t){var i,s,o,n,a,r;C.utility.getSubsPriceData(function(e){i=e.subsPriceData?e.subsPriceData.monthly:{},s=i.catalogId,o=i.priceId,n=i.catalogItemSource,a=escape("/checkoutinterstitial/hwh/?redirect=hwh&command="+s+","+o+",1,"+n),r="/auth?type=simplifiedstudy&action=signup&redirect="+a,$.ajax({url:"/_ajax/logout",type:"get",dataType:"json",data:{token:C.global.csrfToken},context:this,success:function(e){e.logout?(C.utility.setCookie("as_ref",location.href),C.utility.navigate(r)):this.trigger("actionFailure")},error:function(){this.trigger("actionFailure")},complete:function(){"function"==typeof t&&t()}})}.bind(this))},log:function(e){var t=this.get("source"),i=this.get("token")||"unknown",s=window.digitalData&&window.digitalData.pageInfo&&window.digitalData.pageInfo.pageName||null,o="com."+d+".",n={account_sharing_id:i,account_sharing_user_state:"warned",page_url:location.href};switch(e){case a:o+="account_sharing_shown";break;case r:case l:case c:o+="account_sharing_click",n.account_sharing_component=e}null!=C.utility.getCookie("logging")&&console.table({user_state:n.account_sharing_user_state,event:o,click_component:n.account_sharing_component||"n/a",source:t,id:n.account_sharing_id}),window.rio&&window.rio.logEvent&&window.rio.logEvent(t,o,h,n,s,function(){C.log("account_sharing_event",e,"logged")})},sendEmail:function(e){$.ajax({url:"/_ajax/sendemail/reset",type:"get",dataType:"json",data:{token:C.global.csrfToken,page:location.href},context:this,success:function(e){e.emailSent?this.trigger("emailSent"):this.trigger("actionFailure")},error:function(){this.trigger("actionFailure")},complete:function(){"function"==typeof e&&e()}})},readActionData:function(e){var i=!1;return $.ajax({url:"/_ajax/sharing/actions",type:"get",dataType:"json",data:{key:e,mode:"get",token:C.globalcsrfToken},context:this,success:function(e){var t=e.data;t&&t.length&&2===t.length&&(i=parseInt(t[1],10)>Date.now()),C.log("account_sharing_action_get_response",t)}}),i},readBannerClosedData:function(){return this.readActionData(t)},readEmailSentData:function(){return this.readActionData(o)},updateActionData:function(e,t,i){$.ajax({url:"/_ajax/sharing/actions",type:"get",dataType:"json",data:{key:e,mode:"set",token:C.globalcsrfToken,value:t?Date.now()+i:null},context:this,success:function(e){C.log("account_sharing_action_set_response",e.data)}})},updateBannerClosedData:function(e){this.updateActionData(t,e,i)},updateEmailSentData:function(e){this.updateActionData(o,e,n)}}),e;return Backbone.View.extend({initialize:function(e){this.model=new g({source:e.source}),this.model.on("change",function(){if(this.model.hasChanged("bannerClosed")){var e=this.model.get("bannerClosed");this.model.updateBannerClosedData(e),e&&this.remove()}this.model.hasChanged("emailSent")&&(this.model.updateEmailSentData(this.model.get("emailSent")),this.render())},this),this.model.on("actionFailure",this.updateStatusActionFailure,this),this.model.on("emailSent",this.updateStatusEmailSent,this),this.contentSelector=".as-banner-content",this.isMobile=C.utility.isMobile(),this.emailSentClassName="as-banner-sent",this.errorClassName="as-banner-error",this.errorSelector="."+this.errorClassName,this.warningClassName="as-banner-warn",this.model.get("bannerClosed")||this.model.instantiateLogging(),this.render()},events:{"click .as-banner-close":"closeBanner","click .as-banner-send-email":"sendEmail","click .as-banner-subscribe":"subscribe"},template:_.template('<div class="as-banner-wrap"><div id="as-banner-sent-notification" class="visually-hidden"></div><div class="as-banner-content-wrap" tabindex="-1"><%= content %></div><button type="button" class="as-banner-close" aria-labelledby="as-button-label as-banner-label"><div class="icon-chegg-cancel" id="as-button-label" aria-label="close"></div></button><div class="chg-load" aria-hidden="true"></div></div>'),render:function(){this.model.get("bannerClosed")&&this.remove();var e=this.model.get("emailSent"),t=e?this.getEmailSentTemplate({icon:this.getEmailSentIcon()}):this.getWarningTemplate();this.updateBannerClassNames(e),this.el.innerHTML=this.template({content:t}),this.isMobile&&this.el.classList.add("as-mobile")},closeBanner:function(e){e.preventDefault(),this.model.set("bannerClosed",!0)},getEmailSentIcon:_.template('<svg viewBox="0 0 100 56" version="1.1" xmlns="http://www.w3.org/2000/svg"><title>Email Sent</title><g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g transform="translate(-51.000000, -49.000000)"><g transform="translate(51.000000, 49.000000)"><polygon fill="#71CFC9" points="0 21.9260773 4.7373849 26.6630939 54.8600368 26.6630939 54.8600368 21.9260773"></polygon><polygon fill="#71CFC9" points="54.8598527 44.0724862 54.8598527 39.3354696 17.4093923 39.3354696 22.1464088 44.0724862"></polygon><polygon fill="#71CFC9" points="54.8598527 35.3677716 54.8598527 30.6307551 8.70441989 30.6307551 13.4418048 35.3677716"></polygon><g transform="translate(27.992634, 0.000000)"><path d="M48.4314549,6.13134438 C46.3835727,4.60353591 44.8159853,2.47093923 43.9839411,0.000220994475 C43.1518969,2.47093923 41.5839411,4.60353591 39.5364273,6.13134438 C41.5839411,7.65915285 43.1518969,9.79174954 43.9839411,12.2628361 C44.8159853,9.79174954 46.3835727,7.65915285 48.4314549,6.13134438" fill="#FFB70D"></path><g transform="translate(65.193370, 22.467772)"><mask id="magic-email-sent-mask" fill="white"><polygon points="6.44235727 0.257495396 6.44235727 8.9506814 0.136058932 8.9506814 0.136058932 0.257495396 6.44235727 0.257495396"></polygon></mask><path d="M6.4425046,4.6040884 C4.99093923,3.52084715 3.87896869,2.00924494 3.28891344,0.257495396 C2.69959484,2.00924494 1.58762431,3.52084715 0.136058932,4.6040884 C1.58762431,5.68732965 2.69959484,7.19893186 3.28891344,8.9506814 C3.87896869,7.19893186 4.99093923,5.68732965 6.4425046,4.6040884" fill="#FFB70D" mask="url(#magic-email-sent-mask)"></path></g><path d="M6.58946593,50.9019521 C5.13790055,49.8187109 4.02629834,48.3071087 3.43624309,46.5553591 C2.84655617,48.3071087 1.73495396,49.8187109 0.283020258,50.9019521 C1.73495396,51.9851934 2.84655617,53.4967956 3.43624309,55.2485451 C4.02629834,53.4967956 5.13790055,51.9851934 6.58946593,50.9019521" fill="#FFB70D"></path><path d="M60.6293186,46.6694659 C60.6293186,47.2775691 60.1317127,47.7748066 59.5239779,47.7748066 L13.4035359,47.7748066 C12.7954328,47.7748066 12.2981952,47.2775691 12.2981952,46.6694659 L12.2981952,19.3291344 C12.2981952,18.7210313 12.7954328,18.2237937 13.4035359,18.2237937 L59.5239779,18.2237937 C60.1317127,18.2237937 60.6293186,18.7210313 60.6293186,19.3291344 L60.6293186,46.6694659 Z" fill="#FFFFFF"></path><path d="M13.6798527,46.3930387 L13.6798527,20.8994843 L36.4632781,37.6339227 L59.2478085,20.899116 L59.2478085,46.3930387 L13.6798527,46.3930387 Z M56.3420994,19.6051934 L36.4632781,34.20593 L16.5851934,19.6051934 L56.3420994,19.6051934 Z M13.4036096,16.8423941 C12.0323389,16.8423941 10.9166851,17.9576796 10.9166851,19.3289503 L10.9166851,46.6692818 C10.9166851,48.0405525 12.0323389,49.1558379 13.4036096,49.1558379 L59.5244199,49.1558379 C60.8953223,49.1558379 62.0109761,48.0405525 62.0109761,46.6692818 L62.0109761,19.3289503 C62.0109761,17.9576796 60.8953223,16.8423941 59.5244199,16.8423941 L13.4036096,16.8423941 Z" fill="#F07D00"></path></g></g></g></g></svg>'),getEmailSentTemplate:_.template('<div class="as-icon"><%= icon %></div><div class="as-banner-content"><p class="msg-header" id="as-banner-label">Check your email</p><p class="msg-text">We sent you an email to reset your password.</p><p class="msg-text msg-reminder-text">Didn&rsquo;t get it? Wait another minute or <button type="button" class="as-banner-send-email">get a new reset email</button>.</p></div>'),getWarningTemplate:_.template('<div class="as-icon"><div class="icn-messaging-important-lg"></div></div><div><p class="msg-header"  id="as-banner-label">Your account usage is unusually high.</p><p class="msg-text"><button type="button" class="as-banner-send-email">Reset your password</button> to protect your account.</p><p class="msg-text">Need your own subscription? <a href="#" class="as-banner-subscribe">Subscribe now</a></p></div>'),removeActionFailureMessage:function(){var e=this.el.querySelector(this.errorSelector);null!==e&&e.parentNode.removeChild(e)},sendEmail:function(e){e.preventDefault(),this.model.get("emailSent")?($(".as-banner-content .msg-reminder-text").fadeOut("slow"),this.model.log(l)):this.model.log(c),this.el.setAttribute("aria-busy","true"),this.removeActionFailureMessage(),this.model.sendEmail(function(){this.el.setAttribute("aria-busy","false")}.bind(this))},subscribe:function(e){e.preventDefault(),this.model.log(r),this.el.setAttribute("aria-busy","true"),this.removeActionFailureMessage(),this.model.kickToSubscribe(function(){this.el.setAttribute("aria-busy","false")}.bind(this))},updateBannerClassNames:function(e){e?(this.el.classList.add(this.emailSentClassName),this.el.classList.remove(this.warningClassName)):(this.el.classList.add(this.warningClassName),this.el.classList.remove(this.emailSentClassName))},updateStatusActionFailure:function(){var e=document.createElement("div"),t=document.createElement("div");e.classList.add(this.errorClassName),t.classList.add("as-banner-error-content"),e.insertBefore(t,null),this.el.insertBefore(e,null),Eggshell.create("C.common.message",{el:t}).trigger("set type","error").trigger("set size","small").trigger("set body","Sorry, something went wrong. Try again.")},updateStatusEmailSent:function(){var e;this.model.get("emailSent")?(document.getElementById("as-banner-sent-notification").innerText+="Email sent. ",this.model.updateEmailSentData(!0)):this.model.set("emailSent",!0)}})}()),Eggshell.define("C.common.mathattach",{inputs:[],outputs:[]},function(){var e;return Backbone.View.extend({initialize:function(e){this.opts=$.extend(e,{}),this.Eggshell.on("render",this.render,this)},render:function(){var e="Solve more "+(this.opts.subjectName?this.opts.subjectName.toLowerCase():"math")+" problems";this.$el.append(this.template({title:e,assetUrl:C.global.assetUrl,url:this._getMathUrlBySubject(this.opts.subjectId,this.opts.subjectType)})),$(".mathattach-button").on("click",function(e){C.logger.doSessionLog({math_rr_click:1})})},template:_.template('<div class="mathattach"><div class="mathattach-card"><div class="mathattach-card-row"><div class="mathattach-card-preview"><img src="<%= assetUrl %>site/images/img-math-CSCalculator-1.png" alt="Chegg Math Solver preview"></div><div class="mathattach-card-description"><div class="mathattach-card-flag">New</div><div class="mathattach-card-title"><%= title %></div><div class="mathattach-card-text">Understand each step with our guided solver</div></div></div><div class="mathattach-card-row"><a data-type="button" class="btn-secondary btn-sm mathattach-button" href="<%= url %>" target="_blank" am-link-id="Use the solver">Use the solver</a></div></div></div>'),_getMathUrlBySubject:function(e,t){var i="";if("qna"==t)switch(parseInt(e)){case 50:i="pre-algebra-calculator/";break;case 7:i="algebra-calculator/";break;case 8:i="calculus-calculator/";break;case 51:i="pre-calculus-calculator/"}else if("tbs"==t)switch(parseInt(e)){case 67:i="pre-algebra-calculator/";break;case 27:i="algebra-calculator/";break;case 29:i="calculus-calculator/";break;case 69:i="pre-calculus-calculator/"}return"/math-solver/"+i}})}()),$(".online-tutor-link a").on("click",function(e){e.preventDefault();var t=e.currentTarget.href;C.logger.doSessionLog({seo_tutors_click:1},function(){C.utility.navigate(t)})}),function(c,e,d){var t="textarea",i="keyup change paste input";function s(e){var t=c(e),i=t.val(),s=t.val("").height(),o=e.scrollHeight,n=s<o?o-s:0;return t.data("minHeight",s),t.data("scrollOffset",n),t.val(i)}function o(){var e=c(this),t=e.height(),i=e.data("scrollOffset"),s=e.data("minHeight"),o=d.scrollTop(),n=e.height(s).prop("scrollHeight")-i,a=parseInt(e.css("padding-top"),10),r=parseInt(e.css("padding-bottom"),10),l;n+=Math.floor(1.1*(a+r)),e.height(n),d.scrollTop(o),t!==n&&e.trigger("autoresize:resize",n)}function n(){s(this).on(i,o),o.call(this)}e.autoResize=function(){return this.filter(t).each(n)}}(jQuery,jQuery.fn,jQuery(window)),C("widget"),C.widget.answerEditor=C.widget._base.extend({construct:function(e){this.opts=$.extend({},e),this.commentingDisabled=!!$(".nonUS"),this.$el=$(this.opts.elem),this.$el.length&&($(".answers-list .answer-comments .answer-comment:last").addClass("last-child"),this.$answerName=$(".answerer-name",this.$el),this.$answerInput=$(".answer-display:not([disabled])",this.$el),this.$androidAnswerInput=$(".android-answer-display:not([disabled])",this.$el),this.$answerQuestionButton=$(".answer-question",this.$el),this.$wrap=this.$el.hasClass("editor-wrap")?this.$el:this.$el.find(".editor-wrap"),this.$answerForm=this.$el.find(".answer-form"),this.questionId=this.$answerForm.attr("data-qid"),this.$signInButtons=$(".answer-signin",this.$el),this.$answererRealName1=$(".answerer-realname-first",this.$el),this.$answererRealName2=$(".answerer-realname-second",this.$el),this.$answererRealName3=$(".answerer-realname-third",this.$el),this.$answererNickNameMsg=$(".answerer-nickname-msg",this.$el),this.doBind(),this.doWidget())},doWidget:function(){var e=this;this.$answerInput.length&&(this.EggshellEditor=Eggshell.create("C.common.editor",{enableCKEditorNewVersion:this.opts.enableCKEditorNewVersion}).on("editor focused",function(){e.expandEditor(),$.post("/_ajax/log/php",{qid:e.questionId,view:"end",answer:"start"})}).trigger("set container",this.$answerInput[0]).trigger("set type","ask").trigger("render editor")),this.$androidAnswerInput.length&&(this.EggshellEditor=Eggshell.create("C.common.editor",{enableCKEditorNewVersion:this.opts.enableCKEditorNewVersion}).on("editor focused",function(){e.expandEditor(),$.post("/_ajax/log/php",{qid:e.questionId,view:"end",answer:"start"})}).trigger("set container",this.$androidAnswerInput[0]).trigger("set type","ask").trigger("render editor"))},doBind:function(){this.$signInButtons.observe("click.answerSignin",function(e){this.signInAnswerReferrral(e)},this),C.Events.on("C.hwh.fbConnect:success",function(e){e.productName&&"answerer"==e.productName&&(this.waitForUpdateuserinfo=!1,$(".useRealname",this.$el).val("1"),$(".userValidRealName",this.$el).val("1"),this.$answerName.find(".choose-realname").attr("selected",!0),"Your name"==this.$answerName.find(".choose-realname").text()&&e.userName&&$.trim(e.userName).length&&this.$answerName.find(".choose-realname").text(e.userName),this.$answerQuestionButton.parent().after('<div class="msg-success-sm"><div class="msg-icon"><div class="msg-text">Facebook connect was successful.</div></div></div>'),this.answererNameToggle(0,0,0,0))},this),C.Events.on("C.hwh.fbConnect:error",function(e){this.$answerQuestionButton.parent().after('<div class="msg-error-sm"><div class="msg-icon"><div class="msg-text">'+e+"</div></div></div>")},this),$(".fbconnect-container").observe("click",function(e){this.waitForUpdateuserinfo=!0},this),this.$answerName.observe("change",function(e){var t=$(e.target),i=t.val();t.nextAll("input").remove(),this.$answerQuestionButton.parent().parent().find(".msg-error-sm").remove(),this.$answerQuestionButton.prop("disabled",!1),i||this.answererNameToggle(1,0,0,0),"0"===i?(""==$(".userValidRealName",this.$el).val()?(this.waitForUpdateuserinfo=!0,this.showRealNameEntry()):this.answererNameToggle(0,0,0,0),this.$wrap.find(".current-user > img").attr("src",this.opts.userAvatar)):"1"===i&&(""==$(".userNickName",this.$el).val()&&(this.waitForUpdateuserinfo=!0),this.answererNameToggle(0,0,0,1),this.$wrap.find(".current-user > img").attr("src",this.opts.answererImage))},this),$(".realname-link",this.$el).observe("click",function(e){this.answererNameToggle(0,0,1,0)},this),this.$answererRealName3.find("a").observe("click",this.showRealNameEntry,this),this.$answererNickNameMsg.find("a").observe("click",this.showRealNameEntry,this),this.$answerQuestionButton.observe("click.answerSubmit",this.submitAnswer,this)},answererNameToggle:function(e,t,i,s){this.$answererRealName1[e?"removeClass":"addClass"]("hidden"),this.$answererRealName2[t?"removeClass":"addClass"]("hidden"),this.$answererRealName3[i?"removeClass":"addClass"]("hidden"),this.$answererNickNameMsg[s?"removeClass":"addClass"]("hidden")},showRealNameEntry:function(){this.$answerName.val("0"),this.answererNameToggle(0,1,0,0),this.addWidget(new C.widget.popup({el:".answer-form .fbconnect-container",content:$(".fbconnect-popup",this.$el).clone().removeClass("hidden"),width:180,side:"bottom",padding:15,autoCenter:!0}))},validateAndPost:function(){var e=this.getTextareaOrMceContent(),t=e.length,i;return $(".santizedAnswer",this.$el).val(e),this.$answerQuestionButton.parent().parent().find(".msg-error-sm").remove(),t<2?(this.$answerQuestionButton.parent().after('<div class="msg-error-sm"><div class="msg-icon"><div class="msg-text">Answer cannot be empty<span class="msg-close"></span></div></div></div>'),!1):this.validateName()?(this.$answerQuestionButton.parent().after('<div class="msg-error-sm"><div class="msg-icon"><div class="msg-text">What name do you want to answer with?<span class="msg-close"></span></div></div></div>'),!1):65e3<t?(this.$answerQuestionButton.parent().after('<div class="msg-error-sm"><div class="msg-icon"><div class="msg-text">Answer cannot be longer than 65,000 characters<span class="msg-close"></span></div></div></div>'),!1):(regexValidUTF8Char=new RegExp(/^([\x00-\x7F]|[\xC2-\xDF][\x80-\xBF]|\xE0[\xA0-\xBF][\x80-\xBF]|[\xE1-\xEC\xEE\xEF][\x80-\xBF]{2}|\xED[\x80-\x9F][\x80-\xBF]|\xF0[\x90-\xBF][\x80-\xBF]{2}|[\xF1-\xF3][\x80-\xBF]{3}|\xF4[\x80-\x8F][\x80-\xBF]{2})*$/),regexValidUTF8Char.test(e)?void this.postValidAnswerData():(this.$answerQuestionButton.parent().after('<div class="msg-error-sm"><div class="msg-icon"><div class="msg-text">We detected some special characters in the answer body, which are not supported at this time. Please edit your answer and retry submitting.</div></div></div>'),!1))},expandEditor:function(){this.$wrap.hasClass("collapsed")&&this.$wrap.removeClass("collapsed")},getTextareaOrMceContent:function(){var e=this.$answerInput.val();return $.trim(e)?e.length<3?"":this.$answerInput.val():(AndroidAnswerBody=tinyMCE.get("answer_editor").getContent(),$.trim(AndroidAnswerBody)?AndroidAnswerBody.length<3?"":AndroidAnswerBody:void 0)},postValidAnswerData:function(){this.$answerQuestionButton.off(".answerSubmit"),this.$answerQuestionButton.html('<canvas class="loading" width="20" height="20"><img src="/s/_global/images/ajax-loader.gif"></canvas>');var e=this.$answerQuestionButton.find("canvas.loading");e.css({top:"4px"}),new C.widget.spinner({canvas:e,color:"#ffffff"});var t=C.utility.serializeFormToJson(this.$answerForm),i=this;this.addAPITokenTo(t),$.ajax({type:"POST",dataType:"json",url:"/_ajax/questions/answer",data:t,success:function(e){$.proxy(i.answerQuestionSuccess(e),i)},error:function(e){$.proxy(i.answerQuestionError(e),i)}})},answerQuestionSuccess:function(e){null!=e&&411!=e&&417!=e&&412!=e.code&&404!=e?(this.$answerForm.find('input[name="answerId"]').val(""),C.utility.refresh()):this.answerQuestionError(e)},answerQuestionError:function(e){this.$answerQuestionButton.html("Answer");var t="We are unable to post your answer at this time.  Please try again later";411==e?t="Sorry! It looks like your answer is extremely short. Please include more details or elaborate further on your answer--remember, your efforts are going to a student who needs academic assistance, and the more detailed you are, the better they'll be able to learn. Thank you for your efforts!":417==e?t="Sorry, it seems like your answer matches the question that was asked. Please rephrase your answer and try again.":404==e?t="The answer you are trying to edit is already deleted by you.":412==e.code?t="Sorry, we have detected use of an inappropriate word or phrase <strong>"+e.result+"</strong> Please edit and try again":$(".captcha-img").length&&e.responseText&&($(".captcha-img").attr("src","/captcha"),$(".captcha-field").val(""),t="The text entered does not match the image. Please try again."),this.$answerQuestionButton.observe("click.answerSubmit",function(e){$(".answer-error").remove(),this.submitAnswer(e)},this);var i,s=$('<div class="msg-error-sm answer-error" style="display: none;"><div class="msg-icon"><div class="msg-text">'+t+"</div></div></div>");this.$el.append(s),s.fadeIn(500)},submitAnswer:function(e){e.preventDefault(),e.stopPropagation();var t=$("input[name=qid]").val();C.log("QID: "+t),C.logger.doEventLog(C.logs.events.qa.onClickAnswer(t,this.opts.subscription_type)),$.post("/_ajax/log/php",{answer:"end",qid:this.questionId}),this.EggshellEditor.trigger("update container"),this.waitForUpdateuserinfo?this.updateUserInfo():this.validateAndPost()},validateName:function(){var e=this.$answerName.val();return"0"===e&&"1"==$(".userValidRealName",this.$el).val()?($(".useRealname",this.$el).val("1"),!1):"1"!==e||"1"!=$(".userNickName",this.$el).val()||($(".useRealname",this.$el).val(""),!1)},updateUserInfo:function(){var e={},t,i,s,o=$(".realNameInput",this.$el),n=$(".nickNameInput",this.$el);if(e.fname=e.lname=e.nickname="","0"===this.$answerName.val()&&2==o.length){if(t=$.trim($(o[0]).val()),i=$.trim($(o[1]).val()),!t.length&&!i.length)return this.$answerQuestionButton.parent().parent().find(".msg-error-sm").remove(),this.$answerQuestionButton.parent().after('<div class="msg-error-sm"><div class="msg-icon"><div class="msg-text">Please enter valid name<span class="msg-close"></span></div></div></div>'),!1;$(".useRealname",this.$el).val("1"),e.fname=t,e.lname=i}else if("1"===this.$answerName.val()&&0<n.length){if(!(s=n.val()).length)return this.$answerQuestionButton.parent().parent().find(".msg-error-sm").remove(),this.$answerQuestionButton.parent().after('<div class="msg-error-sm"><div class="msg-icon"><div class="msg-text">Please enter valid name<span class="msg-close"></span></div></div></div>'),!1;$(".useRealname",this.$el).val(""),e.nickname=s}$.ajax({context:this,url:"/_ajax/questions/createname",dataType:"json",type:"post",data:{user:e,token:C.global.csrfToken},success:function(e){"pass"==e.results?(s&&s.length?$(".userNickName",this.$el).val("1"):$(".userValidRealName",this.$el).val("1"),this.waitForUpdateuserinfo=!1,this.validateAndPost()):e.results?e.errors&&(this.$answerQuestionButton.parent().parent().find(".msg-error-sm").remove(),this.$answerQuestionButton.parent().after('<div class="msg-error-sm"><div class="msg-icon"><div class="msg-text">'+e.errors[0].message+'<span class="msg-close"></span></div></div></div>')):(this.$answerQuestionButton.parent().parent().find(".msg-error-sm").remove(),this.$answerQuestionButton.parent().after('<div class="msg-error-sm"><div class="msg-icon"><div class="msg-text">An error occurred while updating name. Please try again after some time.<span class="msg-close"></span></div></div></div>'))},error:function(e){this.$answerQuestionButton.parent().parent().find(".msg-error-sm").remove(),this.$answerQuestionButton.parent().after('<div class="msg-error-sm"><div class="msg-icon"><div class="msg-text">An error occurred while updating name. Please try again after some time.<span class="msg-close"></span></div></div></div>')}})},addAPITokenTo:function(e){e.token=C.global.csrfToken},signInAnswerReferrral:function(e){e.preventDefault(),e.stopPropagation();var t="/login/?redirect="+encodeURIComponent(top.location);top.location=t},destruct:function(){$(this.mceId).remove(),this.$el.remove()}}),C("widget"),C.widget.avatarCommenting=C.widget._base.extend({construct:function(e){if(this.opts=$.extend({},e),this.opts.el){this.$el=this.opts.el.jquery?this.opts.el:$(this.opts.el),this.postCommentUrl="/_ajax/questions/postqacomment",this.MAX_CHAR=400,this.textAreaChangeEvents=["keyup","change","paste","input"],this.$textarea=this.$el.find("textarea"),this.$btnContainer=this.$el.find(".button-wrap"),this.$errorJEl=this.$btnContainer.find(".msg-error-sm"),this.$postButton=this.$el.find(".btn-secondary-mini"),this.$commentsList=this.$el.siblings(".comments-list"),this.$showAllComments=this.$commentsList.find(".show-all-comments");var t=this.$textarea.attr("placeholder");this.$textarea.placeholder(t),this.$textarea.autoResize(),this.$textarea.observe("focus blur",this.togglePostBtn,this),this.$textarea.observe("keyup change paste input",this.validateComment,this),this.$postButton.observe("click",this.postComment,this),0<this.$showAllComments.length&&this.$showAllComments.observe("click",this.showAllHiddenComments,this),this.$el.parents(".comment-box").observe("click",".delete-user-comment",this.deleteCommentModal,this),this.$el.parents(".comment-box").observe("click",".edit-user-comment",this.editUserComment,this),this.commentingDisabled=!!$(".nonUS")[0],this.commentingDisabled&&this.$textarea.val("Sorry, answering is currently not available for your account.").prop("disabled",!0),this.showCommentBox()}},editUserComment:function(e){var t=$(e.currentTarget).attr("data-id"),i=this;this.$textarea.attr("data-edit-id",t).val($.trim($(e.currentTarget).siblings(".comment-text").text())).addClass("bg-pulse").focus(),this.$el.removeClass("no-error").addClass("active"),this.$postButton.html("Edit comment"),setTimeout(function(){i.$textarea.removeClass("bg-pulse")},500)},showCommentBox:function(){$(document).observe("click",".show-comment-box",function(e){var t=$(e.currentTarget),i=t.next(".avatar-comments"),s=t.text().trim(),o=t.find("span.icon-chegg-chevron"),n=t.find("span.comment-link-title"),a;e.preventDefault(),-1!==s.indexOf("Hide")?(a=s.replace("Hide","View"),i.slideUp(400,function(){n.text(a),o.addClass("rotate-270")})):(a=-1!==s.indexOf("View")?s.replace("View","Hide"):"Hide comments",i.slideDown(300,function(){i.removeClass("hide"),o.removeClass("rotate-270"),n.text(a)}))},this)},togglePostBtn:function(e){this.$el.removeClass("no-error").addClass("active"),this.$textarea.val()||(this.$postButton[0].disabled=!0)},validateComment:function(e){this.$errorJEl=this.$btnContainer.find(".msg-error-sm");var t=0!=this.$errorJEl.length,i=this.$textarea.val().length,s=this.$textarea.val().trim().length;if(i>this.MAX_CHAR){if(!t){var o='<div class="msg-error-sm"><div class="msg-icon"><div class="msg-text">Comments are limited to '+this.MAX_CHAR+" characters</div></div></div>";this.$btnContainer.append(o),this.$el.addClass("has-error").removeClass("no-error")}}else t&&(this.$errorJEl.remove(),this.$el.removeClass("has-error").addClass("no-error"));this.$el.find(".btn-secondary-mini")[0].disabled=i>this.MAX_CHAR||0==s},deleteCommentModal:function(e){var t=$(e.currentTarget),i='<div class="dialog-4"><div class="dialog-hdr"><h2 class="dialog-title">Delete comment</h2><div class="dialog-close-wrapper"><button class="btn-secondary-sm chg-dialog-close"><span class="icn-cross">Close</span></button></div></div><div class="dialog-content"><section><p>Are you sure you want to delete this comment?</p></section></div><div class="dialog-ftr"><button class="chg-btn btn-secondary-sm chg-dialog-close">Cancel</button> <button class="chg-btn btn-primary-sm chg-dialog-close deleteComment" data-id="'+t.attr("data-id")+'" data-type="'+t.attr("data-type")+'">Yes, delete</button></div></div>';this.addWidget(new C.widget.dialog({content:i,destroyOnClose:!0})),$(".deleteComment").observe("click",this.deleteComment,this)},deleteComment:function(e){var t=$(e.currentTarget);$.ajax({type:"post",url:"/_ajax/hwh/delete",dataType:"json",data:{id:t.attr("data-id"),type:t.attr("data-type"),token:C.global.csrfToken},success:function(){}}),$("[data-id="+t.attr("data-id")+"]").parent().remove()},postComment:function(e){e.preventDefault();var h=new Object,t=this.$el.parents(".answer");if(0<t.length?(h.type="Answer",h.itemId=t.attr("data-commentingId")):(t=this.$el.parents(".question"),h.type="Question",h.itemId=this.$el.parents(".question").attr("data-commentingId")),this.addAPITokenTo(h),h.text=this.$textarea.val(),h.text.length<=this.MAX_CHAR&&0<h.text.trim().length){if(this.$el.css({opacity:.5}),this.$postButton[0].disabled=!0,this.$textarea[0].disabled=!0,this.$textarea.attr("data-edit-id")){h.itemId=this.$textarea.attr("data-edit-id");var i=this;return void $.ajax({type:"POST",url:"/_ajax/questions/updatecomment",data:h,success:function(e){e.success?C.utility.refresh():400==e.code&&i.showProfanityErrorPopup(e)},error:function(){C.utility.refresh()}})}$.post(this.postCommentUrl,h,$.proxy(function(e,t,i){if(e.success){var s=$('<li><img class="chg-shadow avatar" src="'+this.$el.find("img").attr("src")+'" /><span class="txt-small-bold">You commented</span><p class="comment-text">'+h.text+"</p></li>");s.css({overflow:"hidden",opacity:0,height:0}),this.$el.parents(".avatar-comments").find(".comments-list").append(s);var o=s.css("paddingTop"),n=s.css("paddingBottom");s.css({paddingTop:0,paddingBottom:0});var a=s[0].scrollHeight;s.css({paddingTop:o,paddingBottom:n});var r=300,l=200;this.shouldUseTransitions()?($.each(["transition","WebkitTransition","OTransition","msTransition"],function(e,t){s.css(t,"height 300ms, opacity 200ms")}),s.bind("transitionend webkitTransitionEnd oTransitionEnd",function(){s[0].style.opacity=1}),s[0].style.height=a+"px"):s.animate({height:a+"px"},r,"linear",function(){s.animate({opacity:1},l)}),this.$postButton[0].disabled=!1,this.$textarea[0].disabled=!1,this.$textarea.val("").trigger("blur").trigger("keyup"),this.$el.css({opacity:1});var c=this.$commentsList.find(".comment-count");if(c.length){var d=parseInt(c.html(),10);d+=1,c.html(d)}}else this.showProfanityErrorPopup(e)},this))}},showProfanityErrorPopup:function(e){if(400==e.code)var t=Eggshell.create("C.common.dialog").trigger("set headline","").trigger("set content html",'<div class="msg-error-sm msg-contextual">Sorry, we have detected use of an inappropriate word or phrases. Please edit your submission and try again</div>').trigger("enable default control").trigger("set primary button","OK").on("primary button clicked",function(){t.trigger("hide")},this);this.$postButton[0].disabled=!1,this.$textarea[0].disabled=!1,this.$el.css({opacity:1})},addAPITokenTo:function(e){e.token=C.global.csrfToken},showAllHiddenComments:function(){var e;this.$commentsList.find("li.hidden").css({opacity:0}).removeClass("hidden").animate({opacity:1},250),this.$showAllComments.remove()},shouldUseTransitions:function(){var e,t=(document.body||document.documentElement).style,i;if("string"==typeof t[i="transition"])return!0;for(var s=["Webkit","Khtml","O","ms"],i=i.charAt(0).toUpperCase()+i.substr(1),o=0;o<s.length;o++)if("string"==typeof t[s[o]+i])return!0;return!1}}),C("widget"),C.widget.hwhContentModerator=C.widget._base.extend({construct:function(e){this.buildPopup(),this.doBind()},doBind:function(){$(".delete-post-button").observe("click",function(e){var t=$(e.currentTarget),i=t.attr("data-type"),s=t.attr("data-id"),o=t.attr("data-extra-id"),n=t.attr("slnid"),a={id:s,type:i,token:C.global.csrfToken,slnid:n};o&&(a.id_extra=o),$current_comment_count=$("#solutions_comment"+n).html(),$.ajax({type:"post",dataType:"json",url:"/_ajax/hwh/delete",data:a,context:this,success:function(){$("#solutions_comment"+n).html($current_comment_count-1)}}),t.parents("li").eq(0).remove()},this)},buildPopup:function(){var e=this,t;$(".content-moderation-view").length&&(t=$(".abuse-flag:not(.flag-proc)").addClass("flag-proc"),$('<span class="moderator-details" tabindex="0">Details</span>').insertAfter(t).each(function(){var s=$(this).parent().parent().parent().find(".content-moderation").html(),e=Eggshell.create("C.common.overlay.tooltip").on("return tooltip content node",function(e,t){var i;t.html(s)}).trigger("set target",$(this)).trigger("get tooltip content node").trigger("set tooltip above target")}))}}),C("widget"),C.widget.userNicknameModal=C.widget._base.extend({construct:function(e){this.$root=C.dom.$root,this.$window=C.dom.$window,this.$root.length&&this.$window.length&&(this.opts=$.extend({suggestedNicknames:[],jQueryContextObject:null,nicknameModalTrigger:null},e),this.opts.jQueryContextObject&&this.setElem(this.opts.jQueryContextObject))},setup:function(){this.$nameSelector=$(".name-row",this.$elem),this.generateMarkup(),this.bindEvents()},setElem:function(e){this.$elem=e,this.setup()},bindEvents:function(){this.$nicknameLink=$(".nickname-link"),this.$nicknameLink.observe("click",function(e){this.initUserNicknameModal()},this),this.$nameDropdown=$(".name-dropdown"),this.$nameDropdownContent=$(".name-dropdown-content"),this.$nameRows=$(".name-row"),this.$nameTxt=$(".name-txt"),this.$useRealnameHiddenField=$(".useRealname"),this.$userValidRealName=$(".userValidRealName"),this.$nameDropdown.observe("click",this.handleNameDropdownClick,this),this.$nameRows.observe("click",this.handleNameDropdownItemClick,this),this.$nameRows.observe("hover",this.handleNameDropdownItemHover,this),this.$nameRows.length&&this.$nameRows.eq(0).click()},renderModal:function(){var e=$("#nickname_modal").html();if(e.length){var t={content:e},i;return new C.widget.dialog(t)}},generateMarkup:function(){var e=this.opts.suggestedNicknames,t=e[0],i=["<ul>"],s=0;for(var o in e)1!==++s&&(i.push('<li><a href="#" class="alt-suggestion">'),i.push(e[o]),i.push("</a></li>"));i.push("</ul>");var n=i.join("");this.dialogHtml='<script type="text/x-jquery-tmpl" id="nickname_modal"><div class="dialog-1 mu-modal" id="user_nickname_modal"><div class="dialog-hdr"><h2 class="dialog-title">What do you want your nickname to be?</h2><div class="dialog-close-wrapper"><button type="icon" class="icon btn-secondary-sm chg-dialog-close"><span class="icn-cross">Close</span></button></div></div><div class="dialog-content"><section><div class="modal-copy"><p class="txt-3-bold" id="nickname_top_msg">How about&#8230;</p><div class="ss-dropdown"><input type="text" name="nickname" id="nickname_input" value="'+t+'" ></div><div class="alt-suggestions"><span class="txt-3-bold">More suggestions&#8230;</span>'+n+'</div></div></section></div><div class="dialog-ftr"><div id="nickname_bottom_msg"></div><button id="nickname_create" type="button" class="chg-btn btn-primary-sm" href="#">Create nickname</button></div></div><\/script>',C.dom.$body.append($(this.dialogHtml))},validateName:function(){return!1},addAPITokenTo:function(e){e.token=C.global.csrfToken},sendUserNicknameAjax:function(){var e=this,t=$("#user_nickname_modal"),i={nickname:$("#nickname_input",t).val()};this.addAPITokenTo(i),$.ajax({type:"POST",dataType:"json",url:"/_ajax/user/usernicknameset",data:i,success:$.proxy(this.processValidNickname,e),error:$.proxy(this.processNicknameError,e)})},processValidNickname:function(e){var t=$("#user_nickname_modal"),i=$("#nickname_input",t).val(),s;$(".chg-dialog-close",t).click(),this.setupNicknameDropdownInput(i)},processNicknameError:function(e){var t=$("#user_nickname_modal"),i,s=$("#nickname_bottom_msg",t).removeClass("msg-error-sm msg-success-sm").addClass("msg-error-sm").html('<div class="msg-icon"><div class="msg-text"></div></div>').find(".msg-text"),o=$(".alt-suggestion",t),n=$("#nickname_create",t),a=$("#nickname_input",t),r=e.statusText?e.statusText.replace(/^Error: /,""):"An error has occurred creating your nickname. Please try again.";o.slideDown(200),n.html("Create nickname"),a.prop("disabled",!1),s.html(r)},setupNicknameDropdownInput:function(e){$(".name-dropdown .name-txt").html(e),$nickname=$(".name-dropdown-content .nickname"),$nickname.html(e),$nickname.removeClass("hidden"),$(".name-dropdown-content .nickname-link").addClass("hidden"),$nickname.click()},initUserNicknameModal:function(){if(this.$nicknameDialog)this.$nicknameDialog.showDialog();else{this.$nicknameDialog=this.renderModal();var s=$("#nickname_top_msg"),e=$("#nickname__bottom_msg"),o=$("#nickname_input"),n=$(".alt-suggestion"),t=$("#nickname_create"),a=o.val(),r=[a],l=null;n.each(function(){r.push($(this).html())}),o.observe("blur.nickname",function(e){var t=$(e.target);0===t.val().length&&(l=setTimeout(function(){s.html("How about&#8230;"),t.val(a)},150))},this),o.observe("focus",function(e){var t=o.val();if(0<=$.inArray(t,r)){var i='Or create your own: <span class="txt-3-small">(Nickname must be at least 6 characters and alphanumeric)</span>';s.html(i)}},this),n.observe("click",function(e){var t,i=$(e.target).html();e.preventDefault(),e.stopPropagation(),a=i,l&&clearInterval(l),s.html("How about&#8230;"),o.val(i),c(i)},this),t.observe("click",function(e){e.preventDefault(),e.stopPropagation();var t=$("#nickname_create");t.html('<canvas class="loading" width="20" height="20"><img src="/s/_global/images/ajax-loader.gif"></canvas>');var i=t.find("canvas.loading");i.css({top:"4px"}),new C.widget.spinner({canvas:i,color:"#ffffff"}),n.slideUp(200),o.attr("disabled","true"),this.sendUserNicknameAjax()},this)}function c(t){var i=r.slice();n.each(function(){var e=i.shift();e==t&&(a=e,e=i.shift()),$(this).html(e)})}},handleNameDropdownClick:function(e){$(e.target).parents(".disable-shade-out").length||(this.$nameDropdown.hasClass("selected")?(this.$nameDropdown.removeClass("selected"),this.$nameDropdownContent.addClass("hidden")):(this.$nameDropdown.addClass("selected"),this.$nameDropdownContent.removeClass("hidden")))},handleNameDropdownItemClick:function(e){this.$nameRows.removeClass("selected");var t=$(e.target);t.addClass("selected"),this.$nameTxt.html(t.html()),this.$nameDropdown.removeClass("selected"),this.$nameDropdownContent.addClass("hidden"),this.$useRealnameHiddenField.val(t.hasClass("nickname")?0:1)},handleNameDropdownItemHover:function(e){var t;this.$nameRows.removeClass("hover").removeClass("selected"),$(e.target).addClass("hover")},selectNameByValue:function(s){var e=this.$nameRows;$.each(e,function(e,t){var i=$(this);$.trim(i.text())==s&&i.click()})},destruct:function(){}}),C("widget"),C.widget.messages=C.widget._base.extend({construct:function(e){this.opts=$.extend({topOffset:100,leftOffset:0,content:"Success!",fadeDuration:600,close:!0,closeDelay:2500,type:"success"},e),this.opts.relativeTo?this.$relativeTo=this.opts.relativeTo.jQuery?this.opts.relativeTo:$(this.opts.relativeTo):this.$relativeTo=C.dom.$body,this.doSetup()},doSetup:function(){this.getMessageContainer(),this.$msg.appendTo(C.dom.$root),this.positionMessage(),this.closeMessage()},getMessageContainer:function(){var e='<div class="msg-'+this.opts.type+'" id="message-'+this.instanceNumber+'">'+this.opts.content+"</div>";this.$msg=$(e)},positionMessage:function(){var e=this.$relativeTo.offset(),t=this.$relativeTo.outerWidth(),i=this.$relativeTo.outerHeight(),s=this.$msg.outerWidth();this.$msg.css({position:"absolute",top:e.top+this.opts.topOffset+"px",left:e.left+t/2-s/2+"px","z-index":C.utility.getMaxIndex()+1})},closeMessage:function(){this.opts.close&&setTimeout($.proxy(function(){this.$msg.fadeOut(this.opts.fadeDuration)},this),this.opts.closeDelay)},destruct:function(){}}),C("widget"),C.widget.areYouSure=C.widget._base.extend({construct:function(e){this.options=e||{},this.options.title=e.title||"Are you sure you want to take this action?",this.options.hdr=e.hdr||"",this.options.details=e.details||"",this.options.primaryBtnTxt=e.primaryBtnTxt||"Yes, continue",this.options.secondaryBtnTxt=e.secondaryBtnTxt||"Cancel",this.options.dataId="",this.options.dataType="",this.dialog=new C.widget.dialog({content:this.getMarkup()}),this.addWidget(this.dialog)},getMarkup:function(){var e=this.options;return'<div class="dialog-4"><div class="dialog-hdr"><h2 class="dialog-title dialog-title-black">'+e.title+'</h2><div class="dialog-close-wrapper"><button class="btn-secondary-sm chg-dialog-close"><span class="icn-cross">Close</span></button></div></div><div class="dialog-content clearfix"><h3 class="txt-hdr-sec">'+e.hdr+'</h3>\x3c!--<div class="mod-box">--\x3e       <div class="details clearfix">'+e.details+'       </div>\x3c!--</div>--\x3e</div><div class="dialog-ftr"><button class="chg-btn btn-secondary-sm chg-dialog-close">'+e.secondaryBtnTxt+'</button>&nbsp;&nbsp;<button class="chg-btn btn-primary-sm chg-dialog-close">'+e.primaryBtnTxt+"</button></div></div>"},destruct:function(){}}),C("widget"),C.widget.hwhConfirmDialog=C.widget._base.extend({construct:function(e){var t=!1;this.opts=e,this.finalUrl=window.location.href,this.addCourseButton=null,this.opts.orderKey&&this.showConfirmationDialog(),this.$courseAutocomplete=new C.widget.hwhCourseAutoComplete({addMultiple:!1,addCourseBtn:this.addCourseButton,successCallback:$.proxy(this.courseSuccess,this)}),this.addWidget(this.$courseAutocomplete)},destruct:function(){this.dialog.destroy()},showConfirmationDialog:function(){var e,t,i=window.location.href.split("token=")[0],s='<p class="f-size-04 txt-body-bold">What course do you need help with?</p> <p>Find guided textbook solutions, questions from classmates, and answers by Chegg Experts to your course. <p/><br/><input type="text" name="course" class="addCourseInput">',o='Your order <a href="'+C.global.liveSiteUrl+"my/order/"+this.opts.orderKey+'" data-noajax>#'+this.opts.orderKey+"</a> has been placed.",n=this.opts.isHighSchoolStudent?"OK":"Add course";this.finalUrl=i.substring(0,i.length-1),this.dialog=Eggshell.create("C.Eggshell.dialog").trigger("set headline","Welcome to Chegg Study!").trigger("set sub headline",o).trigger("enable default control").trigger("set primary button",n).trigger("hide secondary button").trigger("hide icon").trigger("show").on("close button clicked",function(e){window.location.href=this.finalUrl},this),this.opts.isHighSchoolStudent?this.dialog.on("primary button clicked",function(e){window.location.href=this.finalUrl},this):this.dialog.trigger("set content html",s).on("control area",$.proxy(function(e,t){this.addCourseButton=t.find(".primary.btn-primary-sm")},this)).trigger("get control area")},courseSuccess:function(e){this.opts.orderKey&&(C.utility.showSpinner(),C.utility.navigate(this.finalUrl))}}),C("profile.form"),C.profile.form.picview=C.View.extend({tagName:"div",className:"dialog-4",objName:"C.profile.form.picview",dialogTmpl:_.template('<div class="dialog-hdr"><h2 class="dialog-title">Edit Profile Picture</h2><div class="dialog-close-wrapper"><button class="btn-secondary-sm chg-dialog-close"><span class="icn-cross">Close</span></button></div></div><div class="dialog-content"><section><div class="pl-upload-box clearfix"><div class="pl-upload-inner pl-image-div" data-id="poppicture"></div><div class="pl-upload-inner pl-upload-inner-right"><div data-panel="control" ><button class="chg-btn btn-primary-sm lg-button" data-action="save" style="display:none;">Save photo</button><form action="/_ajax/profile/picture/" method="post" enctype="multipart/form-data"><input type="file" name="myfile" id="uploadFile" data-action="uploadfile" style="position: absolute;left: -9999px;" ><label for="uploadFile" data-type="button" class="chg-btn btn-primary-sm lg-button upload-space" data-action="upload">Upload New Photo</label></form><button class="chg-btn btn-secondary-sm lg-button delete-space" data-action="confirmdelete">Delete photo</button><button class="chg-btn btn-secondary-sm chg-dialog-close sm-button">Cancel</button></div><div data-panel="delete" style="display:none;"><br/><br/><p class="txt-sec-dark">Are you sure you want to delete the photo?</p><br/><br/><button class="chg-btn btn-secondary-sm sm-button" data-action="deletecancel">Cancel</button>&nbsp;&nbsp;&nbsp;<button class="chg-btn btn-primary-sm sm-button" data-action="delete">Delete photo</button></div></div></div></section></div>'),events:{"click [data-action=edit]":"editPhoto","click [data-action=delete]":"deletePhoto","click [data-action=confirmdelete], [data-action=deletecancel]":"deleteswitch","click [data-action=save]":"save"},deleteswitch:function(){this.$("[data-panel=control], [data-panel=delete]").toggle()},openFile:function(){},render:function(){this.$el.empty(),this.img=$('<img id="cropableimg" />'),this.updateImg(this.options.origin.attr("src")),this.$el.append(this.dialogTmpl()),this.$("[data-id=poppicture]").append(this.img);var s=this;return this.$("#uploadFile").change(function(e){var t,i;e.preventDefault(),setTimeout((t=this.form,i=s,function(){$(t).ajaxSubmit({data:{token:C.global.csrfToken},beforeSerialize:$.proxy(i.beforeSerialize,i),beforeSend:i.setupProgressBar,uploadProgress:i.uploadProgress,success:i.updatePhoto,error:i.enableUpload,dataType:"json",context:i})}),1e3)}),this.setElement(this.$el),this.isShowEditButton||this.$("[data-action=confirmdelete]").attr("disabled",!0),this},updateImg:function(e){this.img.attr("src",e)},editPhoto:function(){this.jcrop_api=$.Jcrop("#cropableimg",{aspectRatio:1}),this.jcrop_api.setSelect([55,20,167,170]),this.$(".pl-upload-inner button").toggle()},deletePhoto:function(){var e=this,t=this.options.origin;if(null==this.newdata&&(this.options.answererImage?$.post("/_ajax/questions/answer/answererinfo",{updateimage:"delete",answeredWithNickname:this.options.answeredWithNickname,token:C.global.csrfToken},function(){e.options.refreshAfterSave&&C.utility.refresh()}):$.post("/_ajax/profile/update",{updateimage:"delete",token:C.global.csrfToken}),this.$(".chg-dialog-close:first").trigger("click"),t.trigger("profile.defaultImage")),this.updateImg(t.attr("src")),this.options.answererImage){var i=this.getDefaultImage();this.updateImg(i),$(".answerer-pic").attr("src",i),$(".answerer-photo").attr("src",i),$(".dialog-photo").attr("src",i)}this.newdata=null,this.deleteswitch(),this.$("[data-action=confirmdelete]").attr("disabled",!0),this.isShowEditButton=!1},getDefaultImage:function(){var e="/s/profile/images/avatar_unisex.png",t="/s/profile/images/avatar_male.png",i="/s/profile/images/avatar_female.png",s;switch(this.options.gender?this.options.gender.toLowerCase():""){case"male":return t;case"female":return i;default:return e}},destroyEdit:function(){null!=this.jcrop_api&&(this.jcrop_api.destroy(),this.jcrop_api=null)},beforeSerialize:function(){var e;if(!$.browser.msie&&2<$("#uploadFile")[0].files[0].size/1024/1024)return alert("It looks like your photo is too big. Try one under 2MB."),!1;var t=this.$("#uploadFile").val(),i,s=t.substring(t.lastIndexOf(".")+1).toLowerCase();return"gif"==s||"png"==s||"jpg"==s||"jpeg"==s||(alert("Please upload a JPG, PNG or GIF image"),!1)},setupProgressBar:function(){this.$("button").attr("disabled",!0),this.$("[data-action=upload]").text("Loading...")},uploadProgress:function(){},enableUpload:function(){this.$("button").attr("disabled",!1),this.$("[data-action=upload]").text("Upload New Photo")},updatePhoto:function(e){this.enableUpload(),this.updateImg(e.location),this.$("[data-action=save]").show(),this.$("button").attr("disabled",!1),this.newdata=e},save:function(){var e=this,t=null;this.$("[data-action=save]").hide();var i=this.options.origin;i.attr("src",this.newdata.location),i.trigger("profile.updateImage"),this.options.answererImage?(t=this.options.answeredWithNickname?this.newdata.location:this.newdata.uuid,$.post("/_ajax/questions/answer/answererinfo",{updateimage:t,answeredWithNickname:this.options.answeredWithNickname,token:C.global.csrfToken},function(){e.options.refreshAfterSave&&C.utility.refresh()}),$(".upload-photo-btn").html("Change photo"),$(".answerer-pic").attr("src",this.newdata.location),$(".answerer-photo").attr("src",this.newdata.location),$(".dialog-photo").attr("src",this.newdata.location)):$.post("/_ajax/profile/update",{updateimage:this.newdata.uuid,token:C.global.csrfToken}),this.newdata=null,this.$(".chg-dialog-close:first").trigger("click")},showEditButton:function(e){this.isShowEditButton=e}}),C("page"),C.page.homeworkhelp_question=C.page._base.extend({construct:function(e){this.opts=e,this.answerEditors=[],this.commentForms=[],this.maxBioChars=75,this.textMeAppTooltip=null,this.userNicknameModal=new C.widget.userNicknameModal({suggestedNicknames:this.opts.suggestedNicknames}),this.doVideoWalkthoughLogic(),this.addWidget(this.userNicknameModal),this.renderExpertAnswerTooltip(),this.answerEditorRestriction(),this.wireAnswerEditors(),this.wireAvatarCommenting(),this.wireAskerStatsPopup(),this.wireAnswererStatsPopup(),this.wireModeratorTooltip(),this.doMobileAppPromoLogic(),this.displayQuestionPurchaseMsg(),this.displayBundleBanner(),this.hwhContentModerator=new C.widget.hwhContentModerator({}),this.addWidget(this.hwhContentModerator),this.doPracticeTopicLogic(),this.doUnCancelBanner();var t=this.opts.accountSharingInfo;if("ACCOUNT_SUSPICIOUS"===t){var i=document.querySelector(".chg-container-content"),s="cs-as-warn",o=document.createElement("div");o.id=s,o.setAttribute("aria-live","polite"),o.setAttribute("role","status"),i.parentElement.insertBefore(o,i),Eggshell.create("C.common.csaccountsharing.warn",{el:document.getElementById(s),source:"/web/study/qa"}),this.doOrganizeBanners()}else"ACCOUNT_FLAGGED"===t&&Eggshell.create("C.common.accountsharing.block",{source:"/web/study/qa"});C.log("accountSharingInfo",t),this.addWidget(new C.widget.freemiumUser),$(".fbconnect-container").html((new C.hwh.FBconnectView).render().$el),this.wireEditAnswerLink(),this.wireRemoveAnswerLink(),this.setupAnsweringTips(),this.initScroll(),this.editPhotoBio(),this.doAnswerRating(),this.wireMoreAnswers(),this.doClickEvents(),this.handleMathJaxFrame(),C.utility.setLocal("resubscribe_order_started",!1),this.opts.showResubscribeModal&&this.wireResubscribeModal(),this.scrollCSContainer(),this.triggerQnaAutoSuggest(),this.triggerHeaderExpandSearchBox(),this.removeImageStyling(),this.toggleTranscribedText(),this.toggleTranscribedTextSEO(),this.initInlineEditor(),this.disableEditorBox(),this.opts.hasHomeworkHelpSubscription||(this.listenToNewQuestionMessageLink(),this.testQnaToTbsSearch()),this.doEnhancedContent(),this.wireECDuplicateQuestionsButton(),setTimeout($.proxy(this.wireRecommendedQuestions(),this),0),this.opts.hasHomeworkHelpSubscription&&this.doRightRail(),this.createBookmarkTooltip(),this.doBookmarkCountTooltip(),this.wireFastTrackEA(),this.removeTabIndexes(),this.ratingSocialProofClickLogging();var n=window.cev||new Events;window.cev=window.cev||n,window.cev.addEvent("searchLoad:once",$.proxy(function(e){Eggshell.create("C.common.heartbeat")},this))},doPracticeTopicLogic:function(){var e=this.opts.doEnhancedContent&&this.opts.hasHomeworkHelpSubscription,t;this.opts.practiceTopicExp&&e&&this.doPracticeOnboardingLogic()},doOrganizeBanners:function(){$(".HomeworkhelpQuestion").removeClass("adjust-top");var e=document.getElementById("uncancel-banner"),t=document.getElementById("cs-as-warn"),i;e&&t&&(i=$(e).outerHeight(),$(t).css({"margin-top":i}))},removeTabIndexes:function(){$(".rating-block").keyup(function(e){"Tab"!==e.key&&9!==e.which||$(".thumb-button.thumbs-up, .review-count.up-count").removeAttr("tabindex")})},ratingSocialProofClickLogging:function(){$(".rating-social-proof-click").on("click",function(){C.logger.doSessionLog({rating_social_proof_click:1})})},displayQuestionPurchaseMsg:function(){var e;localStorage.getItem("question_purchased")&&this.opts.isNewQuestion&&Eggshell.create("C.common.dialog").trigger("hide control").trigger("set id","purchase-question-success").trigger("set icon","icn-messaging-success-lg").trigger("set headline","Successfully purchased").trigger("set sub headline","Your question has been successfully posted").trigger("show"),localStorage.removeItem("question_purchased")},displayBundleBanner:function(){this.opts.renderBundleBanner&&Eggshell.create("C.Eggshell.bundlebanner",{element:$(".chg-body"),bannerText:this.opts.bundlePromoText,pageType:this.opts.pageTypeCall,bundleCtaUrl:this.opts.ctaBundleBannerUrl,systemMessageEnabled:this.opts.systemMessage})},doVideoWalkthoughLogic:function(){void 0!==this.opts.showVideo&&this.opts.showVideo&&($(".video-walkthrough-video").append(this.opts.videoUrl),oc.renderNestedComponent($(".video-walkthrough-video oc-component"),function(){$(".video-walkthrough-video .chg-load").remove()}))},doMobileAppPromoLogic:function(){(this.opts.renderTextMeAppBanner||this.opts.renderTextMeAppTooltip||this.opts.renderTextMeAppNewQuestionBanner)&&(oc.events.on("text-me-the-app:submitted",function(e,t){"#textmetheapp-banner"==t.parent?C.logger.doSessionLog({app_promotion_banner_submit:"qna"}):".textmetheapp-tooltip"==t.parent?C.logger.doSessionLog({text_to_app_submit:"qna"}):".post-question-photo-oc"==t.parent&&C.logger.doSessionLog({app_promotion_banner_submit:"ask"})}),oc.events.on("text-me-the-app:success",function(e,t){"#textmetheapp-banner"==t.parent?C.logger.doSessionLog({app_promotion_banner_sent:"qna"}):".textmetheapp-tooltip"==t.parent?($(".textmetheapp-tooltip .textmetheapp-tooltip-header").hide(),C.logger.doSessionLog({text_to_app_sent:"qna"})):".post-question-photo-oc"==t.parent&&C.logger.doSessionLog({app_promotion_banner_sent:"ask"})})),this.opts.renderTextMeAppBanner&&$("#textmetheapp-banner").length&&!this.opts.renderBundleBanner&&(C.logger.doSessionLog({app_promotion_banner_shown:"qna"}),$("#textmetheapp-banner").remove().prependTo(".chg-body").css({display:"inline-block"}),$("#textmetheapp-banner .close-btn").on("click",function(){C.logger.doSessionLog({app_promotion_banner_close:"qna"}),C.utility.setUserKvp("textmetheapp_banner_disabled",1),$("#textmetheapp-banner").remove()}),$(".textmetheapp-banner-button").on("click",function(e){e.preventDefault(),C.logger.doSessionLog({app_promotion_banner_click:"qna"}),$(e.currentTarget).remove(),$("#textmetheapp-oc").prop("style",!1)})),this.opts.renderTextMeAppNewQuestionBanner&&(C.logger.doSessionLog({app_promotion_banner_shown:"ask"}),$(".post-question-textmeapp-button").on("click",function(e){C.logger.doSessionLog({app_promotion_banner_click:"ask"}),$(e.currentTarget).remove(),$(".post-question-photo-oc").prop("style",!1)})),this.opts.renderTextMeAppTooltip&&($(".question-toolbar .icon-text-me-app").on("click",$.proxy(function(){C.logger.doSessionLog({text_to_app_click:"qna"}),this.textMeAppTooltip.trigger("toggle")},this)),this.textMeAppTooltip=Eggshell.create("C.common.overlay.tooltip").on("return tooltip content node",$.proxy(function(e,t){t.append('<div class="textmetheapp-tooltip"></div>'),$(".textmetheapp-tooltip").html('<span class="textmetheapp-tooltip-header">Text yourself this solution</span><oc-component href="'+this.opts.textMeAppTooltipOc+"&layout=standalone&elem="+encodeURIComponent(".textmetheapp-tooltip")+'"></oc-component>'),oc.renderNestedComponent($(".textmetheapp-tooltip oc-component"),function(){})},this)).trigger("add custom css class",{cssClass:"bookmark-tooltip-top-green-border textmetheapp-tooltip-eggshell",cssSelector:".tooltip"}).trigger("set target",$(".icon-text-me-app")).trigger("get tooltip content node").trigger("position caret center").trigger("disable_max_z_index").trigger("disable tooltip on hover").trigger("set tooltip below target").trigger("set tooltip the width",265).trigger("hide tooltip when user click anywhere else"),setTimeout($.proxy(function(){this.opts.forceTextMeAppTooltip&&!this.opts.doOnboardingSequence&&(C.logger.doSessionLog({text_to_app_auto_popup:"qna"}),C.utility.setUserKvp("textmetheapp_tooltip_seen",1),this.textMeAppTooltip.trigger("show"))},this),5e3))},doEnhancedContent:function(){this.opts.doEnhancedContent&&this.opts.hasHomeworkHelpSubscription&&($.ajax({url:"/_ajax/enhancedcontent",type:"GET",data:{token:C.global.csrfToken,questionUuid:this.opts.question.questionUuid,showOnboarding:this.opts.doEcOnboarding,templateName:this.opts.templateName},context:this,success:function(e){e&&void 0!==e.enhancedContentMarkup?($("#enhanced-content .chg-load").remove(),$("#enhanced-content").append(e.enhancedContentMarkup),oc.renderNestedComponent($("#enhanced-content oc-component"),function(){})):console.log("No enhanced content markup available: "+JSON.stringify(e))},error:function(e){console.log("Error in getting enhanced content "+JSON.stringify(e))}}),$(".answers-h2 .feedback-rating.content-feedback").addClass("enhanced-content-rating"))},wireECDuplicateQuestionsButton:function(){$(".ec-available-cta").on("click",function(t){t.preventDefault(),C.logger.doSessionLog({qna_enhanced_content_duplicate_promotion_click:1},function(){var e=$(t.currentTarget).attr("href");C.utility.navigate(e)})})},doBookmarkCountTooltip:function(){var r=this,e=function(e){var t;!(!e||!e.result)&&e.result.hasAsset||!$(".bookmark-count").length||this.opts.isBookmarkSeenQNA||setTimeout(function(){var e=1<parseInt($(".bookmark-count").text())?"students":"student",i='<div class="bookmark-count-tooltip-msg"><span class="exit-icn"></span><span class="bookmark-icn"></span>'+$(".bookmark-count").text()+" "+e+" bookmarked this question. Save it for later.</div>",t;r.bookmarkCountTooltip=Eggshell.create("C.common.overlay.tooltip"),r.bookmarkCountTooltip.on("return tooltip content node",$.proxy(function(e,t){C.utility.setUserKvp("isBookmarkSeenQNA",1),t.html(i),$(".exit-icn").on("click",function(){C.logger.doSessionLog({bookmark_other_users_popup_closed:"QNA"}),r.bookmarkCountTooltip.trigger("hide").trigger("disable tooltip on hover")})},this)).trigger("add custom css class",{cssClass:"bookmark-count-tooltip",cssSelector:".tooltip"}).trigger("set target",$(".save-question .icon-bookmark")).trigger("get tooltip content node").trigger("set tooltip zindex",1).trigger("set tooltip the width",202).trigger("set tooltip below target").trigger("disable tooltip on hover"),C.utility.getParams().hasOwnProperty("hwh_cr")||r.bookmarkCountTooltip.trigger("show");var s=window.pageYOffset,o=window.pageYOffset+window.innerHeight,n=$(".bookmark-count").offset().top+20,a;s<n&&n<o&&"hidden"!==$(".bookmark-count-tooltip").css("visibility")?C.logger.doSessionLog({bookmark_other_users_popup_shown:"qna_visible"}):(C.logger.doSessionLog({bookmark_other_users_popup_shown:"qna_invisible"}),$(window).on("scroll",function(){var e=window.pageYOffset,t=window.pageYOffset+window.innerHeight,i;e<n&&n<t&&(C.logger.doSessionLog({bookmark_other_users_popup_shown_scroll:"QNA"}),$(this).off("scroll"))}))},2500)};if(!this.opts.forceTextMeAppTooltip&&void 0!==C.global.userId&&0<C.global.userId.length){var t={type:"QnA",token:C.global.csrfToken,action_id:"has"};this.getBookmarkInfo(t,e,"POST")}},getBookmarkInfo:function(e,t,i){$.ajax({url:"/_ajax/userasset",type:i,data:e,context:this,success:t,error:function(e){console.log("Error in getting bookmark data: "+JSON.stringify(e))}})},getSubsPriceData:function(e){$.ajax({url:"/_ajax/hwh/subscription/",type:"GET",data:{token:C.global.csrfToken},context:this,success:e,error:function(e){console.log("Error in getting subscription price data: "+JSON.stringify(e))}})},adjustPageForFullWidthBanner:function(t){$(".HomeworkhelpQuestion").addClass("adjust-top");var e=function(){var e=$(".chgg-hdr").outerHeight();$(t).css({top:e+"px"})};$(window).on("resize",e),e()},doUnCancelBanner:function(){this.opts.showUnCancelBanner&&(this.adjustPageForFullWidthBanner($("#uncancel-banner")),$("#uncancel-banner .uncancel-button").on("click",$.proxy(function(e){var t=$(e.currentTarget).hasClass("uncancel-link")?"uncancel_link_click":"uncancel_button_click",i=JSON.parse('{"'+t+'":1}');C.logger.doSessionLog(i),this.showRestartModal()},this)))},showRestartModal:function(){this.popupRestart?this.popupRestart.trigger("show"):this.popupRestart=Eggshell.create("C.common.csrestartmodal",{subscription:this.opts.latestSubscriptionData}).on("primary_cta_clicked",function(){C.logger.doSessionLog({uncancel_modal_click:1}),$("#uncancel-modal").find("button").prop("disabled","disabled")}).on("restart_success",function(){var e=window.location.origin+window.location.pathname+"?cs_restart=1";C.utility.navigate(e)}).trigger("render")},doRightRail:function(){var e=[];this.opts.hasHomeworkHelpSubscription?e="top"===this.opts.mathAttachExp?["postForm","mytbs","math","tutors","tbsRecs"]:"bottom"===this.opts.mathAttachExp?["postForm","mytbs","tutors","math","tbsRecs"]:["postForm","mytbs","tutors","tbsRecs"]:this.opts.showTutorsComponent&&(e=["tutors"]),this.opts.promoteChromeExt&&e.unshift("chromeExtensionPromo");for(var t=e.length-1;0<=t;t--)switch(e[t]){case"math":this.doMathAttach();break;case"mytbs":this.doMyTbs();break;case"tutors":this.wireTutorComponent();break;case"postForm":this.doPostQuestionWidget();break;case"tbsRecs":this.wireQnaToTbsRecommendations();break;case"chromeExtensionPromo":this.doChromeExtensionPromo()}this.initStickyAdvertisement()},doMathAttach:function(){$(".right-sidebar .sidebar-container").prepend('<div class="mathattach-container"></div>'),Eggshell.create("C.common.mathattach",{el:$(".mathattach-container"),subjectId:this.opts.question.boardSubject,subjectName:this.opts.question.subSubjectName,subjectType:"qna"}).trigger("render")},doOnboardingSequence:function(){var e="QNA",t=[{handle:$(".question-body .save-question"),highlightHandle:$(".question-body .save-question"),content:"Save question for quick access later on",position:"bottom"},{handle:$(".answers-list .content-feedback .positive-rating"),highlightHandle:$(".answers-list .content-feedback").first(),content:"Give us feedback on the answer provided",position:"bottom"}],i=$(".mytbs-content a").first().length?$(".mytbs-content a").first():$(".mytbs-content .mytbs-placeholderbook").first().length?$(".mytbs-content .mytbs-placeholderbook").first():"";t.push({handle:$(".mytbs-content"),highlightHandle:i,content:"Find step-by-step solutions for<br/>your books",position:"left"});var s=$(".chg-container-content"),o=$(".main-content .global-breadcrumb");Eggshell.create("C.common.onboardingsequence",{el:$(".chg-container-content"),systemMessageEnabled:this.opts.systemMessage}).trigger("set_banner_handle",o).trigger("set_obfuscation_handle",s).trigger("set_instruction_points",t).on("sequence_started",function(){C.logger.doSessionLog({onboarding_sequence_started:e})}).on("sequence_completed",$.proxy(function(){C.logger.doSessionLog({onboarding_sequence_completed:e}),this.bookmarkCountTooltip&&this.bookmarkCountTooltip.trigger("show")},this)).on("close_button_clicked",$.proxy(function(e,t){C.logger.doSessionLog({onboarding_sequence_close:t.stepNumber}),this.bookmarkCountTooltip&&this.bookmarkCountTooltip.trigger("show")},this)).on("step_viewed",function(e,t){C.logger.doSessionLog({onboarding_sequence_viewed:t.stepNumber})}).trigger("render")},doMyTbs:function(){$(".right-sidebar .sidebar-container").prepend('<div class="mytbs-container"></div>'),Eggshell.create("C.common.mytbs",{el:$(".mytbs-container")}).on("mytbs_ready",$.proxy(function(e){this.opts.doOnboardingSequence&&this.doOnboardingSequence()},this)).trigger("set_source","question_page").trigger("render")},doPostQuestionWidget:function(){$(".right-sidebar .sidebar-container").prepend('<div class="post-new-question-form"></div>');var e=Eggshell.create("C.common.question.form",{el:$(".post-new-question-form")}).trigger("set source","question_page");this.opts.hasHomeworkHelpSubscription&&e.trigger("set form title","Post a question").trigger("set form subtitle","Answers from our experts for your tough homework questions").trigger("set placeholder text","Enter question").trigger("show remaining questions",!0),e.trigger("render")},doChromeExtensionPromo:function(){$(".right-sidebar .sidebar-container").prepend('<div class="chrome-extension-promo-wrapper"></div>'),Eggshell.create("C.common.promotion.chromeextension",{el:$(".chrome-extension-promo-wrapper")}).trigger("render")},renderExpertAnswerTooltip:function(){if(void 0!==this.opts.showExpertTooltip&&this.opts.showExpertTooltip){$('[itemprop="learningResourceType"]').append("<span class='qa-answer-expert-tooltip-overlay' tabindex='0'></span>");var e=$(".qa-answer-expert-tooltip-overlay"),i=this.opts.whoAreTheseExpertsTip;Eggshell.create("C.common.overlay.tooltip").on("return tooltip content node",function(e,t){t.html(i)}).trigger("set target",e).trigger("get tooltip content node").trigger("open on tab"),e.on("mouseleave",function(e){e.currentTarget.__skipReport=!1}).on("blur",function(e){e.currentTarget.__skipReport=!1}),e.mouseover(function(e){var t=e.currentTarget;setTimeout(function(){!t.__skipReport&&$(".tooltip").is(":visible")&&(C.logger.doSessionLog({ea_tooltip_shown:1}),t.__skipReport=!0)},500)}),e.focus(function(e){var t=e.currentTarget;setTimeout(function(){!t.__skipReport&&$(".tooltip").is(":visible")&&(C.logger.doSessionLog({ea_tooltip_shown:1}),t.__skipReport=!0)},500)})}},wireResubscribeModal:function(){var e=this.opts.latestPaymentInfo?this.opts.latestPaymentInfo:[];this.createResubscribeModal("qna",e,!1)},wireTbAttachModal:function(){var e=this.opts.tbAttachPaymentInfo?this.opts.tbAttachPaymentInfo:[];this.createResubscribeModal("tb_attach",e,!0)},createResubscribeModal:function(o,e,i){C.logger.doSessionLog({create_resubscribe_modal:"qna"});var n=Eggshell.create("C.common.csresubscribemodal",{el:$("#resubscribe-obfuscation")}).on("order_processing",$.proxy(function(){C.logger.doSessionLog({resubscribe_order_processing:n.getId()}),$(".cs-obfuscation").remove(),i&&n.trigger("hide_dialog");var e=Eggshell.create("C.Eggshell.loading.inline",{el:$(".dialog-question")}).trigger("render").trigger("show"),t=Eggshell.find(e).getId().replace(".","-");$("#"+t).addClass("resubscribe-loading-indicator")},this)).on("order_success",$.proxy(function(e,t){C.logger.doSessionLog({resubscribe_order_success:n.getId()});var i=t&&t.token?"?token="+t.token:"";i="tb_attach"===o?i+"&new_sub=1&hwh_cr=1":i;var s=window.location.origin+window.location.pathname+i;C.utility.navigate(s)},this)).on("error_placing_order",$.proxy(function(){C.utility.setLocal("resubscribe_order_started",!1),C.logger.doSessionLog({resubscribe_placing_order_error:n.getId()});var e="tb_attach"===o?"?newsub_e=1":"?resub_e=1",t=window.location.origin+window.location.pathname+e;C.utility.navigate(t)},this)).on("error_with_payment_method",$.proxy(function(e,t){C.utility.setLocal("resubscribe_order_started",!1),C.logger.doSessionLog({resubscribe_payment_method_error:n.getId()}),C.utility.navigate(t)},this)).trigger("render_as_dialog",i).trigger("set_theme",o).trigger("set_payment_data",e)},wireRecommendedQuestions:function(){if(!this.opts.isCRSOCEnabled)return!1;function e(){if("undefined"!=typeof oc&&void 0!==oc.renderNestedComponent){var v=!0;oc.events.on("oc:rendered",function(e,t){if(void 0!==t&&void 0!==t.html&&void 0!==t.name&&"opencomponent-relatedcontent"===t.name){var i=$(".recommendations .recommended-questions"),s=$(".recommendations .recommended-questions-problems"),o=!1,n=!1,a=0<t.html.indexOf(".recommended-questions-additional"),r=0<t.html.indexOf(".recommended-questions-problems-additional");if(i.length&&a){var l=i.hasClass("promote-ec"),c={};i.hasClass("has-ec-content")&&l?(c.qna_enhanced_content_next_step_eligible=1,c.qna_enhanced_content_next_step_shown=1,o=!0):c.qna_enhanced_content_next_step_eligible=0,c.qna_next_step_shown=1,c.qna_next_step_eligible=1,C.logger.doSessionLog(c),$(".recommended-questions .question-link").on("click",function(e){e.preventDefault();var t=window.open("","_blank"),i={};i.qna_next_step_question_clicked=$(this).attr("data-question-id"),l&&$(this).hasClass("ec-question")&&(i.qna_enhanced_content_next_step_click=1),C.logger.doSessionLog(i,$.proxy(function(){t.location.href=this.href},this))}),l&&($(window).on("resize",function(){$(window).width()<1220?$(".best-answer-review.new-item").addClass("hidden-promo"):$(".best-answer-review.new-item").removeClass("hidden-promo")}),$(window).resize())}else v&&!r&&C.logger.doSessionLog({qna_next_step_shown:0,qna_next_step_eligible:0});if(s.length&&r){var d=s.hasClass("promote-ec"),h,g={};0<s.find(".question-link.qna").length&&(g.qna_similar_entity_shown="qna"),s.hasClass("has-ec-content")?(g.qna_enhanced_content_similar_eligible=1,d&&(n=!0,g.qna_enhanced_content_similar_shown=1)):g.qna_enhanced_content_similar_eligible=0,C.logger.doSessionLog(g),s.find(".question-link").on("click",function(e){e.preventDefault();var t=window.open("","_blank"),i={};i[$(this).hasClass("qna")?"qna_similar_entity_question_clicked":"qna_similar_entity_tbs_clicked"]=$(this).attr("data-question-id"),d&&$(this).hasClass("ec-question")&&(i.qna_enhanced_content_similar_click=1),C.logger.doSessionLog(i,$.proxy(function(){t.location.href=this.href},this))})}if((o||n)&&void 0===C.utility.getCookie("isUserFirstVisit")){C.utility.setCookie("isUserFirstVisit",!0);var u=$(window),p=$(".has-ec-content");function m(){var e=u.height(),o=u.scrollTop(),n=o+e;$.each(p,function(){var e=$(this),t=e.outerHeight(),i=e.offset().top,s;o<=i+t&&i<=n?e.find(".promote-ec.show-new").addClass("in-view"):e.find(".promote-ec.show-new").removeClass("in-view")})}var f=!1,b=$('<div class="promote-ec show-new"></div>');o&&0===i.find(".promote-ec.show-new").length&&(b.prependTo(".recommended-questions.promote-ec"),C.logger.doSessionLog({qna_enhanced_content_flag_shown:1}),f=!0),n&&0===s.find(".promote-ec.show-new").length&&(b.prependTo(".recommended-questions-problems.promote-ec"),C.logger.doSessionLog({qna_enhanced_content_flag_shown:1}),f=!0),f&&(u.on("scroll resize",m),u.trigger("scroll")),$("body").on("click",".promote-ec.show-new, .question-link.ec-question",function(){var e=$(".promote-ec.show-new");0<e.length&&e.hide()})}v=!1}}),oc.renderNestedComponent($('.recommendations oc-component[data-project="opencomponent-relatedcontent"]'))}else setTimeout(e,50)}e()},listenToNewQuestionMessageLink:function(){$(".nonsub-message-signup").on("click",$.proxy(function(e){e.preventDefault(),this.doConversionFlow()},this))},initInlineEditor:function(){$qBody=$(".question-body"),$qBody.on("click",".edit-qstn",$.proxy(function(e){e.preventDefault();var t=$qBody.html();$qBody.empty();var i=Eggshell.create("C.common.glass.qna.askeditor",{el:$qBody,questionId:this.opts.question.questionId,query:this.opts.question.santizedQuestion,editorHeight:"150px",askPageMode:this.opts.askEditorMode,boardSubject:this.opts.question.boardSubject,subjectName:this.opts.subSubject,enableCKEditorNewVersion:this.opts.enableCKEditorNewVersion});i.trigger("render"),i.on("destroy",function(){$qBody.html(t)})},this))},toggleTranscribedText:function(){$(".transcribed-text").on("click",function(){$(".transcribed-image-text").toggleClass("hidden")})},toggleTranscribedTextSEO:function(){$(".transcribed-text-show").on("click",function(){$("html, body").animate({scrollTop:$(".transcribed-image-text-show").offset().top-70},500)})},wireModeratorTooltip:function(){var e=this,t=0,i=0,s=0,o=0,n=0,a=null;$(".content-feedback").each(function(){t=$(this).attr("data-answerid"),o=$(this).attr("data-askerId"),n=$(this).attr("data-loggedInId"),a=$(this).attr("data-ansCreateDate"),i++,Eggshell.create("C.Eggshell.homeworkhelp.thumbrating",{el:$(this),entityType:"ANSWER",entityId:t,isMobile:!1,askerId:o,loggedInId:n,answerCreatedDate:a,qnaThumbsRatingExpBucket:e.opts.getQnAThumbsRatingExpBucket,userReviewCount:e.opts.getUserReviewCount,isEnhancedContent:e.opts.doEnhancedContent,doTutorAttach:e.opts.doTutorAttach&&e.opts.tutorsFreeTrialMember}).on("display unrated message",function(){s++,C.utility.setLocal("totalUnratedCount",s)},e).trigger("render")}),$(".abuse-flag").on("click keypress",function(e){if("keypress"===e.type){var t;if(13!==(event.keyCode?event.keyCode:event.which))return!1;e.preventDefault()}void 0===this.abuseTooltip&&(this.abuseTooltip=Eggshell.create("C.Eggshell.homeworkhelp.contentfeedback",{container:$(e.target),tooltipTarget:$(e.target),isMobile:!1})),this.abuseTooltip.trigger("show abuse options")}),setTimeout(function(){e.displayUnratedMsg(i)},5e3)},displayUnratedMsg:function(e){var t=C.utility.getLocal("totalUnratedCount"),i=e-t;if(C.log("totalAnswers -> "+e+" ,  totalUnatedCount -> "+t+" ,  unratedAnswersCount -> "+i),0==i){$("#unratedMsg").show(),this.bannerRateAnswerClicked=!1;var s=$(".rate-tooltip-top-green-border"),o=$(".positive-rating .review-count").first(),n={cssClass:"rate-tooltip-top-green-border",cssSelector:".tooltip"},a=null,r="grow";if(0<o.length){a=0<$("#unratedMsg").length?o.offset().top-$("#unratedMsg").offset().top+$("#unratedMsg").scrollTop()-50:o.offset().top-50,0==s.length&&(this.rateAnswerTooltip=Eggshell.create("C.common.overlay.tooltip").on("return tooltip content node",function(e,t){var i;t.html('<span class="rate-answer-tooltip">Rate answer here.</span>')}).trigger("set target",o).trigger("get tooltip content node").trigger("set tooltip below target").trigger("add custom css class",n).trigger("position caret center").trigger("set tooltip zindex",100).trigger("set tooltip the width",145).trigger("set animation",r)),this.rateAnswerTimeoutComplete=!1;var l=window.pageYOffset+window.innerHeight,c=o.offset().top+20,d;c<l?this.beginRateAnswerTooltipTimer():$(window).scroll($.proxy(function(){var e=window.pageYOffset+window.innerHeight,t=c<e;!this.rateAnswerTimeoutComplete&&t&&this.beginRateAnswerTooltipTimer()},this))}$(".banner-rate-answer").on("click",$.proxy(function(){this.bannerRateAnswerClicked=!0,$("html, body").animate({scrollTop:a},250,$.proxy(function(){setTimeout($.proxy(function(){this.rateAnswerTooltip.trigger("show")},this),250)},this)),C.logger.doSessionLog({rate_this_answer_message_click:1,feedback_popup_shown:1})},this))}t&&C.utility.deleteLocal("totalUnratedCount")},beginRateAnswerTooltipTimer:function(){setTimeout($.proxy(function(){$(".banner-rate-answer").length&&!this.bannerRateAnswerClicked&&(this.rateAnswerTimeoutComplete=!0,this.rateAnswerTooltip.trigger("show"),C.logger.doSessionLog({feedback_popup_shown:1}))},this),5e3)},showRecentlyViewedTbs:function(){var e=$('<div class="mod-box ask-sidebar study-sidebar"></div>');$(".right-sidebar .sidebar-container").prepend(e),this.EggshellTbs=Eggshell.create("C.Eggshell.homeworkhelp.book",{el:e}).trigger("render").trigger("show"),$("body").observe("autocomplete:noResults",function(){var e='<div class="msg-info-sm no-results"><div class="msg-icon"><div class="msg-subheader">Solutions are not available for this book, but you can ask any question from your book. <a class="link-body-bold" href="/homework-help/ask">Ask now &raquo;</a></div></div></div>';$("#solutions_autocomplete").append(e)}),C.global.userId&&this.opts.hasHomeworkHelpSubscription?e.append('<a href="#"><div class="find-tbs"><span class="add-icn"></span><span class="tbs-text">Find new textbook solutions</span></div></a>'):e.css("display","none");var t=Eggshell.create("C.Eggshell.loading.inline",{el:e}).trigger("show");Eggshell.connect(this.EggshellTbs,"ready",t,"hide"),Eggshell.connect(this.EggshellTbs,"error",t,"hide")},handleRecentTbsEvents:function(){$(".ask-sidebar .tbs-show-more").observe("click",function(e){$(".ask-sidebar .tbs-row").removeClass("hidden"),$(e.target).addClass("hidden")},this);var e=Eggshell.create("C.common.tbspopup");$(".find-tbs").on("click",function(){e.trigger("show tbs popup")})},testQnaToTbsSearch:function(){var e=this.opts.expQnaToTbsSearch;this.mappingType="ACT",e.show_recs?(this.wireRecommendedTBS(),this.doQnaToTBSLogging()):this.logViewAllTbsClick("clickViewAll")},wireQnaToTbsRecommendations:function(){$recommendedTBS=$('<div class="recommended-tbs"></div>'),$(".right-sidebar .sidebar-container").prepend($recommendedTBS),this.recAvailable=0,this.tbsAjaxCounter=0,this.mappingType="ACT",this.wireRecommendedTBS()},wireRecommendedTBS:function(){$recommendedTBS=$(".recommended-tbs.legacy"),0!==$recommendedTBS.length&&$.ajax({url:"/_ajax/questions/question/gettbssuggestions",dataType:"json",data:{questionId:this.opts.question.questionId,mappingType:this.mappingType,limit:2},context:this,success:function(e){this.opts.hasHomeworkHelpSubscription?this.recommendMemberTbs(e):this.recommendedTBSSuccess(e)},error:function(e){C.log("Error in getting tbs suggestions: "+JSON.stringify(e))}})},wireMoreAnswers:function(){var t=this.opts.question.questionId,i=this.opts.userArray.user_id,u=this,p,s,o;$(".dialog-question").on("click",".merge-question-show-more",function(e){s=$(e.target),o=parseInt(s.attr("data-startvalue")),p=o+2,$(".merge-question-show-more").replaceWith('<span class="loading-indicator" style="display: block"></span>'),$.ajax({url:"/_ajax/questions/question/getmoreanswers",data:{token:C.global.csrfToken,questionId:t,userId:i,start:p,limit:2},success:function(e){$(".loading-indicator").hide(),$("#additional-answers").append(e);var t=$(".list-"+p+" .leave-comment"),i=t.length,s,o,n=[],a;for(n=[],o=0;o<i;o++)s=new C.widget.avatarCommenting({el:t[o]}),n.push(s);$(".answers-list li[data-answerid]").each(function(){var e=$(this),t=e.find(".avatar, .answerer-name"),s=e.find(".answerer-stats-popup").clone().removeClass("hidden"),i=Eggshell.create("C.common.overlay.tooltip").on("return tooltip content node",function(e,t){var i;t.html(s)}).trigger("set target",t).trigger("get tooltip content node").trigger("set tooltip above target")});var r=0,l=0,c=0,d=0,h=0,g=null;$(".list-"+p+" .content-feedback").each(function(){r=$(this).attr("data-answerid"),d=$(this).attr("data-askerId"),h=$(this).attr("data-loggedInId"),g=$(this).attr("data-ansCreateDate"),l++,Eggshell.create("C.Eggshell.homeworkhelp.thumbrating",{el:$(this),entityType:"ANSWER",entityId:r,isMobile:!1,askerId:d,loggedInId:h,answerCreatedDate:g,qnaThumbsRatingExpBucket:u.opts.getQnAThumbsRatingExpBucket,userReviewCount:u.opts.getUserReviewCount,isEnhancedContent:u.opts.doEnhancedContent,doTutorAttach:u.opts.doTutorAttach&&u.opts.tutorsFreeTrialMember}).on("display unrated message",function(){c++,C.utility.setLocal("totalUnratedCount",c)},u).trigger("render")}),$(".abuse-flag").on("click",function(e){void 0===this.abuseTooltip&&(this.abuseTooltip=Eggshell.create("C.Eggshell.homeworkhelp.contentfeedback",{container:$(e.target),tooltipTarget:$(e.target),isMobile:!1})),this.abuseTooltip.trigger("show abuse options")})},error:function(e){C.log("Error in getting more answers: "+JSON.stringify(e))}}),e.preventDefault()})},removeImageStyling:function(){for(var e=$(".question-body img, .answer-body img"),t=0,i=e.length;t<i;t++)$(e[t]).prop("style",!1)},recommendMemberTbs:function(e){this.tbsAjaxCounter++,this.tbsRecs=e.suggested,0!==this.tbsRecs.length&&(this.recAvailable++,1==this.recAvailable&&(this.displayMemberTbs(),this.doMemberTbsLogging(),this.originalMapping=this.mappingType)),1==this.tbsAjaxCounter?this.invokeMemberTbsMapping():2==this.tbsAjaxCounter&&(0==this.recAvailable?(C.logger.doSessionLog({memRecAvailable:0}),C.logger.doSessionLog({memRecShown:0})):this.logMemberRecsAvailable(this.originalMapping))},logMemberRecsAvailable:function(e){if(1===this.recAvailable){var t=e===this.mappingType?2:1;C.logger.doSessionLog({memRecAvailable:t})}else 2===this.recAvailable&&C.logger.doSessionLog({memRecAvailable:3})},invokeMemberTbsMapping:function(){this.mappingType="MGH"==this.mappingType?"ACT":"MGH",this.wireRecommendedTBS()},doMemberTbsLogging:function(){var e="MGH"==this.mappingType?2:1;C.logger.doSessionLog({memRecShown:e});for(var t="",i=0,s=this.tbsRecs.length;i<s;i++)t+=this.tbsRecs[i].destinationId,i!==s-1&&(t+=",");C.logger.doSessionLog({memRecISBNS:t});for(var o=$(".recent-item"),i=0,s=o.length;i<s;i++)$(o[i]).data(this.tbsRecs[i].destinationId);$(".C-common-glass-tbs-recentlyviewed-item").on("click",function(e){e.preventDefault(),e.stopPropagation();var t=$(e.currentTarget);C.logger.doSessionLog({memRecClick:t.find(".recent-item").data("itemid")},function(){C.utility.navigate(t.find("a").attr("href"))})}),$(".find-your-book").on("click",$.proxy(function(e){e.preventDefault(),e.stopPropagation();var t=$(e.target);C.logger.doSessionLog({memClickViewAll:1},function(){var e;Eggshell.create("C.common.tbspopup").trigger("show tbs popup")})},this)),this.logViewAllTbsClick("memClickViewAll")},logViewAllTbsClick:function(i){$(".find-book").on("click",$.proxy(function(e){e.preventDefault(),e.stopPropagation();var t={};t[i]=1,C.logger.doSessionLog(t,$.proxy(function(){$(".dialog .bottom-section").after('<div class="tbs-autosuggest-container"></div>'),$(e.target).css({visibility:"hidden"}),this.displayTbsSearch()},this))},this))},displayTbsSearch:function(e){var t=$(".tbs-autosuggest-container");t.append(this.searchTemplate());var i=window.cev||new Events;window.cev=window.cev||i,window.cev.addEvent("searchLoad:once",$.proxy(function(e){var t=Eggshell.create("C.common.search",{el:$(".tbs-input-search-container")}).trigger("render",{ajaxEndpoint:"/_ajax/search/tbsserp",target:$(".tbs-autosuggest-container .my-tbs-input-field"),filters:{type:"group",variant:"up",count:3,destination:"tbs"}}).trigger("show no segways").trigger("show no categories").trigger("show no bottom content").trigger("set width to size of input field");$(".tbs-autosuggest-container #autosuggest-input").focus(),$(window).click(function(){t.trigger("hide results")})},this)),t.click(function(e){e.stopPropagation()})},searchTemplate:function(){return'<div class="tbs-input-search-container"></div><form class="chg-search-form" method="get" action="/search" onsubmit="return false"><input id="autosuggest-input" name="my_tbs_search" class="my-tbs-input-field form-input-sm" type="text" placeholder="Enter textbook\'s ISBN, title, or author\'s name" autocomplete="off"><a data-type="button" class="autosuggest-search-btn search-magnify-btn" href="#"><span class="icn-magnify">Submit</span></a><a class="autosuggest-search-cancel search-magnify-btn-close autosuggest-search-cancel href="#"><span class="icon-x">Close</span></a></form>'},displayMemberTbs:function(){var e;$recommendedTBS.addClass("member-tbs"),Eggshell.create("C.common.glass.tbs.recentlyviewed",{el:$recommendedTBS}).trigger("set cover size","tiny").trigger("set header","People who viewed this also viewed these solutions").trigger("render",this.tbsRecs)},recommendedTBSSuccess:function(e){this.tbsRecs=e.suggested,"ACT"===this.mappingType&&0===this.tbsRecs.length&&(this.mappingType="SUBJ",this.wireRecommendedTBS())},doQnaToTBSLogging:function(){$(".cs-obfuscation .view-more-tbs").on("click",$.proxy(function(e){e.preventDefault(),e.stopPropagation(),C.logger.doSessionLog({clickViewAll:1},$.proxy(function(){$(".recommended-tbs").prepend('<div class="tbs-autosuggest-container"></div>'),this.displayTbsSearch()},this))},this))},triggerQnaAutoSuggest:function(){C.global.headerAutosuggest&&Eggshell.find(C.global.headerAutosuggest).trigger("render",{ajaxEndpoint:"/_ajax/search/qnaserp",target:$(".chgg-hdr .autosuggest-input-field"),filters:{type:"group",count:5,destination:"qna"}})},triggerHeaderExpandSearchBox:function(){Eggshell.find("C.global.header").trigger("expand search box").trigger("disable auto collapse of searchbox"),Eggshell.find("C.global.header.navigation").trigger("collapse navigation items")},stickyAdBox:null,initStickyAdvertisement:function(){if(this.opts&&this.opts.hasHomeworkHelpSubscription)return $(".chg-display",this.$el).remove(),!1;if(!C.global||!C.global.stickyAds)return!1;if(!this.stickyAdBox){var e=$(".chg-display",this.$el);e&&e.length&&e.hasClass("ad-box")&&!e.parent().hasClass("ad-box-wrapper")&&(e.wrap('<div class="ad-box-wrapper"></div>'),this.stickyAdBox=Eggshell.create("C.Eggshell.common.sticker",{el:$(".ad-box-wrapper",this.$el),pageHeaderBlock:null,pageContentBlock:".parent-container",spyOnUpperBlock:".right-sidebar .sidebar-container:last-child",useScrollTopChecker:!0,horisontalScroll:!0,marginTop:20}),$(".parent-container").height()<850&&$(".parent-container").css("min-height","850px"))}this.stickyAdBox&&(Eggshell.trigger(this.stickyAdBox,"initTopPosition"),Eggshell.trigger(this.stickyAdBox,"scrolling"))},wireTutorComponent:function(){var e=$('<div class="qna-tutors"></div>');$(".right-sidebar .sidebar-container").prepend(e);var t=Eggshell.create("C.common.tutors",{el:e});t.trigger("set opportunity modal data",{modalContext:"QNA_OPP_FLOW",modalBody:"Hi! I'm working on the following problem and would like some help: "+window.location.origin+window.location.pathname}),t.trigger("show tutors",{type:"rightrail",variant:"white sunkist",product:"QNA",subjectId:this.opts.question.subSubjectId,subjectName:this.opts.question.subSubjectName,userHasCsSubscription:this.opts.hasHomeworkHelpSubscription,campaign:"Chegg_Study-QA",entityId:this.opts.question.questionUuid}),Eggshell.on(t,"ready",this.initStickyAdvertisement)},scrollCSContainer:function(){var t=$(".cs-obfuscation"),i;if(this.opts.doEnhancedContent?i=$("#enhanced-content-component .step-content").last():this.opts.smartAnswerPreviewExp&&$(".answer-preview-image").length&&(i=$(".answer-preview-container .answer-preview-image:last-of-type")),0!==t.length){var e=t.offset().top;this.pinContainer.call(this,e,i),$(window).scroll($.proxy(function(){var e=t.offset().top-$(window).scrollTop();this.pinContainer.call(this,e,i)},this))}this.listenToCTAClick()},pinContainer:function(e,t){var i=$(".C-Eggshell-inline-dialog .dialog"),s,o;if((void 0!==t?t.offset().top-$(window).scrollTop():e)<(this.opts.doEnhancedContent?$(window).height()-270:$(window).height()-290)){var n=this.opts.doEnhancedContent?t.offset().top-90:void 0!==t?t.offset().top-70:"initial",a=void 0!==t?"absolute":"relative";i.css({position:a,top:n,bottom:"initial"})}else i.css({position:"fixed",bottom:"20px",top:"initial"})},listenToCTAClick:function(){$(".dialog .cta-btn, .answer-excerpt-seo-more-link").on("click",$.proxy(function(e){e.preventDefault(),C.logger.doSessionLog({cs_cta_click:"qna"}),this.opts.showTbAttachModal?this.wireTbAttachModal():this.doConversionFlow()},this))},doConversionFlow:function(){if(this.opts.resumeSub)this.showResumeModal();else{var e=function(e){var t=e.subsPriceData?e.subsPriceData.monthly:{},i,s,o,n="/checkoutinterstitial/hwh/?redirect=hwh&command="+t.catalogId+","+t.priceId+",1,"+t.catalogItemSource;if(C.global.loggedIn)C.utility.navigate(n);else{var a=escape(n),r=this.opts.pricePoint;C.utility.navigate("/auth?type=simplifiedstudy&action=signup&data=sCS_P_"+r+"&redirect="+a+"&cs_source=qna")}};this.getSubsPriceData(e.bind(this))}},showResumeModal:function(){this.popupResume?this.popupResume.trigger("show"):this.popupResume=Eggshell.create("C.common.csrestartmodal",{subscription:this.opts.latestSubscriptionData}).trigger("render_resume_modal")},handleMathJaxFrame:function(){$mathJaxFrame=$("#MathJax_MSIE_Frame"),""===$mathJaxFrame.html()&&$mathJaxFrame.hide()},_clickevents:{logSimilarEntityClick:function(){$("[data-similar-entity-href]").on("click",function(e){e.preventDefault();var t=$(this),i=t.attr("data-similar-entity-type"),s=t.attr("data-similar-entity-id"),o=t.attr("data-similar-entity-href"),n=JSON.parse('{ "qna_similar_entity_'+i+'_clicked": '+s+" }");C.logger.doSessionLog(n,function(){window.location.href=o},{logSubscription:1})})}},doClickEvents:function(){this._clickevents.logSimilarEntityClick(),$(".answer-input").on("click",function(){$(this).fadeOut(function(){navigator.userAgent.match(/Android/i)&&($("#ans-ques-btn").removeClass("answer-question"),$("#cke_answer_editor").css({display:"none"})),$(".answer-form").removeClass("hidden"),$(".answer-tips").removeClass("hidden")})});var n={show:function(){this.createWalkthroughMarkupIfNotPresent();var s=this.calculateWalkthroughTextImagePositions();$(".overlay-text").on("load",function(){var e=0,t=$(".overlay-text-web-constellation").width(),i=0<s.left-t?s.left-t:0;$(this).offset({top:s.top-0,left:i})}),$("#textmetheapp-banner").remove(),$("body").addClass("show-save-walkthrough")},createWalkthroughMarkupIfNotPresent:function(){0==$(".backdrop-generic").length&&($(".bundlebanner-container").length&&$(".bundlebanner-container").css("z-index",0),$(".chg-container").append('<div class="backdrop-generic"><img src="//c.cheggcdn.com/assets/site/images/qa2-overlay-text.png" class="overlay-text overlay-text-web-constellation" /></div>').on("keydown.backdrop",function(e){$(".backdrop-generic").remove(),$(".bundlebanner-container").length&&$(".bundlebanner-container").css("z-index",1),e.preventDefault(),$(e.target).removeClass("focus--mouse"),$(".chg-container").prop("tabindex",!1),$(this).off("keydown.backdrop")}),$(".backdrop-generic, .chgg-hdr").on("click",function(){$(".backdrop-generic").remove(),$(".bundlebanner-container").length&&$(".bundlebanner-container").css("z-index",1)}))},calculateWalkthroughTextImagePositions:function(){var e=$(".chgg-hdr.type-study").length?$(".chgg-hdr.type-study"):$(".chgg-hdr"),t=$(".nav-item.qa-item").length?$(".nav-item.qa-item"):$(".nav-item.study-item");return{top:e.offset().top+e.outerHeight(),left:t.offset().left+t.width()/2}}},a=this;$("[data-questionid-save]").on("click",function(){var s=$(this),e,t=$(this).hasClass("is-saved")?"unsave":"save",i=$(this).data("questionid-save"),o=void 0!==$(this).attr("data-walkthrough-active")&&"1"===$(this).attr("data-walkthrough-active");a.bookmarkCountTooltip&&a.bookmarkCountTooltip.trigger("hide"),s.hasClass("is-freezed")||$.ajax({type:"POST",url:"/_ajax/userasset",async:!1,data:{type:"QnA",question_id:i,action_id:t,token:C.global.csrfToken},success:function(e){if(200==e.httpCode){var t=s.find(".bookmark-count"),i=parseInt(t.text());void 0!==e.result.id&&null!==e.result.id?(s.addClass("is-saved"),t.length&&(t.html(++i),s.find(".bookmark-count-txt").html(1<i?"bookmarks":"bookmark")),C.utility.fireAdobeClickEvent({eventName:"bookmark | qna",eventValue:C.global.pageObject.opts.question.questionId,eventID:"event61"})):void 0!==e.result.count&&(s.removeClass("is-saved"),t.length&&(t.html(--i),s.find(".bookmark-count-txt").html(1<i?"bookmarks":"bookmark")),C.utility.fireAdobeClickEvent({eventName:"remove bookmark | qna",eventValue:C.global.pageObject.opts.question.questionId,eventID:"event64"})),o&&void 0!==e.result.showOverlay&&null!==e.result.showOverlay&&e.result.showOverlay&&n.show()}},error:function(e,t,i){console.log("Status: "+e.status+"User Asset Error: "+i)},beforeSend:function(){s.addClass("is-freezed")},complete:function(){s.removeClass("is-freezed")}},this)}),$("[data-questionid-save]").on("keydown",function(e){if(13===e.keyCode||32===e.keyCode)return e.preventDefault(),e.currentTarget.click(),!1})},doAnswerRating:function(){var e=$(".rating-stars"),t=e.data("count"),i=isNaN(t)?0:t;Eggshell.create("C.common.rating",{el:e}).trigger("set rating",i).trigger("enable interaction",!1)},editPhotoBio:function(){var t,i,s,o,n,a;$(document).observe("click","a.edit-photo-bio",function(e){e.preventDefault(),t=$(e.target),i=t.attr("data-answerid"),s=$("a.edit-photo-bio").parents(".answers-list li[data-answerid="+i+"]"),o=s.find("div.answerer-stats"),n=this.editPhotoBioHtml(),this.opts.answeredWithNickname=o.attr("data-name"),this.showPhotoBioDialog(n)},this),this.uploadAnswererPhoto(),$(".save-info-btn").observe("click",function(e){a=$(".answerer-bio"),this.saveAnswererBio(a,null)},this)},showPhotoBioDialog:function(e){if(this.photobio1){if(!this.photobio2&&this.photobio1!==e.selector){this.photobio2=e.selector;var t,i=$(".edit-bio").find(".dialog-bio");this.EggshellPhotoBioDialog2=Eggshell.create("C.common.dialog").trigger("set headline","Edit photo & bio").trigger("set content html",e).trigger("enable default control").trigger("set primary button","Save").trigger("set secondary button","Cancel").trigger("hide icon").on("secondary button clicked",function(){this.EggshellPhotoBioDialog2.trigger("hide")},this).on("primary button clicked",function(e){this.saveAnswererBio(i,this.EggshellPhotoBioDialog2)},this)}}else{this.photobio1=e.selector;var s,o=$(".edit-bio").find(".dialog-bio");this.EggshellPhotoBioDialog1=Eggshell.create("C.common.dialog").trigger("set headline","Edit photo & bio").trigger("set content html",e).trigger("enable default control").trigger("set primary button","Save").trigger("set secondary button","Cancel").trigger("hide icon").on("secondary button clicked",function(){this.EggshellPhotoBioDialog1.trigger("hide")},this).on("primary button clicked",function(e){this.saveAnswererBio(o,this.EggshellPhotoBioDialog1)},this)}_.isEqual(e.selector,this.photobio1)?(this.EggshellPhotoBioDialog1.trigger("show"),this.EggshellPhotoBioDialog1.on("content area",$.proxy(function(){this.showCharsLeft()},this)).trigger("get content area")):(this.EggshellPhotoBioDialog2.trigger("show"),this.EggshellPhotoBioDialog2.on("content area",$.proxy(function(){this.showCharsLeft()},this)).trigger("get content area"))},showCharsLeft:function(){var e,t=$(".edit-bio").find(".dialog-bio"),i=t.val().length;$(".chars-left").html(this.maxBioChars-i),t.observe("input",function(){i=t.val().length,$(".chars-left").html(this.maxBioChars-i)},this)},uploadAnswererPhoto:function(){var i=this.opts.answeredWithNickname,s=this.opts.gender;$(document).on("click",".upload-photo-btn",function(e){if(!this.pictureEditor){var t=$(".answers-wrap .avatar");this.pictureEditor=new C.profile.form.picview({origin:t,answererImage:!0,answeredWithNickname:i,gender:s,refreshAfterSave:!0}),this.pictureEditor.showEditButton(!0),this.pictureEditor.render(),this.pictureEditor.updateImg(C.global.staticBaseUrl+"s/profile/images/avatar_"+s.toLowerCase()+".png")}this.pictureDialog=new C.widget.dialog({content:this.pictureEditor.$el})})},saveAnswererBio:function(e,t){headline=$(".edit-bio").find(".dialog-bio").val(),$.ajax({type:"POST",url:"/_ajax/questions/answer/answererinfo",dataType:"json",data:{headline:headline,token:C.global.csrfToken},context:this,success:function(e){$(".added-hidden-answer").addClass("hidden"),t&&t.trigger("hide"),C.utility.refresh(),window.location.reload()},error:function(e){C.utility.refresh()}},this)},editPhotoBioHtml:function(){var e,t;return'<div class="edit-bio"><div class="col-4"><img class="dialog-photo" src= '+this.opts.answererImage+' /></div><div class="col-7"><div class="photo"><div class="photo-bio f-size-05 f-color-05">Photo</div><button class="btn-flat-sm upload-photo-btn">Edit photo</button></div><div class="bio"><div class="photo-bio f-size-05 f-color-05">Bio<span class="char-text f-size-02 f-color-03"> <label class="chars-left">0</label> chars left</span></div><textarea rows="2" maxlength="75" class="dialog-bio" placeholder="Engineer with 20 years of experience and three PHDs from Harvard">'+this.opts.userArray.bio+"</textarea></div></div></div>"},setupAnsweringTips:function(){this.addWidget(new C.widget.popup({className:"answering-tips-popup",template:"gray",side:"right",el:".answering-tips a",width:"400px",content:this.getAnswerTips(),trigger:"click",padding:0,overhang:0}))},getAnswerTips:function(){return'<div class="answer-tip-dialog"><p class="txt-hdr-sec">Tips for Answering</p><br /><ul class="chg-list"><li><span>Write clearly, using proper grammar and punctuation.</span></li><li><span>Break chunks of text into paragraphs so students can follow along more easily.</span></li><li><span>Upload a supporting diagram or a photo of your work.</span></li><li><span>Answer more questions with high-quality answers so you can build up your reputation!</span></li></ul></div>'},answerEditorRestriction:function(){var e=this.opts.ansCount,t=this.opts.isEA,i=this.opts.isCheggExpert,s=this.opts.isModerator;this.opts.remove_most_recent_answer_call||(1==t&&1!=i&&1!=s&&0!==e||1!=t&&1!=i&&1!=s&&0!==e)&&$(".answer-editor").hide()},wireAnswerEditors:function(){if(!(this.opts.isEA||this.opts.isModerator||this.opts.isCheggExpert))return!1;var e=$(".answer-editor"),t=e.length,i,s;for(s=0;s<t;s++)i=new C.widget.answerEditor({elem:e[s],userNicknameModal:this.userNicknameModal,subscription_type:this.opts.subscription_type,userAvatar:this.opts.userAvatar,answererImage:this.opts.answererImage,enableCKEditorNewVersion:this.opts.enableCKEditorNewVersion}),this.answerEditors.push(i)},wireAvatarCommenting:function(){var e=$(".leave-comment"),t=e.length,i,s;for(s=0;s<t;s++)i=new C.widget.avatarCommenting({el:e[s]}),this.commentForms.push(i)},wireAskerStatsPopup:function(){var e=$(".dialog-question"),t=e.find("> .avatar, .metadata .display-name"),i=e.find(".asker-stats-popup").clone().removeClass("hidden");this.addWidget(new C.widget.popup({el:t,content:i,autoCenter:!1,side:"top",pointerEdgePadding:32}))},wireAnswererStatsPopup:function(){var e;$(".answers-list li[data-answerid]").each(function(){var e=$(this),t=e.find(".avatar, .answerer-name"),s=e.find(".answerer-stats-popup").clone().removeClass("hidden"),i=Eggshell.create("C.common.overlay.tooltip").on("return tooltip content node",function(e,t){var i;t.html(s)}).trigger("set target",t).trigger("get tooltip content node").trigger("set tooltip on the right of target")})},wireEditAnswerLink:function(){$(".answers-list .edit-answer-link").observe("click",function(e){$(".answer-editor").show(),$(".answer-input").trigger("click");var t=$(e.target),i=t.attr("data-answerid"),s=C.utility.browser.webkit?C.dom.$body:C.dom.$html,o=t.closest(".answer").find(".answer-given-body");$('.answer-form input[name="answerId"]').val(i),$(".finalized_jax",o).each(function(){var e=$(this),t,i=$("script",e).html();i.replace("// <![CDATA[","").replace("// ]]>",""),e.attr("data-jax",i)}),this.answerEditors[0].EggshellEditor.trigger("set editor html",o.html()).trigger("focus on the editor"),$(".answer-editor").length&&s.stop().animate({scrollTop:$(".answer-editor").offset().top-50})},this)},wireRemoveAnswerLink:function(){C.dom.$content.observe("click",".answers-list .remove-answer-link",function(e){var i=$(e.target),t,s={id:i.attr("data-answerid"),type:"question-answer",token:C.global.csrfToken},o=new C.widget.areYouSure({title:"Remove Post",hdr:"Are you sure you want to remove this post?",primaryBtnTxt:"Remove",details:"<br/><br/>"});this.addWidget(o),o.dialog.$dialog.observe("click",".btn-primary-sm",function(){var e=$(".answer-count"),t=parseInt(e.html(),10);0<t&&e.html(t-1),this.removeAnswer(s,i),i.closest("li").hide("slow"),$("li.added-hidden-answer").hide("slow"),o.dialog.destroy()},this),o.dialog.$dialog.observe("click",".btn-secondary-sm",function(){o.dialog.destroy()},this),o.dialog.show()},this)},removeAnswer:function(e,t){$.ajax({type:"post",dataType:"json",url:"/_ajax/hwh/delete",data:e,context:this,success:function(){}}),t.parents("li").eq(0).remove()},initScroll:function(){var e=C.utility.browser.webkit?C.dom.$body:C.dom.$html,t=$(".added-hidden-answer");0<t.length&&e.stop().animate({scrollTop:t.offset().top-50})},destruct:function(){$(".chg-global-nav").css({visibility:"visible"}),$(".non-subscriber-container").remove()},disableEditorBox:function(){this.opts.remove_most_recent_answer_call||"off"!=this.opts.editorAccess||$(".answer-editor").remove()},createBookmarkTooltip:function(){var e=function(){return'<div class="bookmark-tooltip-links"><ul><li><a id="qna_bookmark_link_rate_the_answer" href="javascript:void(0)">Rate the answer</a></li><li><a href="/study/qa/saved/" target="_blank">See all bookmarks</a></li></ul></div>'},t=function(){var e={cssClass:"bookmark-tooltip-top-green-border",cssSelector:".tooltip"};return Eggshell.create("C.common.overlay.tooltip").on("return tooltip content node",function(e,t){var i;t.html('<div class="bookmark-tooltip-links"><ul><li><a id="qna_bookmark_link_rate_the_answer" href="javascript:void(0)">Rate the answer</a></li><li><a href="/study/qa/saved/" target="_blank">See all bookmarks</a></li></ul></div>')}).trigger("add custom css class",e).trigger("set target",$("[data-questionid-save]")).trigger("get tooltip content node").trigger("position caret center").trigger("set tooltip zindex",1e3).trigger("set tooltip the width",200).trigger("hide tooltip when user click anywhere else").trigger("set tooltip below target").trigger("disable_max_z_index")},i=function(){var e=$(".positive-rating.rating-block .thumb-button"),t;if(0<e.length){var i=e.first(),s={cssClass:"bookmark-tooltip-top-green-border",cssSelector:".tooltip"};return Eggshell.create("C.common.overlay.tooltip").on("return tooltip content node",function(e,t){var i;t.html("<p>Rate Answers here</p>")}).trigger("add custom css class",s).trigger("set target",i).trigger("position caret center").trigger("get tooltip content node").trigger("set tooltip width",100).trigger("hide tooltip when user click anywhere else").trigger("set tooltip below target").trigger("disable_max_z_index").trigger("disable tooltip on hover")}},s=function(e){$("[data-questionid-save]").hasClass("is-saved")?e.trigger("enable tooltip on hover"):e.trigger("disable tooltip on hover").trigger("hide")},o=function(e){$("#qna_bookmark_link_rate_the_answer").on("click",{rateAnswer:e},function(e){var t=e.data.rateAnswer,i,s=n.first().offset().top-$(this).offset().top+$(this).scrollTop()-50;$("html, body").animate({scrollTop:s},1e3,function(){t.trigger("show")})})},n=$(".positive-rating.rating-block"),a;if(0<n.length){var r=t(),l;s(r),o(i()),$("[data-questionid-save]").on("click",{eggshellBookmarkTooltip:r},function(e){s(e.data.eggshellBookmarkTooltip)})}},wireFastTrackEA:function(){if(void 0===this.opts.ftEANotification)return!1;if(C.logger.doSessionLog({fast_track_notification:1}),void 0!==this.opts.ftEANotification.closeable&&this.opts.ftEANotification.closeable&&void 0!==this.opts.ftEANotification.url){var e={text:"Check answer",url:this.opts.ftEANotification.url},t=this.opts.ftEANotification.questionId,i=function(e){$.ajax({type:"POST",url:"/_ajax/fasttracknotification",dataType:"json",data:{qId:e,token:C.global.csrfToken},context:this,success:function(e){}})},s=function(e){C.logger.doSessionLog({fast_track_notification_click:1}),i(e)};return this.pushOnSiteNotification(this.opts.ftEANotification.type,this.opts.ftEANotification.message,this.opts.ftEANotification.closeable,"small",e,s.bind(this,t),i.bind(this,t))}return this.pushOnSiteNotification(this.opts.ftEANotification.type,this.opts.ftEANotification.message,this.opts.ftEANotification.closeable)},pushOnSiteNotification:function(e,t,i,s,o,n,a){return Eggshell.create("C.common.message",{el:$("#study-notification")}).trigger("set type",e).trigger("set size",void 0!==s?s:"small").trigger("set body",t).trigger("set call to action link",void 0!==o?o:{}).trigger("enable close button",void 0!==i&&i).on("close button clicked",void 0!==a?a:function(){}).on("call to action link clicked",void 0!==n?n:function(){})},doPracticeOnboardingLogic:function(){var e="cs_practice_topic",t=C.utility.getParams().hasOwnProperty("hwh_cr");C.utility.getCookie(e)&&!t&&(setTimeout(this.showPracticePromo.bind(this),5e3),C.utility.setCookie(e,-1,-1))},showPracticePromo:function(){Eggshell.create("C.common.onboardingoverlay",{el:$(".chgg-hdr-content")}).trigger("dismiss_on_click").trigger("set_instruction_points",[{top_padding:0,left_padding:-5,handle:$(".link-practice"),content:'<div id="practice-promo"></div>'}]).trigger("render"),Eggshell.create("C.common.overlay.tooltip").on("return tooltip content node",function(e,t){t.html('<div class="practice-tooltip-content"><img src="'+C.global.assetUrl+'site/icons/New_flag_practice_promo.png" class="sticker-on-tooltip"/><div>Solve a set of problems based </br> on your book or topic</div><br /><a data-type="button" class="btn-primary-outline btn-sm practice-now-cta" href="/study/practice">Practice now</a></div>'),$(".practice-item").addClass("highlight"),$(".tooltip-content.grey-border").addClass("practice-topic-onboarding"),$(".practice-now-cta").on("click",function(e){e.preventDefault(),C.logger.doSessionLog({practice_promo_click:1},function(){window.location.href=$(e.target).attr("href")})})}.bind(this)).trigger("add custom css class",{cssClass:"practice-promo-tooltip",cssSelector:".tooltip"}).trigger("set target",$("#practice-promo")).trigger("get tooltip content node").trigger("set tooltip zindex",1e3).trigger("set tooltip the width",315).trigger("hide tooltip when user click anywhere else").trigger("set tooltip below target").trigger("disable tooltip on hover").trigger("show"),C.logger.doSessionLog({practice_promo_shown:1})}}),Eggshell.define("C.common.glass.tbs.recentlyviewed",{inputs:["render","set source","set header","set cover size","add more results","show more cta","show empty message if no tbs","fire adobe events","render bookmarks"],outputs:["ready"],strict:!1},function(){var e;return Backbone.View.extend({initialize:function(e){this.opts=e,this.showEmptyMessageIfNoTBS=!1,this.renderBookmarks=!1,this.showSeeMoreLink="",this.header="My recent Textbook Solutions",this.setupListeners()},setupListeners:function(){Eggshell.find(this).on("render",this.render,this).on("add more results",this.addMoreResults,this).on("show empty message if no tbs",this.setShowEmptyMessage).on("set source",this.setSource).on("set header",this.setHeader).on("set cover size",this.setCoverSize).on("show more cta",this.setShowSeeMoreLink).on("fire adobe events",this.fireAdobeEvents).on("render bookmarks",this.doRenderBookmarks)},setSource:function(e,t){if(!t||"string"!=typeof t)throw"Invalid source type. Source must be of type string";this.source=t},setHeader:function(e,t){if(!t||"string"!=typeof t)throw"Invalid header type. Header must be of type string";this.header=t},setCoverSize:function(e,t){if(!t||"string"!=typeof t)throw"Invalid cover size type. Cover size must be of type string";this.coverSize=t},doRenderBookmarks:function(){$.extend(this.opts,{renderBookmarks:!0})},addMoreResults:function(e,t){t&&0<t.length&&(this.$recentItems=this.$el.find(".tbs-recent-items"),this.renderTbsItem(t)),this.setupEventListeners()},render:function(e,t){if(this.$tbsRecent=$(".C-common-glass-tbs-recentlyviewed"),t&&0<t.length){if(this.$tbsRecent.append('<div class="header">'+this.header+"</div>"),this.$tbsRecent.append('<div class="tbs-recent-items"></div>'),this.$recentItems=$(".tbs-recent-items"),this.renderTbsItem(t),this.opts.isMobile&&"CshpMyTbs"!==this.source){var i=262*t.length;this.$el.css({width:i})}"link"===this.showSeeMoreLink?this.$tbsRecent.append(this.seeMoreLinkTemplate({})):"button"===this.showSeeMoreLink&&this.$tbsRecent.append(this.findYourBookTemplate({})),$(".my-tbs").addClass("has-tbs")}else this.showEmptyMessageIfNoTBS&&(this.opts.isMobile?(this.$el.addClass("no-recent-tbs"),this.$el.html("You have no Textbook Solutions")):this.$el.append(this.noRecentTBSTemplate({elementClass:this.options.getExperimentCSHP?"icon-chegg-solutions_icon":"no-tbs-icon"})));this.setupEventListeners(),Eggshell.find(this).trigger("ready")},renderTbsItem:function(e){for(var t=0;t<e.length;t++){e[t].id=t+1;var i=Eggshell.create("C.common.glass.tbs.recentlyviewed.item",{el:this.$recentItems,options:this.opts});this.source&&i.trigger("set source",this.source),this.coverSize&&i.trigger("set cover size",this.coverSize),i.trigger("render",e[t])}this.opts.isMobile||"CshpMyTbs"!=this.source||($(".bookmarks-list.toggle-bookmark-list").first().removeClass("toggle-bookmark-list"),$(".carret-icn.rotate").first().removeClass("rotate"))},setupEventListeners:function(){$(".C-common-glass-tbs-recentlyviewed-item").on("click",function(e){e.preventDefault(),e.stopPropagation();var t,i=$(e.currentTarget).find("a").attr("href");C.logger.doSessionLog({recently_viewed_tbs_click:1}),C.utility.navigate(i)}),$(".C-common-glass-tbs-recentlyviewed .see-more-link").on("click",function(e){e.preventDefault(),e.stopPropagation();var t,i=$(e.currentTarget).find("a").attr("href");C.logger.doSessionLog({recently_viewed_tbs_see_more_click:1}),C.utility.navigate(i)})},seeMoreLinkTemplate:_.template('<div class="see-more-link" title="See all solutions"><a href="/study/tbs">See all solutions</a></div>'),findYourBookTemplate:_.template('<a data-type="button" class="find-your-book btn-flat-sm" href="#">Find your book</a>'),noRecentTBSTemplate:_.template('<div class="no-recent-tbs-message"><span class="<%= elementClass %>"></span><div class="no-tbs-message">No textbooks added. Use the search box above to access solutions for the problems in your toughest textbooks.</div></div>'),setShowEmptyMessage:function(){this.showEmptyMessageIfNoTBS=!0},setShowSeeMoreLink:function(e,t){this.showSeeMoreLink=t},fireAdobeEvents:function(e,t){t.on("click",function(){C.adobeAnalytics.setData("page",{widget:"[RECENT_TBS]"}),C.adobeAnalytics.track("widget")})}})}()),Eggshell.define("C.common.glass.tbs.recentlyviewed.item",{inputs:{render:{payload:{id:"string",url:"string",title:"string",shortTitle:"string",edition:"string",authors:"string",solutionCount:"string"}}},outputs:{},strict:!1},function(){var e;return Backbone.View.extend({initialize:function(e){this.opts=e.options,Eggshell.find(this).on("set source",this.setSource).on("set cover size",this.setCoverSize).on("render",this.render)},setSource:function(e,t){if(!t||"string"!=typeof t)throw"Invalid source type. Source must be of type string";this.source=t},setCoverSize:function(e,t){if(!t||"string"!=typeof t)throw"Invalid cover size type. Cover size must be of type string";this.coverSize=t},render:function(e,t){var i=t.shortTitle?t.shortTitle:t.title,s=t.authors?this.getMyTbsAuthors(t.authors):[],o=t.editionNo?t.editionNo:t.editionNumber,n=this.toOrdinal(parseInt(o)),a=0,r=[],l=t.editionNo,c="";t.bookmarkedAssets&&(a=t.bookmarkedAssets.length,r=t.bookmarkedAssets),this.opts.renderBookmarks&&!this.opts.isMobile&&"CshpMyTbs"===this.source&&(c=this.cshpMyTbsBookmarkTemplate({count:a,tbsBookmarkInfo:r})),this.$el.html(this.recentTbsTemplate({tbs:{url:this.getTrackUrl(t.url,t.trackid),title:t.title,authors:s,edition:n,shortTitle:i,count:a,isBookmarkedCssClass:0<a?"":"hidden",cshpMyTbsBookmarkMarkup:c,itemId:void 0!==t.destinationId?t.destinationId:null,solutionCount:void 0!==t.solutionCount?t.solutionCount:null}})),this.$el.addClass("tbs-item-"+t.id),this.renderTbsCovers(t),this.addEventListeners()},addEventListeners:function(){this.$el.find(".bookmarks-link-wrapper").on("click",function(e){e.preventDefault(),e.stopPropagation();var t=$(e.currentTarget).parent().parent();t.find(".bookmarks-list").slideToggle(250),t.find(".carret-icn").toggleClass("rotate")}),this.$el.find(".bookmark-problem-link").on("click",function(e){e.preventDefault(),e.stopPropagation();var t=$(e.currentTarget).data("problem-id");C.logger.doSessionLog({bookmark_tbs_clicked:t},function(){window.location.href=$(e.currentTarget).attr("href")})})},renderTbsCovers:function(e){var t=Eggshell.create("C.cs.tbscover",{el:this.$el.find(".left-info")});e.coverImage?t.trigger("set book image",e.coverImage):t.trigger("set book title",e.shortTitle?e.shortTitle:e.title),this.coverSize&&t.trigger("set cover size",this.coverSize),t.trigger("render")},getMyTbsAuthors:function(e){var t,i="",s="";if(this.source&&"CshpMyTbs"===this.source){for(t=0;t<2&&t<e.length;t++)i=i+e[t]+"; ";s='<span class="author-text">Author: </span><span class="author-names">'+(i=i.substring(0,i.length-2))+"</span>"}else s=e[0];return s},toOrdinal:function(e){var t=e%10;return 1==t&&11!==e?e+"st":2==t&&12!==e?e+"nd":3==t&&13!==e?e+"rd":e+"th"},getTrackUrl:function(e,t){return e+"?trackid="+t},events:{mouseenter:"mouseOverItem",mouseleave:"mouseLeaveItem"},mouseOverItem:function(e){e.stopPropagation(),this.$el.addClass("solution-highlight"),this.$el.find(".tbs-solution-count-container").addClass("count-highlight"),this.$el.find(".icon-tbs").addClass("icon-highlight")},mouseLeaveItem:function(e){e.stopPropagation(),this.$el.removeClass("solution-highlight"),this.$el.find(".tbs-solution-count-container").removeClass("count-highlight"),this.$el.find(".icon-tbs").removeClass("icon-highlight")},recentTbsTemplate:_.template('<a href="<%= tbs.url %>"><div class="recent-item" data-itemid="<%= tbs.itemId %>" data-soultioncount="<%= tbs.solutionCount %>" title="<%= tbs.shortTitle %>, <%= tbs.edition %> Edition, Solutions by Chegg"><div class="left-info"></div><div class="right-info"><span class="result-header"><%= tbs.title %></span><span class="result-header short-title"><%= tbs.shortTitle %></span><span class="result-detail result-edition"><%= tbs.edition %> Edition</span><span class="result-detail author-row"><%= tbs.authors %></span><% if (tbs.cshpMyTbsBookmarkMarkup) { %><%= tbs.cshpMyTbsBookmarkMarkup %><% } else { %><div class="result-bookmark-status <%= tbs.isBookmarkedCssClass %>"><span class="icon-bookmark-sm is-static is-saved"></span> <span class="result-bookmark-counter">(<%= tbs.count %>)</span></div><% } %></div></div></a>'),cshpMyTbsBookmarkTemplate:_.template('<% if(count) { %><div class="cshp-my-tbs-bookmarks"><span class="bookmarks-link-wrapper"><span class="icon-bookmark"></span> Bookmarks <span class="count-txt">(<%= count %>)</span> <span class="carret-icn rotate"></span></span><ul class="bookmarks-list toggle-bookmark-list"><% _.each(tbsBookmarkInfo, function(bookmark) { %><a class="bookmark-problem-link" href="<%= bookmark.url %>" data-problem-id="<%= bookmark.problemId %>"><li><span class="bookmark-ch-prob-details">Chapter <%= bookmark.chapterName %> Prob <%= bookmark.problemName %></span> <span class="bookmark-problem-txt"><%= bookmark.text %></span></li></a><% }); %></ul></div><% } %>')})}()),Eggshell.define("C.common.glass.qna.askeditor",{inputs:["render"],outputs:["editor loaded"],singleton:!1},C.View.extend({initialize:function(e){this.opts=$.extend({},e),this.boardSubject=this.opts.boardSubject,this.model=new C.glass.qna.askeditor.model(this.opts),this.setUpListeners()},setUpListeners:function(){this.Eggshell.on("render",this.render)},render:function(){var e;e=this.opts.subjectName?this.opts.subjectName:"Choose a subject",this.$el.html(this._template({subjectBtn:e,questionBody:this.model.getQuestionBody(),hiddenClass:this.model.getHiddenClass(),secondaryAction:this.model.getSecondaryAction(),primaryAction:this.model.getPrimaryAction(),isDisabled:this.model.isBtnDisabled()})),this.doEditor(),this.formatEditor(),this.bindEditorListeners(),Eggshell.find(this.EggshellEditor).on("editor rendered",this.triggerLoaded,this)},doPostQuestionFlow:function(){this.prepareQuestionFormData(),this.displayLoadingSpinner(),this.createQuestion()},events:{"click .select-subj":"handleSubject","click .post-question":"postQuestionClicked","click .back":"navigateBack","click .cancel":"doCancel","change input[name=useRealnameCb]":"askAnon","click .cke_button":"ckeButtonClicked"},_template:_.template('<div class="glass-qna-container"><form name="ask-form" method="post" class="ask-form"><textarea name="glass-ask-editor" class="glass-ask-editor"><%= questionBody %></textarea><div class="ask-anon <%= hiddenClass %>"><input type="checkbox" name="useRealnameCb" id="useRealnameCb"><label class="form-checkbox" for="useRealnameCb">&nbsp;</label> Ask anonymously</div><div class="question-data"><input type="hidden" name="useRealname" class="use-real-name" value="1"><input type="hidden" name="isHighSchoolStudent" value="1"><input type="hidden" name="userValidRealName" value="1"></div></form><div class="subj-wrapper"><a class="btn-flat-sm select-subj" data-type="button"><%= subjectBtn %></a></div><div class="submit-area"><div class="submit-buttons"><a href="#" class="<%=secondaryAction%>"><%=secondaryAction%></a><input type="submit" class="btn-primary-sm post-question" <%= isDisabled %> value="<%=primaryAction%>" /></div></div></div>'),doEditor:function(){this.EggshellEditor=Eggshell.create("C.common.editor",{enableCKEditorNewVersion:this.opts.enableCKEditorNewVersion}).trigger("set container",this.$el.find(".glass-ask-editor")[0]).trigger("set toolbar",this.model.getEditorOptions()).trigger("set height",this.model.getEditorHeight()).trigger("set type","ask").trigger("set resize tooltip flag",!0).trigger("render editor")},triggerLoaded:function(){Eggshell.find(this).trigger("editor loaded")},bindEditorListeners:function(){this.$el.on("click",".cke_button__image_icon",$.proxy(function(e){$(".cke_contents").css("height","230px")},this))},formatEditor:function(){this.opts.fullPage&&$(".subj-wrapper").append('<span class="subj-tagline">(So we can find the right expert)</span>')},handleSubject:function(e){e.preventDefault(),e.stopPropagation(),this.opts.fullPage?($(this.el).off("click",".select-subj"),this.displaySubjList()):(this.EggshellDialog=Eggshell.create("C.Eggshell.dialog").trigger("hide icon").trigger("set headline","Select a subject").trigger("show"),this.EggLoading=Eggshell.create("C.Eggshell.loading.inline",{el:$(".C-Eggshell-dialog:visible .content")}).trigger("render").trigger("show"),this.displaySubjList(),$(".C-Eggshell-dialog .content").after("<div class='contentTutorLink'>Don't see your subject?  <a href='/tutors/' target='_self'>Chegg Tutors</a> can help.</div>")),this.listenToSubjSelection()},displaySubjList:function(){$.ajax({url:"/_ajax/questions/subject/",success:$.proxy(function(e){if(this.opts.fullPage){$(".select-subj").replaceWith('<span class="subj-list-hdr">Choose a subject</span>'),$(".subj-wrapper").addClass("open").append('<div class="subj-list">'+e+"</div>");var t=window.navigator.userAgent;-1===t.indexOf("Firefox")&&-1===t.indexOf("MSIE")&&-1===t.indexOf("Trident")||($(".subj-list").animate({"margin-top":"10px"}),$(".subj-list").animate({opacity:"1"},200))}else this.EggLoading.trigger("hide"),this.EggshellDialog.trigger("set content html",e)},this)})},listenToSubjSelection:function(){var i=function(e){e.stopPropagation(),this.boardSubject=$(e.target).hasClass("selected")?this.model.setSubject(e):"",this.subjectName=this.model.setSubjectName(e),this.togglePostQuestionButton()};this.opts.fullPage?$("body").on("click","a.link-body",$.proxy(function(e){i.call(this,e)},this)):this.EggshellDialog.on("content clicked",$.proxy(function(e,t){$(t.target).is("a.link-body")&&($(".selected").removeClass("selected"),$(".icon-chegg-Check").remove(),$(t.target).hasClass("selected")||$(t.target).addClass("selected"),i.call(this,t),$(".select-subj").html($(t.target).html()),this.EggshellDialog.trigger("hide"))},this)),this.$el.find(".select-subj").removeClass("error")},displaySubjError:function(){this.$el.find(".select-subj").addClass("error")},displayErrorOverEditor:function(e){var t=window.CKEDITOR.instances["glass-ask-editor"],i=this.$el.find(".cke_contents");0===$(".cke-error-message").length&&(i.addClass("cke-error"),i.prepend('<div class="cke-error-message">'+e+"</div>")),$(".cke-error-message").one("click",function(e){i.find(".cke-error-message").remove(),i.removeClass("cke-error"),t.focus()}),t.on("focus",function(e){i.find(".cke-error-message").remove(),i.removeClass("cke-error")})},displayBodyError:function(){this.displayErrorOverEditor("Please provide more details")},displayInvalidImageError:function(e){this.displayErrorOverEditor(e)},askAnon:function(){var e=$(".use-real-name");"0"===e.val()?e.val("1"):e.val("0")},ckeButtonClicked:function(e){e.stopPropagation()},postQuestionClicked:function(e){e.stopPropagation(),e.preventDefault();var t=$(".post-question");if(t.prop("disabled",!0),C.logger.doSessionLog({post_button_click:this.opts.source},null,{logSubscription:1}),void 0===this.boardSubject)this.displaySubjError();else if(void 0===this.getEditorContent())this.displayBodyError();else{t.prop("disabled",!0);var i=$("<div>").html(this.getEditorContent()),s;0<$(i).find("img").length?this.validateImagesThenDoPostQuestion():this.doPostQuestion()}},validateImagesThenDoPostQuestion:function(){var e=this.getEditorContent(),t=$(e).find("img"),i,s=t.length,o=this;t.map(function(){var t=$(this).attr("src");o.validateImage(t).then(function(e){0===(s-=1)&&o.doPostQuestion()},function(e){$(".post-question").prop("disabled",!1),o.displayInvalidImageError("Seems like <strong>"+t+"</strong> is an invalid image path. Please provide a valid one.")})})},doPostQuestion:function(){var e=$("<div>").html(this.getEditorContent());$(".post-question").prop("disabled",!0),$(".post-question-related-answer").html(""),0<this.opts.qnaPostsRemaining||this.opts.askPageMode?"undefined"!=this.opts.isOCRFedSearchOn&&this.opts.isOCRFedSearchOn&&C.global.userId&&1===$(e).find("img").length?(Eggshell.create("C.common.dialog").trigger("hide link").trigger("add class","hang-tight-dialog").trigger("enable default control").trigger("set content html",this.hangTightTemplate()).trigger("hide primary button",!0).trigger("hide secondary button",!0).trigger("hide close button").trigger("disable screen blocker click").trigger("hide icon").trigger("show"),this.sendImageToOCR($(e).find("img").attr("src"))):this.createRelatedQuestionPopUp($(e).text()):Eggshell.create("C.common.purchasequestionsmodal",{questionBody:this.opts.questionBody}).on("question_purchased",this.doPostQuestionFlow,this)},validateImage:function(s){return new Promise(function(e,t){var i=new Image;i.onload=function(){e(s)},i.onerror=function(){t(s)},i.src=s})},hangTightTemplate:_.template('<div class="loader"><div class="C-Eggshell-loading-inline"></div></div><h3 class="heading">Let\'s see if we already have an answer for you</h3><p class="sub-heading">Hang tight. This takes less than a minute.</p>'),createRelatedQuestionPopUp:function(e){1!=this.opts.relatedQuestionDisplayFlag&&"Update"!=$(".post-question").attr("value")?Eggshell.create("C.Eggshell.homeworkhelp.relatedquestions",{el:$(".post-question-related-answer")}).on("related_questions_available",this.displayRelatedAnswerPopUP.bind(this)).on("no_related_questions_found",$.proxy(function(e,t){this.doPostQuestionFlow()},this)).trigger("set query",e).trigger("show ratings",this.opts.showRatingsInRecommendedQuestionsModal).trigger("show more question url",this.opts.showRatingsInRecommendedQuestionsModal).trigger("open answer in new tab",!0).trigger("set entire row clickable",!0).trigger("show question two lines",!0).trigger("render"):this.doPostQuestionFlow()},displayRelatedAnswerPopUP:function(){C.logger.doSessionLog({ask_search_modal:1}),Eggshell.find("C.common.dialog").trigger("hide");var i=Eggshell.create("C.common.dialog").trigger("set headline","Why wait? Your question may already be answered").trigger("hide link").trigger("enable default control").trigger("set primary button","I still want to post a new question").trigger("hide secondary button",!0).trigger("set text below button","<input type='checkbox' id='chk_related_popup_conformation' value='doNotWantRelatedQa' > Don't show this again").trigger("disable screen blocker click").trigger("hide icon").trigger("set content html",$(".post-question-related-answer").html()).on("primary button clicked",$.proxy(function(e,t){C.logger.doSessionLog({ask_search_modal_post:1}),this.doPostQuestionFlow(),i.trigger("hide")},this)).on("close button clicked",function(e){$(".post-question").prop("disabled",!1),C.logger.doSessionLog({ask_search_modal_closed:1}),i.destroy()},this).trigger("show"),e;$("#"+i.getId().replace(".","-")).addClass("related-questions-dialog"),$("<hr>").insertAfter(".related-questions-dialog .related-question"),$(".related-questions-dialog .control .btn-primary").removeClass("btn-lg").addClass("btn-sm"),$(".related-question-view-more").remove().first().insertAfter(".related-questions-dialog .control button.secondary"),$(".related-question-answer-link.firstAns").on("click",function(e){C.logger.doSessionLog({ask_search_modal_result:1})}),$(".related-question-answer-link.secondAns").on("click",function(e){C.logger.doSessionLog({ask_search_modal_result:2})}),$(".related-question-answer-link.thirdAns").on("click",function(e){C.logger.doSessionLog({ask_search_modal_result:3})}),$(".post-question-related-answer").html("")},displayLoadingSpinner:function(){this.$el.find(".post-question").hide(),this.$el.find(".submit-buttons").append('<span class="spinner post-question-spinner"></span>'),Eggshell.create("C.Eggshell.loading.inline",{el:this.$el.find(".spinner")}).trigger("render").trigger("show"),this.$el.find(".submit-area").addClass("adjust-submit-area")},prepareQuestionFormData:function(){this.questionPostData=C.utility.serializeFormToJson($('form[name="ask-form"]')),this.buildQuestionPostData()},createQuestion:function(){$.ajax({type:"POST",dataType:"json",url:"/_ajax/questions/ask",data:$.extend(this.questionPostData,{token:C.global.csrfToken}),context:this,success:this.askQuestionSuccess,error:this.askQuestionError})},buildQuestionPostData:function(){this.model.addAPITokenTo(this.questionPostData),this.subjectName||(this.subjectName=$("#subjectName").val()),this.questionPostData.boardSubject=this.boardSubject,this.questionPostData.askTitle="Question in "+this.subjectName,this.questionPostData.santizedQuestion=this.getEditorContent(),this.questionPostData.askPageMode=this.opts.askPageMode,this.questionPostData.questionId=this.opts.questionId,this.questionPostData.relatedQaFlag=$("#chk_related_popup_conformation").prop("checked"),this.questionPostData.relatedQaFlag&&C.logger.doSessionLog({ask_search_modal_do_not_show:1})},askQuestionSuccess:function(e){if(e.success)C.utility.fireAdobeClickEvent({eventName:"questionPosted",eventValue:e.response.id,eventID:"event62"}),C.logger.doSessionLog({questionPosted:C.global.hasHwhSubscription},function(){window.location.href=e.response.url});else if(411==e)this.displayErrorOverEditor("Question should atleast be 3 characters long"),this.$el.find(".spinner").hide(),this.$el.find(".post-question").show(),this.$el.find(".post-question").prop("disabled",!1);else if(412==e)this.displayErrorDialogWidget("Your question is too long.  Please make sure you're just asking one question and only include the necessary information for the question to be answered.");else if(413==e)0<$("#purchase-questions-modal").parent().length?($("#purchase-questions-modal").parent().css("display","none"),this.displayErrorDialogWidget("You don't have any questions left this subscription period.  Please purchase more questions if you want to ask more questions this period.")):window.location.reload();else if(413==e)0<$("#purchase-questions-modal").parent().length&&($("#purchase-questions-modal").parent().css("display","none"),this.displayErrorDialogWidget("Question balance is 0."));else if(400==e.code){var t="Sorry, we have detected use of an inappropriate word or phrase <strong>"+e.result+"</strong> Please edit and try again";this.displayErrorDialogWidget(t)}},displayErrorDialogWidget:function(e){var t=Eggshell.create("C.common.dialog").trigger("set headline","").trigger("set content html",'<div class="msg-error-sm msg-contextual">'+e+"</div>").trigger("enable default control").trigger("set primary button","OK").trigger("hide close button").trigger("disable screen blocker click").on("primary button clicked",function(){t.trigger("hide"),this.$el.find(".spinner").hide(),this.$el.find(".post-question").show(),this.$el.find(".post-question").prop("disabled",!1)},this)},askQuestionError:function(e){C.utility.refresh()},getEditorContent:function(){if(this.EggshellEditor.trigger("update container"),this.$questionBody=$(".glass-ask-editor"),$.trim(this.$questionBody.val()))return $.trim(this.$questionBody.val())<3?"":this.$questionBody.val()},navigateBack:function(e){e.preventDefault(),this.EggshellEditor.trigger("destroy"),this.$el.empty(),$(".C-common-glass-qna").remove();var t="render";"/study/qa/post"===window.location.pathname&&(t="show component",window.history.pushState("","","/study/qa")),Eggshell.create("C.common.glass.qna",{el:$(".content-area")}).trigger(t,{}),this.Eggshell.destroy()},doCancel:function(){this.EggshellEditor.trigger("destroy"),this.Eggshell.destroy()},sendImageToOCR:function(e){$.ajax({type:"POST",dataType:"json",url:"/_ajax/questions/ocr",data:{actionId:"getHashFromImgURL",imgUrl:e,token:C.global.csrfToken},tryCount:1,retryLimit:3,take:this,success:this.sendImageToOCRSuccess,error:this.sendToOCRError})},sendImageToOCRSuccess:function(e){return("null"==e||null==e)&&this.tryCount<=this.retryLimit?(this.tryCount++,$.ajax(this),!1):this.tryCount>=this.retryLimit?(this.take.postQuestionDirectly(),!0):void(((e||{}).result||{}).id?this.take.sendHashToOCR(e.result.id):this.take.postQuestionDirectly())},sendHashToOCR:function(e){$.ajax({type:"POST",dataType:"json",url:"/_ajax/questions/ocr",data:{actionId:"getTranscribedTextFromHash",hash:e,token:C.global.csrfToken},tryCount:1,retryLimit:60,take:this,success:this.sendHashToOCRSuccess,error:this.sendToOCRError})},sendHashToOCRSuccess:function(e){if("null"==e||null==e||404===e.httpCode){if(this.tryCount++,this.tryCount<=this.retryLimit){var t=this;return setTimeout(function(){$.ajax(t)},1e3),!1}if(this.tryCount>=this.retryLimit)return C.logger.doSessionLog({transcription_timeout:1}),this.take.postQuestionDirectly(),!1}C.logger.doSessionLog({transcription_available:1}),((e||{}).result||{}).text?(C.logger.doSessionLog({transcription_sent_to_search:1}),this.take.createRelatedQuestionPopUp(e.result.text)):this.take.postQuestionDirectly()},postQuestionDirectly:function(){Eggshell.find("C.common.dialog").trigger("hide"),this.doPostQuestionFlow()},sendToOCRError:function(e,t,i){return"timeout"==t&&this.tryCount<=this.retryLimit?(this.tryCount++,$.ajax(this)):this.take.postQuestionDirectly(),!1},togglePostQuestionButton:function(){var t=this;if(void 0!==window.CKEDITOR.instances["glass-ask-editor"]){var i=window.CKEDITOR.instances["glass-ask-editor"];i.on("change",function(){var e=t.getSanitizeQuestion(i.getData());t.checkSubjectAndQuestionBody(e)});var e=t.getEditorContent();e=t.getSanitizeQuestion(e);var s=t.getSanitizeQuestion(e);t.checkSubjectAndQuestionBody(s)}},checkSubjectAndQuestionBody:function(e){void 0!==this.boardSubject&&""!==this.boardSubject&&3<e.length?this.toggleButton(!1):this.toggleButton(!0)},toggleButton:function(e){return $(".post-question").prop("disabled",e)},getSanitizeQuestion:function(e){if(void 0!==e){var t=e.replace(/&nbsp;/g,"");return(t=t.replace(/<(?!img\s*\/?)[^>]+>/g,"")).trim()}}})),C("glass.qna.askeditor"),C.glass.qna.askeditor.model=C.Model.extend({objName:"C.glass.qna.askeditor.model",initialize:function(e){this.opts=$.extend({query:"",questionId:0},e)},getEditorOptions:function(){var e;return["Image","EqnEditor","-","Bold","Italic","Subscript","Superscript","-","Table","-","PasteText","PasteFromWord","Undo","Redo","-"]},getEditorHeight:function(){return this.opts.editorHeight?this.opts.editorHeight:"80px"},getQuestionBody:function(){return this.opts.query},getSecondaryAction:function(){return this.opts.askPageMode?"cancel":"back"},getPrimaryAction:function(){return this.opts.askPageMode?"Update":"Post question"},getHiddenClass:function(){return this.opts.askPageMode?"hidden":""},isBtnDisabled:function(){return this.opts.fullPage?"disabled":""},setSubject:function(e){var t,i;return $(e.target).attr("data-boardid")},setSubjectName:function(e){var t;return $(e.target).html()},addAPITokenTo:function(e){e.token=C.global.csrfToken}}),Eggshell.define("C.common.heartbeat",{inputs:[],outputs:[]},function(){var e;return Backbone.View.extend({initialize:function(){if(this.fibonacci=[0,5,10,30,60,120,240,600,1200,2400,3600],this.firehoseComponent=Eggshell.create("C.search.firehose"),this.next=0,"true"==C.global.heartbeatSwitch&&C.global.heartbeatExp){var e=window.location.href;(-1<e.indexOf("cheggnet.com")||-1<e.indexOf("chegg.com"))&&this.load()}},load:function(){this.heartbeat(this.fibonacci[this.next],$.proxy(function(e){var t=this.getPST(),i=this.getTrackId(),s=this.getStrackId(),o={heartbeatEvent:{heartbeat_event:{timestamp:e,overall_timestamp:t.toString(),page_track_id:C.logger.pageTrackId,url:encodeURI(window.location.href),user_id:C.global.userUuid,uvn:C.utility.getCookie("V"),trackId:i,strackId:s}}};$.ajax({url:C.global.heartbeatURL,type:"POST",dataType:"json",crossDomain:!0,data:JSON.stringify({Record:{Data:o}}),context:this,success:function(e){},error:function(e){},timeout:2e3}),this.next<this.fibonacci.length&&this.load()},this))},heartbeat:function(e,t){function i(){clearTimeout(o),t(e)}var s=0;if(this.prev)var s=e-this.fibonacci[this.prev];this.prev=this.next,this.next++;var o=setTimeout(i,1e3*s)},getPST:function(){d=new Date,utc=d.getTime()+6e4*d.getTimezoneOffset();var e="-8";return nd=new Date(utc+-288e5),nd.toLocaleString("en-US",{hour12:!1})},getTrackId:function(){var e=C.utility.getParams();return e&&e.trackid?encodeURI(e.trackid.substring(0,12)):""},getStrackId:function(){var e=C.utility.getParams();return e&&e.strackid?encodeURI(e.strackid.substring(0,12)):""}})}());